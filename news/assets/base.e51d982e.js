import"./vue.a2f518ee.js";import"./dayjs.49e29cb2.js";import{u as e,a as t}from"./vue-router.907b547c.js";import{a,m as l,M as s}from"./ant-design-vue.db4d48e3.js";import{_ as i,af as o,u as n,p as r,ag as d,ah as c,W as u,ai as p,aj as m,ak as y,al as b,am as f,an as h,ao as v,ap as g}from"./index.7061e8ea.js";import{D as q}from"./index.1cbb3529.js";import{F as k,B as _,a as C}from"./faceSearch.43b839f6.js";import{q as I,w as j,b8 as x,o as D,a as S,c as T,a3 as L,W as U,b as w,O as N,a9 as G,aw as M,aV as V,u as E,R as z,Q as O,y as F,f as K,I as P,a2 as R,aK as Y,M as B,H as A,a7 as H,a1 as W,F as $,n as Q}from"./@vue.919ff404.js";import{E as J}from"./@ant-design.2e172c39.js";import"./@babel.6d5f88cb.js";import"./resize-observer-polyfill.f664b406.js";import"./vue-types.022beab3.js";import"./@ctrl.c020ccd3.js";import"./dom-align.0991ecc5.js";import"./lodash-es.36dcd19c.js";import"./async-validator.267d9719.js";import"./scroll-into-view-if-needed.61c672a4.js";import"./compute-scroll-into-view.17358474.js";/* empty css                    */import"./secure-ls.8c8acb46.js";import"./nprogress.c2257662.js";import"./axios.7aed06b8.js";import"./qs.e55e9b28.js";import"./side-channel.ea627785.js";import"./get-intrinsic.8c87d952.js";import"./has-symbols.caae0f97.js";import"./has-proto.76cff6c7.js";import"./function-bind.cb3858f2.js";import"./has.c1051c46.js";import"./call-bind.208b5ef0.js";import"./object-inspect.e2cfb4a5.js";import"./vuex.f308ecec.js";import"./vuex-persistedstate.fa252374.js";import"./vue-grid-layout.a3ef67ec.js";import"./defal_user.ed3800e6.js";const X={style:{display:"inline-block"}},Z={class:"notice_title"},ee={class:"notice_num"},te={class:"notice_hint"};var ae=i({__name:"noticeCollect",props:{visible:Boolean,id:String,rollType:String},emits:["ok","update:visible"],setup(e,{emit:t}){const s=e,i=a.useForm,n=I({content:""}),r=I({spinning:!1,total:0,visible:!1}),d=I({content:[{required:!0,message:"请输入"},{min:0,max:200,message:"最多只能输入200 个字符"}]}),{resetFields:c,validate:u,validateInfos:p}=i(n,d);j((()=>s.visible),(e=>{r.visible=e,t("update:visible",e)})),j((()=>r.visible),(e=>{t("update:visible",e)}));const m=()=>{r.visible=!0,t("update:visible",!0),o({id:s.id,rollType:s.rollType}).then((e=>{const{content:t,number:a}=e.data;r.total=a||0,n.content=t}))},y=()=>{r.visible=!0,t("update:visible",!1)},b=()=>{0!=r.total?u().then((()=>{t("ok",z(n))})).catch((e=>{})):l.warning("该部门/班级没有采集人员")};return(e,t)=>{const a=x("a-button"),l=x("a-textarea"),s=x("a-form-item"),i=x("a-form"),o=x("exclamation-circle-filled"),d=x("a-modal");return D(),S("div",X,[T(a,{style:{"margin-left":"12px"},onClick:m},{default:L((()=>[U(e.$slots,"default",{},void 0,!0)])),_:3}),T(d,{visible:r.visible,"onUpdate:visible":t[1]||(t[1]=e=>r.visible=e),title:"通知个人采集",onOk:b,onCancel:y,width:"700px"},{default:L((()=>[w("div",Z,[N(" 未采集人脸数量： "),w("span",ee,G(r.total)+"条",1)]),T(i,null,{default:L((()=>[T(s,M(V(E(p).content)),{default:L((()=>[T(l,{value:n.content,"onUpdate:value":t[0]||(t[0]=e=>n.content=e),"show-count":"",maxlength:200,style:{width:"100%"},rows:5},null,8,["value"])])),_:1},16)])),_:1}),w("div",te,[T(o,{class:"notice_hint__icon"}),w("span",null,"发送通知后将提醒"+G(r.total)+"个教职工或家长自行采集人脸信息",1)])])),_:1},8,["visible"])])}}},[["__scopeId","data-v-446518a2"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/basicManagement/faceLibrary/components/noticeCollect.vue"]]);const le={style:{textAlign:"center",marginTop:"16px"}},se={class:"faceLibrary_type__title"},ie={style:{padding:"0 16px 16px 16px"}},oe={key:0,style:{display:"flex"}},ne={key:1,style:{"margin-top":"16px","text-align":"right",flex:"1"}};var re=i({__name:"base",setup(i){const o=e(),U=t(),M=a.useForm,V=n(),X=O(),Z=I({activeId:"",outsidersData:[],outsiders:"1"===U.query.type,groupOptions:[{value:0,label:"本校师生"},{value:1,label:"非本校师生"}],fieldNames:{},treeData:[],defaultExpand:[],selectedKeys:[],placeholder:"请输入学生姓名搜索",title:"loading...",query:{pageNo:2,pageSize:24,total:0},treeSpinning:!1,listSpinning:!0,statusList:[{label:"全部",value:1,count:0},{label:"已采集",value:2,count:0},{label:"未采集",value:3,count:0}],facePageList:[],noticeCollectVisible:!1,batchCollectVisible:!1,customGloupVisible:!1,customGloupIsEdit:!1,customGloupLoading:!1,singleCollect:{userId:""},isTeacherDelpMinimum:!1,multipleUpload:!0,selectUserIds:[],treeData_student:[],treeData_teacher:[],visible:!1,checkedList:[]}),ee=F((()=>{let{type:e,rollType:t,rollValue:a}=Z.query;return a||(a=U.query.rollValue,e=U.query.type),!t&&0!==t||("classes"===a||(!(2!=e||!Z.isTeacherDelpMinimum)||!t&&0!==t))})),te=I({name:null,type:null,startEnd:[]}),re=I({name:[{required:!0,message:"分组名称不能为空"},{min:0,max:20,message:"分组名称不能超过 20 个字符"}],type:[{required:!0,message:"分组类型不能为空"}]}),{resetFields:de,validate:ce,validateInfos:ue}=M(te,re),pe=e=>{_e.addmember(e.map((e=>e.id))),Z.checkedList=[]},me=e=>{_e.addmember(e.map((e=>e.id))),Z.checkedList=[]},ye=(e,t)=>{Z.query.pageNo=e,be()},be=()=>{const e=z(Z.query);Z.listSpinning=!0;const t={...e};c(t).then((e=>{var t;const{list:a,pageNo:l,pageSize:s,total:i}=null==(t=e.data)?void 0:t.page,{countAll:o,count:n}=e.data;Z.statusList[0].count=o||0,Z.statusList[1].count=n||0,Z.statusList[2].count=o-n||0,Z.facePageList=a||[],Z.query.pageNo=l||1,Z.query.pageSize=s||24,Z.query.total=i||0,U.query.deptId&&(Z.selectedKeys=[U.query.deptId])})).catch((()=>{Z.statusList[0].count=0,Z.statusList[1].count=0,Z.statusList[2].count=0,Z.facePageList=[],Z.query.pageNo=1,Z.query.pageSize=24,Z.query.total=0})).finally((()=>{Q((()=>{Z.listSpinning=!1}))}))},fe=(e,t)=>{const{showName:a,name:l,type:s,children:i,rollValue:o}=t;Z.activeId=e,Z.outsiders=!!s,Z.title=a||l,Z.query.id=e,Z.query.rollType=s,Z.query.rollValue=o,Z.selectedKeys=[e],Z.query.pageNo=1,Z.query.pageSize=24,Z.query.total=0,Z.isTeacherDelpMinimum=!(2!=Z.query.type||i.length),be()},he=async(e,t)=>{let a=[];try{switch(e){case 1:a=F((()=>V.state.base.schoolRollTree));break;case 2:a=F((()=>V.state.base.departmentTree));break;case 3:const e=await v();if(a=e.data,e&&e.data.length){const{id:t,title:a,name:l,type:s}=e.data[0];U.query.deptId?(Z.activeId=U.query.deptId,e.data.forEach((e=>{e.id==U.query.deptId&&(Z.selectedKeys=[e.id],Z.outsiders=!!e.type,Z.title=e.title||e.name)}))):(Z.selectedKeys=[t],Z.title=a||l,Z.outsiders=!!s,Z.activeId=t)}}}catch(l){}return Z.treeData=a.value||a,1==e&&(ve.value?Z.defaultExpand=u(z(Z.treeData),ve.value).parentNodeIds:Z.defaultExpand=g(z(Z.treeData)).parentNodeIds),a},ve=F((()=>U.query.deptId)),ge=async()=>{var e,t;Z.treeSpinning=!0;const a={"/basicManagement/faceLibrary/student":{placeholder:"请输入学生姓名搜索",fieldNames:{children:"children",title:"showName",key:"id"},query:{id:"",type:1,status:1,rollType:0,name:"",pageNo:1,pageSize:24,total:0}},"/basicManagement/faceLibrary/teacher":{placeholder:"请输入教职工姓名搜索",fieldNames:{children:"children",title:"name",key:"id"},query:{id:"",type:2,status:1,name:"",pageNo:1,pageSize:24,total:0}},"/basicManagement/faceLibrary/custom":{placeholder:"请输入教职/学生姓名搜索",fieldNames:{children:"children",title:"name",key:"id"},query:{id:"",type:3,status:1,faceType:0,name:"",pageNo:1,pageSize:24,total:0}}}[U.path];Z.placeholder=a.placeholder,Z.query=a.query,Z.fieldNames=a.fieldNames,await he(a.query.type);const l=ve.value||(null==(e=Z.treeData[0])?void 0:e.id);Z.selectedKeys=[l];let s={};if([1,2].includes(a.query.type))s=(null==(t=u(z(Z.treeData||[]),l))?void 0:t.parentNodes[0])||{};else{let e=Z.treeData.findIndex((e=>e.id===l));-1===e&&(e=0),s=Z.treeData[e]||{}}Z.title=(null==s?void 0:s.showName)||(null==s?void 0:s.name),Z.query.id=l,Z.query.rollType=null==s?void 0:s.type,Z.treeData.length?be():Z.listSpinning=!1,Q((()=>{Z.treeSpinning=!1}))};j((()=>{const e=Z.query.type;return 1==e?V.state.base.schoolRollTree:2==e?V.state.base.departmentTree:void 0}),(()=>{ge()})),j((()=>Z.outsiders),(e=>{(e||"1"===U.query.type)&&(async()=>{await d().then((({data:e})=>{Z.outsidersData=[{name:"外部人员",id:"-10000",children:e||[]}]}))})()}),{immediate:!0});const qe=()=>{Z.query.pageNo=1,be()},ke=()=>{Z.query.name="",Z.query.pageNo=1,be()},_e={setStatus(e=!1,t=!0){de(),Z.customGloupIsEdit=e,Z.customGloupVisible=t},create(){_e.setStatus()},edit(e){_e.setStatus(!0),_e.id=e.id;const t=X.value.titleObj[e.id];te.name=t},submit(){let e=["name"];Z.customGloupIsEdit||(e=["name","type"],te.type&&(e=["name","type","startEnd"])),ce(e).then((()=>{Z.customGloupLoading=!0;const{name:e,type:t,startEnd:a}=te,s={id:_e.id,name:e,type:t};t&&(s.startDate=a[0],s.endDate=a[1]),Z.customGloupIsEdit?p(s).then((e=>{_e.setStatus(!1,!1),l.success(e.message),he(Z.query.type)})).finally((()=>{Z.customGloupLoading=!1})):m(s).then((e=>{_e.setStatus(!1,!1),l.success(e.message),he(Z.query.type)})).finally((()=>{Z.customGloupLoading=!1}))}))},remove(e){s.confirm({title:"删除提示",icon:T(J),content:"删除后不可恢复，如需继续删除，请点击确定",okType:"danger",okText:"确定",cancelText:"取消",onOk(){y({id:e.id}).then((t=>{Z.title="loading...",l.success(t.message),e.id==ve.value?(o.push({path:U.path}),ge()):he(Z.query.type)}))},onCancel(){}})},select(e){Z.selectUserIds=e},openAddmember(){},addmember(e){const{id:t,rollType:a,type:s}=Z.query;b({userIds:e,groupId:t,rollType:a,type:s}).then((e=>{l.success(e.message),be()}))},batchDelete(){s.confirm({title:"删除提示",icon:T(J),content:"删除后不可恢复，如需继续删除，请点击确定",okType:"danger",okText:"确定",cancelText:"取消",onOk(){const{id:e,rollType:t,type:a}=Z.query;f({userIds:Z.selectUserIds,groupId:e,rollType:t,type:a}).then((e=>{l.success(e.message),Z.selectUserIds=[],be()}))},onCancel(){}})}},Ce=F((()=>Z.selectUserIds.length>0)),Ie={single(e){Z.singleCollect.userId=e.id,Z.batchCollectVisible=!0,Z.multipleUpload=!1},notice(e){const{id:t,rollType:a,type:s}=Z.query;h({id:t,rollType:a,type:s,content:e}).then((e=>{l.success(e.message),Z.noticeCollectVisible=!1})).catch((e=>{l.error(e.message)}))},changeMultiple(){Z.multipleUpload=!0,Z.singleCollect.userId=""},complete(){be()}};return K((()=>{ge()})),(e,t)=>{const a=x("a-button"),l=x("more-outlined"),s=x("a-menu-item"),i=x("Authorized"),o=x("a-menu"),n=x("a-dropdown"),d=x("plus-outlined"),c=x("a-input"),u=x("a-form-item"),p=x("a-select"),m=x("a-form"),y=x("a-modal"),b=x("a-spin"),f=x("a-col"),h=x("a-row"),v=x("a-pagination"),g=P("auth");return D(),R(h,{type:"flex",class:"faceLibrary_warp_pageitem"},{default:L((()=>[T(f,{class:"demp_tree base"},{default:L((()=>[T(b,{spinning:Z.treeSpinning},{default:L((()=>[T(q,{style:{"min-height":"200px",transition:"all 0.25s"},ref_key:"dempTree",ref:X,treeData:Z.treeData,selectedKeys:Z.selectedKeys,defaultExpand:Z.defaultExpand,fieldNames:Z.fieldNames,onEmitSelect:fe},Y({_:2},[3==Z.query.type?{name:"handleItem",fn:L((({handleItem:e})=>[T(a,{class:"outs-btn",size:"small",type:e.id===Z.activeId?"primary":""},{default:L((()=>[N(G(e.type?"外部":"内部"),1)])),_:2},1032,["type"]),T(n,{trigger:["click"]},{overlay:L((()=>[T(o,null,{default:L((()=>[T(i,{auth:"editCustomGroup"},{default:L((()=>[T(s,{onClick:B((t=>_e.edit(e)),["stop"])},{default:L((()=>[T(a,{type:"text"},{default:L((()=>[N(" 编辑分组 ")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024),T(i,{auth:"removeCustomGroup"},{default:L((()=>[T(s,{onClick:B((t=>_e.remove(e)),["stop"])},{default:L((()=>[T(a,{type:"link",danger:""},{default:L((()=>[N(" 删除分组 ")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),default:L((()=>[A((D(),S("a",{class:"ant-dropdown-link handle_icon",onClick:t[0]||(t[0]=B((()=>{}),["prevent","stop"]))},[T(l)])),[[g,["editCustomGroup","removeCustomGroup"]]])])),_:2},1024)])),key:"0"}:void 0,3===Z.query.type?{name:"handleFooter",fn:L((()=>[A((D(),S("div",le,[T(a,{type:"primary",onClick:_e.create},{icon:L((()=>[T(d)])),default:L((()=>[N(" 添加自定义分组 ")])),_:1},8,["onClick"])])),[[g,"addCustomGroup"]])])),key:"1"}:void 0]),1032,["treeData","selectedKeys","defaultExpand","fieldNames"]),H(" 自定义分组添加、修改 "),T(y,{visible:Z.customGloupVisible,"onUpdate:visible":t[3]||(t[3]=e=>Z.customGloupVisible=e),width:"430px",title:Z.customGloupIsEdit?"编辑分组":"添加分组",okButtonProps:{loading:Z.customGloupLoading},onOk:_e.submit,destroyOnClose:""},{default:L((()=>[T(m,{layout:"vertical"},{default:L((()=>[T(u,W({label:"分组名称："},E(ue).name),{default:L((()=>[T(c,{value:te.name,"onUpdate:value":t[1]||(t[1]=e=>te.name=e),placeholder:"请输入",max:20},null,8,["value"])])),_:1},16),H(" 大学版 "),Z.customGloupIsEdit?H("v-if",!0):(D(),S($,{key:0},[T(u,W({label:"分组类型："},E(ue).type),{default:L((()=>[T(p,{value:te.type,"onUpdate:value":t[2]||(t[2]=e=>te.type=e),options:Z.groupOptions,placeholder:"请选择"},null,8,["value","options"])])),_:1},16),H(' v-if="customGloupFormRef.type" '),H(' <a-form-item\r\n                                label="分组（外部）有限期："\r\n                                v-bind="validateInfos.startEnd"\r\n                                v-if="customGloupFormRef.type"\r\n                            >\r\n                                <a-range-picker\r\n                                    style="width: 100%"\r\n                                    separator="至"\r\n                                    valueFormat="YYYY-MM-DD"\r\n                                    format="YYYY-MM-DD"\r\n                                    :disabled-date="disabledDate"\r\n                                    v-model:value="customGloupFormRef.startEnd"\r\n                                />\r\n                            </a-form-item> ')],64))])),_:1})])),_:1},8,["visible","title","okButtonProps","onOk"])])),_:1},8,["spinning"])])),_:1}),T(f,{style:{flex:"1"}},{default:L((()=>[w("div",se,G(Z.title),1),T(b,{spinning:Z.listSpinning},{default:L((()=>[w("div",ie,[Z.treeData.length?(D(),R(h,{key:0,type:"flex",justify:"space-between"},{default:L((()=>[T(f,null,{default:L((()=>[T(k,{status:Z.query.status,"onUpdate:status":t[4]||(t[4]=e=>Z.query.status=e),name:Z.query.name,"onUpdate:name":t[5]||(t[5]=e=>Z.query.name=e),placeholder:Z.placeholder,onSearch:qe,onReset:ke,data:Z.statusList},null,8,["status","name","placeholder","data"])])),_:1}),T(f,{style:{"margin-bottom":"16px"}},{default:L((()=>[3==Z.query.type?(D(),S("div",oe,[H(" 外部人员 "),H(' <BatchCollect\r\n                                        v-if="state.outsiders"\r\n                                        buttonType="primary"\r\n                                        title="批量添加"\r\n                                        :outsiders="state.outsiders"\r\n                                        :multiple="state.multipleUpload"\r\n                                        :id="state.activeId"\r\n                                        :type="state.query.type"\r\n                                        :userId="state.singleCollect.userId"\r\n                                        v-model:visible="\r\n                                            state.batchCollectVisible\r\n                                        "\r\n                                        @changeMultiple="\r\n                                            handleCollect.changeMultiple\r\n                                        "\r\n                                        @complete="handleCollect.complete"\r\n                                    >\r\n                                        批量添加\r\n                                    </BatchCollect> '),Z.outsiders?A((D(),R(E(r),{key:0,mode:"personnel",tabs:[{tab:"外部人员",key:1,checked:!0}],visible:Z.batchCollectVisible,"onUpdate:visible":t[6]||(t[6]=e=>Z.batchCollectVisible=e),treeData:Z.outsidersData,customInterface:"outsider",checked:Z.checkedList,"onUpdate:checked":t[7]||(t[7]=e=>Z.checkedList=e),onHandleOk:me},{default:L((()=>[T(a,{type:"primary",disabled:!Z.treeData.length||!Z.query.id},{icon:L((()=>[T(d)])),default:L((()=>[N(" 添加成员 ")])),_:1},8,["disabled"])])),_:1},8,["visible","treeData","checked"])),[[g,"addMember"]]):A((D(),R(E(r),{key:1,mode:"personnel",tabs:[{tab:"教职工组",key:1,checked:!0},{tab:"学生组",key:2,checked:!1}],visible:Z.visible,"onUpdate:visible":t[8]||(t[8]=e=>Z.visible=e),checked:Z.checkedList,"onUpdate:checked":t[9]||(t[9]=e=>Z.checkedList=e),onHandleOk:pe},{default:L((()=>[T(a,{type:"primary",disabled:!Z.treeData.length||!Z.query.id},{icon:L((()=>[T(d)])),default:L((()=>[N(" 添加成员 ")])),_:1},8,["disabled"])])),_:1},8,["visible","checked"])),[[g,"addMember"]]),A((D(),R(a,{disabled:!Ce.value,style:{"margin-left":"12px"},onClick:_e.batchDelete,danger:""},{default:L((()=>[N("批量删除")])),_:1},8,["disabled","onClick"])),[[g,"batchRemove"]])])):H("v-if",!0),ee.value?(D(),S($,{key:1},[A((D(),R(_,{title:"批量采集",multiple:Z.multipleUpload,id:Z.query.id,type:Z.query.type,userId:Z.singleCollect.userId,visible:Z.batchCollectVisible,"onUpdate:visible":t[10]||(t[10]=e=>Z.batchCollectVisible=e),onChangeMultiple:Ie.changeMultiple,onComplete:Ie.complete},{default:L((()=>[N("批量采集")])),_:1},8,["multiple","id","type","userId","visible","onChangeMultiple","onComplete"])),[[g,"batchCollection"]]),A((D(),R(ae,{id:Z.query.id,rollType:1==Z.query.type?Z.query.rollType:"",visible:Z.noticeCollectVisible,"onUpdate:visible":t[11]||(t[11]=e=>Z.noticeCollectVisible=e),onOk:Ie.notice},{default:L((()=>[N("通知个人采集 ")])),_:1},8,["id","rollType","visible","onOk"])),[[g,"notifyPersonal"]])],64)):(D(),S($,{key:2},[3!=Z.query.type?A((D(),R(_,{key:0,multiple:Z.multipleUpload,title:"个人采集",id:Z.query.id,type:Z.query.type,userId:Z.singleCollect.userId,visible:Z.batchCollectVisible,"onUpdate:visible":t[12]||(t[12]=e=>Z.batchCollectVisible=e),onComplete:Ie.complete},null,8,["multiple","id","type","userId","visible","onComplete"])),[[g,"batchCollection"]]):H("v-if",!0)],64)),H("  ")])),_:1})])),_:1})):H("v-if",!0),H(" 人脸列表 "),T(C,{onChangeSelect:_e.select,mode:3==Z.query.type?"multiple":"none",data:Z.facePageList,onOpen:Ie.single,style:{"min-height":"500px"},selectUserIds:Z.selectUserIds},null,8,["onChangeSelect","mode","data","onOpen","selectUserIds"]),H(" 分页 "),Z.facePageList.length?(D(),S("div",ne,[T(v,{current:Z.query.pageNo,"onUpdate:current":t[13]||(t[13]=e=>Z.query.pageNo=e),pageSize:Z.query.pageSize,"onUpdate:pageSize":t[14]||(t[14]=e=>Z.query.pageSize=e),"show-quick-jumper":"","show-less-items":"",total:Z.query.total,onChange:ye,"show-total":e=>`共 ${e} 条`,pageSizeOptions:["10","20","24","48","50","60","80"]},null,8,["current","pageSize","total","show-total"])])):H("v-if",!0)])])),_:1},8,["spinning"])])),_:1})])),_:1})}}},[["__scopeId","data-v-5ad7840c"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/basicManagement/faceLibrary/base.vue"]]);export{re as default};
