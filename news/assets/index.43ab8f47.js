import"./vue.a2f518ee.js";import{a as e,m as a,M as t}from"./ant-design-vue.db4d48e3.js";import{_ as s,cf as l,H as o,u as i,cg as n,ch as r,aw as d}from"./index.7061e8ea.js";import{B as u}from"./schoolRoll.370ea454.js";import{e as c,q as p,b8 as m,o as f,a2 as g,a3 as v,c as k,O as _,a1 as w,u as h,a7 as y,a as b,F as j,a8 as I,a9 as x,b as C,Q as N,f as S,b5 as L,b4 as U}from"./@vue.919ff404.js";import{E as z}from"./@ant-design.2e172c39.js";import"./@babel.6d5f88cb.js";import"./resize-observer-polyfill.f664b406.js";import"./vue-types.022beab3.js";import"./@ctrl.c020ccd3.js";import"./dom-align.0991ecc5.js";import"./lodash-es.36dcd19c.js";import"./dayjs.49e29cb2.js";import"./async-validator.267d9719.js";import"./scroll-into-view-if-needed.61c672a4.js";import"./compute-scroll-into-view.17358474.js";/* empty css                    */import"./secure-ls.8c8acb46.js";import"./vue-router.907b547c.js";import"./nprogress.c2257662.js";import"./axios.7aed06b8.js";import"./qs.e55e9b28.js";import"./side-channel.ea627785.js";import"./get-intrinsic.8c87d952.js";import"./has-symbols.caae0f97.js";import"./has-proto.76cff6c7.js";import"./function-bind.cb3858f2.js";import"./has.c1051c46.js";import"./call-bind.208b5ef0.js";import"./object-inspect.e2cfb4a5.js";import"./vuex.f308ecec.js";import"./vuex-persistedstate.fa252374.js";import"./vue-grid-layout.a3ef67ec.js";const F={class:"upload_wap"},W={class:"upload"},D={class:"upload_item__warp"},P={class:"upload_item_image__warp"},q={class:"upload_file__name"},O={title:"单击可以编辑名字"};var E=s(c({__name:"createWork",emits:["emitCreateWork"],setup(t,{expose:s,emit:i}){const n=e.useForm,r=p({loading:!1,actionUrl:"http://192.168.3.158:9528",defaultPercent:!1,visible:!1,multiple:!0,classesId:null,students:[],imageList:[],imageObj:{}}),d=p({studentName:"",classesId:"",studentId:null,workName:null,workDesc:null,isFine:!1,workInfos:[]}),u=e=>new Promise(((a,t)=>{const s=new FileReader;s.readAsDataURL(e),s.onload=()=>a(s.result),s.onerror=e=>t(e)})),c=async e=>{const{size:t,name:s}=e;return t/1024/1024<5?(r.imageList.push({name:s,url:await u(e)}),d.workInfos.push(e)):a.warning("上传图像须小于5MB！"),!1},N=p({workName:[{required:!0,message:"请输入作品名称!",trigger:"change"}],studentId:[{required:!0,message:"请选择学生!",trigger:"change"}]}),{validateInfos:S,resetFields:L,validate:U}=n(d,N),z=()=>{r.visible=!1,r.imageList=[],d.workInfos=[],r.imageObj={},L()},E=()=>{U().then((async e=>{d.workInfos.length>0&&(r.loading=!0,d.workInfos=await new Promise((async(e,a)=>{r.defaultPercent=!0,r.loading=!0;const t=[];for(let s=0;s<d.workInfos.length;s++){const e=d.workInfos[s],a=new FormData;a.append("file",e),await o(a).then((({data:e})=>{e.forEach((e=>{t.push({name:e.name,url:e.url})}))})).finally((()=>{r.defaultPercent=!1}))}e(t)})),d.classesId=r.classesId,r.students.forEach((e=>{e.id===d.studentId&&(d.studentName=e.name)})),l(d).then((e=>{a.success("上传成功！"),z(),i("emitCreateWork")})).finally((()=>{r.loading=!1})))}))};return s({initState:r}),(e,a)=>{const t=m("close-outlined"),s=m("a-input"),l=m("a-form-item"),o=m("a-select-option"),i=m("a-select"),n=m("a-button"),u=m("a-upload"),p=m("a-image"),N=m("close-circle-filled"),L=m("a-col"),U=m("a-row"),R=m("a-spin"),T=m("a-radio"),M=m("a-radio-group"),$=m("a-textarea"),A=m("a-form"),B=m("a-drawer");return r.visible?(f(),g(B,{key:0,visible:r.visible,"onUpdate:visible":a[4]||(a[4]=e=>r.visible=e),title:"上传作品",width:"520",keyboard:!1,closable:!1,maskClosable:!1,"footer-style":{textAlign:"center"},onClose:z},{extra:v((()=>[k(t,{onClick:z})])),footer:v((()=>[k(n,{style:{"margin-right":"8px"},onClick:z},{default:v((()=>[_("取消")])),_:1}),k(n,{type:"primary",loading:r.loading,onClick:E},{default:v((()=>[_("确认")])),_:1},8,["loading"])])),default:v((()=>[k(A,{name:"create-work-form",layout:"vertical",ref:"workFormRef"},{default:v((()=>[k(l,w({label:"作品名称："},h(S).workName),{default:v((()=>[k(s,{value:d.workName,"onUpdate:value":a[0]||(a[0]=e=>d.workName=e),"show-count":"",maxlength:15,placeholder:"请输入"},null,8,["value"])])),_:1},16),k(l,w({label:"选择学生："},h(S).studentId),{default:v((()=>[k(i,{value:d.studentId,"onUpdate:value":a[1]||(a[1]=e=>d.studentId=e),placeholder:"请选择"},{default:v((()=>[y(' <a-select-option value="all">全部</a-select-option> '),(f(!0),b(j,null,I(r.students,((e,a)=>(f(),g(o,{key:a,value:e.id},{default:v((()=>[_(x(e.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1},16),k(l,null,{default:v((()=>[C("div",F,[k(R,{tip:"文件上传中...",spinning:r.defaultPercent},{default:v((()=>[C("div",W,[k(u,{showUploadList:!1,fileList:d.workInfos,multiple:r.multiple,"before-upload":c,action:r.actionUrl+"/cloud/file/upload",class:"upload_comp",accept:"image/png, image/jpg, image/jpeg"},{default:v((()=>[y(' @change="handleChange" '),k(n,{type:"primary",ghost:""},{default:v((()=>[_("选择照片")])),_:1})])),_:1},8,["fileList","multiple","action"])]),y(" 已上传图片 "),k(U,{gutter:[16,16],class:"upload_list"},{default:v((()=>[(f(!0),b(j,null,I(r.imageList,((e,a)=>(f(),g(L,{span:6,key:a},{default:v((()=>[C("div",D,[C("div",P,[k(p,{class:"upload_item_image",preview:!1,width:"86px",height:"86px",src:e.url},null,8,["src"]),y(" remove "),k(N,{class:"upload_item__remove",title:"删除",onClick:e=>(e=>{r.imageList.splice(e,1),d.workInfos.splice(e,1)})(a)},null,8,["onClick"])]),y(" inpurt "),C("div",q,[C("span",O,x(e.name),1)])])])),_:2},1024)))),128))])),_:1})])),_:1},8,["spinning"])])])),_:1}),k(l,{label:"作品标识：",class:"work-logo",rules:[{required:!0}]},{default:v((()=>[k(M,{value:d.isFine,"onUpdate:value":a[2]||(a[2]=e=>d.isFine=e)},{default:v((()=>[k(T,{value:!1},{default:v((()=>[_("不标识")])),_:1}),k(T,{value:!0},{default:v((()=>[_("优秀")])),_:1})])),_:1},8,["value"])])),_:1}),k(l,{label:"作品简介："},{default:v((()=>[k($,{showCount:"",maxlength:50,value:d.workDesc,"onUpdate:value":a[3]||(a[3]=e=>d.workDesc=e),placeholder:"请输入作品简介"},null,8,["value"])])),_:1})])),_:1},512)])),_:1},8,["visible"])):y("v-if",!0)}}}),[["__scopeId","data-v-ec831e70"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/appModel/studentWorks/createWork.vue"]]);const R=e=>(L("data-v-d89f83f2"),e=e(),U(),e),T={class:"layout-header-radius"},M=R((()=>C("i",{class:"iconfont icon-xingzhuangjiehe19"},null,-1))),$=R((()=>C("div",{style:{"margin-top":"8px"}},"上传作品",-1))),A={class:"works-item"},B={class:"works-item-more"},H=["onClick"],Q=R((()=>C("div",{class:"works-black"},null,-1))),V={class:"item-footer"},G={class:"item-name"},J={class:"color-grey"},K={class:"item-itme color-grey"},X={key:0,style:{margin:"auto",width:"180px"}},Y=R((()=>C("p",{style:{width:"180px","text-align":"center"}}," 暂无数据 ",-1)));var Z=s({__name:"index",setup(e){const s=i(),{roll_status_yes_id:l}=s.state.selectSource.dictionary,o=N(),c=p({classes:[],students:[],studentworksList:[]}),w=p({classesId:null,studentId:"",pageNo:1,pageSize:10,total:0}),L=(e,a)=>{w.pageNo=e,w.pageSize=a,W()},U=()=>{o.value.initState.visible=!0,o.value.initState.classesId=w.classesId,o.value.initState.students=c.students},F=()=>{w.pageNo=1,w.pageSize=10,W()},W=()=>{r(w).then((e=>{const{list:a,pageNo:t,pageSize:s,total:l}=e.data;w.pageNo=t,w.pageSize=s,w.total=l,c.studentworksList=a}))},D=e=>{const{classesId:a}=w;u({id:a,pageNo:1,pageSize:100,statusList:l,type:e}).then((e=>{const{studentPageListVO:a}=e.data;c.students=a.list}))},P=e=>{const a=[];c.classes.forEach((t=>{e===t.classesId&&a.push(t.rollType)})),D(a[0]||4)};return S((()=>{d({code:"studentWorks"}).then((e=>{var a;const{data:t}=e;w.classesId=t.length?t[0].classesId:"",c.classes=t,t.length&&(D((null==(a=t[0])?void 0:a.rollType)||4),W())}))})),(e,s)=>{const l=m("a-layout-header"),i=m("a-select-option"),r=m("a-select"),d=m("a-form-item"),u=m("SearchOutlined"),p=m("a-button"),N=m("a-form"),S=m("a-layout-content"),D=m("plus-outlined"),q=m("a-col"),O=m("a-image"),R=m("a-image-preview-group"),Z=m("a-row"),ee=m("a-empty"),ae=m("a-pagination"),te=m("a-layout");return f(),b("div",T,[k(te,{class:"yd-layout layout-header-radius"},{default:v((()=>[k(l,{class:"yd-layout-header"},{default:v((()=>[C("span",{onClick:s[0]||(s[0]=a=>e.$router.back())},[M,y(' <arrow-left-outlined class="left-outlined" /> '),_(" 返回 ")])])),_:1}),k(te,{class:"student-works-layout-content"},{default:v((()=>[k(S,{class:"layout-content-form"},{default:v((()=>[k(N,{name:"student_works_controls",layout:"inline"},{default:v((()=>[k(d,{label:"班级："},{default:v((()=>[k(r,{value:w.classesId,"onUpdate:value":s[1]||(s[1]=e=>w.classesId=e),onChange:P,placeholder:"请选择班级"},{default:v((()=>[(f(!0),b(j,null,I(c.classes,((e,a)=>(f(),g(i,{key:a,value:e.classesId},{default:v((()=>[_(x(e.classesName),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),k(d,{label:"学生："},{default:v((()=>[k(r,{value:w.studentId,"onUpdate:value":s[2]||(s[2]=e=>w.studentId=e),placeholder:"请选择学生"},{default:v((()=>[k(i,{value:""},{default:v((()=>[_("全部")])),_:1}),(f(!0),b(j,null,I(c.students,((e,a)=>(f(),g(i,{key:a,value:e.id},{default:v((()=>[_(x(e.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),k(d,null,{default:v((()=>[k(p,{type:"primary",style:{margin:"0 20px"},onClick:F},{icon:v((()=>[k(u,{style:{"margin-right":"15px"}})])),default:v((()=>[_(" 查询 ")])),_:1})])),_:1})])),_:1})])),_:1}),k(S,{class:"layout-content-list"},{default:v((()=>[k(Z,{justify:"start",align:"top",gutter:[24,16]},{default:v((()=>[k(q,{xs:8,md:6,lg:4,xl:4},{default:v((()=>[C("div",{class:"student-works-add",onClick:U},[k(D),$])])),_:1}),(f(!0),b(j,null,I(c.studentworksList,(e=>(f(),g(q,{xs:8,md:6,lg:4,xl:4,key:e.id},{default:v((()=>[C("div",A,[C("div",B,[k(R,null,{default:v((()=>[(f(!0),b(j,null,I(e.workinfos,(e=>(f(),g(O,{key:e.id,src:e.url},null,8,["src"])))),128))])),_:2},1024)]),k(O,{class:"works-item-img",preview:!1,height:168,width:"100%",src:e.workinfos[0].url},null,8,["src"]),C("div",{class:"works-item-delete",onClick:s=>(e=>{const{workName:s,id:l}=e;t.confirm({title:"删除提示",icon:k(z),content:`确定删除【${s}】？`,okText:"确认",cancelText:"取消",onCancel(){},onOk(){n({id:l}).then((e=>{W(),a.success("删除成功！")}))}})})(e)},null,8,H),Q,C("div",V,[C("div",G,[C("span",null,x(e.workName),1),C("span",J,x(e.studentName),1)]),C("div",K,x(e.createTime),1)])])])),_:2},1024)))),128)),y(' <div v-if="formState.studentworksList.length <= 0">\r\n                        暂无数据\r\n                    </div> ')])),_:1}),c.studentworksList.length<=0?(f(),b("div",X,[k(ee,{image:"/image/empty.png","image-style":{height:"180px",width:"180px"}},{description:v((()=>[Y])),_:1})])):y("v-if",!0),w.total>5?(f(),g(ae,{key:1,class:"studentworks-pagination","show-quick-jumper":"",showSizeChanger:"",current:w.pageNo,"onUpdate:current":s[3]||(s[3]=e=>w.pageNo=e),pageSize:w.pageSize,total:w.total,"show-total":e=>`共 ${e} 条`,onChange:L},null,8,["current","pageSize","total","show-total"])):y("v-if",!0)])),_:1})])),_:1})])),_:1}),k(h(E),{ref_key:"createWorkRef",ref:o,onEmitCreateWork:W},null,512)])}}},[["__scopeId","data-v-d89f83f2"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/appModel/studentWorks/index.vue"]]);export{Z as default};
