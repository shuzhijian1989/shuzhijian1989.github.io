import"./vue.a2f518ee.js";import{m as e,M as a}from"./ant-design-vue.db4d48e3.js";import{_ as t}from"./index.272083a4.js";import{s as i,n,_ as s,p as l}from"./index.7061e8ea.js";import{a as o,u as d}from"./vue-router.907b547c.js";import{q as r,w as c,b8 as p,o as u,a2 as m,a3 as g,c as f,O as v,a7 as h,u as y,a as b,F as w,b as k,b5 as S,b4 as L,f as T,aK as _,a9 as j,n as C,a8 as O,a5 as x,R as I,y as M,r as A,h as D}from"./@vue.919ff404.js";import{E as F}from"./@ant-design.2e172c39.js";import"./@babel.6d5f88cb.js";import"./resize-observer-polyfill.f664b406.js";import"./vue-types.022beab3.js";import"./@ctrl.c020ccd3.js";import"./dom-align.0991ecc5.js";import"./lodash-es.36dcd19c.js";import"./dayjs.49e29cb2.js";import"./async-validator.267d9719.js";import"./scroll-into-view-if-needed.61c672a4.js";import"./compute-scroll-into-view.17358474.js";/* empty css                    */import"./secure-ls.8c8acb46.js";import"./nprogress.c2257662.js";import"./axios.7aed06b8.js";import"./qs.e55e9b28.js";import"./side-channel.ea627785.js";import"./get-intrinsic.8c87d952.js";import"./has-symbols.caae0f97.js";import"./has-proto.76cff6c7.js";import"./function-bind.cb3858f2.js";import"./has.c1051c46.js";import"./call-bind.208b5ef0.js";import"./object-inspect.e2cfb4a5.js";import"./vuex.f308ecec.js";import"./vuex-persistedstate.fa252374.js";import"./vue-grid-layout.a3ef67ec.js";const N=[100,200,300,400,500,600,700,800,900,1e3,2e3,3e3].map((e=>({value:e,label:`${e}米`}))),G=[{name:"地点打卡",flag:"addressSign"},{name:"Wi-Fi打卡",flag:"wifiSign"},{name:"蓝牙打卡",flag:"bluetoothSign"},{name:"设备打卡(指定设备打卡)",flag:"deviceSign"}],W={address:"添加考勤地址",wifi:"添加WI-FI地址",equipment:"绑定设备"};const R=e=>(S("data-v-646b5c06"),e=e(),L(),e),U=R((()=>k("p",{class:"remark"},"备注：以上方式满足一项，考勤组成员即可完成考勤",-1))),z=["onClick"],q=R((()=>k("p",{class:"remark"},"备注：可添加多个地点",-1))),V=["onClick"],E=R((()=>k("p",{class:"remark"},"备注：可添加多个WI-FI地址",-1))),P={key:0},H={key:1},$={key:2},B=["onClick"],J=R((()=>k("p",{class:"remark"},"备注：可绑定多个设备",-1))),K={class:"footer"};var Q=s({__name:"SignDrawer",props:{visible:Boolean,signWay:Object,signList:Object},emits:["openModal","update:visible","confirm"],setup(a,{emit:i}){const n=a,s=r({visible:!1}),l=[{title:"Wi-Fi名称",dataIndex:"wifiName"},{title:"Mac地址",dataIndex:"wifiMac"},{title:"操作",dataIndex:"operation"}],o=[{title:"设备唯一识别码",dataIndex:"deviceId"},{title:"打卡方式",dataIndex:"way"},{title:"操作",dataIndex:"operation"}],d=[{title:"考勤地址",dataIndex:"addressName"},{title:"有效范围",dataIndex:"effectiveRange"},{title:"操作",dataIndex:"operation"}],S=(e,a)=>{switch(a){case"equipment":n.signList.deviceList.splice(e,1);break;case"wifi":n.signList.wifiList.splice(e,1);break;case"address":n.signList.addressList.splice(e,1)}},L=()=>{n.signWay.addressSign||n.signWay.wifiSign||n.signWay.bluetoothSign||n.signWay.deviceSign?n.signWay.addressSign&&0===n.signList.addressList.length?e.error("至少添加一个考勤地址"):n.signWay.wifiSign&&0===n.signList.wifiList.length?e.error("至少添加一个wifi"):n.signWay.deviceSign&&0===n.signList.deviceList.length?e.error("至少添加一个指定设备"):(i("confirm",{signList:n.signList,signWay:n.signWay}),_()):e.error("至少选择一种打卡方式")},T=e=>{i("openModal",e)},_=()=>{i("update:visible",!1)};return c((()=>n.visible),(e=>{s.visible=e})),(e,i)=>{const n=p("a-checkbox"),r=p("a-row"),c=p("a-col"),j=p("a-form-item"),C=p("a-select"),O=p("plus-outlined"),x=p("a-button"),I=p("a-form"),M=p("a-drawer");return u(),m(M,{width:"500",visible:s.visible,"onUpdate:visible":i[6]||(i[6]=e=>s.visible=e),title:"打卡范围设置",maskClosable:!1,onClose:_,zIndex:500},{default:g((()=>[f(I,{layout:"vertical",class:"form"},{default:g((()=>[f(j,{label:"打卡方式："},{default:g((()=>[f(c,{class:"mb20"},{default:g((()=>[f(r,null,{default:g((()=>[f(n,{checked:a.signWay.addressSign,"onUpdate:checked":i[0]||(i[0]=e=>a.signWay.addressSign=e)},{default:g((()=>[v("地点打卡")])),_:1},8,["checked"])])),_:1})])),_:1}),f(c,{class:"mb20"},{default:g((()=>[f(r,null,{default:g((()=>[f(n,{checked:a.signWay.wifiSign,"onUpdate:checked":i[1]||(i[1]=e=>a.signWay.wifiSign=e)},{default:g((()=>[v("Wi-Fi打卡")])),_:1},8,["checked"])])),_:1})])),_:1}),h(' <a-col>\r\n                    <a-row>\r\n                        <a-checkbox v-model:checked="signWay.bluetoothSign">蓝牙打卡</a-checkbox>\r\n                    </a-row>\r\n                </a-col> '),f(c,{class:"mb20"},{default:g((()=>[f(r,null,{default:g((()=>[f(n,{checked:a.signWay.deviceSign,"onUpdate:checked":i[2]||(i[2]=e=>a.signWay.deviceSign=e)},{default:g((()=>[v("设备打卡(指定设备打卡)")])),_:1},8,["checked"])])),_:1})])),_:1}),U])),_:1}),f(j,{label:"地点："},{default:g((()=>[a.signList.addressList.length>0?(u(),m(t,{key:0,columns:d,rowSelection:!1,dataSource:a.signList.addressList},{bodyCell:g((({column:e,record:a,index:t})=>["effectiveRange"===e.dataIndex?(u(),m(C,{key:0,ref:"select",value:a.effectiveRange,"onUpdate:value":e=>a.effectiveRange=e,options:y(N)},null,8,["value","onUpdate:value","options"])):h("v-if",!0),"operation"===e.dataIndex?(u(),b("a",{key:1,style:{color:"var(--error-color)"},onClick:e=>S(t,"address")},"删除",8,z)):h("v-if",!0)])),_:1},8,["dataSource"])):h("v-if",!0),f(x,{type:"primary",class:"btn",onClick:i[3]||(i[3]=e=>T("address"))},{icon:g((()=>[f(O)])),default:g((()=>[v(" 添加地点 ")])),_:1}),q])),_:1}),f(j,{label:"WI-FI地址："},{default:g((()=>[a.signList.wifiList.length>0?(u(),m(t,{key:0,columns:l,rowSelection:!1,dataSource:a.signList.wifiList},{bodyCell:g((({column:e,index:a})=>["operation"===e.dataIndex?(u(),b("a",{key:0,style:{color:"var(--error-color)"},onClick:e=>S(a,"wifi")},"删除",8,V)):h("v-if",!0)])),_:1},8,["dataSource"])):h("v-if",!0),f(x,{type:"primary",class:"btn",onClick:i[4]||(i[4]=e=>T("wifi"))},{icon:g((()=>[f(O)])),default:g((()=>[v(" 添加Wi-Fi地址 ")])),_:1}),E])),_:1}),f(j,{label:"绑定设备："},{default:g((()=>[a.signList.deviceList.length>0?(u(),m(t,{key:0,columns:o,rowSelection:!1,dataSource:a.signList.deviceList},{bodyCell:g((({column:e,record:a,index:t})=>["way"===e.dataIndex?(u(),b(w,{key:0},[a.card?(u(),b("span",P,"刷卡")):h("v-if",!0),a.card&&a.face?(u(),b("span",H,"，")):h("v-if",!0),a.face?(u(),b("span",$,"人脸")):h("v-if",!0)],64)):h("v-if",!0),"operation"===e.dataIndex?(u(),b("a",{key:1,style:{color:"var(--error-color)"},onClick:e=>S(t,"equipment")},"删除",8,B)):h("v-if",!0)])),_:1},8,["dataSource"])):h("v-if",!0),f(x,{type:"primary",class:"btn",onClick:i[5]||(i[5]=e=>T("equipment"))},{icon:g((()=>[f(O)])),default:g((()=>[v(" 绑定设备 ")])),_:1}),J])),_:1})])),_:1}),k("div",K,[f(x,{style:{marginRight:"8px"},onClick:_},{default:g((()=>[v(" 取消 ")])),_:1}),f(x,{type:"primary",onClick:L},{default:g((()=>[v(" 确认 ")])),_:1})])])),_:1},8,["visible"])}}},[["__scopeId","data-v-646b5c06"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/appModel/teacherAttendance/attendanceGroup/components/SignDrawer.vue"]]);const X=["innerHTML"],Y=["innerHTML"],Z={class:"nowarp"},ee={class:"nowarp"};var ae=s({__name:"groupModal",props:{visible:Boolean},emits:["handleClose","update:visible","handerSelectedArry","buildOk"],setup(e,{emit:a}){const s=e,l=r({visible:!1,typeTimeList:[],selectAttendance:[],attendanceType:{schedulingName:"未设置",schedulingDate:"未设置",schedulingTime:"未设置",schedulingTimeRange:"未设置",necessarySignDate:"未设置",unnecessarySignDate:"未设置"},pagination:{pageNo:1,pageSize:10,total:0}}),o=[{title:"考勤排班名称",dataIndex:"schedulingName",width:160},{title:"考勤时间",dataIndex:"schedulingTimeStr"},{title:"特殊日期排班设置",dataIndex:"scheduling"}],d=e=>{a("selectAttendance",e),l.selectAttendance=e},y=()=>{l.attendanceType=l.typeTimeList.filter((e=>e.id===l.selectAttendance[0]))[0],a("buildOk",{attendanceType:l.attendanceType,schedulingId:l.selectAttendance}),L()},S=()=>{(function(e){return i({url:n.schoolAttendanceScheduling,method:"post",data:e})})({pageNo:l.pagination.pageNo,pageSize:l.pagination.pageSize}).then((e=>{const{list:a,total:t}=e.data;l.typeTimeList=a,a.forEach((e=>{e.schedulingTimeStr=`<p>考勤日期：${e.schedulingDate}</p><p>考勤时间：${e.schedulingTime}</p><p>打卡时间范围限制：${e.schedulingTimeRange}</p>`,e.scheduling=`<p>必须打卡的日期：${e.necessarySignDate.join("；")}</p><p>不用打卡的日期：${e.unnecessarySignDate.join("；")}</p>`})),l.pagination.total=t}))},L=()=>{a("update:visible",!1)},C=e=>{const{current:a,pageSize:t}=e;l.pagination.pageNo=a,l.pagination.pageSize=t,S()};return c((()=>s.visible),(e=>{l.visible=e})),T((()=>{S()})),(e,a)=>{const i=p("a-button"),n=p("a-tooltip"),s=p("a-modal");return u(),m(s,{maskClosable:!1,visible:l.visible,"onUpdate:visible":a[0]||(a[0]=e=>l.visible=e),title:"考勤类型与时间设置",onOk:y,width:"1300px",onCancel:L,bodyStyle:{height:"605px",overflow:"scroll"}},{footer:g((()=>[f(i,{key:"back",onClick:L},{default:g((()=>[v("取消")])),_:1}),f(i,{key:"submit",type:"primary",disabled:0===l.selectAttendance.length,onClick:y},{default:g((()=>[v("确定")])),_:1},8,["disabled"])])),default:g((()=>[f(t,{style:{width:"100%"},columns:o,dataSource:l.typeTimeList,slots:["operation"],rowSelection:!0,totals:l.pagination,checkType:"radio",onOnSelectedArry:d,onOnSelectedRowKeys:C},{bodyCell:g((({column:e,text:a,record:t})=>["schedulingTimeStr"===e.dataIndex?(u(),m(n,{key:0,placement:"topLeft",overlayClassName:"min"},_({default:g((()=>[k("p",null,"考勤日期："+j(t.schedulingDate),1),k("p",null,"考勤时间："+j(t.schedulingTime),1),k("p",null,"打卡时间范围限制："+j(t.schedulingTimeRange),1)])),_:2},[(null==a?void 0:a.length)>15?{name:"title",fn:g((()=>[k("div",{innerHTML:a},null,8,X)])),key:"0"}:void 0]),1024)):h("v-if",!0),"scheduling"===e.dataIndex?(u(),b(w,{key:1},[(null==a?void 0:a.length)>15?(u(),m(n,{key:0,placement:"topLeft",overlayClassName:"min"},{title:g((()=>[k("div",{innerHTML:a},null,8,Y)])),default:g((()=>[k("div",Z,"必须打卡的日期："+j(t.necessarySignDate.join("；")),1),k("div",ee,"不用打卡的日期："+j(t.unnecessarySignDate.join("；")),1)])),_:2},1024)):h("v-if",!0)],64)):h("v-if",!0)])),_:1},8,["dataSource","totals"])])),_:1},8,["visible"])}}},[["__scopeId","data-v-6e54e03d"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/appModel/teacherAttendance/attendanceGroup/components/groupModal.vue"]]);const te={class:"header"},ie={style:{"font-size":"12px",color:"#333"}};var ne=s({__name:"index",props:{options:{type:Object,default:()=>({id:"__myMap",locationType:0,zoom:16,longitude:0,latitude:0,address:"",viewMode:"3D",pitch:30,showOverView:!0,showToolBar:!0,showMapType:!0,showGeolocation:!0,positionIcon:"https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png",style:{padding:0,height:"380px",width:"740px",margin:"0px auto 0 auto"}})}},emits:["getAddress"],setup(e,{emit:a}){const t=e,i=r({key:"41a32b85bc37cf2fe1b0ed049874f5ce",map:null,marker:null,circle:null,rangeList:[100,200,300,400,500,600,700,800,900,1e3,2e3,3e3],currentRange:300,currentAddress:{},searchValue:null,searchResult:[]});function n(e){i.currentRange=e,i.marker&&(o(),i.map.setFitView(),a("getAddress",{address:i.currentAddress,range:i.currentRange}))}async function s(e){i.searchValue=e;const a=new AMap.PlaceSearch({city:"全国"}),t=await d(a,e);i.searchResult=t}function l(e){i.currentAddress=i.searchResult.find((a=>a.id==e)),i.currentAddress&&(!function(){const{lng:e,lat:a}=i.currentAddress.location;i.marker&&i.map.remove(i.marker),i.marker=new window.AMap.Marker({icon:t.options.positionIcon,position:[e,a]}),i.map.add(i.marker)}(),o(),i.map.setFitView(),a("getAddress",{address:i.currentAddress,range:i.currentRange}))}function o(){var e;const{lng:a,lat:t}=null==(e=i.currentAddress)?void 0:e.location;i.circle&&i.map.remove(i.circle),i.circle=new window.AMap.Circle({center:[a,t],radius:i.currentRange,strokeColor:"#00b781",strokeOpacity:.7,strokeWeight:2,fillColor:"#1791fc",fillOpacity:.5}),i.map.add(i.circle)}function d(e,a){return new Promise(((t,i)=>{e.search(a,((e,a)=>{if("OK"===a.info){const e=a.poiList.pois;t(e)}else i()}))}))}return T((()=>{window._AMapSecurityConfig={serviceHost:"https://cloud.yyide.com/_AMapService/api"},C((()=>{!function(){const{id:e,viewMode:a,zoom:n,pitch:s,positionIcon:l,showOverView:o,showToolBar:r,showMapType:c,showGeolocation:p,showScale:u,longitude:m,latitude:g,address:f,locationType:v}=I(t.options);window.onmaploaded=()=>{const t={zoom:n,zooms:[3,18],pitch:s,viewMode:a,resizeEnable:!0,lang:"zh_cn"},l=new window.AMap.Map(e,t);i.map=l,AMap.plugin(["AMap.ToolBar","AMap.Scale","AMap.HawkEye","AMap.MapType","AMap.Geolocation","AMap.AutoComplete","AMap.PlaceSearch","AMap.Circle"],(async()=>{if(u&&l.addControl(new AMap.Scale),r&&l.addControl(new AMap.ToolBar({position:{top:"130px",right:"20px"}})),o&&l.addControl(new AMap.HawkEye({isOpen:!0})),c&&l.addControl(new AMap.MapType),p&&l.addControl(new AMap.Geolocation),0==v&&f&&f){const e=new AMap.PlaceSearch({city:"全国"});await d(e,f)}0==v&&f&&l.setFitView(),m&&g&&l.setFitView()}))};const h=`https://webapi.amap.com/maps?v=2.0&key=${i.key}&callback=onmaploaded`,y=document.createElement("script");y.charset="utf-8",y.src=h,document.head.appendChild(y)}()}))})),(a,t)=>{const o=p("a-select"),d=p("a-select-option");return u(),b("div",null,[k("div",te,[f(o,{style:{width:"50%"},value:i.searchValue,"onUpdate:value":t[0]||(t[0]=e=>i.searchValue=e),"show-search":"",placeholder:"请输入地址搜索","default-active-first-option":!1,"show-arrow":!1,"filter-option":!1,"not-found-content":null,options:i.searchResult,onSearch:s,onChange:l,"field-names":{label:"name",value:"id"}},{option:g((({label:e,name:a,address:t})=>[v(j(a)+" ",1),k("span",ie,"- "+j(t),1)])),_:1},8,["value","options"]),f(o,{value:i.currentRange,"onUpdate:value":t[1]||(t[1]=e=>i.currentRange=e),style:{"margin-left":"12px",width:"30%"},onChange:n},{default:g((()=>[(u(!0),b(w,null,O(i.rangeList,((e,a)=>(u(),m(d,{value:e,key:a},{default:g((()=>[v(j(e)+"米",1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])]),k("div",{id:"__myMap",style:x({width:e.options.style.width,height:e.options.style.height}),class:"map"},null,4)])}}},[["__scopeId","data-v-6ba0ce93"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/components/MyMap/index.vue"]]);function se(){return{drawer:r({signWay:{addressSign:!1,wifiSign:!1,bluetoothSign:!1,deviceSign:!1},attendanceGroupSignCreateObj:{addressSign:!1,wifiSign:!1,bluetoothSign:!1,deviceSign:!1,signInOutSide:!0,signByFace:!1,addressList:[],wifiList:[],deviceList:[]},mapOptions:{id:"map",locationType:0,zoom:16,longitude:113.853495,latitude:22.606643,address:"",viewMode:"3D",pitch:30,positionIcon:"https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png",style:{padding:0,height:438}}}),mapData:M((()=>(e,a)=>e.length&&""!==a?e.map((e=>e[a])).join("；"):e.length&&""===a?e.join("；"):"未设置"))}}var le=s({__name:"wifiModal",props:{visible:Boolean,modalTitle:String,signList:Object},emits:["handleClose","update:visible"],setup(a,{emit:t}){const s=a,{drawer:l}=se(),o=A(),d={wifiName:[{required:!0,message:"请输入Wi-Fi名称"}]},k=(e,a)=>a?/^[^\u4e00-\u9fa5]+$/.test(a)?/\s/g.test(a)?Promise.reject(new Error("mac地址中不能含有空格")):Promise.resolve():Promise.reject(new Error("mac地址中不能含有中文")):Promise.reject(new Error("mac地址不能为空")),S=r({address:"",wifiObj:{wifiName:"",wifiMac:""},deviceObj:{deviceId:"",card:!0,face:!1},addressObj:{effectiveRange:null},visible:!1,attendanceDeviceList:[]}),L=e=>{var a;const{lng:t,lat:i}=null==(a=e.address)?void 0:a.location;l.mapOptions.address=e.address.name,S.addressObj.effectiveRange=e.range,l.mapOptions.longitude=t,l.mapOptions.latitude=i},_=()=>{t("update:visible",!1)},C=()=>{i({url:n.getAttendanceDevice,method:"get"}).then((e=>{S.attendanceDeviceList=e.data}))},x=a=>{if(a.length>=10)return e.error("最多添加十个"),!0},I=(a,t,i)=>{for(let n=0;n<a.length;n++){if(a[n][t]===i)return e.error("已经存在请不要重复添加"),!0}};return c((()=>s.visible),(e=>{S.visible=e})),T((()=>{C()})),(t,i)=>{const n=p("a-button"),r=p("a-input"),c=p("a-form-item"),T=p("a-form"),C=p("a-select-option"),M=p("a-select"),A=p("a-checkbox"),D=p("a-modal");return u(),m(D,{maskClosable:!1,visible:S.visible,"onUpdate:visible":i[6]||(i[6]=e=>S.visible=e),title:y(W)[a.modalTitle],width:"address"===a.modalTitle?788:408,onCancel:_,zIndex:1001},{footer:g((()=>[f(n,{key:"back",onClick:_},{default:g((()=>[v("取消")])),_:1}),f(n,{key:"submit",type:"primary",onClick:i[0]||(i[0]=t=>(a=>{switch(a){case"wifi":o.value.validate().then((()=>{x(s.signList.wifiList)||I(s.signList.wifiList,"wifiName",S.wifiObj.wifiName)||(s.signList.wifiList.push(JSON.parse(JSON.stringify(S.wifiObj))),_())})).catch((e=>{}));break;case"equipment":if(!S.deviceObj.deviceId)return void e.error("请输入设备唯一识别码");if(x(s.signList.deviceList))return;s.signList.deviceList.push(JSON.parse(JSON.stringify(S.deviceObj))),_();break;case"address":if(!l.mapOptions.address||!S.addressObj.effectiveRange)return void e.error("请输入考勤地址或有效打卡距离");if(I(s.signList.addressList,"addressName",l.mapOptions.address))return;if(x(s.signList.addressList))return;if(!l.mapOptions.longitude)return void e.error("当前输入的地址无效，请重新输入");s.signList.addressList.push({addressName:l.mapOptions.address,geo:l.mapOptions.longitude,lat:l.mapOptions.latitude,effectiveRange:S.addressObj.effectiveRange}),_()}})(a.modalTitle))},{default:g((()=>[v("确定")])),_:1})])),default:g((()=>["wifi"===a.modalTitle?(u(),m(T,{key:0,layout:"vertical",ref_key:"addressRules",ref:o,model:S.wifiObj,rules:d},{default:g((()=>[f(c,{label:"Wi-Fi名称：",name:"wifiName"},{default:g((()=>[f(r,{value:S.wifiObj.wifiName,"onUpdate:value":i[1]||(i[1]=e=>S.wifiObj.wifiName=e),maxlength:15,placeholder:"请输入 15字以内"},null,8,["value"])])),_:1}),f(c,{label:"Mac地址：",name:"wifiMac",rules:{validator:k,trigger:"change",required:!0}},{default:g((()=>[f(r,{value:S.wifiObj.wifiMac,"onUpdate:value":i[2]||(i[2]=e=>S.wifiObj.wifiMac=e),placeholder:"请输入 例如：02:10:18:02:4"},null,8,["value"])])),_:1},8,["rules"])])),_:1},8,["model"])):h("v-if",!0),"address"===a.modalTitle?(u(),b(w,{key:1},[h(' <a-form>\r\n                <div class="flex">\r\n                    <a-form-item>\r\n                        <a-input style="width: 336px" placeholder="请输入考勤地址" v-model:value="state.address" >\r\n                            <template #suffix>\r\n                                <a-tooltip>\r\n                                    <search-outlined style="color: #c2c2c2" />\r\n                                </a-tooltip>\r\n                            </template>\r\n                        </a-input>\r\n                    </a-form-item>\r\n                    <a-button type="primary" @click="drawer.mapOptions.address = state.address">\r\n                        搜索\r\n                        <template #icon><SearchOutlined /></template>\r\n                    </a-button>\r\n                    <a-form-item>\r\n                        <a-select\r\n                            ref="select"\r\n                            v-model:value="state.addressObj.effectiveRange"\r\n                            style="width: 280px;z-index: 2001"\r\n                            placeholder="请选择打卡范围"\r\n                            :options="distanceList"                            \r\n                            >\r\n                        </a-select>\r\n                    </a-form-item>\r\n                </div>\r\n            </a-form> '),f(ne,{onGetAddress:L})],64)):h("v-if",!0),"equipment"===a.modalTitle?(u(),m(T,{key:2,layout:"vertical"},{default:g((()=>[f(c,{label:"设备唯一识别码："},{default:g((()=>[h(' <a-input placeholder="请输入" v-model:value="state.deviceObj.deviceId"></a-input> '),f(M,{value:S.deviceObj.deviceId,"onUpdate:value":i[3]||(i[3]=e=>S.deviceObj.deviceId=e)},{default:g((()=>[(u(!0),b(w,null,O(S.attendanceDeviceList,(e=>(u(),m(C,{key:e.no,value:e.no},{default:g((()=>[v(j(e.machineName),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),f(c,{label:"打卡方式："},{default:g((()=>[f(A,{checked:S.deviceObj.card,"onUpdate:checked":i[4]||(i[4]=e=>S.deviceObj.card=e)},{default:g((()=>[v("刷卡")])),_:1},8,["checked"]),f(A,{checked:S.deviceObj.face,"onUpdate:checked":i[5]||(i[5]=e=>S.deviceObj.face=e)},{default:g((()=>[v("人脸")])),_:1},8,["checked"])])),_:1})])),_:1})):h("v-if",!0)])),_:1},8,["visible","title","width"])}}},[["__scopeId","data-v-f4b949ce"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/appModel/teacherAttendance/attendanceGroup/components/wifiModal.vue"]]);const oe={class:"header"},de={class:"box"},re=(e=>(S("data-v-3d40a64d"),e=e(),L(),e))((()=>k("i",{class:"iconfont icon-xingzhuangjiehe19"},null,-1))),ce={class:"eidtAddAttendance"},pe={class:"setupItem"},ue={class:"setupItem"},me={class:"setupItem"},ge={class:"setupItem"},fe={class:"addAttendanceFooter"};var ve=s({__name:"attendanceEdit",props:{groupId:String,visible:Boolean},emits:["handleClose"],setup(t,{emit:s}){const c=t,m=o(),S=d(),L=A(),_=(e,a)=>z.attendanceForm.personnelList.length?Promise.resolve():Promise.reject(new Error("请设置考勤人员")),C=(e,a)=>z.schedulingId.length?Promise.resolve():Promise.reject(new Error("请设置考勤类型与时间")),O=(e,a)=>z.attendanceForm.directorList.length?Promise.resolve():Promise.reject(new Error("请设置考勤负责人")),I=(e,a)=>{const{addressSign:t,wifiSign:i,bluetoothSign:n,deviceSign:s}=N.attendanceGroupSignCreateObj;return!(t||i||n||s)?Promise.reject(new Error("请设置打卡范围")):Promise.resolve()},{drawer:N,mapData:W}=se(),{modal:R}={modal:r({signList:{wifiList:[],deviceList:[],addressList:[]}})},U=M((()=>e=>e.length&&"#000")),z=r({managerVisible:!1,managerList:[],spinLoad:!1,attendanceForm:{name:"",personnelList:[],directorList:[]},schedulingId:[],selectTabs:[{tab:"教职工",key:1,checked:!0},{tab:"学生组",key:2,checked:!1}],filterArr:[],select:0,typeAndTimeVisible:!1,punchSetShow:!1,modalTitleShow:!1,selectAttendance:[],attendanceType:{schedulingName:"",schedulingDate:"",schedulingTime:"",schedulingTimeRange:"",necessarySignDate:"",unnecessarySignDate:""}}),q=()=>{const{source:e}=m.query;S.replace({query:{source:e}}),s("handleClose",!1)},V=e=>{switch(z.managerVisible=!0,z.select=e,e){case 1:z.managerList=JSON.parse(JSON.stringify(z.attendanceForm.personnelList)),z.selectTabs=[{tab:"教职工",key:1,checked:!0}];break;case 2:z.managerList=JSON.parse(JSON.stringify(z.attendanceForm.directorList)),z.selectTabs=[{tab:"教职工",key:1,checked:!0}]}},E=e=>{switch(z.select){case 1:z.attendanceForm.personnelList=P(e);break;case 2:z.attendanceForm.directorList=P(e)}},P=e=>e.map((e=>({name:e.name,id:e.id,userType:e.studentCode?1:2}))),H=e=>{z.modalTitle=e,z.modalTitleShow=!0},$=()=>{z.punchSetShow=!0;for(const e in N.signWay)N.signWay[e]=N.attendanceGroupSignCreateObj[e];for(const e in R.signList)R.signList[e]=JSON.parse(JSON.stringify(N.attendanceGroupSignCreateObj[e]))},B=e=>{z.selectAttendance=e},J=e=>{const{signList:a,signWay:t}=e;for(const i in t)N.attendanceGroupSignCreateObj[i]=t[i];z.filterArr=G.filter((e=>t[e.flag]));for(const i in a)N.attendanceGroupSignCreateObj[i]=a[i]},K=()=>{L.value.validate().then((()=>{a.confirm({title:"考勤生效设置",icon:f(F),content:D("div",{},[D("p","明日生效：保存设置成功后，则相应人员次日00:00后按新考勤进行考勤处理")]),okText:"确认",cancelText:"取消",onOk(){var a;const t={name:z.attendanceForm.name,employee:z.attendanceForm.personnelList.map((e=>({id:e.id,userType:e.userType}))),leader:z.attendanceForm.directorList.map((e=>({id:e.id,userType:e.userType}))),schedulingId:(null==(a=z.schedulingId)?void 0:a[0])||""};c.groupId?(t.attendanceWorkGroupSignUpdateObj={...N.attendanceGroupSignCreateObj},t.id=c.groupId,function(e){return i({url:n.attendanceGroupUpdate,method:"post",data:e})}(t).then((a=>{e.success("编辑成功"),q()}))):(t.attendanceWorkGroupSignCreateObj={...N.attendanceGroupSignCreateObj},function(e){return i({url:n.attendanceGroupAdd,method:"post",data:e})}(t).then((a=>{e.success("新增成功"),q()})))}})}))},X=e=>{const{attendanceType:a,schedulingId:t}=e;z.attendanceType=a,z.schedulingId=t},Y=()=>{const e={id:c.groupId};var a;z.spinLoad=!0,(a=e,i({url:n.attendanceGroupInfo,method:"get",params:a})).then((e=>{const{name:a,employee:t,leader:i,signDetailObj:n}=e.data;z.attendanceForm.name=a,z.attendanceForm.personnelList=t,z.attendanceForm.directorList=i,N.attendanceGroupSignCreateObj=n;for(const s in z.attendanceType)z.attendanceType[s]=Z(e.data[s]);z.attendanceType.necessarySignDate=Z(e.data.necessaryDate),z.attendanceType.unnecessarySignDate=Z(e.data.unnecessaryDate),z.schedulingId=e.data.schedulingId?[e.data.schedulingId]:[],z.filterArr=G.filter((e=>N.attendanceGroupSignCreateObj[e.flag]))})).catch((e=>{})).finally((()=>{z.spinLoad=!1}))},Z=e=>e||"";return T((()=>{c.groupId&&Y()})),(e,a)=>{const i=p("a-button"),n=p("a-input"),s=p("a-form-item"),o=p("a-switch"),d=p("a-form"),r=p("a-spin");return u(),b(w,null,[k("div",oe,[k("div",de,[f(i,{type:"text",class:"tabs_back",onClick:q},{default:g((()=>[re,h(' <arrow-left-outlined class="tabs_back__icon" /> ')])),_:1}),k("span",null,j(c.groupId?"编辑考勤组":"新增考勤组"),1)])]),f(r,{spinning:z.spinLoad},{default:g((()=>[k("div",ce,[h(" 表单 "),f(d,{class:"formClass",ref_key:"formRef",ref:L,model:z.attendanceForm,name:"base"},{default:g((()=>[f(s,{label:"考勤组名称：",name:"name",rules:[{required:z.attendanceForm.name,message:"请填写考勤组名称",required:!0}]},{default:g((()=>[f(n,{style:{width:"360px"},disabled:""!==t.groupId,value:z.attendanceForm.name,"onUpdate:value":a[0]||(a[0]=e=>z.attendanceForm.name=e),maxlength:20,placeholder:"请输入"},null,8,["disabled","value"])])),_:1},8,["rules"]),f(s,{label:"考勤人员：",name:"peopel",rules:[{validator:_,trigger:"change",required:!0}]},{default:g((()=>[k("div",{class:"setupColor",onClick:a[1]||(a[1]=e=>V(1))},"设置")])),_:1},8,["rules"]),k("div",pe,[v(" 参与考勤人员："),k("span",{style:x({color:U.value(z.attendanceForm.personnelList)})},j(y(W)(z.attendanceForm.personnelList,"name")),5)]),f(s,{label:"考勤负责人：",name:"peopel",rules:[{validator:O,trigger:"change",required:!0}]},{default:g((()=>[k("div",{class:"setupColor",onClick:a[2]||(a[2]=e=>V(2))},"设置")])),_:1},8,["rules"]),k("div",ue,[v(" 考勤负责人："),k("span",{style:x({color:U.value(z.attendanceForm.directorList)})},j(y(W)(z.attendanceForm.directorList,"name")),5)]),f(s,{label:"考勤类型与时间：",name:"peopel",rules:[{validator:C,trigger:"change",required:!0}]},{default:g((()=>[k("div",{class:"setupColor",onClick:a[3]||(a[3]=e=>z.typeAndTimeVisible=!0)},"设置")])),_:1},8,["rules"]),k("div",me,[k("p",null,[v("考勤排班名称： "),k("span",{style:x({color:U.value(z.attendanceType.schedulingName)})},j(z.attendanceType.schedulingName?z.attendanceType.schedulingName:"未设置"),5)]),k("p",null,[v("考勤日期： "),k("span",{style:x({color:U.value(z.attendanceType.schedulingDate)})},j(z.attendanceType.schedulingDate?z.attendanceType.schedulingDate:"未设置"),5)]),k("p",null,[v("考勤时间： "),k("span",{style:x({color:U.value(z.attendanceType.schedulingTime)})},j(z.attendanceType.schedulingTime?z.attendanceType.schedulingTime:"未设置"),5)]),k("p",null,[v("打卡时间范围限制： "),k("span",{style:x({color:U.value(z.attendanceType.schedulingTimeRange)})},j(z.attendanceType.schedulingTimeRange?z.attendanceType.schedulingTimeRange:"未设置"),5)]),k("p",null,[v("必须打卡日期： "),k("span",{style:x({color:U.value(z.attendanceType.necessarySignDate)})},j(y(W)(z.attendanceType.necessarySignDate,"")),5)]),k("p",null,[v("不用打卡日期： "),k("span",{style:x({color:U.value(z.attendanceType.unnecessarySignDate)})},j(y(W)(z.attendanceType.unnecessarySignDate,"")),5)])]),f(s,{label:"打卡范围：",name:"peopel",rules:[{validator:I,trigger:"change",required:!0}]},{default:g((()=>[k("div",{class:"setupColor",onClick:$},"设置")])),_:1},8,["rules"]),k("div",ge,[k("p",null,[v("打卡方式： "),k("span",{style:x({color:U.value(z.filterArr)})},j(y(W)(z.filterArr,"name")),5)]),k("p",null,[v("地点： "),k("span",{style:x({color:U.value(y(N).attendanceGroupSignCreateObj.addressList)})},j(y(W)(y(N).attendanceGroupSignCreateObj.addressList,"addressName")),5)]),k("p",null,[v("Wi-Fi： "),k("span",{style:x({color:U.value(y(N).attendanceGroupSignCreateObj.wifiList)})},j(y(W)(y(N).attendanceGroupSignCreateObj.wifiList,"wifiName")),5)]),k("p",null,[v("设备唯一识别码： "),k("span",{style:x({color:U.value(y(N).attendanceGroupSignCreateObj.deviceList)})},j(y(W)(y(N).attendanceGroupSignCreateObj.deviceList,"deviceId")),5)])]),f(s,{label:"外勤打卡：",name:"peopel"},{default:g((()=>[f(o,{checked:y(N).attendanceGroupSignCreateObj.signInOutSide,"onUpdate:checked":a[4]||(a[4]=e=>y(N).attendanceGroupSignCreateObj.signInOutSide=e),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])),_:1}),h(' <a-form-item label="人脸打卡：" name="peopel">\r\n                <a-switch v-model:checked="drawer.attendanceGroupSignCreateObj.signByFace" checked-children="开" un-checked-children="关" />\r\n            </a-form-item> ')])),_:1},8,["model"]),h(" 考勤人员 "),f(y(l),{tabs:z.selectTabs,mode:"personnel",visible:z.managerVisible,"onUpdate:visible":a[5]||(a[5]=e=>z.managerVisible=e),selectedKeys:[],checked:z.managerList,"onUpdate:checked":a[6]||(a[6]=a=>e.checkedList=a),onHandleOk:E},null,8,["tabs","visible","checked"]),h(" 类型和时间 "),f(ae,{visible:z.typeAndTimeVisible,"onUpdate:visible":a[7]||(a[7]=e=>z.typeAndTimeVisible=e),onSelectAttendance:B,onBuildOk:X},null,8,["visible"]),h(" 地点 wifi 绑定设备弹窗 "),f(le,{visible:z.modalTitleShow,"onUpdate:visible":a[8]||(a[8]=e=>z.modalTitleShow=e),modalTitle:z.modalTitle,signList:y(R).signList},null,8,["visible","modalTitle","signList"]),h(" 打卡范围设置 "),f(Q,{visible:z.punchSetShow,"onUpdate:visible":a[9]||(a[9]=e=>z.punchSetShow=e),signWay:y(N).signWay,signList:y(R).signList,onOpenModal:H,onConfirm:J},null,8,["visible","signWay","signList"])]),k("div",fe,[f(i,{type:"primary",onClick:K},{default:g((()=>[v("保存设置")])),_:1})])])),_:1},8,["spinning"])],64)}}},[["__scopeId","data-v-3d40a64d"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/appModel/teacherAttendance/attendanceGroup/attendanceEdit.vue"]]);const he={key:0,class:"attendanceGroup"},ye={class:"groupTop"},be={class:"buttonBox"},we=["innerHTML"],ke=["innerHTML"],Se=["innerHTML"],Le={class:"nowarp"},Te={class:"nowarp"},_e=["onClick"],je=["onClick"];var Ce=s({__name:"index",setup(s){const l=d(),c=o(),y=r({pagination:{pageNo:1,pageSize:10,total:0},name:"",groupId:"",spinLoad:!1,toDoTable:[],showFlag:!1}),S=[{title:"名称",ellipsis:!0,dataIndex:"name",width:"150px"},{title:"人数(人)",ellipsis:!0,dataIndex:"personCount",width:"100px"},{title:"考勤排班名称",ellipsis:!0,dataIndex:"schedulingName",width:"150px"},{title:"考勤时间",ellipsis:!0,dataIndex:"schedulingTime"},{title:"特殊日期排班设置",dataIndex:"scheduling",ellipsis:!0,showSorterTooltip:!0},{title:"操作",ellipsis:!0,dataIndex:"operation",width:"100px"}],L=e=>{y.groupId=e.id,l.replace({query:{...c.query,type:"edit"}}),y.showFlag=!0},C=()=>{const e={pageNo:y.pagination.pageNo,pageSize:y.pagination.pageSize,name:y.name};y.spinLoad=!0,function(e){return i({url:n.attendanceGroup,method:"post",data:e})}(e).then((e=>{const{list:a,total:t}=e.data;a.forEach((e=>{e.attendanceDate&&e.attendanceTime&&e.attendanceTime&&e.timeRange&&e.necessarySignDate&&e.unnecessarySignDate?(e.schedulingTime=`<p>考勤日期：${e.attendanceDate}</p><p>考勤时间：${e.attendanceTime}</p><p>打卡时间范围限制：${e.timeRange}</p>`,e.scheduling=`<p>必须打卡的日期：${e.necessarySignDate.join("；")}</p><p>不用打卡的日期：${e.unnecessarySignDate.join("；")}</p>`):(e.schedulingTime="<p>考勤日期：未设置</p><p>考勤时间：：未设置</p><p>打卡时间范围限制：未设置</p>",e.scheduling="<p></p>")})),y.pagination.total=t,y.toDoTable=a})).catch((e=>{})).finally((()=>{y.spinLoad=!1}))},O=()=>{y.name="",C()},x=e=>{const{current:a,pageSize:t}=e;y.pagination.pageNo=a,y.pagination.pageSize=t,C()},I=t=>{a.confirm({title:"删除提示",icon:f(F),content:D("div",{},[D("p",`确定删除'${t.name}'考勤组吗？`)]),okText:"确认",cancelText:"取消",onOk(){(function(e){return i({url:n.attendanceGroupDel,method:"post",data:e})})([t.id]).then((a=>{e.success(a.message)})).finally((()=>{C()}))}})},M=e=>{y.showFlag=e,C()},A=()=>{y.pagination.pageNo=1,y.pagination.pageSize=10,C()};return T((()=>{C()})),(e,a)=>{const i=p("a-input-search"),n=p("SearchOutlined"),s=p("a-button"),l=p("reload-outlined"),o=p("plus-outlined"),d=p("a-tooltip");return u(),b("div",null,[y.showFlag?h("v-if",!0):(u(),b("div",he,[k("div",ye,[k("div",null,[f(i,{placeholder:"请输入考勤组名称",value:y.name,"onUpdate:value":a[0]||(a[0]=e=>y.name=e),style:{width:"336px","padding-bottom":"16px"},onSearch:A},null,8,["value"]),f(s,{type:"primary",style:{margin:"0 20px"},onClick:A},{icon:g((()=>[f(n,{style:{"margin-right":"15px"}})])),default:g((()=>[v(" 查询 ")])),_:1}),f(s,{onClick:O},{icon:g((()=>[f(l,{style:{"margin-right":"15px"}})])),default:g((()=>[v(" 重置 ")])),_:1})]),k("div",be,[f(s,{type:"primary",onClick:a[1]||(a[1]=e=>L({id:""}))},{icon:g((()=>[f(o)])),default:g((()=>[v(" 新增考勤组 ")])),_:1})])]),f(t,{columns:S,dataSource:y.toDoTable,slots:["operation"],rowSelection:!1,totals:y.pagination,spinLoad:y.spinLoad,onOnSelectedRowKeys:x},{bodyCell:g((({column:e,text:a,record:t})=>["schedulingTime"===e.dataIndex?(u(),m(d,{key:0,placement:"topLeft",overlayClassName:"min"},_({default:g((()=>[k("div",{innerHTML:a},null,8,ke)])),_:2},[(null==a?void 0:a.length)>15?{name:"title",fn:g((()=>[k("div",{innerHTML:a},null,8,we)])),key:"0"}:void 0]),1024)):h("v-if",!0),"scheduling"===e.dataIndex?(u(),m(d,{key:1,placement:"topLeft",overlayClassName:"min"},_({default:g((()=>[k("div",Le," 必须打卡的日期："+j(t.necessarySignDate?t.necessarySignDate.join("；"):"未设置"),1),k("div",Te," 不用打卡的日期："+j(t.unnecessarySignDate?t.unnecessarySignDate.join("；"):"未设置"),1)])),_:2},[(null==a?void 0:a.length)>15?{name:"title",fn:g((()=>[k("div",{innerHTML:a},null,8,Se)])),key:"0"}:void 0]),1024)):h("v-if",!0),"operation"===e.dataIndex?(u(),b(w,{key:2},[k("a",{onClick:e=>L(t),style:{color:"var(--primary-color)","margin-right":"10px"}},"编辑",8,_e),k("a",{onClick:e=>I(t),style:{color:"var(--error-color)"}},"删除",8,je)],64)):h("v-if",!0)])),_:1},8,["dataSource","totals","spinLoad"])])),y.showFlag?(u(),m(ve,{key:1,groupId:y.groupId,onHandleClose:M},null,8,["groupId"])):h("v-if",!0)])}}},[["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/appModel/teacherAttendance/attendanceGroup/index.vue"]]);export{Ce as default};
