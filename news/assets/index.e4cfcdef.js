import"./vue.a2f518ee.js";import{_ as e}from"./empty.1f473950.js";import{a as l,m as a,M as i}from"./ant-design-vue.db4d48e3.js";import{s,n as o,_ as t,G as d}from"./index.7061e8ea.js";import{q as n,r as u,b8 as r,o as m,a2 as c,a3 as p,c as h,O as f,a1 as b,u as v,Q as g,w as y,a as j,F as C,a8 as z,a9 as x,a7 as _,b as k,b5 as O,b4 as w,y as I,f as T,a4 as L,M as U,a5 as $,m as S}from"./@vue.919ff404.js";import{g as M}from"./oss.72e23b0d.js";import"./@babel.6d5f88cb.js";import"./resize-observer-polyfill.f664b406.js";import"./vue-types.022beab3.js";import"./@ant-design.2e172c39.js";import"./@ctrl.c020ccd3.js";import"./dom-align.0991ecc5.js";import"./lodash-es.36dcd19c.js";import"./dayjs.49e29cb2.js";import"./async-validator.267d9719.js";import"./scroll-into-view-if-needed.61c672a4.js";import"./compute-scroll-into-view.17358474.js";/* empty css                    */import"./secure-ls.8c8acb46.js";import"./vue-router.907b547c.js";import"./nprogress.c2257662.js";import"./axios.7aed06b8.js";import"./qs.e55e9b28.js";import"./side-channel.ea627785.js";import"./get-intrinsic.8c87d952.js";import"./has-symbols.caae0f97.js";import"./has-proto.76cff6c7.js";import"./function-bind.cb3858f2.js";import"./has.c1051c46.js";import"./call-bind.208b5ef0.js";import"./object-inspect.e2cfb4a5.js";import"./vuex.f308ecec.js";import"./vuex-persistedstate.fa252374.js";import"./vue-grid-layout.a3ef67ec.js";import"./ali-oss.e15d125a.js";import"./ydutils.99497787.js";import"./ydutils.a58fbaf1.js";function F(e){return s({url:o.customizeModuleCreate,method:"post",data:e})}function D(e){return s({url:o.customizeModuleUpdate,method:"post",data:e})}var N=t({__name:"addModule",emits:["handleOk"],setup(e,{expose:i,emit:t}){const d=l.useForm,g=n({name:null}),y=u(!1),j=u(!1),C=n({name:[{required:!0,message:"请输入模块名称!",trigger:"change"}]}),{validateInfos:z,resetFields:x,validate:_}=d(g,C),k=()=>{_().then((()=>{var e;y.value=!0,(e=g,s({url:o.customizeClassifyCreate,method:"post",data:e})).then((e=>{a.success(e.message),t("handleOk"),x()})).finally((()=>{j.value=!1,y.value=!1}))}))},O=()=>{j.value=!1,x()};return i({moduleVisible:j}),(e,l)=>{const a=r("a-button"),i=r("a-input"),s=r("a-form-item"),o=r("a-form"),t=r("a-modal");return m(),c(t,{visible:j.value,"onUpdate:visible":l[1]||(l[1]=e=>j.value=e),maskClosable:!1,onOk:k,onCancel:O,title:"添加模块"},{footer:p((()=>[h(a,{onClick:O},{default:p((()=>[f("取消")])),_:1}),h(a,{type:"primary",onClick:k,loading:y.value},{default:p((()=>[f("确认")])),_:1},8,["loading"])])),default:p((()=>[h(o,{layout:"vertical",ref:"moduleFormRef"},{default:p((()=>[h(s,b({label:"模块名称："},v(z).name),{default:p((()=>[h(i,{value:g.name,"onUpdate:value":l[0]||(l[0]=e=>g.name=e),"show-count":"",maxlength:20,placeholder:"请输入"},null,8,["value"])])),_:1},16)])),_:1},512)])),_:1},8,["visible"])}}},[["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/appModel/smartClassSign/customModule/components/addModule.vue"]]);const P=e=>(O("data-v-53bd6a12"),e=e(),w(),e),q={key:0,style:{width:"100px",height:"100px",border:"1px solid #eee",cursor:"pointer"}},R=["src"],V={key:1,style:{cursor:"pointer",width:"100px",height:"100px",border:"1px solid #eee",display:"flex","align-items":"center","flex-direction":"column","justify-content":"center","background-color":"#f6f6f6"}},G=P((()=>k("span",{style:{color:"rgba(0, 0, 0, 0.45)","font-size":"12px","font-weight":"400","padding-top":"4px"}},"点击上传图片",-1))),H={class:"banpai_item_hander"},J=P((()=>k("label",{for:""},[k("i",{style:{color:"red"}}," * "),f("班牌：")],-1))),E={class:"banpai_item"},A={class:"color-picker mag50"};var B=t({__name:"addModuleCon",props:{sizeList:{type:Array,default:()=>[]},imgSizeType:{type:Array,default:()=>[]},direction:{type:Number,default:0},schoolClassifyId:{type:String,default:""},moduleConInfo:{type:Object,default:()=>{}}},emits:["handleOk"],setup(e,{expose:l,emit:i}){const s=e,o=n({url:null,size:null,descriptive:null,borderColor:"#FFFFFF",images:"",imgType:1,streamDetails:[{brandId:null,nums:1,streamUrls:[{}]}]}),t=n({imgTypes:[{text:"链接",value:1},{text:"图片",value:2},{text:"视频流",value:3}],disabledSize:!1,moduleObj:{url:null,size:null,descriptive:null,borderColor:"#FFFFFF",images:"",imgType:1,streamDetails:[{brandId:null,nums:1,streamUrls:[{}]}]},fileList:[],percentage:0,banpaiOption:[],fieldNames:{label:"showName",value:"id",children:"children"},pagination:{pageNo:1,pageSize:99,total:0}}),u=g(!1),b=g(!1),v=g(),O={46:"https://brand-yide.oss-cn-shenzhen.aliyuncs.com/icon/hbzdy46.png",86:"https://brand-yide.oss-cn-shenzhen.aliyuncs.com/icon/hbzdy86.png",64:"https://brand-yide.oss-cn-shenzhen.aliyuncs.com/icon/sbzdy64.png",68:"https://brand-yide.oss-cn-shenzhen.aliyuncs.com/icon/sbzdy68.png",22:"https://brand-yide.oss-cn-shenzhen.aliyuncs.com/icon/sbzdy22.png",21:"https://brand-yide.oss-cn-shenzhen.aliyuncs.com/icon/sbzdy21.png"},w=(e,l)=>l?Promise.resolve():Promise.reject("请上传图片"),I=(e,l)=>l?Promise.resolve():Promise.reject("请选择尺寸"),T=(e,l)=>l?Promise.resolve():Promise.reject("请输入"),L=()=>{u.value=!1},U=e=>{const{streamUrls:l,nums:a}=e,i=l.length;if(a>i)for(let s=i;s<a;s++)e.streamUrls.push({});else for(let s=0;s<i-a;s++)e.streamUrls.pop()},$=()=>{t.moduleObj.streamDetails.push({brandId:null,nums:1,streamUrls:[{}]})},S=e=>{e.forEach((e=>{4!==e.type&&(e.disabled=!0),e.children&&e.children.length&&S(e.children)}))},N=e=>!(e.size/1024/1024<5)&&(a.error("文件大于5M，请重新上传"),!0),P=e=>{t.percentage=0,M(e,{catalogue:"/smartClassSign/customModule"},(e=>{t.percentage=e})).then((l=>{const{code:i,msg:s,url:o}=l;0===i?(e.fileList.length>0&&(t.fileList=[e.fileList[e.fileList.length-1]]),t.moduleObj.images=o,v.value.validateFields("images"),t.fileList=[]):(a.error(s),t.moduleObj.images="")})).finally((()=>{}))},B=()=>{v.value.validate().then((()=>{b.value=!0;const{url:e,borderColor:l,size:o,descriptive:d,images:n,imgType:r,streamDetails:m}=t.moduleObj;let c=F;const p={url:e,borderColor:l,descriptive:d,direction:s.direction,imgType:r};s.moduleConInfo.id?(p.images=n,p.id=s.moduleConInfo.id,c=D):(p.images=1===r?O[`${o.split("x").join("")}`]+`?t=${Date.now()}`:n,p.schoolClassifyId=s.schoolClassifyId,p.width=o.split("x")[0],p.high=o.split("x")[1]),3===t.moduleObj.imgType&&(p.streamDetails=m,p.images=O[`${o.split("x").join("")}`]+`?t=${Date.now()}`),c(p).then((e=>{a.success(e.message),i("handleOk",t.moduleObj),b.value=!1,u.value=!1,v.value.resetFields()})).catch((()=>{b.value=!1}))}))},Q=(e=null)=>{if(e){const e=JSON.parse(JSON.stringify(s.moduleConInfo));for(const l in t.moduleObj)t.moduleObj[l]=e[l];t.moduleObj.size=`${s.moduleConInfo.width}x${s.moduleConInfo.high}`}else for(const l in t.moduleObj)"imgType"!==l&&(t.moduleObj[l]="streamDetails"===l?[{brandId:null,nums:1,streamUrls:[{}]}]:o[l])};y((()=>u.value),(e=>{if(!e)return;(async()=>{const{data:e}=await d({direction:""});S(e),t.banpaiOption=e})();const{id:l}=s.moduleConInfo;l||(t.moduleObj.borderColor="#FFFFFF",t.moduleObj.imgType=1),t.disabledSize=!!l,Q(!!l)}));const K=e=>{const l=e.target.value,{imgType:a}=s.moduleConInfo;Q(l===a)};return l({moduleVisible:u}),(l,i)=>{const s=r("a-button"),o=r("a-radio"),d=r("a-radio-group"),n=r("a-form-item"),g=r("a-input"),y=r("plus-outlined"),O=r("a-upload"),S=r("a-select-option"),M=r("a-select"),F=r("close-circle-outlined"),D=r("home-outlined"),Q=r("a-tree-select"),W=r("a-input-number"),X=r("a-form"),Y=r("a-modal");return m(),c(Y,{visible:u.value,"onUpdate:visible":i[7]||(i[7]=e=>u.value=e),maskClosable:!1,destroyOnClose:!0,onOk:B,bodyStyle:{overflow:"hidden auto",maxHeight:"600px"},title:t.disabledSize?"编辑":"新增模块内容"},{footer:p((()=>[h(s,{onClick:L},{default:p((()=>[f("取消")])),_:1}),h(s,{type:"primary",onClick:B,loading:b.value},{default:p((()=>[f("确认")])),_:1},8,["loading"])])),default:p((()=>[h(X,{layout:"vertical",model:t.moduleObj,ref_key:"moduleConFormRef",ref:v},{default:p((()=>[h(n,{label:""},{default:p((()=>[h(d,{value:t.moduleObj.imgType,"onUpdate:value":i[0]||(i[0]=e=>t.moduleObj.imgType=e),name:"radioGroup",onChange:K,disabled:t.disabledSize},{default:p((()=>[(m(!0),j(C,null,z(t.imgTypes,(e=>(m(),c(o,{key:e.value,value:e.value},{default:p((()=>[f(x(e.text),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value","disabled"])])),_:1}),1===t.moduleObj.imgType?(m(),c(n,{key:0,label:"链接地址：",rules:{required:!0,validateTrigger:"blur",message:"请添加链接地址"},name:"url"},{default:p((()=>[h(g,{value:t.moduleObj.url,"onUpdate:value":i[1]||(i[1]=e=>t.moduleObj.url=e),placeholder:"请输入"},null,8,["value"])])),_:1})):_("v-if",!0),2===t.moduleObj.imgType?(m(),c(n,{key:1,label:"图片：",rules:{required:!0,validator:w},name:"images"},{default:p((()=>[h(O,{ref:"uploads",accept:".jpg, .jpeg, .png, .JPG, .JPEG,",action:"/",multiple:!1,"show-upload-list":!1,"file-list":t.fileList,limit:1,"before-upload":N,onChange:P},{default:p((()=>[t.moduleObj.images?(m(),j("div",q,[k("img",{src:t.moduleObj.images,style:{width:"100%",height:"100%"}},null,8,R)])):(m(),j("div",V,[h(y,{style:{"font-size":"24px"}}),G]))])),_:1},8,["file-list"])])),_:1},8,["rules"])):_("v-if",!0),2===t.moduleObj.imgType?(m(),c(n,{key:2,label:"跳转链接："},{default:p((()=>[h(g,{value:t.moduleObj.url,"onUpdate:value":i[2]||(i[2]=e=>t.moduleObj.url=e),placeholder:"请输入"},null,8,["value"])])),_:1})):_("v-if",!0),1===t.moduleObj.imgType?(m(),c(n,{key:3,label:"选择尺寸：",rules:{required:!0,validator:I,trigger:["change","blur"]},name:"size"},{default:p((()=>[h(M,{value:t.moduleObj.size,"onUpdate:value":i[3]||(i[3]=e=>t.moduleObj.size=e),disabled:t.disabledSize,placeholder:"请选择"},{default:p((()=>[(m(!0),j(C,null,z(e.sizeList,(e=>(m(),c(S,{key:`${e.width}x${e.high}`,value:`${e.width}x${e.high}`},{default:p((()=>[f(x(`${e.width}x${e.high}`),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value","disabled"])])),_:1},8,["rules"])):_("v-if",!0),2===t.moduleObj.imgType||3===t.moduleObj.imgType?(m(),c(n,{key:4,label:"选择尺寸：",rules:{required:!0,validator:I,trigger:["change","blur"]},name:"size"},{default:p((()=>[h(M,{value:t.moduleObj.size,"onUpdate:value":i[4]||(i[4]=e=>t.moduleObj.size=e),disabled:t.disabledSize,placeholder:"请选择"},{default:p((()=>[(m(!0),j(C,null,z(e.imgSizeType,(e=>(m(),c(S,{key:`${e.width}x${e.high}`,value:`${e.width}x${e.high}`},{default:p((()=>[f(x(`${e.width}x${e.high}`),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value","disabled"])])),_:1},8,["rules"])):_("v-if",!0),h(n,{label:"说明："},{default:p((()=>[h(g,{value:t.moduleObj.descriptive,"onUpdate:value":i[5]||(i[5]=e=>t.moduleObj.descriptive=e),"show-count":"",maxlength:10,placeholder:"请输入该模块尺寸的说明信息"},null,8,["value"])])),_:1}),3===t.moduleObj.imgType?(m(),j(C,{key:5},[(m(!0),j(C,null,z(t.moduleObj.streamDetails,((e,l)=>(m(),j(C,{key:l},[k("div",H,[J,h(F,{class:"banpai_item_delete",onClick:e=>(e=>{t.moduleObj.streamDetails.splice(e,1)})(l)},null,8,["onClick"])]),k("div",E,[_(" message: '请选择设备', "),h(n,{rules:{required:!0,message:"请选择设备",trigger:["change","blur"]},name:["streamDetails",l,"brandId"],label:"","dropdown-style":{maxHeight:"400px",overflow:"auto"}},{default:p((()=>[h(Q,{value:e.brandId,"onUpdate:value":l=>e.brandId=l,style:{width:"100%"},placeholder:"请选择","tree-default-expand-all":"",fieldNames:t.fieldNames,"allow-clear":"","tree-data":t.banpaiOption,onChange:e=>((e,l)=>{t.moduleObj.streamDetails.forEach(((i,s)=>{s!==l&&i.brandId===e&&(a.error("设备不能重复选择!"),t.moduleObj.streamDetails[l].brandId=null)}))})(e,l)},{title:p((e=>[h(D,{class:"icon-yellow"}),f(" "+x(e.showName),1)])),_:2},1032,["value","onUpdate:value","fieldNames","tree-data","onChange"])])),_:2},1032,["name"]),h(n,{label:"分屏数量："},{default:p((()=>[h(W,{id:"inputNumber",type:"number",value:e.nums,"onUpdate:value":l=>e.nums=l,min:1,max:8,style:{width:"100%"},onStep:l=>U(e),onBlur:l=>U(e),placeholder:"分屏数量最大值为8"},null,8,["value","onUpdate:value","onStep","onBlur"])])),_:2},1024),(m(!0),j(C,null,z(e.streamUrls,((e,a)=>(m(),c(n,{key:`${a}_i`,label:"",name:["streamDetails",l,"streamUrls",a,"url"],rules:{required:!0,validator:T}},{default:p((()=>[h(g,{value:e.url,"onUpdate:value":l=>e.url=l,placeholder:"请输入","auto-size":""},null,8,["value","onUpdate:value"])])),_:2},1032,["name","rules"])))),128))])],64)))),128)),h(s,{type:"primary",onClick:$},{default:p((()=>[f("添加班牌")])),_:1})],64)):_("v-if",!0)])),_:1},8,["model"]),3!==t.moduleObj.imgType?(m(),c(X,{key:0},{default:p((()=>[h(n,{label:"边框颜色："},{default:p((()=>[k("div",A,[h(g,{type:"color",value:t.moduleObj.borderColor,"onUpdate:value":i[6]||(i[6]=e=>t.moduleObj.borderColor=e)},null,8,["value"])])])),_:1})])),_:1})):_("v-if",!0)])),_:1},8,["visible","title"])}}},[["__scopeId","data-v-53bd6a12"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/appModel/smartClassSign/customModule/components/addModuleCon.vue"]]);function Q(){return{delModule:e=>new Promise(((l,a)=>{i.confirm({title:"删除提示",content:"此操作将永久删除该模块，是否继续？",okText:"确定",okType:"danger",cancelText:"取消",onOk(){(function(e){return s({url:o.customizeClassifyDel,method:"post",data:e})})({id:e.id}).then((e=>{l(e)}))},onCancel(){a()}})})),delModuleCon:e=>new Promise(((l,a)=>{i.confirm({title:"删除提示",content:"请确认删除模块内容？",okText:"确认",okType:"danger",cancelText:"取消",onOk(){(function(e){return s({url:o.customizeModuleDel,method:"post",data:e})})({id:e.id}).then((e=>{l(e)}))},onCancel(){a()}})}))}}const K=e=>(O("data-v-d5d21c94"),e=e(),w(),e),W={class:"custom_module"},X={class:"header"},Y={key:0,class:"con"},Z={class:"list"},ee=["onClick"],le=["onClick"],ae={class:"size"},ie=["onClick"],se={class:"main"},oe=K((()=>k("div",{style:{"margin-top":"8px"}},"添加模块内容",-1))),te={class:"module_item"},de=["src"],ne={class:"module_edit"},ue=["onClick"],re=["onClick"],me={key:1,class:"no_data"},ce=[K((()=>k("img",{src:e,alt:""},null,-1))),K((()=>k("p",null,"暂无数据",-1)))];var pe=t({__name:"index",setup(e){const{delModule:l,delModuleCon:i}=Q(),{proxy:t}=S(),d=n({type:0,moduleId:null,moduleName:null,sizeIndex:"2x2",moduleTitList:[],color:"",moduleList:[],sizeType:{0:{sizeList:[{width:4,high:6},{width:8,high:6}]},1:{sizeList:[{width:6,high:4},{width:6,high:8}]}},imgSizeType:{0:{sizeList:[{width:2,high:2},{width:4,high:6},{width:8,high:6}]},1:{sizeList:[{width:2,high:1},{width:2,high:2},{width:6,high:4},{width:6,high:8}]}},moduleConInfo:{}}),u=(e,s)=>{const{id:o}=s;"module"===e?l(s).then((e=>{a.success(e.message),b(o)})):i(s).then((e=>{a.success(e.message),v()}))},b=e=>{(function(e){return s({url:o.layoutclasssignClassifyList,method:"post",data:e})})({direction:d.type,types:[2]}).then((l=>{var a,i,s,o;d.moduleId!==e&&null!==e||(d.moduleId=null==(i=null==(a=l.data)?void 0:a.classifyList[0])?void 0:i.id,d.moduleName=null==(o=null==(s=l.data)?void 0:s.classifyList[0])?void 0:o.name),d.moduleTitList=l.data.classifyList,v()}))},v=()=>{(function(e){return s({url:o.layoutclasssignModuleList,method:"post",data:e})})({direction:d.type,width:d.sizeIndex.split("x")[0],high:d.sizeIndex.split("x")[1],schoolClassifyId:d.moduleId}).then((e=>{d.moduleList=e.data}))},g=()=>{const{width:e,high:l}=d.sizeType[d.type].sizeList[0];d.sizeIndex=`${e}x${l}`,v()},y=e=>{if("module"===e)t.$refs.addModuleRef.moduleVisible=!0;else{if(0===d.moduleTitList.length)return void a.error("请添加模块后再添加模块内容");d.moduleConInfo={},t.$refs.addModuleConRef.moduleVisible=!0}},O=e=>{d.sizeIndex=e.size,v()},w=I((()=>d.sizeType[d.type].sizeList)),M=I((()=>d.imgSizeType[d.type].sizeList));return T((()=>{b(null)})),(e,l)=>{const a=r("a-radio-button"),i=r("a-radio-group"),s=r("plus-outlined"),o=r("a-button"),n=r("a-col"),I=r("a-row");return m(),j(C,null,[k("div",W,[k("div",X,[h(i,{value:d.type,"onUpdate:value":l[0]||(l[0]=e=>d.type=e),onChange:g,"button-style":"solid"},{default:p((()=>[h(a,{value:0},{default:p((()=>[f("横版")])),_:1}),h(a,{value:1},{default:p((()=>[f("竖版")])),_:1})])),_:1},8,["value"]),h(o,{type:"primary",onClick:l[1]||(l[1]=e=>y("module"))},{icon:p((()=>[h(s)])),default:p((()=>[f(" 添加模块 ")])),_:1})]),d.moduleTitList.length>0?(m(),j("div",Y,[k("div",Z,[(m(!0),j(C,null,z(d.moduleTitList,(e=>(m(),j("div",{class:L(["list_item",{bg:d.moduleId===e.id}]),key:e.id,onClick:l=>{var a;(a=e).id!==d.moduleId&&(d.moduleId=a.id,d.moduleName=a.name,v())}},[f(x(e.name)+" ",1),k("div",{class:"del",onClick:U((l=>u("module",e)),["stop"])},"×",8,le)],10,ee)))),128))]),k("div",ae,[_(" {{ initState.sizeType[initState.type] }} "),(m(!0),j(C,null,z(M.value,((e,l)=>(m(),j("span",{key:`size${l}`,onClick:l=>{return a=e,d.sizeIndex=`${a.width}x${a.high}`,void v();var a},class:L({fontColor:d.sizeIndex===`${e.width}x${e.high}`})},x(e.width+"x"+e.high),11,ie)))),128))]),k("div",se,[h(I,{justify:"start",align:"top",gutter:[24,16]},{default:p((()=>[h(n,{xs:12,md:8,lg:6,xl:6},{default:p((()=>[k("div",{class:"module_add",onClick:l[2]||(l[2]=e=>y("moduleCon"))},[h(s,{style:{"font-size":"20px"}}),oe])])),_:1}),(m(!0),j(C,null,z(d.moduleList,((e,l)=>(m(),c(n,{xs:12,md:8,lg:6,xl:6,key:l},{default:p((()=>[k("div",te,[k("div",{style:$({borderColor:e.borderColor})},[k("span",null,x(d.moduleName),1),2===e.imgType?(m(),j("img",{key:0,style:{width:"100%",height:"80%","margin-top":"10px","border-radius":"4px"},src:e.images,alt:""},null,8,de)):_("v-if",!0)],4)]),k("div",ne,[k("span",{onClick:l=>{return a=e,t.$refs.addModuleConRef.moduleVisible=!0,void(d.moduleConInfo=a);var a}},"编辑",8,ue),k("span",{onClick:l=>u("moduleCon",e)},"删除",8,re)])])),_:2},1024)))),128))])),_:1})])])):(m(),j("div",me,ce))]),h(N,{ref:"addModuleRef",onHandleOk:b},null,512),h(B,{ref:"addModuleConRef",onHandleOk:O,moduleConInfo:d.moduleConInfo,direction:d.type,schoolClassifyId:d.moduleId,sizeList:w.value,imgSizeType:M.value},null,8,["moduleConInfo","direction","schoolClassifyId","sizeList","imgSizeType"])],64)}}},[["__scopeId","data-v-d5d21c94"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/appModel/smartClassSign/customModule/index.vue"]]);export{pe as default};
