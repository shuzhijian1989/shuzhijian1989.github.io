import"./vue.a2f518ee.js";import{a as e,u as a}from"./vue-router.907b547c.js";import{_ as i}from"./play.3707bb58.js";import{_ as t,aw as s}from"./index.7061e8ea.js";import{e as l,b as n,c as o,d,i as c,f as r,a as u,k as p,j as m,g}from"./album.dcc239e6.js";import{g as f}from"./oss.72e23b0d.js";import{D as y}from"./index.1cbb3529.js";import{m as h,M as v}from"./ant-design-vue.db4d48e3.js";import{y as b,q as k,r as L,b8 as A,o as _,a2 as w,a3 as S,c as x,O as I,a as j,F as C,a8 as U,a9 as V,b as z,a7 as D,h as F,w as M,f as T,M as R,H as K,L as O,n as H,b5 as P,b4 as B,m as E,bz as Y,Q as $,W as N,a6 as q}from"./@vue.919ff404.js";import{P as Q}from"./xgplayer.da4cd2f5.js";import{f as G}from"./@ant-design.2e172c39.js";import{u as X}from"./vuex.f308ecec.js";import"./@babel.6d5f88cb.js";/* empty css                    */import"./secure-ls.8c8acb46.js";import"./nprogress.c2257662.js";import"./axios.7aed06b8.js";import"./dayjs.49e29cb2.js";import"./qs.e55e9b28.js";import"./side-channel.ea627785.js";import"./get-intrinsic.8c87d952.js";import"./has-symbols.caae0f97.js";import"./has-proto.76cff6c7.js";import"./function-bind.cb3858f2.js";import"./has.c1051c46.js";import"./call-bind.208b5ef0.js";import"./object-inspect.e2cfb4a5.js";import"./vuex-persistedstate.fa252374.js";import"./vue-grid-layout.a3ef67ec.js";import"./resize-observer-polyfill.f664b406.js";import"./vue-types.022beab3.js";import"./@ctrl.c020ccd3.js";import"./dom-align.0991ecc5.js";import"./lodash-es.36dcd19c.js";import"./async-validator.267d9719.js";import"./scroll-into-view-if-needed.61c672a4.js";import"./compute-scroll-into-view.17358474.js";import"./ali-oss.e15d125a.js";import"./ydutils.99497787.js";import"./ydutils.a58fbaf1.js";import"./eventemitter3.dc5195d7.js";import"./delegate.22f46840.js";import"./downloadjs.a8c93dc4.js";var Z=t({__name:"moveAlbum",props:{classifiyId:{type:String,default:""},classifiyList:{type:Array,default:()=>[]},checkedAlbum:{type:Array,default:()=>[]}},emits:["handelOk"],setup(e,{expose:a,emit:i}){const t=e,s=b((()=>t.classifiyId)),n=b((()=>t.classifiyList)),o=k({btnLoading:!1}),d=L(!1),c=()=>{const e={ids:t.checkedAlbum,classifyId:t.classifiyId};o.btnLoading=!0,l(e).then((e=>{h.success(e.message),i("handelOk")})).finally((()=>{d.value=!1,o.btnLoading=!1}))};return a({visible:d}),(e,a)=>{const i=A("a-button"),t=A("a-select-option"),l=A("a-select"),r=A("a-form-item"),u=A("a-form"),p=A("a-modal");return _(),w(p,{maskClosable:!1,visible:d.value,"onUpdate:visible":a[2]||(a[2]=e=>d.value=e),title:"移动视频"},{footer:S((()=>[x(i,{key:"back",onClick:a[0]||(a[0]=e=>d.value=!1)},{default:S((()=>[I("取消")])),_:1}),x(i,{key:"submit",type:"primary",loading:o.btnLoading,onClick:c},{default:S((()=>[I("确定")])),_:1},8,["loading"])])),default:S((()=>[x(u,{layout:"vertical"},{default:S((()=>[x(r,{label:"移动至：",name:"name"},{default:S((()=>[x(l,{value:s.value,"onUpdate:value":a[1]||(a[1]=e=>s.value=e)},{default:S((()=>[(_(!0),j(C,null,U(n.value,(e=>(_(),w(t,{key:e.id,value:e.id},{default:S((()=>[I(V(e.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1})])),_:1})])),_:1},8,["visible"])}}},[["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/appModel/videoAlbum/components/moveAlbum.vue"]]);const J={class:"video"},W={id:"campusVideo_xigua",ref:"campusVideo_xigua"};var ee=t({__name:"albumPlay",props:{url:{type:String,default:""}},setup(e,{expose:a}){var i;const t=L(!1),s=k({bodyStyle:{padding:0,margin:0,height:"600px"},autoplay:!0});function l(){i.destroy(!0),t.value=!1}return a({visible:t,open:e=>{t.value=!0,(e=>{-1==e.indexOf("flv")?setTimeout((()=>{(i=new Q({id:"campusVideo_xigua",autoplay:!0,url:e,videoInit:!0,fitVideoSize:"auto",volume:.6,playbackRate:[.5,.75,1,1.5,2],defaultPlaybackRate:1,playsinline:!0,cors:!0,loop:!1,rotateFullscreen:!1,width:"100%",height:"500px",cssFullscreen:!1,maxBufferLength:10}))&&i.start(e)}),1):setTimeout((()=>{(i=new window.FlvJsPlayer({id:"campusVideo_xigua",autoplay:!0,url:e,videoInit:!0,fitVideoSize:"auto",volume:.6,playbackRate:[.5,.75,1,1.5,2],defaultPlaybackRate:1,playsinline:!0,cors:!0,loop:!1,rotateFullscreen:!1,width:"100%",height:"500px",cssFullscreen:!1,maxBufferLength:10}))&&i.start(e)}),1)})(e)}}),(e,a)=>{const i=A("a-modal");return _(),w(i,{width:"auto",closable:!1,maskClosable:!1,visible:t.value,"onUpdate:visible":a[0]||(a[0]=e=>t.value=e),bodyStyle:s.bodyStyle,footer:null},{default:S((()=>[z("div",{class:"close",onClick:l},"×"),z("div",J,[z("div",W,null,512),D(' <source src="movie.mp4" type="video/mp4" />\r\n            <source src="movie.webm" type="video/webm" />\r\n            <source src="movie.ogg" type="video/ogg" /> ')])])),_:1},8,["visible","bodyStyle"])}}},[["__scopeId","data-v-22f32d98"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/appModel/videoAlbum/components/albumPlay.vue"]]);function ae(){return{delAlbum:e=>new Promise(((a,i)=>{v.confirm({title:"提示",icon:x(G),content:`请确认删除${e.ids.length}视频`,okText:"确定",okType:"danger",cancelText:"取消",onOk(){n(e).then((e=>{a(e)})).catch((()=>{i()}))},onCancel(){i()}})})),deleteClassifiy:e=>new Promise(((a,i)=>{v.confirm({title:"删除提示",icon:x(G),content:F("div",{},[F("p",`确定删除视频分类【${e.name}】？`)]),okText:"确认",cancelText:"取消",onOk(){o({id:e.id}).then((e=>{a(e)})).catch((()=>{i()}))},onCancel(){i()}})}))}}const ie=e=>(P("data-v-85ef0d8a"),e=e(),B(),e),te={class:"videoAlbum"},se={class:"left"},le=ie((()=>z("span",{class:"tree_icon"},[z("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAMCAYAAABSgIzaAAAAAXNSR0IArs4c6QAAAIVJREFUKFNj/L+A4RYDA4MqAyr4wsDMYMIYy3ATTRzOZfy/gOE/Dsm7DAwMz3HI3YZoVIxmYJB0wmU4qvjzfQwM95cyMP5fz/efQTuXgYFHnjiNXx4yMFydzMD4/6T6fwZGRuI0wVT9/8/A+P+UBi4/4jVsVCOe4AEFzn0GBgYF0uKD4QEA2DoyATFp0w8AAAAASUVORK5CYII=",alt:""})],-1))),ne={class:"right"},oe={class:"header"},de=ie((()=>z("div",null,null,-1))),ce={key:0,class:"btn_list"},re={style:{color:"#00b781"}},ue={class:"list"},pe=ie((()=>z("div",{class:"box1"},[z("p",{class:"iconfont icon-xingzhuangjiehe14"}),z("p",null,"上传视频")],-1))),me=["onClick"],ge=["id"],fe=ie((()=>z("div",{class:"mask"},[z("img",{src:i,alt:""})],-1))),ye={class:"switch"},he=ie((()=>z("span",{style:{"margin-right":"8px"}},"展示",-1))),ve=ie((()=>z("span",{style:{"margin-right":"8px"}}," 设为首页视频 ",-1))),be={key:0,class:"list"},ke=[ie((()=>z("p",{class:"iconfont icon-xingzhuangjiehe14",style:{"margin-right":"0"}},null,-1))),ie((()=>z("p",null,"上传视频",-1)))],Le=["src"],Ae=ie((()=>z("div",{class:"mask"},null,-1))),_e={key:1,style:{margin:"auto",width:"180px"}},we=ie((()=>z("p",{style:{width:"180px","text-align":"center"}}," 暂无数据 ",-1))),Se={key:2,style:{margin:"16px 16px 0 0","text-align":"right"}};var xe=t({__name:"classes",setup(e){const a=X(),{proxy:i}=E(),{delAlbum:t,deleteClassifiy:l}=ae(),n=k({isHomeLogdin:!1,alertMessage:"1、不能超过500MB；2、视频格式，目前支持MP4,FLV； 3、首页模块只能展示一个视频。",classList:[],classesId:"",albumList:[],checkedVideo:[],videoUrlLook:"",checkAll:!1,indeterminate:!1,leftSpinLoad:!1,rightSpinLoad:!1,tabKey:"classes",classifyTitle:"新建视频分类",classifyShow:!1,classifiyList:[],selectedKeys:[],editFlag:!1,btnLoading:!1,classifyInfo:{id:"",name:""},paginationData:{total:0,current:1,pageSize:10},fileList:[],videoUrl:"",spinLoad:!1,percentage:0,isSureUpload:!0,isSizeUpload:!0}),o={key:"id",title:"name"};function v(){n.classifyInfo.name?(n.btnLoading=!0,"编辑视频分类"===n.classifyTitle?B():Y()):h.info("请输入分类名称")}const b=e=>{const a=e.name.match(/[^.]+$/)[0],i=["mp4","flv"].includes(a),t=e.size/1024/1024<500;return n.isSureUpload=i,n.isSizeUpload=t,i?t?(!i||!t)&&void 0:(h.error("文件大于500M，请重新上传"),!0):(h.error("请上传MP4,FLV格式文件!"),!0)},L=e=>{if(!n.isSureUpload||!n.isSizeUpload)return!1;n.percentage=0;const i=a.state.user.currentSchool.id;n.spinLoad=!0,f(e,{catalogue:""+("/"+i+"/videoAlbum")},(e=>{n.percentage=e})).then((a=>{const{code:i,msg:t,url:s}=a;0===i?(e.fileList.length>0&&(n.fileList=[e.fileList[e.fileList.length-1]]),n.videoUrl=s,n.fileList=[]):(n.$message.error(t),n.videoUrl="")})).finally((()=>{n.spinLoad=!1,q()}))},F=()=>{$()},P=()=>{const e={kind:1,classesId:n.classesId};n.leftSpinLoad=!0,g(e).then((e=>{var a;n.classifiyList=e.data,n.selectedKeys=[null==(a=e.data[0])?void 0:a.id],$()})).finally((()=>{n.leftSpinLoad=!1}))},B=()=>{d(n.classifyInfo).then((e=>{h.success("操作成功"),n.classifyShow=!1,P()})).finally((()=>{n.btnLoading=!1}))},Y=()=>{const e={kind:1,classesId:n.classesId,name:n.classifyInfo.name};c(e).then((e=>{h.success("操作成功"),n.classifyShow=!1,P()})).finally((()=>{n.btnLoading=!1}))},$=()=>{const e={type:2,kind:1,pageNo:n.paginationData.current,classifyId:n.selectedKeys[0],classesId:n.classesId,pageSize:n.paginationData.pageSize};n.rightSpinLoad=!0,r(e).then((({data:e})=>{const{list:a,total:i}=e;n.albumList=a,n.paginationData.total=i;const t=a.map(((e,a)=>({id:`${e.id}video${a}`,url:e.url})));H((()=>{t.forEach((e=>{((e={url:""})=>{let a=null;try{const i={...e,width:"100%",height:"100%",videoInit:!0,fitVideoSize:"auto",volume:.6,autoplay:!1,playbackRate:[.5,.75,1,1.5,2],defaultPlaybackRate:1,playsinline:!0,cors:!0,loop:!1,maxBufferLength:10,errorTips:"暂不支持音频/视频"};a=new Q(i)}catch(i){}})(e)}))}))})).finally((()=>{n.rightSpinLoad=!1}))},N=(e,a)=>{n.selectedKeys=[e],$()},q=e=>{const a={classesId:n.classesId,urls:[n.videoUrl],type:2,kind:1};u(a).then((e=>{h.success("操作成功"),$()}))},G=()=>{t({ids:n.checkedVideo}).then((e=>{h.success(e.message),n.paginationData.current=1,$(),n.checkedVideo=[],n.editFlag=!n.editFlag}))},J=()=>{n.modalVisible=!0},W=()=>{n.editFlag=!1,n.checkedVideo=[],$()},ie=()=>{n.editFlag=!1,n.checkedVideo=[]},xe=e=>{Object.assign(n,{checkedVideo:e.target.checked?n.albumList.map((e=>e.id)):[],indeterminate:!1,checkAll:e.target.checked})};M((()=>n.checkedVideo),(e=>{n.indeterminate=!!e.length&&e.length<n.albumList.length,n.checkAll=e.length===n.albumList.length}));const Ie=e=>{n.paginationData.current=e,$()};return T((()=>{s({code:"videoAlbum"}).then((e=>{var a;n.classList=e.data,n.classesId=null==(a=n.classList[0])?void 0:a.classesId,$()}))})),(e,a)=>{const t=A("a-select-option"),s=A("a-select"),d=A("more-outlined"),c=A("a-button"),r=A("a-menu-item"),u=A("a-menu"),g=A("a-dropdown"),f=A("a-spin"),k=A("a-alert"),M=A("a-checkbox"),T=A("a-upload"),H=A("a-switch"),B=A("a-checkbox-group"),E=A("a-empty"),Y=A("a-pagination"),q=A("a-input"),Q=A("a-form-item"),X=A("a-form"),ae=A("a-modal");return _(),j(C,null,[D(" 视频相册 1"),z("div",te,[z("div",se,[x(f,{spinning:n.leftSpinLoad},{default:S((()=>[x(s,{style:{width:"100%","margin-bottom":"20px"},onChange:F,value:n.classesId,"onUpdate:value":a[0]||(a[0]=e=>n.classesId=e)},{default:S((()=>[(_(!0),j(C,null,U(n.classList,(e=>(_(),w(t,{key:e.classesId},{default:S((()=>[I(V(e.classesName),1)])),_:2},1024)))),128))])),_:1},8,["value"]),x(y,{ref:"dempTree",treeData:n.classifiyList,fieldNames:o,onEmitSelect:N,selectedKeys:n.selectedKeys},{treeIcon:S((()=>[le])),handleItem:S((({handleItem:e})=>[x(g,{trigger:["hover"]},{overlay:S((()=>[x(u,null,{default:S((()=>[x(r,{onClick:a=>((e,a)=>{if(e){n.classifyTitle="编辑视频分类";for(const e in n.classifyInfo)n.classifyInfo[e]=a[e]}else{for(const e in n.classifyInfo)n.classifyInfo[e]="";n.classifyTitle="新增视频分类"}n.classifyShow=!0})(!0,e)},{default:S((()=>[x(c,{type:"text"},{default:S((()=>[I("编辑")])),_:1})])),_:2},1032,["onClick"]),x(r,{onClick:a=>{l(e).then((e=>{h.success(e.message),n.checkedVideo=[],P()}))}},{default:S((()=>[x(c,{type:"link",danger:""},{default:S((()=>[I("删除")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),default:S((()=>[z("a",{class:"ant-dropdown-link handle_icon",style:{"margin-right":"5px"},onClick:a[1]||(a[1]=R((()=>{}),["prevent","stop"]))},[x(d)])])),_:2},1024)])),_:1},8,["treeData","selectedKeys"]),D(' <a-button type="primary"  @click="addEditClassifiy(false, {})">\r\n                                    <template #icon>\r\n                                        <plus-outlined />\r\n                                    </template>\r\n                                    新建视频分类\r\n                                </a-button>')])),_:1},8,["spinning"])]),z("div",ne,[x(k,{class:"right-alert",message:n.alertMessage,type:"warning","show-icon":""},null,8,["message"]),x(f,{spinning:n.rightSpinLoad},{default:S((()=>[z("div",oe,[de,n.editFlag?(_(),j("div",ce,[x(M,{checked:n.checkAll,"onUpdate:checked":a[2]||(a[2]=e=>n.checkAll=e),indeterminate:n.indeterminate,onChange:xe},{default:S((()=>[I("全选")])),_:1},8,["checked","indeterminate"]),z("span",null,[I("已选择 "),z("span",re,V(n.checkedVideo.length),1),I(" 个 ")]),x(c,{onClick:G,disabled:!n.checkedVideo.length,danger:""},{default:S((()=>[I("删除")])),_:1},8,["disabled"]),D(' <a-button @click="moveAlbumItem" :disabled="!state.checkedVideo.length">移动</a-button> '),x(c,{onClick:ie},{default:S((()=>[I("取消")])),_:1})])):(_(),w(c,{key:1,type:"primary",onClick:a[3]||(a[3]=e=>n.editFlag=!n.editFlag)},{default:S((()=>[I("编辑")])),_:1}))]),K(z("div",ue,[z("div",{class:"video_item",onClick:J},[x(f,{spinning:n.spinLoad,tip:""+("上传中..."+n.percentage+"%")},{default:S((()=>[x(T,{ref:"uploads",accept:".mp4,.flv,.m3u8,.mpd",action:"/",multiple:!1,"show-upload-list":!1,"file-list":n.fileList,limit:1,"before-upload":b,onChange:L},{default:S((()=>[pe,D(' <div class="video" v-if="state.videoUrl">\r\n                                                    <video\r\n                                                        :src="state.videoUrl"\r\n                                                        controls="controls"\r\n                                                        class="video"\r\n                                                    ></video>\r\n                                                    <div class="del" @click="del">x</div>\r\n                                                </div>')])),_:1},8,["file-list"])])),_:1},8,["spinning","tip"])]),D(' <div id="video-player" class="video-player"></div> '),(_(!0),j(C,null,U(n.albumList,((e,a)=>(_(),j("div",{class:"video_item",key:e.id},[z("div",{class:"box",onClick:a=>{return t=e,n.videoUrlLook=t.url,void i.$refs.albumPlayRef.open(t.url);var t}},[z("div",{class:"main_item_video",id:e.id+"video"+a},null,8,ge),fe],8,me),z("div",ye,[z("div",null,[he,x(H,{checked:e.isShow,onChange:a=>(e=>{n.isHomeLogdin||(n.isHomeLogdin=!0,p({id:e.id}).then((e=>{h.success(e.message),$()})).finally((()=>n.isHomeLogdin=!1)))})(e)},null,8,["checked","onChange"])]),z("div",null,[ve,x(H,{checked:e.isHome,onChange:a=>{return i=e.id,void(n.isHomeLogdin||(n.isHomeLogdin=!0,m({id:i}).then((e=>{h.success(e.message),$()})).finally((()=>n.isHomeLogdin=!1))));var i}},null,8,["checked","onChange"])])])])))),128))],512),[[O,!n.editFlag]]),n.editFlag?(_(),j("div",be,[x(B,{value:n.checkedVideo,"onUpdate:value":a[4]||(a[4]=e=>n.checkedVideo=e)},{default:S((()=>[z("div",{class:"list_item1",onClick:J},ke),(_(!0),j(C,null,U(n.albumList,(e=>(_(),w(M,{key:e.id,value:e.id},{default:S((()=>[z("video",{src:e.url},null,8,Le),Ae])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])):D("v-if",!0),n.albumList.length?D("v-if",!0):(_(),j("div",_e,[x(E,{image:"/image/empty.png","image-style":{height:"180px",width:"180px"}},{description:S((()=>[we])),_:1})])),n.albumList.length>0?(_(),j("div",Se,[x(Y,{current:n.paginationData.current,"onUpdate:current":a[5]||(a[5]=e=>n.paginationData.current=e),pageSize:n.paginationData.pageSize,"onUpdate:pageSize":a[6]||(a[6]=e=>n.paginationData.pageSize=e),"show-quick-jumper":"",total:n.paginationData.total,onChange:Ie,"show-total":e=>`共 ${e} 条`},null,8,["current","pageSize","total","show-total"])])):D("v-if",!0)])),_:1},8,["spinning"])]),x(ae,{maskClosable:!1,visible:n.classifyShow,"onUpdate:visible":a[9]||(a[9]=e=>n.classifyShow=e),title:n.classifyTitle,onOk:v,width:"530px"},{footer:S((()=>[x(c,{key:"back",onClick:a[7]||(a[7]=e=>n.classifyShow=!1)},{default:S((()=>[I("取消")])),_:1}),x(c,{key:"submit",type:"primary",loading:n.btnLoading,onClick:v},{default:S((()=>[I("确定")])),_:1},8,["loading"])])),default:S((()=>[x(X,{layout:"vertical"},{default:S((()=>[x(Q,{label:"视频分类名称：",name:"name"},{default:S((()=>[x(q,{maxlength:20,value:n.classifyInfo.name,"onUpdate:value":a[8]||(a[8]=e=>n.classifyInfo.name=e),placeholder:"请输入分类名称"},null,8,["value"])])),_:1})])),_:1})])),_:1},8,["visible","title"]),x(ee,{ref:"albumPlayRef",url:n.videoUrlLook},null,8,["url"]),x(Z,{ref:"moveAlbumRef",classifiyList:n.classifiyList,classifiyId:n.selectedKeys[0],onHandelOk:W,checkedAlbum:n.checkedVideo},null,8,["classifiyList","classifiyId","checkedAlbum"])])],2112)}}},[["__scopeId","data-v-85ef0d8a"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/appModel/videoAlbum/components/classes.vue"]]);const Ie=e=>(P("data-v-98a943f6"),e=e(),B(),e),je={class:"videoAlbum"},Ce={class:"right"},Ue={class:"header"},Ve=Ie((()=>z("div",null,null,-1))),ze={key:0,class:"btn_list"},De={style:{color:"#00b781"}},Fe={class:"list"},Me=Ie((()=>z("div",{class:"box1"},[z("p",{class:"iconfont icon-xingzhuangjiehe14"}),z("p",null,"上传视频")],-1))),Te=["onClick"],Re=["src"],Ke=Ie((()=>z("div",{class:"mask"},[z("img",{src:i,alt:""})],-1))),Oe={class:"switch"},He=Ie((()=>z("span",{style:{"margin-right":"8px"}},"展示",-1))),Pe=Ie((()=>z("span",{style:{"margin-right":"8px"}}," 设为首页视频 ",-1))),Be={key:0,class:"list"},Ee=[Ie((()=>z("p",{class:"iconfont icon-xingzhuangjiehe14",style:{"margin-right":"0"}},null,-1))),Ie((()=>z("p",null,"上传视频",-1)))],Ye=["src"],$e=Ie((()=>z("div",{class:"mask"},null,-1))),Ne={key:1,style:{margin:"auto",width:"180px"}},qe=Ie((()=>z("p",{style:{width:"180px","text-align":"center"}}," 暂无数据 ",-1))),Qe={key:2,style:{margin:"16px 16px 0 0","text-align":"right"}};var Ge=t({__name:"schoolLevel",setup(e){const a=X(),{proxy:i}=E(),{delAlbum:t,deleteClassifiy:s}=ae(),l=k({isHomeLogdin:!1,alertMessage:"1、视频大小不能超过500MB；2、视频格式，目前支持MP4,FLV； 3、首页模块只能展示一个视频。",classList:[],albumList:[],checkedVideo:[],videoUrlLook:"",tabKey:"classes",checkAll:!1,indeterminate:!1,classifyTitle:"新建视频分类",classifyShow:!1,classifiyList:[],selectedKeys:"",editFlag:!1,btnLoading:!1,classifyInfo:{id:"",name:""},leftSpinLoad:!1,rightSpinLoad:!1,paginationData:{total:0,current:1,pageSize:10},fileList:[],videoUrl:"",spinLoad:!1,percentage:0}),n=e=>{const a=e.name.match(/[^.]+$/)[0],i=["mp4","flv"].includes(a),t=e.size/1024/1024<500;return l.isSureUpload=i,l.isSizeUpload=t,i?t?(!i||!t)&&void 0:(h.error("文件大于500M，请重新上传"),!0):(h.error("请上传MP4,FLV格式文件!"),!0)},o=async e=>{if(!l.isSureUpload||!l.isSizeUpload)return!1;l.percentage=0;const i=a.state.user.currentSchool.id;l.spinLoad=!0;const{code:t,msg:s,url:n}=await f(e,{catalogue:""+("/"+i+"/videoAlbum")},(e=>{l.percentage=e}));0===t?(e.fileList.length>0&&(l.fileList=[e.fileList[e.fileList.length-1]]),l.videoUrl=n,l.spinLoad=!1,l.fileList=[],c()):(l.spinLoad=!1,l.$message.error(s),l.videoUrl="",c())},d=()=>{const e={type:2,kind:2,pageNo:l.paginationData.current,classifyId:l.selectedKeys[0],pageSize:l.paginationData.pageSize};l.rightSpinLoad=!0,r(e).then((({data:e})=>{const{list:a,total:i}=e;l.albumList=a,l.paginationData.total=i;const t=a.map(((e,a)=>({id:`${e.id}video${a}`,url:e.url})));H((()=>{t.forEach((e=>{((e={url:""})=>{let a=null;try{const i={...e,width:"100%",height:"100%",videoInit:!0,fitVideoSize:"auto",volume:.6,autoplay:!1,playbackRate:[.5,.75,1,1.5,2],defaultPlaybackRate:1,playsinline:!0,cors:!0,loop:!1,maxBufferLength:10,errorTips:"暂不支持音频/视频"};a=new Q(i)}catch(i){}})(e)}))}))})).finally((()=>{l.rightSpinLoad=!1}))},c=e=>{const a={classifyId:l.selectedKeys[0],urls:[l.videoUrl],type:2,kind:2};u(a).then((e=>{h.success("操作成功"),d()}))},g=()=>{t({ids:l.checkedVideo}).then((e=>{h.success(e.message),l.paginationData.current=1,d(),l.checkedVideo=[],l.editFlag=!l.editFlag}))},y=()=>{},v=()=>{l.editFlag=!1,l.checkedVideo=[],d()},b=()=>{l.editFlag=!1,l.checkedVideo=[]},L=e=>{Object.assign(l,{checkedVideo:e.target.checked?l.albumList.map((e=>e.id)):[],indeterminate:!1,checkAll:e.target.checked})};M((()=>l.checkedVideo),(e=>{l.indeterminate=!!e.length&&e.length<l.albumList.length,l.checkAll=e.length===l.albumList.length}));const F=e=>{l.paginationData.current=e,d()};return T((()=>{d()})),(e,a)=>{const t=A("a-alert"),s=A("a-checkbox"),c=A("a-button"),r=A("a-upload"),u=A("a-spin"),f=A("a-switch"),k=A("a-checkbox-group"),M=A("a-empty"),T=A("a-pagination"),R=A("a-input"),H=A("a-form-item"),P=A("a-form"),B=A("a-modal");return _(),j(C,null,[D(" 视频相册 2"),z("div",je,[D(' <div class="left">\r\n            <a-spin :spinning="state.leftSpinLoad">\r\n                <DempTree\r\n                    ref="dempTree"\r\n                    :treeData="state.classifiyList"\r\n                    :fieldNames="fieldNames"\r\n                    @emitSelect="selectSemester"\r\n                    :selectedKeys="state.selectedKeys"\r\n                >\r\n                    <template #treeIcon>\r\n                        <img\r\n                            src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAMCAYAAABSgIzaAAAAAXNSR0IArs4c6QAAAIVJREFUKFNj/L+A4RYDA4MqAyr4wsDMYMIYy3ATTRzOZfy/gOE/Dsm7DAwMz3HI3YZoVIxmYJB0wmU4qvjzfQwM95cyMP5fz/efQTuXgYFHnjiNXx4yMFydzMD4/6T6fwZGRuI0wVT9/8/A+P+UBi4/4jVsVCOe4AEFzn0GBgYF0uKD4QEA2DoyATFp0w8AAAAASUVORK5CYII="\r\n                            alt\r\n                        />\r\n                    </template>\r\n                    <template #handleItem="{ handleItem }">\r\n                        <a-dropdown :trigger="[\'hover\']">\r\n                            <a\r\n                                class="ant-dropdown-link handle_icon"\r\n                                style="margin-right: 5px"\r\n                                @click.prevent.stop\r\n                            >\r\n                                <more-outlined />\r\n                            </a>\r\n                            <template #overlay>\r\n                                <a-menu>\r\n                                    <a-menu-item\r\n                                        @click="addEditClassifiy(true, handleItem)"\r\n                                    >\r\n                                        <a-button type="text">编辑</a-button>\r\n                                    </a-menu-item>\r\n                                    <a-menu-item\r\n                                        @click="delClassifiy(handleItem)"\r\n                                    >\r\n                                        <a-button type="link" danger\r\n                                            >删除</a-button\r\n                                        >\r\n                                    </a-menu-item>\r\n                                </a-menu>\r\n                            </template>\r\n                        </a-dropdown>\r\n                    </template>\r\n                </DempTree>\r\n                <a-button type="primary"  @click="addEditClassifiy(false, {})">\r\n                    <template #icon>\r\n                        <plus-outlined />\r\n                    </template>\r\n                    新建视频分类\r\n                </a-button>\r\n            </a-spin>\r\n        </div>'),z("div",Ce,[x(t,{class:"right-alert",message:l.alertMessage,type:"warning","show-icon":""},null,8,["message"]),x(u,{spinning:l.rightSpinLoad},{default:S((()=>[z("div",Ue,[Ve,l.editFlag?(_(),j("div",ze,[x(s,{checked:l.checkAll,"onUpdate:checked":a[0]||(a[0]=e=>l.checkAll=e),indeterminate:l.indeterminate,onChange:L},{default:S((()=>[I("全选")])),_:1},8,["checked","indeterminate"]),z("span",null,[I("已选择 "),z("span",De,V(l.checkedVideo.length),1),I(" 个 ")]),x(c,{onClick:g,disabled:!l.checkedVideo.length,danger:""},{default:S((()=>[I("删除")])),_:1},8,["disabled"]),D(' <a-button @click="moveAlbumItem" :disabled="!state.checkedVideo.length">移动</a-button> '),x(c,{onClick:b},{default:S((()=>[I("取消")])),_:1})])):(_(),w(c,{key:1,type:"primary",onClick:a[1]||(a[1]=e=>l.editFlag=!l.editFlag)},{default:S((()=>[I("编辑")])),_:1}))]),K(z("div",Fe,[z("div",{class:"video_item",onClick:y},[x(u,{spinning:l.spinLoad,tip:""+("上传中..."+l.percentage+"%")},{default:S((()=>[x(r,{ref:"uploads",accept:".mp4,.flv,.m3u8,.mpd",action:"/",multiple:!1,"show-upload-list":!1,"file-list":l.fileList,limit:1,"before-upload":n,onChange:o},{default:S((()=>[Me])),_:1},8,["file-list"])])),_:1},8,["spinning","tip"])]),(_(!0),j(C,null,U(l.albumList,(e=>(_(),j("div",{class:"video_item",key:e.id},[z("div",{class:"box",onClick:a=>{return t=e,l.videoUrlLook=t.url,void i.$refs.albumPlayRef.open(t.url);var t}},[D(' <div\r\n                                class="main_item_video"\r\n                                :id="item.id + \'video\' + index"\r\n                            ></div> '),z("video",{src:e.url},null,8,Re),Ke],8,Te),z("div",Oe,[z("div",null,[He,x(f,{checked:e.isShow,onChange:a=>(e=>{l.isHomeLogdin||(l.isHomeLogdin=!0,p({id:e.id}).then((e=>{h.success(e.message),d()})).finally((()=>l.isHomeLogdin=!1)))})(e)},null,8,["checked","onChange"])]),z("div",null,[Pe,x(f,{checked:e.isHome,onChange:a=>{return i=e.id,void(l.isHomeLogdin||(l.isHomeLogdin=!0,m({id:i}).then((e=>{h.success(e.message),d()})).finally((()=>l.isHomeLogdin=!1))));var i}},null,8,["checked","onChange"])])])])))),128))],512),[[O,!l.editFlag]]),l.editFlag?(_(),j("div",Be,[x(k,{value:l.checkedVideo,"onUpdate:value":a[2]||(a[2]=e=>l.checkedVideo=e)},{default:S((()=>[z("div",{class:"list_item1",onClick:y},Ee),(_(!0),j(C,null,U(l.albumList,(e=>(_(),w(s,{key:e.id,value:e.id},{default:S((()=>[z("video",{src:e.url},null,8,Ye),$e])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])):D("v-if",!0),l.albumList.length<=0?(_(),j("div",Ne,[x(M,{image:"/image/empty.png","image-style":{height:"180px",width:"180px"}},{description:S((()=>[qe])),_:1})])):D("v-if",!0),l.albumList.length>0?(_(),j("div",Qe,[x(T,{current:l.paginationData.current,"onUpdate:current":a[3]||(a[3]=e=>l.paginationData.current=e),pageSize:l.paginationData.pageSize,"onUpdate:pageSize":a[4]||(a[4]=e=>l.paginationData.pageSize=e),"show-quick-jumper":"",total:l.paginationData.total,onChange:F,"show-total":e=>`共 ${e} 条`,pageSizeOptions:["10","20","24","48","50","60","80"]},null,8,["current","pageSize","total","show-total"])])):D("v-if",!0)])),_:1},8,["spinning"])]),x(B,{maskClosable:!1,visible:l.classifyShow,"onUpdate:visible":a[7]||(a[7]=e=>l.classifyShow=e),title:l.classifyTitle,onOk:e.classifyOkFn,width:"530px"},{footer:S((()=>[x(c,{key:"back",onClick:a[5]||(a[5]=e=>l.classifyShow=!1)},{default:S((()=>[I("取消")])),_:1}),x(c,{key:"submit",type:"primary",loading:l.btnLoading,onClick:e.classifyOkFn},{default:S((()=>[I("确定")])),_:1},8,["loading","onClick"])])),default:S((()=>[x(P,{layout:"vertical"},{default:S((()=>[x(H,{label:"视频分类名称：",name:"name"},{default:S((()=>[x(R,{maxlength:20,value:l.classifyInfo.name,"onUpdate:value":a[6]||(a[6]=e=>l.classifyInfo.name=e),placeholder:"请输入分类名称"},null,8,["value"])])),_:1})])),_:1})])),_:1},8,["visible","title","onOk"]),x(ee,{ref:"albumPlayRef",url:l.videoUrlLook},null,8,["url"]),x(Z,{ref:"moveAlbumRef",classifiyList:l.classifiyList,classifiyId:l.selectedKeys[0],onHandelOk:v,checkedAlbum:l.checkedVideo},null,8,["classifiyList","classifiyId","checkedAlbum"])])],2112)}}},[["__scopeId","data-v-98a943f6"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/appModel/videoAlbum/components/schoolLevel.vue"]]);const Xe={class:"videoAlbum_box"},Ze={class:"header"},Je=(e=>(P("data-v-54573098"),e=e(),B(),e))((()=>z("i",{class:"iconfont icon-xingzhuangjiehe19"},null,-1)));var We=t({__name:"index",setup(i){Y((e=>({"54573098-showBackStyle":e.showBackStyle})));const t=L("classes"),s=$(xe),l=e(),n=a(),o=e=>{s.value="classes"===e?xe:Ge},d=()=>{n.push({name:l.query.source})};return(e,a)=>{const i=A("a-button"),l=A("a-tab-pane"),n=A("a-tabs");return _(),j(C,null,[D(" 视频相册0 "),z("div",Xe,[z("div",Ze,[x(n,{activeKey:t.value,"onUpdate:activeKey":a[0]||(a[0]=e=>t.value=e),onChange:o},{leftExtra:S((()=>[N(e.$slots,"leftExtra",{},(()=>[x(i,{type:"text",class:"tabs_back",onClick:d},{default:S((()=>[Je,D(' <arrow-left-outlined class="tabs_back__icon" /> ')])),_:1})]),!0)])),default:S((()=>[x(l,{key:"classes",tab:"班级"}),x(l,{key:"schoolLevel",tab:"校级"})])),_:3},8,["activeKey"]),(_(),w(q(s.value)))])])],2112)}}},[["__scopeId","data-v-54573098"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/appModel/videoAlbum/index.vue"]]);export{We as default};
