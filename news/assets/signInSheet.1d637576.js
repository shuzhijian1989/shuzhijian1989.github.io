import{_ as e,u as t,p as a}from"./index.7061e8ea.js";import"./vue.a2f518ee.js";import{_ as o}from"./siteImg.e530de90.js";import{c as s}from"./chooseSite.149fe6d3.js";import{S as i}from"./index.7c2c5596.js";import{d as n}from"./dayjs.49e29cb2.js";import{e as d,s as l,f as r,h as u}from"./siteBooking.8c7dbe73.js";import{m as c}from"./ant-design-vue.db4d48e3.js";import{b as m}from"./siteDetail.3ffd69d1.js";import{v as p}from"./uuid.73c2ed78.js";import{r as g,q as k,w as v,f,v as h,b8 as b,o as y,a as I,b as w,c as S,a3 as x,F as D,a8 as F,u as Y,a2 as _,a9 as N,a7 as M,O as T,aL as B,b5 as O,b4 as L,n as j,a4 as C,M as z}from"./@vue.919ff404.js";import{_ as U}from"./index.272083a4.js";import{u as H,a as R}from"./vue-router.907b547c.js";const V=e=>(O("data-v-91262c8e"),e=e(),L(),e),q={class:"records"},E=V((()=>w("span",{style:{"margin-left":"10px"}},"预约",-1))),W={class:"content"},A={class:"top"},$={class:"left"},P=V((()=>w("div",{class:"titl"},"预约内容",-1))),J=V((()=>w("div",{style:{"margin-bottom":"6px",display:"flex","align-items":"center"}},[w("span",{style:{color:"red",padding:"4px 4px 0px 0px"}},"* "),T(" 设置开始时间 : ")],-1))),K={style:{display:"flex","align-items":"center",width:"100%"}},G={key:0},Q={key:1},X={style:{display:"flex"}},Z={class:"right"},ee=V((()=>w("div",{class:"titl"},"场地可选预约时间",-1))),te={key:0},ae=B('<div class="table-header" data-v-91262c8e><div data-v-91262c8e><span class="box1 span" data-v-91262c8e></span>课程</div><div data-v-91262c8e><span class="box2 span" data-v-91262c8e></span>已预约</div><div data-v-91262c8e><span class="box3 span" data-v-91262c8e></span>审核中</div><div data-v-91262c8e><span class="box4 span" data-v-91262c8e></span>可预约</div><div data-v-91262c8e><span class="box5 span" data-v-91262c8e></span>不可预约 </div></div>',1),oe={class:"tubiao"},se={key:1,class:"empty"},ie=[V((()=>w("img",{src:o,alt:""},null,-1))),V((()=>w("p",null,"请先在左侧选择场地",-1)))],ne={class:"footer"};var de=e({__name:"toBooking",props:{typeId:{type:String,default:""},bookDetail:{type:Object,default:()=>{}}},emits:["showView"],setup(e,{emit:o}){const u=e,B=t(),O=g(),L=g(),j=g(),C=k({organizatioData:[],studentstatusData:[],selectData:[],weekNum:0,initProps:!1,houred:[],mined:[],houreds:[],mineds:[],codes:"",visible:!1,statusNum:null,checkedList:[],chooseSiteVisible:!1,bookForm:{schedule:!0,signIn:!0,dateTime:"",time:"",duration:null},formRules:{name:[{trigger:"change",required:!0,message:"请输入预约主题"}],dateTime:[{trigger:"change",required:!0,message:"请选择日期"}],time:[{trigger:"blur",required:!0,message:"请选择时间"}],duration:[{trigger:"blur",required:!0,message:"请选择预约时长"}],site:[{trigger:"change",required:!0,message:"请选择场地"}]},textNum:0,inputNumber:0,maxInput:30,typeId:"",typeOptions:[],siteId:[],begainMins:"",siteBookingSignList:[],chooseSiteId:"",addOneWeek:0,duration:{hour:0,min:0},nowHourMinute:""+(n().hour()+":"+n().minute()),changeWeek:"",occupy:[],actnum:1}),z=U();function U(){const e=[];for(let t=0;t<1440;t+=15){const a=t%60;let o=parseInt(t/60);o=H(o,2),e.push(o+":"+a)}return e.shift(),e}function H(e,t){return String(e).length>t?e:(Array(t).join(0)+e).slice(-t)}v((()=>u.bookDetail),((e,t)=>{var a,o,s,i,n;"{}"!==JSON.stringify(e)&&(C.typeId=e.siteBookingTypeId,C.siteId[0]=e.siteId,C.siteBookingSignList=e.signList.map((e=>({userId:e.userId,userType:e.userType,dept:e.dept}))),C.bookForm=e,C.bookForm.site=e.siteInfo.name,C.chooseSiteId=e.siteInfo.id,C.bookForm.participants=e.signList.map((e=>e.userName)),C.bookForm.dateTime=e.startTimeStr.substring(0,10),C.bookForm.time=e.startTimeStr.substring(16,11),e.duration?(C.duration=e.duration,C.bookForm.duration=e.duration&&(null==(a=e.duration)?void 0:a.hour)<10?"0"+(null==(o=e.duration)?void 0:o.hour)+":"+(null==(s=e.duration)?void 0:s.min):(null==(i=e.duration)?void 0:i.hour)+":"+(null==(n=e.duration)?void 0:n.min)):C.duration={hour:0,min:0})}),{immediate:!0,deep:!0}),v((()=>C.bookForm.begainHour),((e,t)=>{}),{immediate:!0,deep:!0});const R=()=>{o("showView")};function V(){var e;const t=[],a=null==(e=C.nowHourMinute)?void 0:e.split(":");if(C.bookForm.dateTime===n().format("YYYY-MM-DD"))for(let s=0;s<parseInt(a[0]);s++)t.push(s);const o=[];for(let s=0;s<8;s++)o.push(s);return o.concat(t).filter(((e,t,a)=>a.indexOf(e)===t))}function de(e){var t;const a=null==(t=C.nowHourMinute)?void 0:t.split(":"),o=[];if(e===parseInt(a[0])&&C.bookForm.dateTime===n().format("YYYY-MM-DD"))for(let s=0;s<parseInt(a[1]);s++)o.push(s);return o}const le=()=>{C.inputNumber=C.bookForm.name.length},re=e=>e&&e<n().endOf("day").add(-1,"day"),ue=()=>{C.chooseSiteVisible=!1},ce=(e,t)=>{if(C.siteId=e,t.forEach((t=>{t.id===e[0]&&(C.chooseSiteId=t.id,C.bookForm.site=t.siteName,C.statusNum=t.status)})),C.chooseSiteId)if(1===C.statusNum)c.error("该场地已约满"),C.chooseSiteId=null,C.bookForm.site="";else{C.chooseSiteVisible=!1;const e=n().startOf("week").format("YYYY-MM-DD"),t=n().endOf("week").format("YYYY-MM-DD"),a=C.chooseSiteId;C.actnum=1,C.occupy=[],be(e,t,a),C.actnum=1,O.value&&(O.value.calendarOptions.events=[]),C.occupy=[];const o=n().startOf("week").format("YYYY-MM-DD"),s=n().endOf("week").format("YYYY-MM-DD"),i=C.chooseSiteId;be(o,s,i)}else c.warning("请先选择场地")},me=e=>{C.selectData=e>1?C.studentstatusData:C.organizatioData},pe=e=>{C.siteBookingSignList=e.map((e=>{let t="";return t=1===e._source?e.deptString:e.className,{userId:e.id,userType:1===e._source?1:0,dept:t}})),C.bookForm.participants=e.map((e=>e.name)),C.visible=!1},ge=e=>{C.siteId=e},ke=()=>{const e=n(C.bookForm.dateTime).format(),t=m(n(e).day()),a=n(e).day()?t:"日";C.changeWeek=""+("周"+a)},ve=e=>{C.weekNum++;const t=n().startOf("week").add(C.weekNum,"week").format("YYYY-MM-DD"),a=n().endOf("week").add(C.weekNum,"week").format("YYYY-MM-DD");be(t,a,C.chooseSiteId)},fe=e=>{C.weekNum--;const t=n().startOf("week").add(C.weekNum,"week").format("YYYY-MM-DD"),a=n().endOf("week").add(C.weekNum,"week").format("YYYY-MM-DD");be(t,a,C.chooseSiteId)},he=(e,t,a=null)=>e.map(((e,a)=>({id:p(),color:t,start:`${e.startTime.replace(/\s+/g,"T")}:00`,end:`${e.endTime.replace(/\s+/g,"T")}:00`}))),be=(e,t,a,o=C.typeId)=>{r({startTime:e,endTime:t,siteId:a,siteBookingTypeId:o}).then((e=>{const{inApprovalDateList:t,noBookingDateList:a,timetableDateList:o,yesBookingDateList:s}=e.data,i=he(o,"#00B781"),n=he(s,"#F5222D"),d=he(t,"#FAAD14"),l=he(a,"#cccccc");1===C.actnum&&0===C.occupy.length?O.value.calendarOptions.events=i.concat(n,d,l):C.occupy=i.concat(n,d,l)}))};return f((()=>{C.typeId=u.typeId,B.dispatch("selectSource/setOrganizationTree",{code:"siteBooking"}).then((e=>{C.selectData=e,C.organizatioData=e})),B.dispatch("selectSource/setStudentStatusTree",{code:"siteBooking"}).then((e=>{C.studentstatusData=e})),l().then((e=>{C.typeOptions=e.data})),U()})),h((()=>{})),(e,t)=>{const o=b("a-layout-header"),n=b("a-input"),l=b("a-form-item"),r=b("a-date-picker"),m=b("a-time-picker"),p=b("a-select-option"),g=b("a-select"),k=b("a-textarea"),v=b("a-checkbox"),f=b("a-form"),h=a;return y(),I("div",null,[w("div",q,[S(o,{class:"reset-layout-header layout-header-radius",style:{position:"relative"}},{default:x((()=>[w("i",{class:"iconfont icon-xingzhuangjiehe19",onClick:t[0]||(t[0]=e=>R())}),E])),_:1}),w("div",W,[w("div",A,[w("div",$,[P,S(f,{ref_key:"formRef",ref:j,layout:"vertical",model:C.bookForm,name:"base",rules:C.formRules},{default:x((()=>[S(l,{name:"name",label:"预约主题 :"},{default:x((()=>[S(n,{maxlength:30,value:C.bookForm.name,"onUpdate:value":t[1]||(t[1]=e=>C.bookForm.name=e),valueModifiers:{trim:!0},onInput:le,placeholder:"请输入",showCount:""},null,8,["value"])])),_:1}),S(l,{name:"site",label:"场地 :"},{default:x((()=>[S(n,{value:C.bookForm.site,"onUpdate:value":t[2]||(t[2]=e=>C.bookForm.site=e),readonly:!0,onClick:t[3]||(t[3]=e=>{C.chooseSiteVisible=!0}),placeholder:"请选择(单选)"},null,8,["value"])])),_:1}),J,w("div",K,[S(l,{name:"dateTime",style:{width:"70%"}},{default:x((()=>[S(r,{format:""+("YYYY-MM-DD  "+C.changeWeek),valueFormat:"YYYY-MM-DD",style:{width:"95%"},value:C.bookForm.dateTime,"onUpdate:value":t[4]||(t[4]=e=>C.bookForm.dateTime=e),onChange:ke,placeholder:"请选择","disabled-date":re},null,8,["format","value"])])),_:1}),S(l,{name:"time",style:{width:"30%"}},{default:x((()=>[S(m,{style:{width:"101%"},hideDisabledOptions:"",format:"HH:mm",valueFormat:"HH:mm",showNow:!1,value:C.bookForm.time,"onUpdate:value":t[5]||(t[5]=e=>C.bookForm.time=e),placeholder:"请选择",disabledHours:V,disabledMinutes:de,minuteStep:15},null,8,["value"])])),_:1})]),S(l,{name:"duration",label:"预约时长："},{default:x((()=>[S(g,{ref:"select",value:C.bookForm.duration,"onUpdate:value":t[6]||(t[6]=e=>C.bookForm.duration=e),placeholder:"请选择预约时长"},{default:x((()=>[(y(!0),I(D,null,F(Y(z),(e=>(y(),_(p,{value:e,key:e},{default:x((()=>["00"!==e.slice(0,2)?(y(),I("span",G,N(e.slice(0,2)+"小时"),1)):M("v-if",!0),"00"!==e.slice(3,5)&&"0"!==e.slice(3,5)?(y(),I("span",Q,N(e.slice(3,5)+"分钟"),1)):M("v-if",!0)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),S(l,{name:"participants",label:"参会人 :"},{default:x((()=>[S(n,{onClick:t[7]||(t[7]=e=>{C.visible=!0}),"allow-clear":"",value:C.bookForm.participants,"onUpdate:value":t[8]||(t[8]=e=>C.bookForm.participants=e),placeholder:"请选择"},null,8,["value"])])),_:1}),S(l,{name:"shuom",label:"预约说明 :"},{default:x((()=>[S(k,{maxlength:300,value:C.bookForm.describe,"onUpdate:value":t[9]||(t[9]=e=>C.bookForm.describe=e),onInput:t[10]||(t[10]=e=>{C.textNum=C.bookForm.describe.length}),placeholder:"请输入",showCount:"","auto-size":{minRows:3,maxRows:5}},null,8,["value"])])),_:1}),w("div",X,[S(l,null,{default:x((()=>[S(v,{checked:C.bookForm.schedule,"onUpdate:checked":t[11]||(t[11]=e=>C.bookForm.schedule=e)},{default:x((()=>[T("是否加入日程安排")])),_:1},8,["checked"])])),_:1}),S(l,null,{default:x((()=>[S(v,{checked:C.bookForm.signIn,"onUpdate:checked":t[12]||(t[12]=e=>C.bookForm.signIn=e)},{default:x((()=>[T("是否需要签到")])),_:1},8,["checked"])])),_:1})])])),_:1},8,["model","rules"])]),w("div",Z,[ee,C.chooseSiteId?(y(),I("div",te,[ae,w("div",oe,[S(i,{onNextWeeks:ve,onPrevWeeks:fe,ref_key:"schedRef",ref:O,initialEvents:C.occupy},null,8,["initialEvents"])])])):(y(),I("div",se,ie))])])]),w("div",ne,[w("div",{class:"footer_btn",onClick:t[13]||(t[13]=e=>{j.value.validate().then((()=>{const e={};e.name=C.bookForm.name,e.siteBookingTypeId=C.typeId,e.siteId=C.chooseSiteId,e.startTime=C.bookForm.dateTime+" "+C.bookForm.time,e.describe=C.bookForm.describe;const t=C.bookForm.duration.substring(0,2),a=C.bookForm.duration.substring(3,5);C.duration.hour="00"===t?"0":t.replace(/\b(0+)/gi,""),C.duration.min=a,e.duration=C.duration,e.schedule=C.bookForm.schedule?1:0,e.signIn=C.bookForm.signIn?1:0,e.siteBookingSignList=C.siteBookingSignList,d(e).then((e=>{0===e.code&&(c.success(e.message),R())}))}))})},"提交")])]),M(" 选择场地 "),S(s,{title:"选择场地",ref_key:"statusRef",ref:L,isRadio:!0,types:C.typeOptions,typeId:u.typeId,isVisible:C.chooseSiteVisible,onSelectChangeArr:ge,onEmitHandleOk:ce,onEmithandleCancel:ue},null,8,["types","typeId","isVisible"]),M(" 选人组件 "),S(h,{mode:"personnel",tabs:[{tab:"教职工",key:1,checked:!0},{tab:"学生组",key:2,checked:!1}],treeData:C.selectData,visible:C.visible,"onUpdate:visible":t[14]||(t[14]=e=>C.visible=e),checked:C.checkedList,"onUpdate:checked":t[15]||(t[15]=e=>C.checkedList=e),codes:"siteBooking",onHandleOk:pe,onEmitChangeTabs:me},null,8,["treeData","visible","checked"])])}}},[["__scopeId","data-v-91262c8e"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/appModel/siteBooking/siteBook/toBooking.vue"]]);const le={class:"dao"},re=(e=>(O("data-v-5713dc94"),e=e(),L(),e))((()=>w("span",{style:{"margin-left":"10px"}},"签到表",-1))),ue={class:"warps"},ce={class:"sear"};var me=e({__name:"signInSheet",emits:["showViews"],setup(e,{emit:t}){H();const a=R(),o=k({visible:!1,spinLoad:!1,pagination:{pageNo:1,pageSize:10,total:0},status:null,userName:"",siteBookingId:a.query.siteBookingId,tables:[],statusList:[{statusName:"全部",status:null},{statusName:"未签到",status:0},{statusName:"已签到",status:1},{statusName:"未开始",status:2}],statusIndex:0}),s=[{title:"序号",key:"id",ellipsis:!0,width:"100px",customRender:({index:e})=>`${e+1}`,fixed:"left"},{title:"姓名",dataIndex:"userName"},{title:"所在部门",dataIndex:"dept"},{title:"状态",dataIndex:"signInTime"}],i=()=>{o.pagination.pageNo=1,d()},n=e=>{const{current:t,pageSize:a}=e;o.pagination.pageNo=t,o.pagination.pageSize=a,d()};v((()=>a.query.siteBookingId),(e=>{o.siteBookingId=e}),{immediate:!0,deep:!0});const d=()=>{o.spinLoad=!0;const e={status:o.status,userName:o.userName,siteBookingId:window.localStorage.getItem("_siteBookingId"),pageNo:o.pagination.pageNo,pageSize:o.pagination.pageSize};u(e).then((e=>{const{list:t,total:a,pageNo:s,pageSize:i}=e.data;o.tables=t,o.pagination.pageNo=s,o.pagination.pageSize=i,o.pagination.total=a,o.spinLoad=!1})).finally((()=>{o.spinLoad=!1}))};return f((()=>{o.tables=[],j((()=>{i()}))})),(e,a)=>{const l=b("a-layout-header"),r=b("a-input"),u=b("a-form-item"),c=b("SearchOutlined"),m=b("a-button"),p=b("redo-outlined"),g=b("a-form"),k=b("caret-down-outlined"),v=b("a-menu-item"),f=b("a-menu"),h=b("a-dropdown"),Y=b("a-badge");return y(),I("div",le,[S(l,{class:"reset-layout-header",style:{position:"relative","z-index":"999"}},{default:x((()=>[w("i",{class:"iconfont icon-xingzhuangjiehe19",onClick:a[0]||(a[0]=e=>{t("showViews")})}),re])),_:1}),w("div",ue,[w("div",ce,[S(g,{layout:"inline"},{default:x((()=>[S(u,{label:"姓名："},{default:x((()=>[S(r,{value:o.userName,"onUpdate:value":a[1]||(a[1]=e=>o.userName=e),valueModifiers:{trim:!0},placeholder:"请输入",style:{width:"240px"}},null,8,["value"])])),_:1}),S(u,null,{default:x((()=>[S(m,{type:"primary",style:{"margin-right":"12px"},onClick:a[2]||(a[2]=e=>i())},{icon:x((()=>[S(c,{style:{"margin-right":"12px"}})])),default:x((()=>[T(" 查询 ")])),_:1}),S(m,{onClick:a[3]||(a[3]=e=>(o.userName="",o.status=null,o.pagination.pageNo=1,void d()))},{icon:x((()=>[S(p,{style:{"margin-right":"12px"}})])),default:x((()=>[T(" 重置 ")])),_:1})])),_:1})])),_:1})]),S(U,{columns:s,dataSource:o.tables,slots:["operation"],rowSelection:!1,totals:o.pagination,spinLoad:o.spinLoad,onOnSelectedRowKeys:n},{headerCell:x((({column:e})=>["signInTime"===e.dataIndex?(y(),_(h,{key:0},{overlay:x((()=>[S(f,null,{default:x((()=>[(y(!0),I(D,null,F(o.statusList,((e,t)=>(y(),_(v,{key:t,onClick:a=>((e,t)=>{o.statusIndex=t,o.status=e.status,d()})(e,t)},{default:x((()=>[w("span",{class:C(o.statusIndex===t?"act":"")},N(e.statusName),3)])),_:2},1032,["onClick"])))),128))])),_:1})])),default:x((()=>[w("a",{style:{color:"#000"},onClick:a[4]||(a[4]=z((()=>{}),["prevent"]))},[T(" 状态 "),S(k,{style:{color:"var(--primary-color)"}})])])),_:1})):M("v-if",!0)])),bodyCell:x((({column:e,record:t})=>["signInTime"===e.dataIndex?(y(),_(Y,{key:0,status:["warning","success","default"][t.status],text:["未签到","已签到","未开始"][t.status]},null,8,["status","text"])):M("v-if",!0)])),_:1},8,["dataSource","totals","spinLoad"])])])}}},[["__scopeId","data-v-5713dc94"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/appModel/siteBooking/appointmentRecord/signInSheet.vue"]]);export{me as s,de as t};
