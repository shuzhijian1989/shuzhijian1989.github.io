import"./vue.a2f518ee.js";import{_ as e}from"./index.272083a4.js";import{_ as t,u as a,bq as s,br as l,bs as i,ax as n,ao as c,bt as d,ag as o,bu as r,bv as u,bw as p,bx as h,by as m}from"./index.7061e8ea.js";import{u as y}from"./vue-router.907b547c.js";import{q as v,y as f,w as g,R as b,r as k,t as _,b8 as x,o as N,a as S,b as L,W as w,c as I,a3 as T,F as K,a8 as C,a2 as D,O,a7 as P,a9 as U,a4 as j,a5 as z,a1 as A,b5 as E,b4 as q,f as M,u as R,M as V}from"./@vue.919ff404.js";import{m as F}from"./ant-design-vue.db4d48e3.js";import{E as $}from"./@ant-design.2e172c39.js";const B=e=>(E("data-v-20f91915"),e=e(),q(),e),H={class:"y_select"},J={class:"userselect_search"},W={class:"userselect"},Y={key:0,style:{"max-height":"500px","overflow-y":"scroll"}},G=B((()=>L("i",{class:"iconfont icon-yellow icon-a-Fill21"},null,-1))),Q={key:0},X={style:{color:"red"}},Z={key:1},ee={style:{"font-size":"12px"}},te={key:0},ae=B((()=>L("i",{class:"iconfont icon-yellow icon-a-Fill21"},null,-1))),se={key:1},le=B((()=>L("i",{class:"iconfont icon-yellow icon-a-Fill21"},null,-1))),ie={key:1,class:"hide_empty"},ne=B((()=>L("div",null,"暂无数据",-1))),ce={style:{"font-size":"12px"}},de=B((()=>L("i",{class:"iconfont icon-yellow icon-a-Fill21"},null,-1)));var oe=t({__name:"indexFace",props:{checkParents:{type:Boolean,default:!1},treeData:{type:Array,default:()=>[]},customTree:{type:Array,default:()=>[]},deviceId:{type:String,default:""},fieldNames:{type:Object,default:()=>({children:"children",title:"showName",key:"id"})},selectedKeys:{type:Array,default:()=>[]},expandedKeys:{type:Array,default:()=>[]},multiple:{type:Boolean,default:!0},visible:{type:Boolean,default:!1},tabs:{type:Array,default:()=>[{tab:"教职工",key:1,checked:!1},{tab:"学生组",key:2,checked:!0,disabled:[]},{tab:"按场地",key:3,checked:!0,disabled:[]},{tab:"自定义组",key:4,checked:!0,disabled:[]}]},checked:{type:Array,default:()=>[]},checkedKey:{type:String,default:"id"},mode:{type:String,default:"personnel",validator:e=>["personnel","depa"].includes(e)},queryEltern:{type:Boolean,default:!0}},emits:["handleOk","update:mode","update:visible","update:checked","emitChangeTabs","emitSelectLeft"],setup(e,{expose:t,emit:c}){const d=e,o=y(),r=a(),u=v({isParents:!1,isParentTab:"",identity:0,slots:"",searchValue:"",selectedKeys:[],autoExpandParent:!0,_selectedKeys:[],expandedKeys:[],_treeDatas:[],activeKey:1,selectedAll:{indeterminate:!1,checked:!1,disabled:!1},notSelectedList:[],selectedList:[],_selectedList:[],visible:!1,isSearchMode:!1,selectedSearchTableIds:[],searchData:[],searchPagination:{total:0,size:10,current:1,showTotal:e=>`共 ${e} 条`,showSizeChanger:!1},searchLoading:!1}),p=f((()=>d.deviceId)),h=[{title:"姓名",dataIndex:"name",width:"100px"},{title:"部门/班级",dataIndex:"demp",width:"260px",customRender:({record:e})=>{var t;return"personnel"===d.mode&&1===u.activeKey?null==(t=e.deptVOList)?void 0:t.map((e=>e.name)).join(","):"personnel"===d.mode&&2===u.activeKey?e.className:void 0}}],m=f((()=>{const e={personnel:"人",depa:"组"};return t=>`${t}${e[d.mode]}`})),E=new Map,q=new Map;function M(){u.isSearchMode=!1,u.searchValue="";let e=null;d.tabs.length&&(e=d.tabs.find((e=>e.checked)),u.identity=e.identity,u.activeKey=e.key||d.tabs[0].key||1),u.notSelectedList=[],u._selectedList=[],V(e.key,e.isParty)}function R(){M(),u.selectedList=d.checked.map((e=>e)),u.visible=!0,c("update:visible",!0)}function V(e,t,a=null){if(d.treeData.length){if(t){if(u._treeDatas=[],2===e)return void r.dispatch(t).then((e=>{const{data:t}=e;u._treeDatas=t}));"base/getCustomMethod"===t&&(a={equipmentType:2}),r.dispatch(t,a).then((e=>{const{data:t}=e;if(null==t?void 0:t.length){const e=[{id:"2121211",leader:"323232322",name:"全校",showName:"全校",sort:-1,type:-1,children:b(r.state.base.departmentTree)}];u._treeDatas=k(e)}else u._treeDatas=[t]}))}}else{if(1===e){const e=[{id:"2121211",leader:"323232322",name:"全校",showName:"全校",sort:-1,type:-1,children:b(r.state.base.departmentTree)}];return void(u._treeDatas=k(e))}u._treeDatas=f((()=>r.state.base.schoolRollTree))}}function F(e){u.isSearchMode=!1;let t=null;d.tabs.forEach(((a,s)=>{a.key===e&&(u.isParents="家长"===a.tab,u.isParentTab=a.tab,t=a.isParty,u.identity=a.identity,a.paramsKey&&(a.paramsKey=a.paramsValue))})),3!==e&&V(e,t,null),u.notSelectedList=[],c("emitChangeTabs",e),u.searchPagination.total=0,u.searchPagination.current=1,u.searchData=[]}function $(){u.selectedAll.indeterminate=!1,u.selectedAll.checked=!1,u.selectedAll.disabled=!1}function B(){u._selectedList=[],u.selectedList=[],u.notSelectedList.forEach((e=>{var t;e._checked=!1,d.checkParents&&(null==(t=e.elterns)?void 0:t.length)&&e.elterns.forEach((e=>e._checked=!1))})),u.isSearchMode&&(u.selectedSearchTableIds=[])}f((()=>e=>{let t="";return r.state.selectSource.dictionary.relations.forEach((a=>a.value==e&&(t=a.label))),t})),g((()=>d.selectedKeys),(e=>{u.selectedKeys=[...e],u._selectedKeys=[...e]})),g((()=>u.notSelectedList),(e=>{d.multiple?function(e){if(e.forEach((t=>{const a=u.selectedList.findIndex((e=>e[d.checkedKey]===t[d.checkedKey]));d.checkParents&&2==u.activeKey?e.length&&(t._checked?-1===a&&u.selectedList.push(t):-1!==a&&u.selectedList.splice(a,1)):t._checked?-1===a&&u.selectedList.push(t):-1!==a&&u.selectedList.splice(a,1)})),u.selectedList.length){const t=e.filter((e=>!0===e._checked));t.length?(u.selectedAll.indeterminate=t.length!==e.length,u.selectedAll.checked=t.length===e.length):$()}else $();u.selectedAll.disabled=!!u.notSelectedList.every((e=>e._disabled))||!e.length}(b(e)):u.selectedList=e.filter((e=>e[d.checkedKey]===u._selectedList))}),{deep:!0}),g((()=>d.checked),(e=>{u.selectedList=b(e)}),{deep:!0}),g((()=>d.treeData),(e=>{u._treeDatas=k(e)}),{deep:!0}),g((()=>d.visible),(e=>{u.selectedKeys=[],u.visible=e,e&&(u.isParents=!1,u.selectedList=d.checked.map((e=>e)),M())}),{deep:!0});const oe=async(e,t)=>{var a;if("-1"===t.node.type)return;e.length?(u._selectedKeys=e,u.selectedKeys=e):u.selectedKeys=u._selectedKeys;const s=t.node,r=2==u.activeKey,h=null==(a=d.tabs.find((e=>2==e.key)))?void 0:a.disabled;let m=!1;if("personnel"===d.mode){const a=d.tabs.findIndex((e=>e.key==u.activeKey)),c={id:s.id,type:s.type,item:s};let r=[];if("outsiders"===d.tabs[a].selectType){const{data:a}=await l({deviceId:p.value,rollType:t.node.type,id:e[0]||t.node.id,name:"",pageNo:1,pageSize:100,status:1,type:4});r=(null==a?void 0:a.page.list)||[]}else r=await async function({id:e,type:t,item:a},s){var l;let c=[];if(1===u.activeKey)try{const t=e,{data:{list:a}}=await i({deviceId:p.value,statusList:ue,deptId:t,pageNo:1,pageSize:999,code:o.currentRoute.value.meta.code});c=a,E.set(t,c)}catch(h){}const r=(null==(l=he.value[t])?void 0:l.key)||"";if(2==u.activeKey&&"classes"===r)try{const t=e,a={deviceId:p.value,statusList:re,classesId:t,code:o.currentRoute.value.meta.code};a.filterNonEltern="家长"===u.isParentTab,a.queryEltern=d.queryEltern;c=(await n(a)).data,q.set(t,c)}catch(h){}return c}(c);u.notSelectedList=r.map((e=>{var t;const a=u.selectedList.findIndex((t=>t[d.checkedKey]===e[d.checkedKey]));return e._checked=!1,d.checkParents&&(null==(t=e.elterns)?void 0:t.length)&&e.elterns.forEach((e=>{var t;if(-1==a)e._checked=!1;else{const s=null==(t=u.selectedList[a])?void 0:t.elterns.find((t=>t.id===e.id));e._checked=!!s}})),{...e,showName:e.showName||e.name||e.userName,_checked:a>-1,_disabled:m,_source:u.activeKey}}))}else{const e=s.children||[];u.notSelectedList=e.map((e=>{const t=u.selectedList.findIndex((t=>t[d.checkedKey]===e[d.checkedKey]));return m=r&&(null==h?void 0:h.includes(e.type)),{...e,showName:e.showName||e.name,_checked:t>-1,_disabled:m,_source:u.activeKey}})),c("emitSelectLeft",u.notSelectedList)}4===u.activeKey&&l({deviceId:p.value,rollType:t.node.type,id:e[0]||t.node.id,name:"",pageNo:1,pageSize:100,status:1,type:3}).then((e=>{u.notSelectedList=e.data.page.list}))},{roll_status_yes_id:re,emp_status_yes_id:ue}=r.state.selectSource.dictionary||{};function pe(e){const t=u.notSelectedList.filter((e=>!e.disable));t.length&&t.forEach((t=>{var a;t._checked=e.target.checked,d.checkParents&&(null==(a=t.elterns)?void 0:a.length)&&t.elterns.forEach((t=>t._checked=e.target.checked))}))}const he=f((()=>{const e={};return r.state.base.commentJsonKeys.INIT_ROLL_LIST.forEach((t=>e[t.level]=t)),e}));function me(e){const t=u.notSelectedList.findIndex((t=>t[d.checkedKey]===e.target.value));u.notSelectedList.forEach(((e,a)=>{e._checked=t===a}))}function ye(){c("update:checked",b(u.selectedList)),u.visible=!1,c("update:visible",!1),c("handleOk",b(u.selectedList)),c("emitChangeTabs",1),u.searchPagination.total=0,u.searchPagination.current=1,u.searchValue=""}const ve=()=>{u.visible=!1,c("emitChangeTabs",1),c("update:visible",!1)};function fe(){u.isSearchMode=!1,u.searchPagination.total=0,u.searchPagination.current=1,u.searchData=[],u.searchValue=""}const ge=(e,t)=>{let a=null;for(let s=0;s<t.length;s++){const l=t[s];l.children&&(l.children.some((t=>(t.showName||t.name)===e))?a=l.id:ge(e,l.children)&&(a=ge(e,l.children)))}return a};function be(e=[],t=[],a=0){return e&&e.length?(a++,e.reduce(((e,s)=>(s.depth=a,e.push(s),s.children&&s.children.length&&be(s.children,t,a),e)),t)):[]}function ke(e){u.searchPagination.current=e.current,_e(u.searchValue,"pagination")}async function _e(e,t){var a;if(u.searchValue=e,"pagination"!==t&&(u.searchPagination.current=1),"depa"===d.mode){const t=b(u._treeDatas),s=be(null==(a=t[0])?void 0:a.children).map((a=>{var s;const l=a.showName||a.name;return l.indexOf(e)>-1?ge(l,null==(s=t[0])?void 0:s.children):null})).filter(((e,t,a)=>e&&a.indexOf(e)===t));u.expandedKeys=s,u.autoExpandParent=!0}if("personnel"===d.mode){if(u.isSearchMode=!0,u.selectedSearchTableIds=u.selectedList.map((e=>e[d.fieldNames.key])),u.searchLoading=!0,1===Number.parseInt(u.activeKey)){const t=await i({statusList:ue,pageNo:u.searchPagination.current,pageSize:u.searchPagination.size,name:e,code:o.currentRoute.value.meta.code});u.searchPagination.total=t.data.total,u.searchData=t.data.list}if(2===Number.parseInt(u.activeKey)){const t=await n({statusList:re,pageNo:1,pageSize:10,name:e,code:o.currentRoute.value.meta.code});u.searchData=t.data||[]}u.searchLoading=!1}}function xe(e){d.multiple?u.selectedSearchTableIds=e:u.selectedSearchTableIds=[e[e.length-1]]}function Ne(e){const t=b(e),a=u.selectedList.findIndex((e=>e[d.fieldNames.key]===t.id));-1===a?(t._checked=!0,d.multiple?u.selectedList.push({...t,showName:t.showName||t.name||t.userName,_source:u.activeKey}):u.selectedList=[{...t,showName:t.showName||t.name||t.userName,_source:u.activeKey}]):u.selectedList.splice(a,1)}function Se(e){}return t({..._(u)}),(t,a)=>{const l=x("a-tab-pane"),i=x("a-tabs"),n=x("a-input-search"),c=x("a-button"),o=x("a-table"),r=x("a-col"),p=x("a-checkbox"),y=x("a-row"),v=x("a-radio"),f=x("a-radio-group"),g=x("a-image"),b=x("close-outlined"),k=x("a-modal");return N(),S("div",H,[L("span",{class:"def_slot",onClick:R},[w(t.$slots,"default",{},void 0,!0)]),I(k,A({maskClosable:!1,destroyOnClose:""},t.$attrs,{visible:u.visible,"onUpdate:visible":a[5]||(a[5]=e=>u.visible=e),class:"y_select__modal",width:"980px","ok-button-props":{disabled:!u.selectedList.length},onOk:ye,onCancel:ve}),{title:T((()=>[I(i,{activeKey:u.activeKey,"onUpdate:activeKey":a[0]||(a[0]=e=>u.activeKey=e),class:"y_select__tabs",onTabClick:F},{default:T((()=>[(N(!0),S(K,null,C(e.tabs,(e=>(N(),D(l,{key:e.key,tab:`${e.tab}`},null,8,["tab"])))),128))])),_:1},8,["activeKey"])])),default:T((()=>[I(y,{type:"flex",style:{height:"574px"}},{default:T((()=>[I(r,{flex:"auto",class:"userselect_warp"},{default:T((()=>[L("div",J,[I(n,{value:u.searchValue,"onUpdate:value":a[1]||(a[1]=e=>u.searchValue=e),placeholder:"请输入关键字","enter-button":"",onSearch:_e,"allow-clear":""},null,8,["value"]),u.isSearchMode?(N(),D(c,{key:0,type:"link",onClick:fe},{default:T((()=>[O("取消")])),_:1})):P("v-if",!0)]),L("div",W,[P(" 搜索模式 "),u.isSearchMode?(N(),S("div",Y,[I(o,{rowKey:"id",size:"small","row-selection":{selectedRowKeys:u.selectedSearchTableIds,onChange:xe,onSelect:Ne,hideSelectAll:!0},pagination:u.searchPagination,style:{margin:"8px"},dataSource:u.searchData,columns:h,loading:u.searchLoading,onChange:ke},null,8,["row-selection","pagination","dataSource","loading"])])):(N(),S(K,{key:1},[P(" 正常 "),I(y,{type:"flex",style:{"min-height":"100%"}},{default:T((()=>[I(r,{flex:"50%",class:"userselect_tree"},{default:T((()=>[u._treeDatas.length?(N(),D(s,{key:u.activeKey,selectedKeys:u.selectedKeys,"onUpdate:selectedKeys":a[2]||(a[2]=e=>u.selectedKeys=e),"tree-data":u._treeDatas,"field-names":e.fieldNames,onSelect:oe,"default-expand-all":"",onExpand:Se},{title:T((({dataRef:t})=>[G,(t.showName||t.name).indexOf(u.searchValue)>-1?(N(),S("span",Q,[O(U((t.showName||t.name).substr(0,(t.showName||t.name).indexOf(u.searchValue)))+" ",1),L("span",X,U(u.searchValue),1),O(" "+U((t.showName||t.name).substr((t.showName||t.name).indexOf(u.searchValue)+u.searchValue.length)),1)])):(N(),S("span",Z,U(t[e.fieldNames.title]||t.name),1))])),_:1},8,["selectedKeys","tree-data","field-names"])):P("v-if",!0)])),_:1}),P(" 中间池数据 "),I(r,{flex:"50",class:"userselect_checklist"},{default:T((()=>[u.notSelectedList.length?(N(),S(K,{key:0},[I(y,{type:"flex",justify:"space-between"},{default:T((()=>[I(r,{style:{color:"rgba(0, 0, 0, 0.85)",padding:"0 8px","margin-bottom":"8px"}},{default:T((()=>[O(U(e.multiple?"全":"单")+"选 ",1),L("span",ee,"共"+U(m.value(u.notSelectedList.length)),1)])),_:1}),e.multiple&&u.notSelectedList.length?(N(),D(r,{key:0,style:{"padding-right":"12px"}},{default:T((()=>[I(p,{checked:u.selectedAll.checked,"onUpdate:checked":a[3]||(a[3]=e=>u.selectedAll.checked=e),indeterminate:u.selectedAll.indeterminate,disabled:u.selectedAll.disabled,onChange:pe},null,8,["checked","indeterminate","disabled"])])),_:1})):P("v-if",!0)])),_:1}),e.multiple?(N(),S("ul",te,[(N(!0),S(K,null,C(u.notSelectedList,((t,a)=>(N(),S("li",{key:a,class:j({selected_item:!0,selected_item_activate:t._checked})},[L("label",null,[I(y,{type:"flex",justify:"space-between",style:z([{cursor:"pointer"},{display:u.slots&&2==u.activeKey&&"flow-root"}])},{default:T((()=>[I(r,{style:{overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap",flex:"1"}},{default:T((()=>[ae,O(" "+U(t[e.fieldNames.title]||t.name)+" ",1),P(" 家长信息 "),P(' <div\r\n                                                            v-for="it in item.elterns"\r\n                                                            class="slots-selecte-elterns"\r\n                                                            :key="it.id"\r\n                                                        >\r\n                                                            <a-col\r\n                                                                style="\r\n                                                                    padding-left: 26px;\r\n                                                                "\r\n                                                            >\r\n                                                                {{ it.name }}\r\n                                                                <span\r\n                                                                    class="relations"\r\n                                                                >\r\n                                                                    {{\r\n                                                                        relations(\r\n                                                                            it.relations\r\n                                                                        )\r\n                                                                    }}\r\n                                                                </span>\r\n                                                            </a-col>\r\n                                                        </div> ')])),_:2},1024),I(r,null,{default:T((()=>[P(" 中间池单选 "),I(p,{checked:t._checked,"onUpdate:checked":e=>t._checked=e,disabled:t.disable},null,8,["checked","onUpdate:checked","disabled"])])),_:2},1024)])),_:2},1032,["style"])])],2)))),128))])):(N(),S("ul",se,[I(f,{value:u._selectedList,"onUpdate:value":a[4]||(a[4]=e=>u._selectedList=e),style:{width:"100%"},onChange:me},{default:T((()=>[(N(!0),S(K,null,C(u.notSelectedList,((t,a)=>(N(),S("li",{key:a,class:j({selected_item:!0,selected_item_activate:t._checked})},[L("label",null,[I(y,{type:"flex",justify:"space-between",style:{cursor:"pointer"}},{default:T((()=>[I(r,{style:{"font-size":"14px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","margin-right":"10px",flex:"1"}},{default:T((()=>[le,O(" "+U(t[e.fieldNames.title]||t.name),1)])),_:2},1024),I(r,null,{default:T((()=>[I(v,{checked:t._checked,"onUpdate:checked":e=>t._checked=e,value:t[e.fieldNames.key],label:t.id,disabled:t._disabled},null,8,["checked","onUpdate:checked","value","label","disabled"])])),_:2},1024)])),_:2},1024)])],2)))),128))])),_:1},8,["value"])]))],64)):(N(),S("div",ie,[I(g,{width:120,height:120,src:"/image/empty.png",preview:!1}),ne]))])),_:1})])),_:1})],2112))])])),_:1}),I(r,{flex:"280px",class:"usercheck_warp"},{default:T((()=>[I(y,{type:"flex",justify:"space-between",style:{"align-items":"center"}},{default:T((()=>[I(r,{style:{color:"rgba(0, 0, 0, 0.85)",padding:"0 8px"}},{default:T((()=>[O(" 已选 "),L("span",ce,U(m.value(u.selectedList.length)),1)])),_:1}),u.selectedList.length?(N(),D(r,{key:0},{default:T((()=>[I(c,{class:"empty_allselected",type:"link",onClick:B},{default:T((()=>[O("清空")])),_:1})])),_:1})):P("v-if",!0)])),_:1}),(N(!0),S(K,null,C(u.selectedList,((t,a)=>(N(),D(y,{key:a,type:"flex",justify:"space-between",class:"selected_item"},{default:T((()=>[I(r,{style:{overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","margin-right":"10px",flex:"1"}},{default:T((()=>[de,O(" "+U(t[e.fieldNames.title]||t.name||t.realname),1)])),_:2},1024),P(" 家长信息 "),P(' <template v-if="item.elterns && item.elterns.length">\r\n                            <a-col\r\n                                class="slots-selecte"\r\n                                v-for="(it, cindex) in item.elterns"\r\n                                :key="it.id"\r\n                            >\r\n                                <span class="slots-selecte-user">\r\n                                    {{ it.name }}\r\n                                    <span class="relations">\r\n                                        {{ relations(it.relations) }}\r\n                                    </span>\r\n                                </span>\r\n                            </a-col>\r\n                            <close-outlined\r\n                                style="color: #d9d9d9"\r\n                                class="elterns_del"\r\n                                title="删除"\r\n                                @click="delSelecteItem(item, index)"\r\n                            />\r\n                        </template> '),I(r,null,{default:T((()=>[I(b,{style:{color:"#d9d9d9"},title:"删除",onClick:e=>function(e,t,a){const s=u.notSelectedList.findIndex((t=>t[d.checkedKey]===e[d.checkedKey]));if(-1!==s&&(u.notSelectedList[s]._checked=!1,void 0!==a)){const t=e.elterns[a];u.notSelectedList[s].elterns.forEach((e=>{e.id===t.id&&(e._checked=!1)}))}if(d.checkParents&&void 0!==a||u.selectedList.splice(t,1),d.multiple||(u._selectedList=""),u.isSearchMode){const t=u.selectedSearchTableIds.findIndex((t=>t===e.id));t>-1&&u.selectedSearchTableIds.splice(t,1)}}(t,a)},null,8,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1},16,["visible","ok-button-props"])])}}},[["__scopeId","data-v-20f91915"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/components/YSelect/indexFace.vue"]]);const re=[{title:"ID",dataIndex:"id",width:200},{title:"姓名",dataIndex:"userName",width:100},{title:"人员类型",dataIndex:"userType",width:130},{title:"状态",dataIndex:"status",width:140},{title:"有效期（结束日期）",dataIndex:"expirationEndTime",width:200},{title:"更新时间",dataIndex:"syncTime",width:200},{title:"操作",ellipsis:!0,dataIndex:"operation",width:100,fixed:"right"}],ue=["已同步","异常","未同步","同步中","删除中"],pe=["success","error","default","warning","error"],he=[{className:"全部",status:null},{className:"已同步",status:0},{className:"异常",status:1},{className:"未同步",status:2},{className:"同步中",status:3},{className:"删除中",status:4}];const me=e=>(E("data-v-ae501720"),e=e(),q(),e),ye=me((()=>L("div",{class:"text"},"当前设备",-1))),ve={class:"curr"},fe={class:"right"},ge={class:"top"},be=me((()=>L("span",{class:"color_black division_line"},"/",-1))),ke={class:"color_black"},_e={key:0},xe=me((()=>L("div",{class:"tip"},"以下设备存在相同人员，可选择同时更新",-1))),Ne={style:{"margin-bottom":"20px"}},Se={class:"check_box"},Le={class:"curr_item"},we={class:"right"},Ie={class:"top"},Te={class:"left"},Ke={class:"right"},Ce=me((()=>L("span",{class:"color_black division_line"},"/",-1))),De={class:"color_black"},Oe={class:"down"};var Pe=t({__name:"FaceModel",emits:["syncOnePerson"],setup(e,{expose:t,emit:a}){const s=v({spinning:!1,machineName:"",machineStatus:0,faceNumber:0,synchronousNumber:0,siteName:"",checked:!0,checkAll:!1,checkedList:[],plainOptions:[],indeterminate:!1,visible:!1,setFaceTitle:!0});function l(e){Object.assign(s,{checkedList:e.target.checked?s.plainOptions:[],indeterminate:!1})}function i(){a("syncOnePerson")}return g((()=>s.checkedList),(e=>{s.indeterminate=!!e.length&&e.length<s.plainOptions.length,s.checkAll=e.length===s.plainOptions.length})),t({..._(s)}),(e,t)=>{const a=x("a-checkbox"),n=x("a-checkbox-group"),c=x("a-spin"),d=x("a-modal");return N(),D(d,{visible:s.visible,"onUpdate:visible":t[3]||(t[3]=e=>s.visible=e),title:s.setFaceTitle?"同步":"刪除",onOk:i},{default:T((()=>[I(c,{spinning:s.spinning},{default:T((()=>[L("div",null,U(s.setFaceTitle?"同步":"刪除")+"人员信息？",1),ye,I(a,{checked:s.checked,"onUpdate:checked":t[0]||(t[0]=e=>s.checked=e)},{default:T((()=>[L("div",ve,[L("div",fe,[L("div",ge,[L("div",{class:"left",style:z(1===Number(s.machineStatus)?"color: #00b781":"")},[L("span",{class:j(["cyl",["act_no","act"][Number(s.machineStatus)]])},null,2),L("span",null,U(s.machineName),1)],4),L("div",{class:j(1===Number(s.machineStatus)?"right right_class ":"right")},[L("span",null,U(s.synchronousNumber||0),1),be,L("span",ke,U(s.faceNumber||0),1)],2)]),L("div",{class:"down",style:z(1===Number(s.machineStatus)?"color: #00b781":"")},[L("span",null,U(s.siteName),1)],4)])])])),_:1},8,["checked"]),s.plainOptions&&s.plainOptions.length>0?(N(),S("div",_e,[xe,L("div",Ne,[I(a,{checked:s.checkAll,"onUpdate:checked":t[1]||(t[1]=e=>s.checkAll=e),indeterminate:s.indeterminate,onChange:l},{default:T((()=>[O("全选")])),_:1},8,["checked","indeterminate"])]),L("div",Se,[I(n,{value:s.checkedList,"onUpdate:value":t[2]||(t[2]=e=>s.checkedList=e)},{default:T((()=>[(N(!0),S(K,null,C(s.plainOptions,((e,t)=>(N(),D(a,{value:e,key:t},{default:T((()=>[L("div",Le,[L("div",we,[L("div",Ie,[L("div",Te,[L("span",{class:j(["cyl",["act_no","act"][Number(e.machineStatus)]])},null,2),L("span",null,U(e.machineName),1)]),L("div",Ke,[L("span",null,U(e.synchronousNumber||0),1),Ce,L("span",De,U(e.faceNumber||0),1)])]),L("div",Oe,[L("span",null,U(e.siteName),1)])])])])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])])):P("v-if",!0)])),_:1},8,["spinning"])])),_:1},8,["visible","title"])}}},[["__scopeId","data-v-ae501720"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/appModel/components/FaceModel.vue"]]);const Ue=e=>(E("data-v-b43f8acc"),e=e(),q(),e),je={class:"face_lib"},ze={class:"fixed"},Ae={class:"top text"},Ee=Ue((()=>L("div",{class:"left"},"设备列表",-1))),qe={class:"right"},Me={key:0,class:"equipment_list"},Re=["onClick"],Ve={class:"left"},Fe=Ue((()=>L("span",{class:"color_black division_line"},"/",-1))),$e={class:"color_black"},Be={key:1,class:"no_data"},He=[Ue((()=>L("img",{src:"/image/faceEmpty.png",alt:""},null,-1))),Ue((()=>L("span",{class:"text"},"暂无设备数据",-1)))],Je={class:"top_name"},We={class:"warp"},Ye={class:"left"},Ge={class:"right"},Qe=Ue((()=>L("span",{class:"ti"},"序列号：",-1))),Xe={class:"xu_num"},Ze={class:"searchHead"},et={key:0},tt={style:{color:"#000"}},at={key:0,style:{color:"red",cursor:"pointer","margin-left":"6px"},class:"iconfont icon-outlinebeifen"},st=["onClick"],lt=["onClick"];var it=t({__name:"DeviceaceLibrary",props:{faceType:{type:String,default:""}},setup(t){const s=t,l=a(),i=k(),n=k(null),y={faceMachine:1,class:2,attendance:3,neutral:4,oneMachine:5,books:6},g=f((()=>s.faceType)),b=v({tableLoading:!1,deviceLoading:!1,treeData:[],customTree:[],outsidersTree:[],id:"",schoolId:"",synchronousNumber:0,faceNumber:0,all:0,curObj:{},device:{pageNo:1,pageSize:100},visible:!1,checkedList:[],name:"",nameDevice:"",siteName:"",no:"",List:[],firstCount:0,active:0,topname:"",pagination:{pageNo:1,pageSize:10,total:0},statusIndex:0,peopleIndex:0,faceTable:[],userId:"",onLine:0,onCount:0,onAllCount:0,isSync:!0,queryUserType:null,queryStatus:null}),_=f((()=>{var e,t;return[{label:"全部",status:0,machineStatus:0,value:null},...null==(t=null==(e=l.state)?void 0:e.selectSource)?void 0:t.dictionary.face_user_type]})),w=f((()=>{var e,t;const a=null==(t=null==(e=l.state)?void 0:e.selectSource)?void 0:t.dictionary.face_user_type,s=["-"];return a.forEach((e=>{s.push(e.label)})),s||["-","学生","教师工","外部人员"]}));function A(){b.queryStatus=null,b.queryUserType=null;const e={pageSize:b.device.pageSize,pageNo:b.device.pageNo,name:b.nameDevice,deviceType:y[g.value]};b.deviceLoading=!0,d(e).then((e=>{var t,a,s,l,i,n;const{list:c}=e.data;b.list=c,b.all=c.length,c&&c.length>0&&(""!==b.id&&b.id||(b.topname=(null==(t=c[0])?void 0:t.machineName)||"",b.siteName=(null==(a=c[0])?void 0:a.siteName)||"",b.buildingName=(null==(s=c[0])?void 0:s.buildingName)||"",b.no=(null==(l=c[0])?void 0:l.no)||"",b.id=(null==(i=c[0])?void 0:i.id)||"",b.curObj=c[0]||{},b.schoolId=(null==(n=c[0])?void 0:n.schoolId)||""),ee())})).finally((()=>{b.deviceLoading=!1}))}c().then((e=>{b.customTree=e.data}));const E=async e=>{const t={1:[{id:"2121211",leader:"323232322",name:"全校",machineName:"全校",showName:"全校",sort:-1,type:-1,children:l.state.base.departmentTree}],2:l.state.base.schoolRollTree,3:b.outsidersTree,4:b.customTree};b.treeData=k(t[e])},q=e=>{let t=[];t=e.map((e=>1===e._source?{peopleType:2,schoolUserId:e.id}:2===e._source?{peopleType:1,schoolUserId:e.id}:3===e._source?{peopleType:3,schoolUserId:e.id}:{peopleType:e.faceType,schoolUserId:e.userId})),window.localStorage.setItem("face_one",JSON.stringify(t));const a={userInfo:t,deviceId:b.id};r(a).then((e=>{F.success(e.message),A()}))},B=()=>{A()},H=()=>{ee()},J=()=>{b.queryStatus=null,b.queryUserType=null,b.name="",b.pagination.pageNo=1,ee()},W=e=>{const{current:t,pageSize:a}=e;b.pagination.pageNo=t,b.pagination.pageSize=a,ee()},Y=(e,t)=>{b.isSync=t,b.userId=e.userId,i.value.spinning=!0,i.value.visible=!0,i.value.setFaceTitle=t,i.value.checkAll=!1;const a={pageNo:1,pageSize:100,syncUserIds:[e.userId],deviceType:y[g.value],syncEquipmentId:b.id};d(a).then((e=>{const{list:t}=null==e?void 0:e.data;if(b.list&&b.list.length>0){const{siteName:e,machineName:t,synchronousNumber:a,faceNumber:s,machineStatus:l}=b.list[b.active];i.value.machineStatus=Number(l)||"",i.value.machineName=t||"",i.value.siteName=e||"",i.value.synchronousNumber=a||"",i.value.faceNumber=s||""}i.value.plainOptions=t||[]})).finally((()=>{i.value.spinning=!1}))},G=()=>{n.value.selectedList.length=0,b.visible=!0},Q=()=>{u("一键同步","确定同步列表中所有人员的人脸信息？",$).then((e=>{e&&p({deviceId:b.id}).then((e=>{F.success(e.message),ee()}))}))},X=()=>{let e=[];e=i.value.checkedList.map((e=>e.id));const t={deviceId:b.id,userIds:[b.userId],syncDeviceIds:e};b.isSync?p(t).then((e=>{F.success(e.message),i.value.visible=!1,ee()})):h({deviceId:window.localStorage.getItem("device_id"),userIds:[b.userId],syncDeviceIds:e}).then((e=>{F.success(e.message),i.value.visible=!1,deviceListFn()}))},Z=()=>{u("提示","确定清空本机所有的人员信息？",$).then((e=>{e&&h({deviceId:b.id}).then((e=>{F.success(e.message),A()}))}))},ee=()=>{b.tableLoading=!0;const e={pageSize:b.pagination.pageSize,pageNo:b.pagination.pageNo,userType:b.queryUserType,id:b.curObj.id||b.id,schoolId:b.curObj.schoolId||b.schoolId,name:b.name,status:b.queryStatus};b.curObj.id||b.id?m(e).then((e=>{b.faceTable=e.data.list,b.pagination.pageNo=e.data.pageNo,b.pagination.pageSize=e.data.pageSize,b.pagination.total=e.data.total})).finally((()=>{b.tableLoading=!1})):b.tableLoading=!1};return M((()=>{A(),(async()=>{await o().then((({data:e})=>{b.outsidersTree=[{name:"外部人员",id:"-10000",children:e}]}))})()})),(t,a)=>{const s=x("a-input-search"),l=x("a-tooltip"),c=x("a-spin"),d=x("a-layout-sider"),o=x("search-outlined"),r=x("a-input"),u=x("a-form-item"),p=x("SearchOutlined"),h=x("a-button"),m=x("redo-outlined"),y=x("a-form"),v=x("caret-down-outlined"),f=x("a-menu-item"),g=x("a-menu"),k=x("a-dropdown"),A=x("a-badge"),M=x("a-layout-content"),F=x("a-layout");return N(),S(K,null,[L("div",je,[I(F,{class:"content"},{default:T((()=>[I(d,{class:"sider",width:"276"},{default:T((()=>[L("div",ze,[L("div",Ae,[Ee,L("div",qe,"共"+U(b.all)+"台",1)]),I(s,{placeholder:"请输入设备名称/序列号",allowClear:"",value:b.nameDevice,"onUpdate:value":a[0]||(a[0]=e=>b.nameDevice=e),onSearch:B},null,8,["value"])]),I(c,{spinning:b.deviceLoading,tip:"数据加载中...",style:{height:"500px"}},{default:T((()=>[b.list&&b.list.length>0?(N(),S("div",Me,[(N(!0),S(K,null,C(b.list,((e,t)=>{var a;return N(),S("div",{class:j(["item",b.active===t?"active":""]),key:t,onClick:a=>((e,t)=>{b.faceTable=[],b.queryStatus=null,b.queryUserType=null,b.pagination.total=0,b.active=t,b.topname=b.list[t].machineName,b.siteName=b.list[t].siteName,b.buildingName=b.list[t].buildingName,b.no=b.list[t].no,b.id=b.list[t].id,window.localStorage.setItem("device_id",b.id),b.synchronousNumber=b.list[t].synchronousNumber,b.faceNumber=b.list[t].faceNumber,b.curObj=e,b.pagination.pageNo=1,ee()})(e,t)},[L("div",Ve,[L("div",{class:j(["on_line",1==e.machineStatus?"act":""])},null,2),(null==(a=e.machineName)?void 0:a.length)>10?(N(),D(l,{key:0,placement:"top"},{title:T((()=>[L("span",null,U(e.machineName),1)])),default:T((()=>[L("div",{class:"name",style:z(b.active==t?"color: #00B781;":"")},U(e.machineName),5)])),_:2},1024)):(N(),S("div",{key:1,class:"name",style:z(b.active==t?"color: #00B781;":"")},U(e.machineName),5))]),L("div",{class:j(b.active==t?"right right_class ":"right")},[L("span",null,U(e.synchronousNumber||0),1),Fe,L("span",$e,U(e.faceNumber||0),1)],2)],10,Re)})),128))])):(N(),S("div",Be,He))])),_:1},8,["spinning"])])),_:1}),I(M,{class:"contents"},{default:T((()=>[L("div",Je,U(b.topname),1),L("div",We,[L("div",Ye,[L("span",null,U(`${b.buildingName?b.buildingName+"-":""}${b.siteName}`),1)]),L("div",Ge,[Qe,L("span",Xe,U(b.no),1)])]),L("div",Ze,[I(y,{layout:"inline"},{default:T((()=>[I(u,{label:""},{default:T((()=>[I(r,{placeholder:"请输入姓名",maxlength:20,value:b.name,"onUpdate:value":a[1]||(a[1]=e=>b.name=e),style:{width:"240px",margin:"0px 14px 14px 0px"}},{suffix:T((()=>[I(o,{onClick:H,style:{"font-size":"20px",color:"#8f8f8f"}})])),_:1},8,["value"])])),_:1}),L("div",null,[I(h,{style:{"margin-right":"12px"},type:"primary",onClick:H},{icon:T((()=>[I(p,{style:{"margin-right":"12px"}})])),default:T((()=>[O(" 查询 ")])),_:1}),I(h,{onClick:J},{icon:T((()=>[I(m,{style:{"margin-right":"12px"}})])),default:T((()=>[O(" 重置 ")])),_:1})])])),_:1}),L("div",null,[I(h,{onClick:G,type:"primary",disabled:!b.curObj.id||!b.id,style:{margin:"0px 12px 12px 0px"}},{default:T((()=>[O(" 关联人脸库 ")])),_:1},8,["disabled"]),I(h,{onClick:Q,type:"primary",disabled:b.faceTable&&0==b.faceTable.length,style:{margin:"0px 12px 12px 0px"}},{default:T((()=>[O(" 一键同步 ")])),_:1},8,["disabled"]),I(h,{onClick:Z,danger:"",disabled:b.faceTable&&0==b.faceTable.length},{default:T((()=>[O(" 清空 ")])),_:1},8,["disabled"])])]),I(c,{spinning:b.tableLoading},{default:T((()=>[I(e,{scroll:{x:1200},columns:R(re),dataSource:b.faceTable,slots:["operation"],rowSelection:!1,totals:b.pagination,spinLoad:b.spinLoad,onOnSelectedRowKeys:W},{headerCell:T((({column:e})=>["status"===e.dataIndex?(N(),D(k,{key:0,placement:"bottomRight"},{overlay:T((()=>[I(g,null,{default:T((()=>[(N(!0),S(K,null,C(R(he),((e,t)=>(N(),D(f,{key:t,onClick:a=>((e,t)=>{b.pagination.pageNo=1,b.statusIndex=t,b.queryStatus=e.status,ee()})(e,t)},{default:T((()=>[L("span",{class:j(b.statusIndex===t?"act":"")},U(e.className),3)])),_:2},1032,["onClick"])))),128))])),_:1})])),default:T((()=>[L("a",{style:{color:"#000"},onClick:a[2]||(a[2]=V((()=>{}),["prevent"]))},[O(" 状态 "),I(v,{style:{color:"var(--primary-color)"}})])])),_:1})):P("v-if",!0),"userType"===e.dataIndex?(N(),D(k,{key:1,placement:"bottomRight"},{overlay:T((()=>[I(g,null,{default:T((()=>[(N(!0),S(K,null,C(_.value,((e,t)=>(N(),D(f,{key:t,onClick:a=>((e,t)=>{b.queryUserType=e.value,b.peopleIndex=t,b.pagination.pageNo=1,ee()})(e,t)},{default:T((()=>[L("span",{class:j(b.peopleIndex===t?"act_peo":"")},U(e.label),3)])),_:2},1032,["onClick"])))),128))])),_:1})])),default:T((()=>[L("a",{style:{color:"#000"},onClick:a[3]||(a[3]=V((()=>{}),["prevent"]))},[O(" 人员类型 "),I(v,{style:{color:"var(--primary-color)"}})])])),_:1})):P("v-if",!0)])),bodyCell:T((({column:e,record:t,text:a})=>["userType"===e.dataIndex?(N(),S("span",et,U(w.value[t.userType]),1)):"status"===e.dataIndex?(N(),S(K,{key:1},[I(A,{status:R(pe)[t.status],text:R(ue)[t.status]},null,8,["status","text"]),I(l,{placement:"top",color:"#fff"},{title:T((()=>[L("span",tt," 同步异常："+U(t.renson),1)])),default:T((()=>[1===t.status?(N(),S("i",at)):P("v-if",!0)])),_:2},1024)],64)):"operation"===e.dataIndex?(N(),S(K,{key:2},[L("a",{style:{color:"#00b781","margin-right":"10px"},onClick:e=>Y(t,!0)},"同步",8,st),L("a",{style:{color:"var(--error-color)"},onClick:e=>Y(t,!1)},"删除",8,lt)],64)):(N(),S(K,{key:3},[O(U(a||"-"),1)],64))])),_:1},8,["columns","dataSource","totals","spinLoad"])])),_:1},8,["spinning"])])),_:1})])),_:1})]),P(" 选人组件 "),I(oe,{ref_key:"selectPersonnelRef",ref:n,mode:"personnel",onEmitChangeTabs:E,treeData:b.treeData,customTree:b.customTree,deviceId:b.id,tabs:[{tab:"教职工组",key:1,checked:!0},{tab:"学生组",key:2,checked:!1},{tab:"外部人员",key:3,checked:!1,selectType:"outsiders"},{tab:"自定义组",key:4,checked:!1}],visible:b.visible,"onUpdate:visible":a[4]||(a[4]=e=>b.visible=e),checked:b.checkedList,"onUpdate:checked":a[5]||(a[5]=e=>b.checkedList=e),onHandleOk:q},null,8,["treeData","customTree","deviceId","visible","checked"]),I(Pe,{ref_key:"faceRef",ref:i,onSyncOnePerson:X},null,512)],64)}}},[["__scopeId","data-v-b43f8acc"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/appModel/components/DeviceaceLibrary.vue"]]);export{it as D};
