import"./vue.a2f518ee.js";import{C as a}from"./index.2069fba3.js";import{_ as e,u as n,n as s}from"./index.7061e8ea.js";import{m as t}from"./ant-design-vue.db4d48e3.js";import{e as l,q as i,t as r,r as o,y as p,f as c,b8 as m,o as f,a as d,b as u,c as v,a3 as g,u as b,a2 as h,a7 as y,O as j,a9 as _,P as k,R as x,b5 as C,b4 as I,m as F}from"./@vue.919ff404.js";import"./@babel.6d5f88cb.js";import"./cropperjs.fe6d04b8.js";/* empty css                    */import"./secure-ls.8c8acb46.js";import"./vue-router.907b547c.js";import"./nprogress.c2257662.js";import"./axios.7aed06b8.js";import"./dayjs.49e29cb2.js";import"./qs.e55e9b28.js";import"./side-channel.ea627785.js";import"./get-intrinsic.8c87d952.js";import"./has-symbols.caae0f97.js";import"./has-proto.76cff6c7.js";import"./function-bind.cb3858f2.js";import"./has.c1051c46.js";import"./call-bind.208b5ef0.js";import"./object-inspect.e2cfb4a5.js";import"./@ant-design.2e172c39.js";import"./@ctrl.c020ccd3.js";import"./vuex.f308ecec.js";import"./vuex-persistedstate.fa252374.js";import"./vue-grid-layout.a3ef67ec.js";import"./resize-observer-polyfill.f664b406.js";import"./vue-types.022beab3.js";import"./dom-align.0991ecc5.js";import"./lodash-es.36dcd19c.js";import"./async-validator.267d9719.js";import"./scroll-into-view-if-needed.61c672a4.js";import"./compute-scroll-into-view.17358474.js";const z=a=>(C("data-v-d2e8b94e"),a=a(),I(),a),P={class:"personalCenter"},w={class:"personalCenter_left"},H={class:"personalCenter_title"},B=z((()=>u("h1",null,"个人信息",-1))),U=z((()=>u("i",{class:"iconfont icon-xingzhuangjiehe27",style:{"font-size":"12px","margin-right":"5px"}},null,-1))),$=z((()=>u("i",{class:"iconfont icon-xingzhuangjiehe113",style:{"font-size":"12px","margin-right":"5px"}},null,-1))),A={key:0,class:"edit_tip"},Z=z((()=>u("i",{class:"iconfont icon-a-ShapeCopy2"},null,-1))),q={class:"personalCenter_body"},N={class:"headPortrait"},D={class:"ml"},R={class:"ml"},S={class:"ml"},E={class:"ml"},W={class:"ml"},M={class:"ml"},O=z((()=>u("div",{class:"border"},null,-1))),T={class:"personalCenter_right"},G={class:"personalCenter_title"},J=z((()=>u("h1",null,"人脸采集",-1))),K=z((()=>u("i",{class:"iconfont icon-xingzhuangjiehe27",style:{"font-size":"12px","margin-right":"5px"}},null,-1))),L=z((()=>u("i",{class:"iconfont icon-xingzhuangjiehe113",style:{"font-size":"12px","margin-right":"5px"}},null,-1))),Q={class:"personalCenter_body"},V=z((()=>u("h2",{class:"text"}," 人脸信息用于学校考勤，在校门闸机、宿舍、教室等场所使用 ",-1))),X={class:"uploadDiv"},Y=z((()=>u("div",{class:"describe"},[u("span",{class:"requirementText"},"人脸照片要求："),u("span",null,"1.脸部占画面约1/4，正脸无遮挡，露眉露耳不露齿。"),u("h3",null,"2. 正常光照，亮度均匀，无阴阳脸，无浓妆。")],-1)));var aa=e(l({__name:"index",setup(e){const{proxy:l}=F(),C=n(),I=i({personalInformationForm:{avatar:"",schoolName:"",phone:"",name:"",gender:"",birthday:"",email:""},file:"",disabled:!0,informationflag:!0,faceflag:!0,picturePath1:"",labelCol:{style:{width:"60px"}},spinning:!1,spinning1:!1,fileone:""}),{personalInformationForm:z,faceflag:aa,informationflag:ea,picturePath1:na,labelCol:sa,spinning:ta,spinning1:la}=r(I),ia=()=>{I.informationflag=!1,I.personalInformationForm.email=C.state.user.userInfo.email,I.personalInformationForm.avatar=C.state.user.userInfo.avatar},ra=()=>{oa.value.validateFields().then((()=>{I.informationflag=!0,ga()}))},oa=o(),pa=()=>{I.faceflag=!1,I.disabled=!1},ca=()=>{I.faceflag=!0,I.disabled=!0,ba()},ma=({base64:a,file:e})=>{I.personalInformationForm.avatar=a,I.fileone=e,ya(I.fileone,1)},fa=({base64:a,file:e})=>{I.picturePath1=a,I.file=e,ya(I.file,2)},da=p((()=>C.state.user.userInfo)),ua=p((()=>C.state.user.currentSchool)),va=()=>{l.$defHttp.get(s.getCurrentUser).then((a=>{const{data:e,code:n}=a;I.personalInformationForm=e}))},ga=()=>{I.spinning=!0;const a=x(da.value),e={id:a.id,avatar:I.personalInformationForm.avatar};l.$defHttp.post(s.userupdate,e).then((n=>{t.success(n.message),C.commit("user/setUser",{...a,avatar:e.avatar}),va()})).finally((()=>{I.spinning=!1}))},ba=a=>{I.spinning1=!0;const e={imgPath:I.picturePath1};l.$defHttp.post(s.uploadFace,e).then((a=>{t.success(a.message),ha()})).catch((()=>I.picturePath1="")).finally((()=>{I.spinning1=!1}))},ha=()=>{l.$defHttp.get(s.getFace).then((a=>{const{data:e}=a;I.picturePath1=null==e?void 0:e.imgPath}))},ya=(a,e)=>{const n=new FormData;switch(n.append("file",a),e){case 1:l.$defHttp.post(s.fileUpload,n).then((a=>{const{data:e}=a;e.forEach((a=>{I.personalInformationForm.avatar=a.url}))})).catch((()=>{I.personalInformationForm.avatar=""}));break;case 2:l.$defHttp.post(s.fileUpload,n).then((a=>{const{data:e}=a;e.forEach((a=>{I.picturePath1=a.url}))})).catch((()=>{I.picturePath1=""}))}};return c((()=>{ha(),va()})),(e,n)=>{const s=m("a-button"),t=m("a-image"),l=m("a-form-item"),i=m("a-form"),r=m("a-spin");return f(),d("div",P,[u("div",w,[v(r,{spinning:b(ta)},{default:g((()=>[u("div",H,[B,b(ea)?(f(),h(s,{key:0,type:"link",class:"button-link",onClick:ia},{default:g((()=>[y(" <template #icon><edit-outlined /></template> "),U,j(" 编辑 ")])),_:1})):y("v-if",!0),b(ea)?y("v-if",!0):(f(),h(s,{key:1,type:"link",class:"button-link",onClick:ra},{default:g((()=>[$,j(" 保存 ")])),_:1}))]),b(ea)?y("v-if",!0):(f(),d("div",A,[Z,j("提示：手机号/姓名/性别/生日/邮箱 信息可在“教职工管理”进行修改。 ")])),u("div",q,[v(i,{model:b(z),labelAlign:"left","wrapper-col":{span:18},"label-col":b(sa),ref_key:"personalInformationRef",ref:oa,hideRequiredMark:""},{default:g((()=>[v(l,{label:"头   像："},{default:g((()=>[u("div",N,[b(ea)?(f(),h(t,{key:0,src:b(z).avatar||da.value.avatar,fallback:"/image/uploadImg.png"},null,8,["src"])):y("v-if",!0),b(ea)?y("v-if",!0):(f(),h(a,{value:b(z).avatar,"onUpdate:value":n[0]||(n[0]=a=>b(z).avatar=a),onChange:ma,minCropBoxWidth:1920,minCropBoxHeight:400,key:"2",class:"imgimg",isNum:1},{parents:g((()=>[b(ea)||""==b(z).avatar?y("v-if",!0):(f(),h(s,{key:0,class:"headBtn",type:"primary",shape:"round"},{default:g((()=>[j(" 修改")])),_:1}))])),_:1},8,["value"]))])])),_:1}),v(l,{label:"学   校："},{default:g((()=>[u("span",D,_(ua.value.schoolName||"-"),1)])),_:1}),v(l,{label:"手机号："},{default:g((()=>[u("span",R,_(da.value.phone||"-"),1)])),_:1}),v(l,{label:"姓   名："},{default:g((()=>[u("span",S,_(b(z).name||da.value.name||"-"),1)])),_:1}),v(l,{label:"性   别："},{default:g((()=>[u("span",E,_("1"==(b(z).gender||da.value.gender)?"男":"0"==(b(z).gender||da.value.gender)?"女":"-"),1)])),_:1}),v(l,{label:"生   日："},{default:g((()=>[u("span",W,_(b(z).birthday||da.value.birthday||"-"),1)])),_:1}),v(l,{label:"邮   箱："},{default:g((()=>[u("span",M,_(b(z).email||da.value.email||"-"),1)])),_:1}),y(' <a-form-item\r\n                            label="邮&nbsp;&nbsp;&nbsp;箱："\r\n                            name="email"\r\n                            :rules="[\r\n                                {\r\n                                    type: \'string\',\r\n                                    message: \'请输入正确的邮箱\',\r\n                                    trigger: \'blur\',\r\n                                    transform(value) {\r\n                                        if (value) {\r\n                                            if (\r\n                                                /^([a-zA-Z0-9]+[_|_|.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|_|.]?)*[a-zA-Z0-9]+\\.[a-zA-Z]{2,3}$/.test(\r\n                                                    value\r\n                                                )\r\n                                            )\r\n                                                return val\r\n                                            return false\r\n                                        }\r\n                                    }\r\n                                }\r\n                            ]"\r\n                        >\r\n                            <span class="ml" v-if="informationflag"\r\n                                >{{\r\n                                    personalInformationForm.email ||\r\n                                    userInfo.email ||\r\n                                    \'-\'\r\n                                }}\r\n                            </span>\r\n                            <a-input\r\n                                v-if="!informationflag"\r\n                                v-model:value="personalInformationForm.email"\r\n                                class="ml"\r\n                                allowClear\r\n                                maxlength="50"\r\n                            />\r\n                        </a-form-item> ')])),_:1},8,["model","label-col"])])])),_:1},8,["spinning"])]),O,u("div",T,[v(r,{spinning:b(la)},{default:g((()=>[u("div",G,[J,b(aa)?(f(),h(s,{key:0,type:"link",class:"button-link",onClick:pa},{default:g((()=>[K,j(" 编辑 ")])),_:1})):y("v-if",!0),b(aa)?y("v-if",!0):(f(),h(s,{key:1,type:"link",class:"button-link",onClick:ca},{default:g((()=>[L,j(" 保存 ")])),_:1}))]),u("div",Q,[V,u("div",X,[b(aa)?(f(),h(t,{key:0,src:b(na)||"/image/uploadImg.png",fallback:"/image/uploadImg.png"},null,8,["src"])):y("v-if",!0),b(aa)?(f(),h(s,{key:1,class:"uploadBtn",type:"primary",disabled:"true"},{default:g((()=>[j("点击上传")])),_:1})):y("v-if",!0),b(aa)?y("v-if",!0):(f(),h(a,{value:b(na),"onUpdate:value":n[1]||(n[1]=a=>k(na)?na.value=a:null),onChange:fa,minCropBoxWidth:1920,minCropBoxHeight:400,key:"1",isNum:1},{parents:g((()=>[v(s,{class:"uploadBtn",type:"primary"},{default:g((()=>[j("点击上传")])),_:1})])),_:1},8,["value"]))]),Y])])),_:1},8,["spinning"])])])}}}),[["__scopeId","data-v-d2e8b94e"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/users/center/index.vue"]]);export{aa as default};
