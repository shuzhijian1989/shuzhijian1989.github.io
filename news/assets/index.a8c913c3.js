import"./vue.a2f518ee.js";import{u as e}from"./vue-router.907b547c.js";import{_ as a,u as t,aV as i,p as s,bc as d,bd as l,aR as n,a$ as o}from"./index.7061e8ea.js";import{m as c}from"./ant-design-vue.db4d48e3.js";import{S as r}from"./index.510cb628.js";import{I as p}from"./index.5bf217c5.js";import{q as u,r as m,y as v,f as b,b8 as g,o as h,a as f,c as y,a3 as S,b as I,a9 as x,u as j,a2 as L,a7 as k,F as N,a8 as w,O as C}from"./@vue.919ff404.js";import"./@babel.6d5f88cb.js";/* empty css                    */import"./secure-ls.8c8acb46.js";import"./nprogress.c2257662.js";import"./axios.7aed06b8.js";import"./dayjs.49e29cb2.js";import"./qs.e55e9b28.js";import"./side-channel.ea627785.js";import"./get-intrinsic.8c87d952.js";import"./has-symbols.caae0f97.js";import"./has-proto.76cff6c7.js";import"./function-bind.cb3858f2.js";import"./has.c1051c46.js";import"./call-bind.208b5ef0.js";import"./object-inspect.e2cfb4a5.js";import"./@ant-design.2e172c39.js";import"./@ctrl.c020ccd3.js";import"./vuex.f308ecec.js";import"./vuex-persistedstate.fa252374.js";import"./vue-grid-layout.a3ef67ec.js";import"./resize-observer-polyfill.f664b406.js";import"./vue-types.022beab3.js";import"./dom-align.0991ecc5.js";import"./lodash-es.36dcd19c.js";import"./async-validator.267d9719.js";import"./scroll-into-view-if-needed.61c672a4.js";import"./compute-scroll-into-view.17358474.js";const U={class:"batchAddEdit"},_={class:"addSite"},T={style:{display:"flex","justify-content":"space-between"}},E={class:"footBottom"};var O=a({__name:"index",setup(a){const O=t(),D=e(),{getItem:z}=i(),M=()=>{D.push({path:"/basicManagement/site",query:{buildingId:q.buildingId}})},V=[{title:"楼层",dataIndex:"floor"},{title:"房间号",dataIndex:"roomNum"},{title:"场地名称",dataIndex:"name"},{title:"容纳人数",dataIndex:"peppleNum"},{title:"面积(㎡)",dataIndex:"space"},{title:"场地类型",dataIndex:"siteTypeId"},{title:"管理员",dataIndex:"managerName"},{title:"绑定班级",dataIndex:"classesName"}],q=u({managerName:"",managerVisible:!1,addSitesLoging:!1,addClassIndex:0,addSiteList:[],typeList:[],batchTitle:"快速创建",buildingId:"",pagination:{pageNo:1,pageSize:10,total:0},selectSourceObj:{organizationTree:[],studentStatusTree:[]},managerList:[],isSelectSource:1}),P=m({upload:"",download:"",continueImport:""}),R=()=>{const e={...q.pagination,buildingId:q.buildingId,name:q.searchName};o(e).then((e=>{q.addSiteList=e.data.list,q.pagination.total=e.data.total,q.addSiteList.length&&q.addSiteList.forEach((e=>{var a;if(void 0!==e.list){const t=null==(a=e.list)?void 0:a.map((e=>e.name?e.name:[]));e.managerName=t.join("、")}}))})).finally((()=>{q.deleteLoging=!1}))},K=e=>{q.addSiteList=[],q.searchName=e,q.pagination.pageSize=999,R()},F=v((()=>{const e=[];return O.state.base.commentJsonKeys.INIT_ROLL_LIST.forEach((a=>"classes"!==a.key&&e.push(a.level))),e})),A=e=>{const a=e.map(((a,t)=>{const i=[];return i.push(Object.assign({},{peopleId:e[t].peopleId?e[t].peopleId:e[t].id,name:e[t].name})),i}));q.addSiteList[q.addIndex].list=[...new Set([].concat(...a.map((e=>e))))];const t=q.addSiteList[q.addIndex].list.map((e=>e.name));q.addSiteList[q.addIndex].managerName=t.join("、")},B=e=>{if(2===q.isSelectSource)q.addSiteList[q.addClassIndex].classesId=e[0].id,q.addSiteList[q.addClassIndex].classesName=e[0].showName},G=()=>{const e=z("batchData")?z("batchData"):{};switch(null==e?void 0:e.isEdit){case!1:q.addSiteList.filter((e=>""===e.name||!e.siteTypeId)).length>0?c.error("请输入场地名称和场地类型"):(q.addSitesLoging=!0,l(q.addSiteList).then((e=>{c.success(e.message),D.push({path:"/basicManagement/site",query:{buildingId:q.buildingId}})})).finally((()=>{q.addSitesLoging=!1})));break;case!0:q.addSiteList.filter((e=>""===e.name||!e.siteTypeId)).length>0?c.error("请输入场地名称和场地类型"):(q.addSitesLoging=!0,d(q.addSiteList).then((e=>{c.success(e.message),D.push({path:"/basicManagement/site",query:{buildingId:q.buildingId}})})).finally((()=>{q.addSitesLoging=!1})));break}};return b((()=>{n().then((e=>{q.typeList=e.data})),(()=>{const e=z("batchData")?z("batchData"):{},a=null==e?void 0:e.typeList;switch(null==e?void 0:e.isEdit){case!1:{const t=null==e?void 0:e.layoutList;q.addSiteList=[...new Set([].concat(...t.map((e=>e))))],q.typeList=a;break}case!0:switch(q.batchTitle="批量修改",null==e?void 0:e.islist){case!0:{const a=null==e?void 0:e.editSiteList;q.buildingId=null==e?void 0:e.eidtSiteId,q.addSiteList=a,q.addSiteList.length&&q.addSiteList.forEach((e=>{var a;if(void 0!==e.list){const t=null==(a=e.list)?void 0:a.map((e=>e.name?e.name:[]));e.managerName=t.join("、")}}));break}case!1:q.pagination.pageSize=999,q.buildingId=null==e?void 0:e.eidtSiteId,R()}q.typeList=a}})()})),(e,a)=>{var t;const i=g("a-layout-header"),d=g("a-input-search"),l=g("a-input-number"),n=g("a-input"),o=g("a-select-option"),c=g("a-select"),u=g("a-table"),m=g("a-button");return h(),f("div",U,[y(i,{class:"reset-layout-header"},{default:S((()=>[I("i",{class:"iconfont icon-xingzhuangjiehe19",onClick:M}),I("span",null,x(q.batchTitle),1)])),_:1}),I("div",_,[I("div",T,[1==(null==(t=j(z)("batchData"))?void 0:t.isEdit)?(h(),L(d,{key:0,placeholder:"请输入关键字搜索",style:{width:"336px"},onSearch:K})):k("v-if",!0)]),y(u,{style:{"margin-top":"16px"},"data-source":q.addSiteList,pagination:!1,size:"small",columns:V},{bodyCell:S((({column:e,record:a,index:t})=>["floor"===e.dataIndex?(h(),L(l,{key:0,max:27,min:1,id:"inputNumber",style:{width:"80px"},value:a.floor,"onUpdate:value":e=>a.floor=e,placeholder:"请输入",precision:0},null,8,["value","onUpdate:value"])):k("v-if",!0),"roomNum"===e.dataIndex?(h(),L(n,{key:1,maxlength:10,style:{width:"100px"},value:a.roomNum,"onUpdate:value":e=>a.roomNum=e,valueModifiers:{trim:!0},placeholder:"请输入"},null,8,["value","onUpdate:value"])):k("v-if",!0),"name"===e.dataIndex?(h(),L(n,{key:2,maxlength:20,style:{width:"200px"},value:a.name,"onUpdate:value":e=>a.name=e,valueModifiers:{trim:!0},placeholder:"请输入"},null,8,["value","onUpdate:value"])):k("v-if",!0),"peppleNum"===e.dataIndex?(h(),L(l,{key:3,max:999999999,id:"inputNumber",style:{width:"100px"},value:a.peppleNum,"onUpdate:value":e=>a.peppleNum=e,placeholder:"请输入"},null,8,["value","onUpdate:value"])):k("v-if",!0),"space"===e.dataIndex?(h(),L(l,{key:4,id:"inputNumber",style:{width:"100px"},value:a.space,"onUpdate:value":e=>a.space=e,placeholder:"请输入",step:1,min:0,max:99999999.99,precision:2},null,8,["value","onUpdate:value"])):k("v-if",!0),"siteTypeId"===e.dataIndex?(h(),L(c,{key:5,style:{width:"200px"},value:a.siteTypeId,"onUpdate:value":e=>a.siteTypeId=e,ref:"select",placeholder:"请选择"},{default:S((()=>[(h(!0),f(N,null,w(q.typeList,(e=>(h(),L(o,{key:e.id,value:e.id},{default:S((()=>[C(x(e.name),1)])),_:2},1032,["value"])))),128))])),_:2},1032,["value","onUpdate:value"])):k("v-if",!0),"managerName"===e.dataIndex?(h(),L(n,{key:6,value:a.managerName,placeholder:"请选择",onClick:e=>(async(e,a)=>{if(e){const a=e.filter((e=>e.name));q.managerList=a.map((e=>e.name?{id:e.peopleId,name:e.name}:[]))}q.managerVisible=!0,q.addIndex=a})(a.list,t),onChange:e=>(e=>{q.addSiteList[e].managerName="",q.addSiteList[e].list=[]})(t),"allow-clear":""},null,8,["value","onClick","onChange"])):k("v-if",!0),"classesName"===e.dataIndex?(h(),L(n,{key:7,"allow-clear":"",value:a.classesName,"onUpdate:value":e=>a.classesName=e,placeholder:"请选择",onClick:e=>(e=>{q.addClassIndex=e,q.isSelectSource=2;const a=O.state.selectSource.selectSourceObj.treeData_student,t={modalVisible:!0,selectSourceObj:{singleChoice:!0,checkPeople:!1,defaultExpand:[],optionalClass:{key:"type",value:F},tabsTexts:[{tab:"绑定班级",key:"student"}],treeData_student:a}};O.commit("selectSource/GET_USER_INFOS",t)})(t),onChange:e=>(e=>{q.addSiteList[e].classesId=""})(t)},null,8,["value","onUpdate:value","onClick","onChange"])):k("v-if",!0)])),_:1},8,["data-source"])]),y(r,{selectSourceParams:q.selectSourceObj,onCallbackParameter:B},null,8,["selectSourceParams"]),y(p,{ref:"importExportRef",action:P.value},null,8,["action"]),I("div",E,[y(m,{type:"primary",onClick:G,loading:q.addSitesLoging},{default:S((()=>[C("保存")])),_:1},8,["loading"])]),y(j(s),{mode:"personnel",tabs:[{tab:"管理员",key:1,checked:!0}],visible:q.managerVisible,"onUpdate:visible":a[0]||(a[0]=e=>q.managerVisible=e),selectedKeys:[],checked:q.managerList,"onUpdate:checked":a[1]||(a[1]=e=>q.managerList=e),checkedKey:"userId",onHandleOk:A},null,8,["visible","checked"])])}}},[["__scopeId","data-v-f4dd1c76"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/basicManagement/site/addEditSite/index.vue"]]);export{O as default};
