import"./vue.a2f518ee.js";import{a as e,u as s}from"./vue-router.907b547c.js";import{_ as r,u as o,cq as t,cr as c,cp as i,L as a}from"./index.7061e8ea.js";import{m as n}from"./ant-design-vue.db4d48e3.js";import{f as m,b8 as p,o as d,a2 as l}from"./@vue.919ff404.js";import"./@babel.6d5f88cb.js";/* empty css                    */import"./secure-ls.8c8acb46.js";import"./nprogress.c2257662.js";import"./axios.7aed06b8.js";import"./dayjs.49e29cb2.js";import"./qs.e55e9b28.js";import"./side-channel.ea627785.js";import"./get-intrinsic.8c87d952.js";import"./has-symbols.caae0f97.js";import"./has-proto.76cff6c7.js";import"./function-bind.cb3858f2.js";import"./has.c1051c46.js";import"./call-bind.208b5ef0.js";import"./object-inspect.e2cfb4a5.js";import"./@ant-design.2e172c39.js";import"./@ctrl.c020ccd3.js";import"./vuex.f308ecec.js";import"./vuex-persistedstate.fa252374.js";import"./vue-grid-layout.a3ef67ec.js";import"./resize-observer-polyfill.f664b406.js";import"./vue-types.022beab3.js";import"./dom-align.0991ecc5.js";import"./lodash-es.36dcd19c.js";import"./async-validator.267d9719.js";import"./scroll-into-view-if-needed.61c672a4.js";import"./compute-scroll-into-view.17358474.js";var u=r({__name:"socialLogin",setup(r){const u=e(),j=s(),f=o(),{token:h,auth:b,redirectUrl:v}=u.query,g={token:h,auth:b,grant_type:"social",client_id:"yide-cloud",client_secret:"yide1234567"},y=()=>({success(){n.success("登录成功")},error(){n.error("登录失败"),f.commit("user/removerUserLoginInfo")}});function _(){n.error("授权失败"),setTimeout((()=>{v&&""!==v?location.replace(v):j.replace({path:"/login"})}),2e3)}function k(){t(g).then((e=>{const{accessToken:s,refreshToken:r}=e.data;f.commit("user/setToken",{accessToken:s,refreshToken:r}),c().then((e=>{f.commit("user/setUser",e.data);const s=e.data.school||[];(null==s?void 0:s.length)>=1?(f.commit("user/setCurrentSchool",s[0]),function(e,s){i({schoolId:e.id}).then((r=>{if(0===r.code){if(void 0!==e.isEnabled&&!e.isEnabled)return y().error(),n.error("该学校被禁用");if(e.children.length){const{isEnabled:s}=e.children[0];if(!s)return y().error(),n.error("该教职工账号已停用")}a.set("schoolId",e.id),f.commit("user/setCurrentSchool",e);try{j.replace({path:"/"}),n.success("授权成功")}catch(o){_()}s&&s()}else n.error(r.message),_()})).catch((()=>{s&&s(),_()}))}(s[0])):_()})).catch((()=>{_()}))})).catch((()=>{_()}))}return m((()=>{h&&b?k():_()})),(e,s)=>{const r=p("a-spin");return d(),l(r,{tip:"授权中...",class:"spin"})}}},[["__scopeId","data-v-3028d8ac"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/login/socialLogin.vue"]]);export{u as default};
