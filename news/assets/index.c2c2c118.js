import"./vue.a2f518ee.js";import{_ as e}from"./index.272083a4.js";import{F as i,M as a,m as t}from"./ant-design-vue.db4d48e3.js";import{_ as l,p as r}from"./index.7061e8ea.js";import{d as s}from"./dayjs.49e29cb2.js";import{a as o,u as d}from"./vue-router.907b547c.js";import{f as m,p as n,h as u,i as c,j as p,u as y,k,l as f}from"./trafficRules.626c1e24.js";import{S as v,P as T,E as w}from"./@ant-design.2e172c39.js";import{e as h,q as F,r as b,t as g,f as x,b8 as I,o as _,a as L,a7 as S,b as N,c as D,a3 as C,u as j,O as A,a9 as V,F as R,a5 as O,a2 as U,aK as q,P as E,a4 as M,a8 as H,n as Y,b5 as z,b4 as K}from"./@vue.919ff404.js";import"./@babel.6d5f88cb.js";import"./resize-observer-polyfill.f664b406.js";import"./vue-types.022beab3.js";import"./@ctrl.c020ccd3.js";import"./dom-align.0991ecc5.js";import"./lodash-es.36dcd19c.js";import"./async-validator.267d9719.js";import"./scroll-into-view-if-needed.61c672a4.js";import"./compute-scroll-into-view.17358474.js";/* empty css                    */import"./secure-ls.8c8acb46.js";import"./nprogress.c2257662.js";import"./axios.7aed06b8.js";import"./qs.e55e9b28.js";import"./side-channel.ea627785.js";import"./get-intrinsic.8c87d952.js";import"./has-symbols.caae0f97.js";import"./has-proto.76cff6c7.js";import"./function-bind.cb3858f2.js";import"./has.c1051c46.js";import"./call-bind.208b5ef0.js";import"./object-inspect.e2cfb4a5.js";import"./vuex.f308ecec.js";import"./vuex-persistedstate.fa252374.js";import"./vue-grid-layout.a3ef67ec.js";const J=e=>(z("data-v-680f6a9d"),e=e(),K(),e),P={class:"trafficRuleDiv"},B={class:"right"},G={class:"searchForm"},$={class:"searchHead"},Q={key:0},W={key:1},X={key:0},Z={key:1},ee={key:3,style:{display:"flex","align-items":"center"}},ie={key:5},ae={class:"threeButton"},te={key:2},le=J((()=>N("span",{class:"holidayText"},"(同一时刻表内，节假日规则优先于常规规则)",-1))),re=J((()=>N("label",null,[N("i",{style:{color:"red"}},"*"),A(" 通行规则： "),N("span",{style:{color:"#00000033"}}," (通行规则按照每周循环) ")],-1))),se=["onClick"],oe={key:0,style:{color:"red",padding:"0px 0px 10px 70px"}},de=J((()=>N("i",{class:"iconfont icon-Shape6"},null,-1))),me={class:"footer"},ne={key:0},ue={key:1},ce={key:2},pe=J((()=>N("span",null,"以下人员在该场地存在规则冲突，请调整后重新保存，同一场地同一人员同一时间内只能有一条同一类型的规则",-1)));var ye=l(h({__name:"index",setup(l){const h=o(),z=new Date,K=z.getFullYear();let J=z.getMonth()+1,ye=z.getDate();J<10&&(J="0"+J),ye<10&&(ye="0"+ye),d();const ke=K+"-"+J+"-"+ye,fe=F({loading:!1,roleTree:[],fieldNames:{children:"children",title:"name",key:"id"},searchForm:{fieid:"",name:"",deviceType:""},dataSource:[],fieldList1:[],checked:!0,flag:!1,addRuleVisible:!1,rulesVisible:!1,title:"",rulesForm:{id:"",ruleName:"",siteId:null,personnelName:"",teacherList:[],studentList:[],direction:"",time:"",deviceType:1},activeKey:0,rulesRef:i,fieldList:[],personnelvisible:!1,checkedList:[],weekListLoca:{},weekForm:{weekList:[{weekName:"周一",week:1,isAllow:"0",name:"1",timelist:[{time:""}]},{weekName:"周二",week:2,isAllow:"0",name:"2",timelist:[{time:""}]},{weekName:"周三",week:3,isAllow:"0",name:"3",timelist:[{time:""}]},{weekName:"周四",week:4,isAllow:"0",name:"4",timelist:[{time:""}]},{weekName:"周五",week:5,isAllow:"0",name:"5",timelist:[{time:""}]},{weekName:"周六",week:6,isAllow:"0",name:"6",timelist:[{time:""}]},{weekName:"周日",week:7,isAllow:"0",name:"7",timelist:[{time:""}]}]},everyDay:!1,holidayDataSource:[],holidayVisible:!1,holidayForm:{name:"",date:""},holidayRef:i,title1:"",times:"2022-3-8",seeDataSource:[],seeHolidayDataSource:[],disabled:!1,pagination:{total:0,pageNo:1,pageSize:10},rulesType:0,editType:0,ruleId:"",seeType:"",isInOut:"",treeId:null,abnormalVisible:!1,abnormalDataSource:[],treeTitle:"",selectPriceDate:"",noTime:!1,offsetDays:6048e5}),ve=b(),Te=e=>{3===fe.rulesType&&(fe.selectPriceDate=e[0])},we=e=>{if(3===fe.rulesType){if(fe.selectPriceDate){const i=s(fe.selectPriceDate,"YYYY-MM-DD").valueOf();return e>s(new Date(i+fe.offsetDays).getTime())||e<s(new Date(i-fe.offsetDays).getTime())}return!1}},{roleTree:he,fieldNames:Fe,searchForm:be,dataSource:ge,fieldList:xe,addRuleVisible:Ie,rulesVisible:_e,title:Le,rulesForm:Se,weekListLoca:Ne,activeKey:De,rulesRef:Ce,personnelvisible:je,checkedList:Ae,everyDay:Ve,holidayDataSource:Re,holidayVisible:Oe,holidayForm:Ue,holidayRef:qe,title1:Ee,times:Me,seeDataSource:He,seeHolidayDataSource:Ye,fieldList1:ze,disabled:Ke,isInOut:Je,weekForm:Pe,abnormalVisible:Be,abnormalDataSource:Ge,treeTitle:$e}=g(fe),Qe=[{title:"序号",width:80,customRender:({text:e,record:i,index:a})=>`${a+1}`},{title:"规则类型",dataIndex:"rulesType",key:"id",width:120},{title:"设备类型",dataIndex:"deviceType",key:"deviceType",width:120},{title:"场地",dataIndex:"siteName",key:"id",width:120},{title:"人员数量",dataIndex:"peopleNumber",key:"id",width:120},{title:"通行方向",dataIndex:"inOut",key:"id",width:120},{title:"规则名称",dataIndex:"ruleName",key:"id",width:120,ellipsis:!0,showSorterTooltip:!0},{title:"有效期",dataIndex:"time",key:"id",width:260},{title:"状态",dataIndex:"isEnable",key:"id",width:120},{title:"操作",dataIndex:"operation",key:"id",width:280,fixed:"right"}],We=[{title:"节假日",dataIndex:"name",key:"id",width:100},{title:"时间",dataIndex:"time",key:"id",width:200},{title:"操作",dataIndex:"operation",width:50}],Xe=[{title:"",dataIndex:"time",key:"id"},{title:"周一",dataIndex:"date1",key:"id"},{title:"周二",dataIndex:"date2",key:"id"},{title:"周三",dataIndex:"date3",key:"id"},{title:"周四",dataIndex:"date4",key:"id"},{title:"周五",dataIndex:"date5",key:"id"},{title:"周六",dataIndex:"date6",key:"id"},{title:"周日",dataIndex:"date7",key:"id"}],Ze=[{title:"节假日",dataIndex:"holiday",key:"id"},{title:"时间",dataIndex:"time",key:"id"}],ei=[{title:"规则重复人员",dataIndex:"userName",key:"id",align:"center"}],ii=(e,i,a)=>i?Promise.resolve():Promise.reject(""),ai=F({label:"name",value:"id",children:"children"}),ti=()=>{fe.pagination.pageNo=1,Fi()},li=()=>{fe.searchForm.fieid="",fe.searchForm.name="",fe.searchForm.deviceType="",Fi()},ri=()=>{fe.noTime=!1,fe.everyDay=!1,fe.rulesVisible=!0,fe.addRuleVisible=!1,fe.title="添加常规规则",fe.rulesType=1,Ce.value.resetFields(),fe.weekForm={weekList:[{weekName:"周一",week:1,isAllow:"0",name:"1",timelist:[{time:""}]},{weekName:"周二",week:2,isAllow:"0",name:"2",timelist:[{time:""}]},{weekName:"周三",week:3,isAllow:"0",name:"3",timelist:[{time:""}]},{weekName:"周四",week:4,isAllow:"0",name:"4",timelist:[{time:""}]},{weekName:"周五",week:5,isAllow:"0",name:"5",timelist:[{time:""}]},{weekName:"周六",week:6,isAllow:"0",name:"6",timelist:[{time:""}]},{weekName:"周日",week:7,isAllow:"0",name:"7",timelist:[{time:""}]}]},fe.checkedList=[],fe.rulesForm.time=""},si=()=>{fe.noTime=!1,fe.everyDay=!1,fe.rulesVisible=!0,fe.addRuleVisible=!1,fe.title="添加节假日规则",fe.rulesType=2,Ce.value.resetFields(),gi()},oi=()=>{fe.rulesVisible=!0,fe.noTime=!1,fe.everyDay=!1,fe.addRuleVisible=!1,fe.title="添加临时规则",fe.rulesType=3,Ce.value.resetFields(),fe.weekForm={weekList:[{weekName:"周一",week:1,isAllow:"0",name:"1",timelist:[{time:""}]},{weekName:"周二",week:2,isAllow:"0",name:"2",timelist:[{time:""}]},{weekName:"周三",week:3,isAllow:"0",name:"3",timelist:[{time:""}]},{weekName:"周四",week:4,isAllow:"0",name:"4",timelist:[{time:""}]},{weekName:"周五",week:5,isAllow:"0",name:"5",timelist:[{time:""}]},{weekName:"周六",week:6,isAllow:"0",name:"6",timelist:[{time:""}]},{weekName:"周日",week:7,isAllow:"0",name:"7",timelist:[{time:""}]}]},fe.checkedList=[],fe.rulesForm.time=""},di=()=>{fe.rulesVisible=!1,Ce.value.resetFields()},mi=()=>{Ce.value.resetFields()},ni=()=>{const e=fe.weekForm.weekList;"添加节假日规则"!==fe.title&&(fe.noTime=!e[fe.activeKey].timelist.every((e=>!!e.time))),fe.noTime||fe.weekForm.weekList.forEach((e=>{e.timelist=JSON.parse(JSON.stringify(fe.weekForm.weekList[fe.activeKey].timelist)),e.isAllow=JSON.parse(JSON.stringify(fe.weekForm.weekList[fe.activeKey].isAllow))})),Ce.value.validateFields().then((()=>{if(fe.rulesForm.id){if(fe.noTime)return;a.confirm({title:"您确定要修改该条规则吗？",icon:D(w),content:"修改后，旧的规则将失效，闸机将匹配新的人员和规则。",okText:"确认",cancelText:"取消",onCancel(){t.info("已取消！")},onOk(){_i()}})}else bi()}))},ui=(e,i,a)=>{fe.rulesForm.siteId=e},ci=e=>{const i=[];e.length&&(e.map((e=>{i.push(e.name)})),fe.rulesForm.personnelName=i.join("、"),fe.rulesForm.studentList=e.filter((e=>2===e._source||"1"===e.peopleType)).map((e=>({peopleId:e.id}))),fe.rulesForm.teacherList=e.filter((e=>1===e._source||"2"===e.peopleType)).map((e=>({userId:e.userId,peopleId:e.id}))))},pi=()=>{fe.holidayVisible=!0,fe.title1="添加节假日"},yi=()=>{qe.value.validateFields().then((()=>{const e={name:fe.holidayForm.name,startTime:fe.holidayForm.date[0],endTime:fe.holidayForm.date[1]};fe.holidayDataSource.push(e),fe.holidayVisible=!1,fe.holidayForm={name:"",date:""}}))},ki=()=>{fe.addRuleVisible=!0,hi()},fi=e=>{!0===e.target.checked?a.confirm({title:"应用到每天",icon:D(w),content:"确定要将当前通行规则应用到每天吗？",okText:"确认",cancelText:"取消",onCancel(){t.info("已取消！"),fe.everyDay=!1},onOk(){fe.everyDay=!0,fe.weekForm.weekList.forEach((e=>{e.timelist=JSON.parse(JSON.stringify(fe.weekForm.weekList[fe.activeKey].timelist)),e.isAllow=JSON.parse(JSON.stringify(fe.weekForm.weekList[fe.activeKey].isAllow))}))}}):!1===e.target.checked&&a.confirm({title:"应用到每天",icon:D(w),content:"确定要取消应用到每天吗？",okText:"确认",cancelText:"取消",onCancel(){t.info("已取消！"),fe.everyDay=!0},onOk(){fe.everyDay=!1}})},vi=e=>{const{current:i,pageSize:a}=e;fe.pagination.pageNo=i,fe.pagination.pageSize=a,Fi()},Ti=()=>{fe.rulesForm.siteId=null,hi()},wi=e=>e.map((e=>(e.children&&(e.disabled=!0,wi(e.children)),e))),hi=e=>{m({type:e||fe.rulesForm.deviceType}).then((({data:i})=>{2==e?fe.fieldList1=i:fe.fieldList=wi(i)}))},Fi=()=>{const e={pageNo:fe.pagination.pageNo,pageSize:fe.pagination.pageSize,userName:fe.searchForm.name,siteId:fe.searchForm.fieid&&fe.searchForm.fieid[1],passId:fe.treeId||h.query.id||h.query.deptId,deviceType:fe.searchForm.deviceType};n(e).then((e=>{const{data:i}=e;fe.pagination.total=i.total,i.list.forEach((e=>{e.isStatus=1===e.isEnable})),fe.dataSource=i.list}))},bi=()=>{const e={type:fe.rulesType,passsceneId:fe.treeId||h.query.id,...fe.rulesForm,ruleHolTimeList:fe.holidayDataSource,isDay:fe.everyDay};delete e.time,2==fe.rulesType?(delete e.ruleTimeList,e.ruleHolTimeList=fe.holidayDataSource.map((e=>({holName:e.name,holStartTime:e.startTime,holEndTime:e.endTime})))):(fe.rulesForm.time&&fe.rulesForm.time.length>0?(e.startTime=fe.rulesForm.time[0],e.endTime=fe.rulesForm.time[1]):fe.rulesForm.time||(e.isForever=1),e.ruleTimeList=fe.weekForm.weekList.map((e=>({allowType:e.isAllow,week:e.week||e.id,weekTimes:e.timelist.map((e=>({weekStartTime:e.time&&e.time[0]?e.time[0]:"",weekEndTime:e.time&&e.time[1]?e.time[1]:""})))}))),delete e.ruleHolTimeList),fe.loading=!0,u(e).then((e=>{t.success(e.message),Fi(),fe.rulesVisible=!1,Ce.value.resetFields()})).catch((e=>{1002013009===e.data.code&&(fe.abnormalVisible=!0,fe.abnormalDataSource=e.data.data)})).finally((()=>fe.loading=!1))},gi=()=>{c().then((e=>{const{data:i}=e;fe.holidayDataSource=i}))},xi=e=>{let i=[],a=[],t=[],l=[],r=[],s=[],o=[];const d=[];e.weeksTimeRes.forEach((e=>{1==e.week&&(i=e.weeksReqList.map((i=>2===e.passageType?"不允许通行":1===e.passageType?"全天通行":i.startTime||i.endTime?i.startTime+"-"+i.endTime:""))),2==e.week&&(a=e.weeksReqList.map((i=>2===e.passageType?"不允许通行":1===e.passageType?"全天通行":i.startTime||i.endTime?i.startTime+"-"+i.endTime:""))),3==e.week&&(t=e.weeksReqList.map((i=>2===e.passageType?"不允许通行":1===e.passageType?"全天通行":i.startTime||i.endTime?i.startTime+"-"+i.endTime:""))),4==e.week&&(l=e.weeksReqList.map((i=>2===e.passageType?"不允许通行":1===e.passageType?"全天通行":i.startTime||i.endTime?i.startTime+"-"+i.endTime:""))),5==e.week&&(r=e.weeksReqList.map((i=>2===e.passageType?"不允许通行":1===e.passageType?"全天通行":i.startTime||i.endTime?i.startTime+"-"+i.endTime:""))),6==e.week&&(s=e.weeksReqList.map((i=>2===e.passageType?"不允许通行":1===e.passageType?"全天通行":i.startTime||i.endTime?i.startTime+"-"+i.endTime:""))),7==e.week&&(o=e.weeksReqList.map((i=>2===e.passageType?"不允许通行":1===e.passageType?"全天通行":i.startTime||i.endTime?i.startTime+"-"+i.endTime:"")))}));for(let m=0;m<6;m++){const e={time:"通行时间",date1:i[m]||"-",date2:a[m]||"-",date3:t[m]||"-",date4:l[m]||"-",date5:r[m]||"-",date6:s[m]||"-",date7:o[m]||"-"};let n=!1;for(const i in e)e[i]&&"通行时间"!==e[i]&&"-"!==e[i]&&(n=!0);n&&d.push(e)}return d},Ii=e=>{p(e).then((i=>{const{data:a}=i;if("1"===e.ruleType){fe.rulesForm.id=a.ordinaryForm.id,fe.rulesForm.ruleName=a.ordinaryForm.ruleName,fe.rulesForm.siteId=a.ordinaryForm.siteId,fe.rulesForm.direction=a.ordinaryForm.inOut,fe.rulesForm.deviceType=a.ordinaryForm.deviceType,fe.rulesForm.time=[a.ordinaryForm.startTime,a.ordinaryForm.endTime],fe.everyDay=a.ordinaryForm.isDay;const e=[];a.ordinaryForm.peopleVoForms.map((i=>{e.push(i.name)})),fe.rulesForm.personnelName=e.join("、"),fe.rulesForm.studentList=a.ordinaryForm.peopleVoForms.filter((e=>!e.userId)).map((e=>({peopleId:e.id}))),fe.rulesForm.teacherList=a.ordinaryForm.peopleVoForms.filter((e=>e.userId)).map((e=>({userId:e.userId,peopleId:e.id})));const i=a.ordinaryForm.peopleVoForms.map((e=>({...e,id:e.id})));fe.checkedList=i,a.ordinaryForm.weeksTimeRes.forEach(((e,i)=>{fe.weekForm.weekList[i].isAllow=e.passageType,fe.weekForm.weekList[i].timelist=e.weeksReqList.map((e=>e.startTime?{time:[e.startTime,e.endTime]}:{time:""}))})),fe.weekListLoca=fe.weekForm.weekList,fe.seeDataSource=xi(a.ordinaryForm),hi()}if("2"===e.ruleType){fe.rulesForm.id=a.holidayForm.id,fe.rulesForm.ruleName=a.holidayForm.ruleName,fe.rulesForm.siteId=a.holidayForm.siteId,fe.rulesForm.deviceType=a.holidayForm.deviceType,fe.rulesForm.direction=a.holidayForm.inOut,fe.rulesForm.time=[a.holidayForm.startTime,a.holidayForm.endTime],fe.holidayDataSource=a.holidayForm.holidayReqList.map((e=>({name:e.holidayName,startTime:e.holidayStartTime,endTime:e.holidayEndTime}))),fe.seeHolidayDataSource=a.holidayForm.holidayReqList.map((e=>({holiday:e.holidayName,time:e.holidayStartTime+"/"+e.holidayEndTime}))),fe.isInOut="1"===a.holidayForm.inOut?"允许出入":"不允许出入";const e=[];a.holidayForm.peopleVoForms.map((i=>{e.push(i.name)})),fe.rulesForm.personnelName=e.join("、"),fe.rulesForm.studentList=a.holidayForm.peopleVoForms.filter((e=>!e.userId)).map((e=>({peopleId:e.id}))),fe.rulesForm.teacherList=a.holidayForm.peopleVoForms.filter((e=>e.userId)).map((e=>({userId:e.userId,peopleId:e.id})));const i=a.holidayForm.peopleVoForms.map((e=>({...e,id:e.id})));fe.checkedList=i,hi()}if("3"===e.ruleType){fe.rulesForm.id=a.temporaryForm.id,fe.rulesForm.deviceType=a.temporaryForm.deviceType,fe.rulesForm.ruleName=a.temporaryForm.ruleName,fe.rulesForm.siteId=a.temporaryForm.siteId,fe.rulesForm.direction=a.temporaryForm.inOut,fe.rulesForm.time=[a.temporaryForm.startTime,a.temporaryForm.endTime],fe.everyDay=a.temporaryForm.isDay;const e=[];a.temporaryForm.peopleVoForms.map((i=>{e.push(i.name)})),fe.rulesForm.personnelName=e.join("、"),fe.rulesForm.studentList=a.temporaryForm.peopleVoForms.filter((e=>!e.userId)).map((e=>({peopleId:e.id}))),fe.rulesForm.teacherList=a.temporaryForm.peopleVoForms.filter((e=>e.userId)).map((e=>({userId:e.userId,peopleId:e.id})));const i=a.temporaryForm.peopleVoForms.map((e=>({...e,id:e.id})));fe.checkedList=i,a.temporaryForm.weeksTimeRes.forEach(((e,i)=>{fe.weekForm.weekList[i].isAllow=e.passageType,fe.weekForm.weekList[i].timelist=e.weeksReqList.map((e=>e.startTime?{time:[e.startTime,e.endTime]}:{time:""}))})),fe.seeDataSource=xi(a.temporaryForm),hi()}}))},_i=()=>{const e={type:fe.editType,ruleId:fe.ruleId,passsceneId:fe.treeId||h.query.id,...fe.rulesForm,ruleHolTimeList:fe.holidayDataSource,isDay:fe.everyDay};delete e.time,2==fe.editType?(delete e.ruleTimeList,e.ruleHolTimeList=fe.holidayDataSource.map((e=>({holName:e.name,holStartTime:e.startTime,holEndTime:e.endTime})))):(fe.rulesForm.time&&fe.rulesForm.time.length>0?(e.startTime=fe.rulesForm.time[0],e.endTime=fe.rulesForm.time[1]):fe.rulesForm.time||(e.isForever=1),e.ruleTimeList=fe.weekForm.weekList.map((e=>({allowType:e.isAllow,week:e.week||e.id,weekTimes:e.timelist.map((e=>({weekStartTime:e.time&&e.time[0]?e.time[0]:"",weekEndTime:e.time&&e.time[1]?e.time[1]:""})))}))),delete e.ruleHolTimeList),fe.loading=!0,y(e).then((e=>{t.success(e.message),Fi(),fe.rulesVisible=!1})).finally((()=>fe.loading=!1))},Li=e=>{k(e).then((e=>{Fi()}))},Si=e=>{f(e).then((e=>{t.success(e.message),Fi()}))};return x((()=>{Fi(),gi(),hi(2)})),(i,l)=>{const s=I("a-cascader"),o=I("a-form-item"),d=I("a-input"),m=I("a-select-option"),n=I("a-select"),u=I("a-button"),c=I("redo-outlined"),p=I("a-form"),y=I("exclamation-circle-outlined"),k=I("a-tooltip"),f=I("a-switch"),h=I("a-modal"),F=I("a-radio"),b=I("a-radio-group"),g=I("a-tree-select"),x=I("a-range-picker"),z=I("a-time-range-picker"),K=I("a-space"),J=I("a-tab-pane"),ye=I("a-tabs"),he=I("a-checkbox"),Fe=I("a-drawer");return _(),L("div",P,[S(" 侧边栏 "),S(' <div class="left">\r\n            <DempTree\r\n                v-if="roleTree.length"\r\n                :treeData="roleTree"\r\n                :fieldNames="fieldNames"\r\n                :expandAll="true"\r\n                @emitSelect="selectSemester"\r\n                @getTreeTypeId="getTreeTypeIder"\r\n            ></DempTree>\r\n        </div> '),S(" 侧边栏 "),N("div",B,[S(" 搜索表单 "),N("div",G,[N("div",$,[D(p,{model:j(be),layout:"inline"},{default:C((()=>[D(o,{label:"场地：",style:{"margin-bottom":"12px"}},{default:C((()=>[D(s,{value:j(be).fieid,"onUpdate:value":l[0]||(l[0]=e=>j(be).fieid=e),fieldNames:ai,options:j(ze),placeholder:"请选择",style:{width:"200px"}},null,8,["value","fieldNames","options"])])),_:1}),D(o,null,{default:C((()=>[D(d,{value:j(be).name,"onUpdate:value":l[1]||(l[1]=e=>j(be).name=e),placeholder:"请输入人员姓名搜索",allowClear:""},null,8,["value"])])),_:1}),D(o,{label:"设备类型："},{default:C((()=>[D(n,{style:{width:"150px"},value:j(be).deviceType,"onUpdate:value":l[2]||(l[2]=e=>j(be).deviceType=e),placeholder:"全部"},{default:C((()=>[D(m,{value:""},{default:C((()=>[A("全部")])),_:1}),D(m,{value:1},{default:C((()=>[A("人脸机")])),_:1}),D(m,{value:3},{default:C((()=>[A("考勤机")])),_:1})])),_:1},8,["value"])])),_:1}),D(o,null,{default:C((()=>[D(u,{type:"primary",style:{"margin-right":"10px"},onClick:ti},{icon:C((()=>[D(j(v),{style:{"margin-right":"10px"}})])),default:C((()=>[A(" 查询 ")])),_:1}),D(u,{onClick:li},{icon:C((()=>[D(c,{style:{"margin-right":"10px"}})])),default:C((()=>[A(" 重置 ")])),_:1})])),_:1})])),_:1},8,["model"]),D(u,{type:"primary",onClick:ki},{icon:C((()=>[D(j(T))])),default:C((()=>[A(" 添加规则 ")])),_:1})])]),S(" 表格 "),D(e,{class:"worker-table tableBox",columns:Qe,dataSource:j(ge),rowSelection:!1,isScroll:!0,totals:fe.pagination,onOnSelectedRowKeys:vi},{bodyCell:C((({column:e,text:i,record:l})=>["rulesType"===e.dataIndex?(_(),L("div",Q,V(1==l.rulesType?"常规规则":2==l.rulesType?"节假日规则":3==l.rulesType?"临时规则":""),1)):S("v-if",!0),"deviceType"===e.dataIndex?(_(),L("div",W,V(1==l.deviceType?"人脸机":2==l.deviceType?"班牌":3==l.deviceType?"考勤机":"-"),1)):S("v-if",!0),"inOut"===e.dataIndex?(_(),L(R,{key:2},[2!=l.rulesType?(_(),L("div",X,V(1==l.inOut?"出":2==l.inOut?"入":"-"),1)):(_(),L("div",Z,V(1==l.inOut?"不允许出入":2==l.inOut?"允许出入":"-"),1))],64)):S("v-if",!0),"isEnable"===e.dataIndex?(_(),L("div",ee,[N("div",{class:"stateLi",style:O(1==l.isEnable?"background: var(--primary-color)":2==l.isEnable?"background: #F5222D":"background:#BFBFBF")},null,4),N("div",null,V(1==l.isEnable?"已启用":2==l.isEnable?"禁用":"未启用"),1)])):S("v-if",!0),"time"===e.dataIndex?(_(),L(R,{key:4},[A(V(l.startTime+"/"+l.endTime)+" ",1),"2099-12-31"==l.endTime?(_(),U(k,{key:0},{title:C((()=>[A("该条规则永久有效")])),default:C((()=>["2099-12-31"==l.endTime?(_(),U(y,{key:0,style:{"font-size":"16px",color:"#ff9800"}})):S("v-if",!0)])),_:2},1024)):S("v-if",!0),new Date(l.endTime).getTime()<new Date(ke).getTime()?(_(),U(k,{key:1},{title:C((()=>[A("该条规则已过期")])),default:C((()=>[new Date(l.endTime).getTime()<new Date(ke).getTime()?(_(),U(y,{key:0,style:{"font-size":"16px",color:"#989595"}})):S("v-if",!0)])),_:2},1024)):S("v-if",!0)],64)):S("v-if",!0),"operation"===e.dataIndex?(_(),L("div",ie,[D(u,{type:"link",style:{color:"var(--primary-color)","padding-left":"0"},onClick:e=>(e=>{fe.noTime=!1,fe.ruleId=e.ruleId;const i={id:e.ruleId,ruleType:e.rulesType};1==e.rulesType?(fe.title="修改常规规则",fe.editType=1):2==e.rulesType?(fe.title="修改节假日规则",fe.editType=2):(fe.title="修改临时规则",fe.editType=3),fe.rulesVisible=!0,Ii(i)})(l)},{default:C((()=>[A("修改")])),_:2},1032,["onClick"]),D(u,{type:"link",onClick:e=>(e=>{const i={id:e.ruleId,ruleType:e.rulesType};a.confirm({title:"删除提示",icon:D(w),content:"是否删除该条规则？",okText:"确认",cancelText:"取消",onCancel(){t.info("已取消！")},onOk(){Li(i)}})})(l),style:{color:"red"}},{default:C((()=>[A("删除")])),_:2},1032,["onClick"]),D(u,{type:"link",style:{color:"var(--primary-color)"},onClick:e=>(e=>{fe.holidayVisible=!0,fe.title1=e.ruleName,fe.seeType=e.rulesType,fe.times=e.startTime+"/"+e.endTime;const i={id:e.ruleId,ruleType:e.rulesType};Ii(i)})(l)},{default:C((()=>[A("查看规则")])),_:2},1032,["onClick"]),D(f,{checked:l.isStatus,"onUpdate:checked":e=>l.isStatus=e,onChange:e=>(e=>{const i={ruleId:e.ruleId,ruleType:e.rulesType,isEnable:e.isStatus?1:2};Si(i)})(l)},null,8,["checked","onUpdate:checked","onChange"]),A(" "+V(1==l.isEnable?"禁用":"启用"),1)])):S("v-if",!0),"ruleName"===e.dataIndex||"siteName"===e.dataIndex?(_(),U(k,{key:6,placement:"topLeft"},q({default:C((()=>[A(" "+V(i),1)])),_:2},[(null==i?void 0:i.length)>15?{name:"title",fn:C((()=>[A(V(i),1)])),key:"0"}:void 0]),1024)):S("v-if",!0)])),_:1},8,["dataSource","totals"]),S(" 暂无数据 "),S(' <div class="noData_empty" v-else>\r\n                <a-empty\r\n                    image="/image/empty.png"\r\n                    :image-style="{\r\n                        height: \'180px\',\r\n                        width: \'180px\'\r\n                    }"\r\n                >\r\n                    <template #description>\r\n                        <span>暂无规则</span>\r\n                    </template>\r\n                </a-empty>\r\n            </div> ')]),S(" 添加规则弹框 "),D(h,{visible:j(Ie),"onUpdate:visible":l[3]||(l[3]=e=>E(Ie)?Ie.value=e:null),class:"addRuleModal",width:"408px",footer:""},{title:C((()=>[N("div",null,[A(" 添加规则 "),D(k,{title:"临时出入规则的优先级最高，节假日出入规则的\r\n                        优先级高于常规出入规则。"},{default:C((()=>[D(y,{style:{"font-size":"18px",color:"#ff9800"}})])),_:1})])])),default:C((()=>[N("div",ae,[D(u,{type:"primary",class:"btn",onClick:ri},{default:C((()=>[A("添加常规规则")])),_:1}),D(u,{type:"primary",class:"btn",onClick:si},{default:C((()=>[A("添加节假日规则")])),_:1}),D(u,{type:"primary",class:"btn",onClick:oi},{default:C((()=>[A("添加临时规则")])),_:1})])])),_:1},8,["visible"]),S(" 规则弹窗 "),D(Fe,{visible:j(_e),"onUpdate:visible":l[14]||(l[14]=e=>E(_e)?_e.value=e:null),title:j(Le),width:"502",onClose:mi},{footer:C((()=>[N("div",me,[D(u,{style:{"margin-right":"8px"},onClick:di},{default:C((()=>[A("取消")])),_:1}),D(u,{type:"primary",loading:fe.loading,onClick:ni},{default:C((()=>[A("确认")])),_:1},8,["loading"])])])),default:C((()=>[D(p,{model:j(Se),layout:"vertical",ref_key:"rulesRef",ref:Ce},{default:C((()=>[D(o,{label:"选择通行设备：",name:"deviceType",class:"form_inline",rules:[{required:!0,message:"请选择通行设备"}]},{default:C((()=>[D(b,{value:j(Se).deviceType,"onUpdate:value":l[4]||(l[4]=e=>j(Se).deviceType=e),onChange:Ti},{default:C((()=>[D(F,{value:1},{default:C((()=>[A(" 人脸机 ")])),_:1}),D(F,{value:3},{default:C((()=>[A(" 考勤机 ")])),_:1})])),_:1},8,["value"])])),_:1}),D(o,{label:"规则名称：",name:"ruleName",rules:[{required:!0,message:"请输入规则名称"}]},{default:C((()=>[D(d,{value:j(Se).ruleName,"onUpdate:value":l[5]||(l[5]=e=>j(Se).ruleName=e),placeholder:"请输入","allow-clear":"",maxlength:"20"},null,8,["value"])])),_:1}),D(o,{label:"选择场地：",name:"siteId",rules:[{required:!0,message:"请选择场地"}]},{default:C((()=>[D(g,{class:"select_site_class",value:j(Se).siteId,"onUpdate:value":l[6]||(l[6]=e=>j(Se).siteId=e),"show-search":"",placeholder:"请选择","allow-clear":"","tree-default-expand-all":"","tree-data":j(xe),"field-names":{children:"children",label:"name",key:"id",value:"id"},onSelect:ui,disabled:j(Ke),showSearch:!1},null,8,["value","tree-data","disabled"])])),_:1}),D(o,{label:"选择人员：",name:"personnelName",rules:[{required:!0,message:"请选择人员"},{validator:ii,trigger:"blur"}]},{default:C((()=>[D(j(r),{mode:"personnel",tabs:[{tab:"教职工",key:1,checked:!0},{tab:"学生组",key:2,checked:!1}],visible:j(je),"onUpdate:visible":l[8]||(l[8]=e=>E(je)?je.value=e:null),checked:j(Ae),"onUpdate:checked":l[9]||(l[9]=e=>E(Ae)?Ae.value=e:null),queryEltern:!1,onHandleOk:ci},{default:C((()=>[D(d,{value:j(Se).personnelName,"onUpdate:value":l[7]||(l[7]=e=>j(Se).personnelName=e),onClick:i.addMember,allowClear:"",placeholder:"请选择",readonly:"readonly"},null,8,["value","onClick"])])),_:1},8,["visible","checked"])])),_:1},8,["rules"]),1===j(Se).deviceType?(_(),U(o,{key:0,label:"通行方向：",class:"form_inline",name:"direction",rules:[{required:!0,message:"请选择通行方向"}]},{default:C((()=>[D(b,{value:j(Se).direction,"onUpdate:value":l[10]||(l[10]=e=>j(Se).direction=e),onChange:i.changeDirection},{default:C((()=>[D(F,{value:"2"},{default:C((()=>[N("span",null,V("添加节假日规则"==j(Le)||"修改节假日规则"==j(Le)?"允许出入":"入"),1)])),_:1}),D(F,{value:"1"},{default:C((()=>[A(V("添加节假日规则"==j(Le)||"修改节假日规则"==j(Le)?"不允许出入":"出"),1)])),_:1})])),_:1},8,["value","onChange"])])),_:1})):S("v-if",!0),"添加节假日规则"!=j(Le)&&"修改节假日规则"!=j(Le)?(_(),U(o,{key:1,label:"有效期：",name:"添加临时规则"==j(Le)?"time":"",rules:"添加临时规则"==j(Le)?[{required:!0,message:"请选择"}]:[]},{default:C((()=>[D(x,{value:j(Se).time,"onUpdate:value":l[11]||(l[11]=e=>j(Se).time=e),"value-format":"YYYY-MM-DD",style:{width:"100%"},separator:"至","disabled-date":we,onCalendarChange:Te},null,8,["value"])])),_:1},8,["name","rules"])):S("v-if",!0),S(" 节假日表格 "),"添加节假日规则"==j(Le)||"修改节假日规则"==j(Le)?(_(),L("div",te,[D(u,{onClick:pi,style:{color:"var(--primary-color)","border-color":"var(--primary-color)",background:"rgba(0, 183, 129, 0.08)"}},{icon:C((()=>[D(j(T))])),default:C((()=>[A(" 添加节假日 ")])),_:1}),le,D(e,{columns:We,dataSource:j(Re),rowSelection:!1,style:{"margin-top":"16px"}},{bodyCell:C((({column:e,record:i})=>["operation"===e.dataIndex?(_(),U(u,{key:0,type:"link",onClick:e=>{return l=i,void a.confirm({title:"删除提示",icon:D(w),content:"是否删除该条节假日?",okText:"确认",cancelText:"取消",onCancel(){t.info("已取消！")},onOk(){fe.holidayDataSource=fe.holidayDataSource.filter((e=>e!==l)),t.info("删除成功！")}});var l},style:{color:"red"}},{default:C((()=>[A("删除")])),_:2},1032,["onClick"])):S("v-if",!0),"time"===e.dataIndex?(_(),L(R,{key:1},[A(V(i.startTime+"/"+i.endTime),1)],64)):S("v-if",!0)])),_:1},8,["dataSource"])])):S("v-if",!0)])),_:1},8,["model"]),"添加节假日规则"!=j(Le)&&"修改节假日规则"!=j(Le)?(_(),U(p,{key:0,ref_key:"formRef",ref:ve,layout:"inline",model:j(Pe)},{default:C((()=>[re,D(ye,{activeKey:j(De),"onUpdate:activeKey":l[12]||(l[12]=e=>E(De)?De.value=e:null),type:"card",class:M({atab:j(Ve)}),id:"atabDiv"},{default:C((()=>[(_(!0),L(R,null,H(j(Pe).weekList,((e,i)=>(_(),U(J,{tab:e.weekName,key:i},{default:C((()=>[D(b,{value:e.isAllow,"onUpdate:value":i=>e.isAllow=i,name:"radioGroup",onChange:i=>(e=>{fe.weekListLoca,"0"===e.isAllow?e.timelist=[{time:""}]:e.timelist=[{time:["00:00:00","23:59:59"]}]})(e),style:{margin:"10px"}},{default:C((()=>[D(F,{value:"0"},{default:C((()=>[A("自定义")])),_:1}),D(F,{value:"1"},{default:C((()=>[A("允许全天通行")])),_:1}),"添加临时规则"==j(Le)?(_(),U(F,{key:0,value:"2"},{default:C((()=>[A("不允许全天通行")])),_:1})):S("v-if",!0)])),_:2},1032,["value","onUpdate:value","onChange"]),(_(!0),L(R,null,H(e.timelist,((a,l)=>(_(),U(K,{style:{display:"flex","margin-bottom":"8px"},align:"baseline",key:l},{default:C((()=>[D(o,{label:2==e.isAllow?"非通行时间":"通行时间"},{default:C((()=>[D(z,{value:a.time,"onUpdate:value":e=>a.time=e,onChange:e=>((e,i,a)=>{if(e||Y((()=>{fe.weekForm.weekList[i].timelist[a].time=""})),Y((()=>{ve.value.clearValidate()})),a>0){const e="2021-12-02",l=e+" "+fe.weekForm.weekList[i].timelist[a-1].time[1],r=e+" "+fe.weekForm.weekList[i].timelist[a].time[0];new Date(r).getTime()<new Date(l).getTime()&&(t.error("当前通行时间小于上一时间"),Y((()=>{fe.weekForm.weekList[i].timelist[a].time=""})))}})(e,i,l),"value-format":"HH:mm:ss",disabled:1==e.isAllow||2==e.isAllow},null,8,["value","onUpdate:value","onChange","disabled"])])),_:2},1032,["label"]),0==e.isAllow?(_(),L("i",{key:0,class:"iconfont icon-shanchu",style:{"font-size":"22px"},onClick:i=>((e,i)=>{e.timelist.splice(i,1)})(e,l)},null,8,se)):S("v-if",!0),S(' <MinusCircleOutlined\r\n                                @click="removeUser(item, i)"\r\n                                v-if="item.isAllow == 0"\r\n                            />')])),_:2},1024)))),128)),fe.noTime?(_(),L("div",oe,[de,A(" 通行时间没有填写完整 ")])):S("v-if",!0),0==e.isAllow&&e.timelist.length<6?(_(),U(o,{key:1},{default:C((()=>[D(u,{style:{color:"var(--primary-color)","border-color":"var(--primary-color)",background:"rgba(0, 183, 129, 0.08)"},onClick:i=>(e=>{e.timelist.push({time:""})})(e)},{icon:C((()=>[D(j(T))])),default:C((()=>[A("添加通行时间 ")])),_:2},1032,["onClick"])])),_:2},1024)):S("v-if",!0)])),_:2},1032,["tab"])))),128))])),_:1},8,["activeKey","class"]),D(he,{checked:j(Ve),"onUpdate:checked":l[13]||(l[13]=e=>E(Ve)?Ve.value=e:null),onChange:fi},{default:C((()=>[A("应用到每天")])),_:1},8,["checked"])])),_:1},8,["model"])):S("v-if",!0)])),_:1},8,["visible","title"]),S(" 节假日弹窗、 查看规则弹窗"),D(h,{visible:j(Oe),"onUpdate:visible":l[17]||(l[17]=e=>E(Oe)?Oe.value=e:null),title:j(Ee),onOk:yi,width:"添加节假日"==j(Ee)?"408px":"800px",zIndex:1049,class:M("添加节假日"==j(Ee)?"":"addRuleModal")},{default:C((()=>[S(" 添加节假日 "),"添加节假日"==j(Ee)?(_(),L("div",ne,[D(p,{model:j(Ue),layout:"vertical",ref_key:"holidayRef",ref:qe},{default:C((()=>[D(o,{label:"节日名称：",name:"name",rules:[{required:!0,message:"请输入节日名称"}]},{default:C((()=>[D(d,{value:j(Ue).name,"onUpdate:value":l[15]||(l[15]=e=>j(Ue).name=e),"allow-clear":"",maxlength:"10",placeholder:"请输入节日名称"},null,8,["value"])])),_:1}),D(o,{label:"日期",name:"date",rules:[{required:!0,message:"请选择日期"}]},{default:C((()=>[D(x,{value:j(Ue).date,"onUpdate:value":l[16]||(l[16]=e=>j(Ue).date=e),"value-format":"YYYY-MM-DD",style:{width:"100%"},separator:"至"},null,8,["value"])])),_:1})])),_:1},8,["model"])])):S("v-if",!0),S(" 查看常规、临时规则 "),2!=fe.seeType&&"添加节假日"!=j(Ee)?(_(),L("div",ue,[A(" 有效期： "),N("span",null,V(j(Me)),1),D(e,{columns:Xe,dataSource:j(He),rowSelection:!1,style:{"margin-top":"16px"}},null,8,["dataSource"])])):S("v-if",!0),S(" 查看节假日规则 "),2==fe.seeType&&"添加节假日"!=j(Ee)?(_(),L("div",ce,[S(" {{ isInOut }} "),D(e,{columns:Ze,dataSource:j(Ye),rowSelection:!1,style:{"margin-top":"16px"}},null,8,["dataSource"])])):S("v-if",!0)])),_:1},8,["visible","title","width","class"]),S(" 规则重复的异常弹框 "),D(h,{visible:j(Be),"onUpdate:visible":l[18]||(l[18]=e=>E(Be)?Be.value=e:null),title:"异常",width:"408px",class:"abnormalModal"},{default:C((()=>[D(j(w),{id:"itemTooltip",style:{"font-size":"18px",color:"#ff9800"}}),pe,D(e,{columns:ei,dataSource:j(Ge),rowSelection:!1,style:{"margin-top":"16px"}},null,8,["dataSource"])])),_:1},8,["visible"])])}}}),[["__scopeId","data-v-680f6a9d"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/appModel/traffic/trafficRule/index.vue"]]);export{ye as default};
