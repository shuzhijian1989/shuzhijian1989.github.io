import"./vue.a2f518ee.js";import{m as e}from"./ant-design-vue.db4d48e3.js";import{r as t,d as s,c as i,a,u as o}from"./schedule.c815e51b.js";import{s as n,y as r}from"./academicYearSemester.a705d5c5.js";import{_ as l}from"./index.272083a4.js";import{_ as d}from"./index.7061e8ea.js";import{r as c,q as p,f as m,b8 as g,I as u,o as h,a as f,a7 as y,b,c as L,H as v,a2 as x,a3 as w,O as T,aK as j,a9 as z,F as _,a8 as k,b5 as I,b4 as S,m as D}from"./@vue.919ff404.js";import{E as A}from"./@ant-design.2e172c39.js";import"./@babel.6d5f88cb.js";import"./resize-observer-polyfill.f664b406.js";import"./vue-types.022beab3.js";import"./@ctrl.c020ccd3.js";import"./dom-align.0991ecc5.js";import"./lodash-es.36dcd19c.js";import"./dayjs.49e29cb2.js";import"./async-validator.267d9719.js";import"./scroll-into-view-if-needed.61c672a4.js";import"./compute-scroll-into-view.17358474.js";import"./qs.e55e9b28.js";import"./side-channel.ea627785.js";import"./get-intrinsic.8c87d952.js";import"./has-symbols.caae0f97.js";import"./has-proto.76cff6c7.js";import"./function-bind.cb3858f2.js";import"./has.c1051c46.js";import"./call-bind.208b5ef0.js";import"./object-inspect.e2cfb4a5.js";/* empty css                    */import"./secure-ls.8c8acb46.js";import"./vue-router.907b547c.js";import"./nprogress.c2257662.js";import"./axios.7aed06b8.js";import"./vuex.f308ecec.js";import"./vuex-persistedstate.fa252374.js";import"./vue-grid-layout.a3ef67ec.js";const N={class:"restBox"},$=(e=>(I("data-v-75b3e29c"),e=e(),S(),e))((()=>b("div",{class:"restTitle"},"作息表",-1))),C={class:"restHeader"},O={style:{display:"flex"}},M=["onClick"],U={style:{display:"flex",width:"100%"}},Y={style:{"margin-bottom":"10px",display:"flex","flex-wrap":"wrap"}},H={class:"sectionTime"},R={class:"editButton"};var q=d({__name:"index",setup(d){const{proxy:I}=D(),S={name:[{required:!0,message:"请输入作息表名称"}],semesterId:[{required:!0,message:"请选择学期"}],schoolYearId:[{required:!0,message:"请选择学年"}]},q=c(),E=[{title:"作息表名称",dataIndex:"name",width:"450px",ellipsis:!0,showSorterTooltip:!0},{title:"学年",dataIndex:"yearName"},{title:"学期",dataIndex:"semesterName"},{title:"操作",dataIndex:"operation",width:"150px",align:"right"}],B=p({scheduleDisabled:!0,semesterDisabled:!1,searchLoading:!1,deleteLoging:!1,submitLoading:!1,spinning:!1,onSearchName:"",pagination:{pageNo:1,pageSize:10,total:0},visible:!1,visibleTitle:"添加作息",restList:{name:"",semesterId:"",schoolYearId:"",sectionList:[],selfMorning:0,earlyMorning:0,afternoon:0,eveningNum:0,evening:0},dataSource:[],allRoutine:[],timeSlotList:[{periodType:1,title:"早自习",code:0,list:[]},{periodType:2,title:"上午",code:0,list:[]},{periodType:3,title:"下午",code:0,list:[]},{periodType:4,title:"晚上",code:0,list:[]},{periodType:5,title:"晚自习",code:0,list:[]}],zzx:[],sw:[],xw:[],ws:[],wzx:[],semesterData:[],yearData:[]}),F=e=>{B.restList.semesterId="",B.restList.yearId=e;const t={pageNo:1,pageSize:999,schoolYearId:B.restList.yearId};n(t).then((e=>{B.semesterData=e.data.list}))},K=[{title:"时段",dataIndex:"name",width:"30%",align:"center"},{title:"节次",dataIndex:"section",width:"100px",align:"center"},{title:"上课时间",dataIndex:"time",type:Array,align:"center"}],W=()=>{B.spinning=!0;const e={...B.pagination,name:B.onSearchName};t(e).then((e=>{const{data:t}=e;B.dataSource=t.list,B.pagination.total=t.total})).finally((()=>{B.spinning=!1,B.searchLoading=!1}))},G=()=>{I.$confirm({title:"删除提示",icon:L(A),content:"删除后不可恢复，如需继续删除，请点击确认！",okType:"danger",okText:"确定",cancelText:"取消",onOk(){B.deleteLoging=!0;const t={ids:B.allRoutine};s(t).then((t=>{e.success(t.message),B.pagination.pageNo=1,W()})).finally((()=>{B.deleteLoging=!1}))}})},J=(e,t)=>{r({pageNo:1,pageSize:999}).then((e=>{B.yearData=e.data,F()})),B.zzx=[],B.sw=[],B.xw=[],B.ws=[],B.wzx=[],!1===e?(B.restList.name="",B.restList.semesterName="",B.restList.semesterId="",B.restList.schoolYearId="",B.restList.sectionList=[],B.timeSlotList.forEach((e=>{e.code=0})),B.visible=!0,B.visibleTitle="添加作息",B.semesterDisabled=!1):(B.visible=!0,B.visibleTitle="编辑作息",B.semesterDisabled=!0,X(t))},P=()=>{q.value.validate().then((()=>{B.restList.sectionList.length>0?"添加作息"===B.visibleTitle?Q():Z():e.error("请选择节次")})).catch((e=>{}))},Q=()=>{B.submitLoading=!0,i(B.restList).then((t=>{B.visible=!1,e.success(t.message),W()})).finally((()=>{B.submitLoading=!1}))},V=e=>{e.filter((e=>2===e.periodType||3===e.periodType||4===e.periodType)).forEach(((e,t)=>{e.section=""+("第"+te(t+1)+"节")}))},X=e=>{const t={id:e.id};a(t).then((e=>{B.restList=e.data,B.restList.sectionList.forEach((e=>{if(1===e.periodType){const t="早自习";B.zzx.push(Object.assign({},{code:e.code,periodType:e.periodType,name:e.periodName,time:e.time,section:`${t}${te(e.code)}`,id:e.id}))}else if(2===e.periodType)B.sw.push(Object.assign({},{code:e.code,periodType:e.periodType,name:e.periodName,time:e.time,section:`第${te(e.code)}节`,id:e.id}));else if(3===e.periodType)B.xw.push(Object.assign({},{code:e.code,periodType:e.periodType,name:e.periodName,time:e.time,section:`第${te(e.code)}节`,id:e.id}));else if(4===e.periodType)B.ws.push(Object.assign({},{code:e.code,periodType:e.periodType,name:e.periodName,time:e.time,section:`第${te(e.code)}节`,id:e.id}));else if(5===e.periodType){const t="晚自习";B.wzx.push(Object.assign({},{code:e.code,periodType:e.periodType,name:e.periodName,time:e.time,section:`${t}${te(e.code)}`,id:e.id}))}})),B.restList.sectionList=[].concat([],B.zzx,B.sw,B.xw,B.ws,B.wzx),V(B.restList.sectionList),B.restList.selfMorning=B.zzx.length,B.restList.earlyMorning=B.sw.length,B.restList.afternoon=B.xw.length,B.restList.eveningNum=B.ws.length,B.restList.evening=B.wzx.length;const t=[e.data.selfMorning,e.data.earlyMorning,e.data.afternoon,e.data.eveningNum,e.data.evening],s=[];t.forEach(((e,t)=>{s.push(Object.assign({},{periodType:t+1,code:e,title:t+1===1?"早自习":t+1===2?"上午":t+1===3?"下午":t+1===4?"晚上":t+1===5?"晚自习":""}))})),B.timeSlotList=s}))},Z=()=>{B.submitLoading=!0,o(B.restList).then((t=>{B.visible=!1,e.success(t.message),W()})).finally((()=>{B.submitLoading=!1}))},ee=["零","一","二","三","四","五","六","七","八","九","十"],te=e=>{let t="";e=""+e;for(let s=0;s<e.length;s++)t+=ee[parseInt(e.charAt(s))];return 2===t.length&&(t.charAt(1)===ee[0]?(t=t.charAt(0)+ee[10],t===ee[1]+ee[10]&&(t=ee[10])):t.charAt(0)===ee[1]?t=ee[10]+t.charAt(1):t.charAt(0)===ee[2]?t=ee[2]+ee[10]+t.charAt(1):t.charAt(0)===ee[3]?t=ee[3]+ee[10]+t.charAt(1):t.charAt(0)===ee[4]?t=ee[4]+ee[10]+t.charAt(1):t.charAt(0)===ee[5]?t=ee[5]+ee[10]+t.charAt(1):t.charAt(0)===ee[6]?t=ee[6]+ee[10]+t.charAt(1):t.charAt(0)===ee[7]?t=ee[7]+ee[10]+t.charAt(1):t.charAt(0)===ee[8]?t=ee[8]+ee[10]+t.charAt(1):t.charAt(0)===ee[9]?t=ee[9]+ee[10]+t.charAt(1):t.charAt(0)===ee[10]&&(t=ee[10]+ee[10]+t.charAt(1))),t},se=({code:e,periodType:t,title:s,time:i},a)=>{const o=e-a,n=[];if(1===t){const e="早自习";for(let i=0;i<o;i++)n.push(Object.assign({},{code:i+1+a,periodType:t,name:s,section:`${e}${i+1+a}`,time:[]}));return n}if(5===t){const e="晚自习";for(let i=0;i<o;i++)n.push(Object.assign({},{code:i+1+a,periodType:t,name:s,section:`${e}${i+1+a}`,time:[]}));return n}for(let r=0;r<o;r++)n.push(Object.assign({},{code:r+1+a,periodType:t,name:s,section:`第${te(r+1+a)}节`,time:[]}));return n},ie=(e,t)=>{e.length>0?(B.scheduleDisabled=!1,B.allRoutine=e):B.scheduleDisabled=!0},ae=e=>{B.searchLoading=!0,B.onSearchName=e,B.pageNo=1,B.pageSize=10,W()},oe=e=>{B.pagination.pageNo=e.current,B.pagination.pageSize=e.pageSize,W()};return m((()=>{W()})),(t,s)=>{const i=g("a-input-search"),a=g("plus-outlined"),o=g("a-button"),n=g("a-spin"),r=g("a-tooltip"),d=g("a-layout-content"),c=g("a-input"),p=g("a-form-item"),m=g("a-select-option"),I=g("a-select"),D=g("a-empty"),A=g("a-time-range-picker"),W=g("a-table"),Q=g("a-form"),X=g("a-drawer"),Z=u("auth");return h(),f("div",N,[$,y(" 头部 "),b("div",C,[L(i,{placeholder:"请输入关键字搜索",style:{width:"336px"},loading:B.searchLoading,onSearch:ae,allowClear:!0},null,8,["loading"]),b("div",O,[v((h(),x(o,{type:"primary",onClick:s[0]||(s[0]=e=>J(!1))},{icon:w((()=>[L(a)])),default:w((()=>[T(" 添加作息 ")])),_:1})),[[Z,"add"]]),L(n,{spinning:B.deleteLoging},{default:w((()=>[v((h(),x(o,{onClick:G,danger:"",style:{"margin-left":"12px"},disabled:B.scheduleDisabled},{default:w((()=>[T(" 批量删除 ")])),_:1},8,["disabled"])),[[Z,"batchRemove"]])])),_:1},8,["spinning"])])]),L(d,null,{default:w((()=>[y(" 表格主体 "),L(n,{spinning:B.spinning},{default:w((()=>[L(l,{columns:E,dataSource:B.dataSource,slots:["operation"],rowSelection:!0,totals:B.pagination,onOnSelectedArry:ie,onOnSelectedRowKeys:oe},{bodyCell:w((({column:e,text:t,record:s})=>["operation"===e.dataIndex?v((h(),f("a",{key:0,style:{color:"var(--primary-color)"},onClick:e=>J(!0,s)},[T("编辑")],8,M)),[[Z,"edit"]]):(h(),x(r,{key:1,placement:"topLeft"},j({default:w((()=>[T(" "+z(t),1)])),_:2},[(null==t?void 0:t.length)>15?{name:"title",fn:w((()=>[T(z(t),1)])),key:"0"}:void 0]),1024))])),_:1},8,["dataSource","totals"])])),_:1},8,["spinning"])])),_:1}),y(" 编辑新增弹框 "),L(X,{class:"drawerButton",visible:B.visible,"onUpdate:visible":s[5]||(s[5]=e=>B.visible=e),title:B.visibleTitle,maskClosable:!1},{default:w((()=>[L(Q,{layout:"vertical",name:"base",rules:S,model:B.restList,ref_key:"restFromRef",ref:q},{default:w((()=>[L(p,{label:"作息表名称：",name:"name"},{default:w((()=>[L(c,{maxLength:50,value:B.restList.name,"onUpdate:value":s[1]||(s[1]=e=>B.restList.name=e),placeholder:"请输入作息表名称"},null,8,["value"])])),_:1}),b("div",U,[L(p,{label:"学年：",name:"schoolYearId",style:{width:"250px"}},{default:w((()=>[L(I,{disabled:B.semesterDisabled,value:B.restList.schoolYearId,"onUpdate:value":s[2]||(s[2]=e=>B.restList.schoolYearId=e),placeholder:"请选择",onChange:F},{default:w((()=>[(h(!0),f(_,null,k(B.yearData,(e=>(h(),x(m,{value:e.id,key:e.id},{default:w((()=>[T(z(e.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["disabled","value"])])),_:1}),L(p,{label:"学期：",name:"semesterId",style:{width:"245px","margin-left":"8px"}},{default:w((()=>[L(I,{disabled:B.semesterDisabled,value:B.restList.semesterId,"onUpdate:value":s[3]||(s[3]=e=>B.restList.semesterId=e),placeholder:"请选择"},{default:w((()=>[(h(!0),f(_,null,k(B.semesterData,(e=>(h(),x(m,{value:e.id,key:e.id,title:`${e.name}  ${e.startDate} ~ ${e.endDate}`},{default:w((()=>[T(z(e.name)+"("+z(e.startDate)+" ~ "+z(e.endDate)+")",1)])),_:2},1032,["value","title"])))),128))])),_:1},8,["disabled","value"])])),_:1})]),L(p,{label:"节次：",class:"selectWidth"},{default:w((()=>[b("div",Y,[(h(!0),f(_,null,k(B.timeSlotList,(e=>(h(),f("div",{key:e.key,style:{display:"flex",width:"160px"}},[b("p",H,z(e.title),1),L(I,{value:e.code,"onUpdate:value":t=>e.code=t,ref_for:!0,ref:"select",onChange:t=>(e=>{if(B.restList.sectionList===[]){switch(e.periodType){case 1:B.zzx=se(e);break;case 2:B.sw=se(e);break;case 3:B.xw=se(e);break;case 4:B.ws=se(e);break;case 5:B.wzx=se(e)}B.restList.sectionList=[].concat([],B.zzx,B.sw,B.xw,B.ws,B.wzx)}else switch(e.periodType){case 1:{const t=B.restList.sectionList.filter((e=>1===e.periodType));e.code>t.length?B.zzx=t.concat([],se(e,t.length)):e.code<t.length&&(B.zzx=B.zzx.splice(0,e.code));break}case 2:{const t=B.restList.sectionList.filter((e=>2===e.periodType));e.code>t.length?B.sw=t.concat([],se(e,t.length)):e.code<t.length&&(B.sw=B.sw.splice(0,e.code));break}case 3:{const t=B.restList.sectionList.filter((e=>3===e.periodType));e.code>t.length?B.xw=t.concat([],se(e,t.length)):e.code<t.length&&(B.xw=B.xw.splice(0,e.code));break}case 4:{const t=B.restList.sectionList.filter((e=>4===e.periodType));e.code>t.length?B.ws=t.concat([],se(e,t.length)):e.code<t.length&&(B.ws=B.ws.splice(0,e.code));break}case 5:{const t=B.restList.sectionList.filter((e=>5===e.periodType));e.code>t.length?B.wzx=t.concat([],se(e,t.length)):e.code<t.length&&(B.wzx=B.wzx.splice(0,e.code));break}}B.restList.sectionList=[].concat([],B.zzx,B.sw,B.xw,B.ws,B.wzx),V(B.restList.sectionList),B.restList.selfMorning=B.zzx.length,B.restList.earlyMorning=B.sw.length,B.restList.afternoon=B.xw.length,B.restList.eveningNum=B.ws.length,B.restList.evening=B.wzx.length})(e)},{default:w((()=>[L(m,{value:0},{default:w((()=>[T(" 无 ")])),_:1}),(h(),f(_,null,k(9,(e=>L(m,{key:e,value:e},{default:w((()=>[T(z(e),1)])),_:2},1032,["value"]))),64))])),_:2},1032,["value","onUpdate:value","onChange"])])))),128))])])),_:1}),L(p,{label:"时间："},{default:w((()=>[L(W,{bordered:"","data-source":B.restList.sectionList,pagination:!1,columns:K,size:"small",locale:{emptyText:"fasdfasdf"}},{emptyText:w((()=>[L(D,{image:"image/empty.png","image-style":{width:"100%",height:"150px"}})])),bodyCell:w((({column:t,record:s,index:i})=>["time"===t.dataIndex?(h(),x(A,{key:0,valueFormat:"HH:mm",value:s.time,"onUpdate:value":e=>s.time=e,format:"HH:mm",onChange:t=>((t,s)=>{if(t[0]===t[1]&&(e.warning("开始时间与结束时间不可相等"),B.restList.sectionList[s].time=[]),s>0)try{const i=t[0],a=B.restList.sectionList[s-1].time[1],o=`${(new Date).toLocaleDateString()} ${i}`,n=`${(new Date).toLocaleDateString()} ${a}`;if(new Date(n).getTime()<new Date(o).getTime())return;e.warning("与其他课次时间冲突，请重新输入！"),B.restList.sectionList[s].time=[]}catch(i){e.warning("请按顺序选择时段！"),B.restList.sectionList[s].time=[]}})(t,i)},null,8,["value","onUpdate:value","onChange"])):y("v-if",!0)])),_:1},8,["data-source"])])),_:1}),L(p,{style:{position:"absolute",left:"0",bottom:"-24px",width:"100%",background:"#fff"}},{default:w((()=>[b("div",R,[L(o,{style:{"margin-right":"10px"},onClick:s[4]||(s[4]=e=>B.visible=!1)},{default:w((()=>[T("取消")])),_:1}),L(n,{spinning:B.submitLoading},{default:w((()=>[L(o,{type:"primary",onClick:P},{default:w((()=>[T("确定")])),_:1})])),_:1},8,["spinning"])])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible","title"])])}}},[["__scopeId","data-v-75b3e29c"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/basicManagement/schedule/index.vue"]]);export{q as default};
