import"./vue.a2f518ee.js";import{d as e}from"./dayjs.49e29cb2.js";import{_ as t}from"./index.272083a4.js";import{c as s}from"./chooseSite.149fe6d3.js";import{q as a,s as i,r as o,t as l,u as d,v as r}from"./siteBooking.8c7dbe73.js";import{_ as m,bv as n}from"./index.7061e8ea.js";import{m as p}from"./ant-design-vue.db4d48e3.js";import{r as c,q as u,f as b,b8 as y,o as F,a as f,b as v,c as g,a3 as h,O as T,a9 as k,a7 as j,F as _,a5 as I,a2 as S,b5 as x,b4 as C}from"./@vue.919ff404.js";import{E as Y}from"./@ant-design.2e172c39.js";import"./@babel.6d5f88cb.js";/* empty css                    */import"./secure-ls.8c8acb46.js";import"./vue-router.907b547c.js";import"./nprogress.c2257662.js";import"./axios.7aed06b8.js";import"./qs.e55e9b28.js";import"./side-channel.ea627785.js";import"./get-intrinsic.8c87d952.js";import"./has-symbols.caae0f97.js";import"./has-proto.76cff6c7.js";import"./function-bind.cb3858f2.js";import"./has.c1051c46.js";import"./call-bind.208b5ef0.js";import"./object-inspect.e2cfb4a5.js";import"./vuex.f308ecec.js";import"./vuex-persistedstate.fa252374.js";import"./vue-grid-layout.a3ef67ec.js";import"./resize-observer-polyfill.f664b406.js";import"./vue-types.022beab3.js";import"./@ctrl.c020ccd3.js";import"./dom-align.0991ecc5.js";import"./lodash-es.36dcd19c.js";import"./async-validator.267d9719.js";import"./scroll-into-view-if-needed.61c672a4.js";import"./compute-scroll-into-view.17358474.js";const z=e=>(x("data-v-e9c73b5c"),e=e(),C(),e),N={class:"appoin_type"},O={class:"top"},w=z((()=>v("div",{class:"tips"},[v("img",{src:"/image/tips.png",alt:""}),v("p",null,"审核机制：仅限场地管理员审核")],-1))),D={key:0},M=["onClick"],U=["onClick"],L={class:"input_max"},V={style:{color:"var(--primary-color)"}},q=z((()=>v("div",null,"开放时间 :",-1))),E={class:"zhoumo"},R={class:"left"},B={class:"right"},A={class:"jiari"},H={class:"left"},K={class:"right"},P={class:"footer",style:{"text-align":"center"}};var G=m({__name:"index",setup(m){const x=c(),C=c(),z=u({changeTypeOptions:[],yuTable:[],spinLoad:!1,pagination:{pageNo:1,pageSize:10,total:0},columns:[{title:"预约类型",dataIndex:"name"},{title:"关联场地类型",dataIndex:"siteTypeName"},{title:"操作",dataIndex:"operation"}],formStatus:0,title:"新增",setVisible:!1,obj1:{},obj2:{},obj3:{},setForm:{siteTypeId:[],siteIds:[],time1:[],time2:[],time3:[],type1:!1,type2:!1,type3:!1,gz:!1,gz2:!1,allClose:!1},disableds:!1,disabled2:!1,setRules:{name:[{required:!0,message:"请选择"}],siteTypeId:[{required:!0,message:"请选择"}],siteIds:[{required:!0,message:"请选择"}],userType:[{required:!0,message:"请选择"}]},maxInput:10,inputNumber:0,cid:[],sitess:[],typeOptions:[],siteOptions:[],userOptions:[{label:"学生",value:"0"},{label:"教职工",value:"1"}],chooseSiteVisible:!1,id:""}),G={label:"name",value:"id"},J={label:"label",value:"value"},Q={label:"label",value:"value"},W=t=>t&&t<e().endOf("day").add(-1,"day"),X=e=>{z.id=e.id,r({id:e.id}).then((e=>{const{data:t}=e;z.setForm.name=t.name,z.inputNumber=t.name.length,z.setForm.allClose=t.temporaryClosed,z.setForm.siteTypeId=t.siteTypeId.split(","),z.setForm.userType=t.userType.split(","),z.setForm.siteIds=t.siteList.map((e=>e.id)),z.siteOptions=t.siteList.map((e=>({label:e.siteName,value:e.id}))),z.setForm.allClose?z.disableds=!0:z.disableds=!1,t.configList.forEach((e=>{e.type&&1===e.type?(z.setForm.type1=!0,z.setForm.time1=[e.startTime,e.endTime]):e.type&&2===e.type?(z.setForm.type2=!0,z.setForm.time2=[e.startTime,e.endTime]):e.type&&3===e.type&&(z.setForm.type3=!0,z.setForm.time3=[e.startTime,e.endTime])}))})),z.setVisible=!0},Z=e=>{const{current:t,pageSize:s}=e;z.pagination.pageNo=t,z.pagination.pageSize=s,re()};function $(e,t){switch(z.formStatus=e,e){case 0:z.inputNumber=0,z.setForm.siteIds=[],z.setForm.type1=!1,z.setForm.type2=!1,z.setForm.type3=!1,z.setForm.time1=[],z.setForm.time2=[],z.setForm.time3=[],z.disableds=!1,z.disabled2=!1,z.setVisible=!0;break;case 1:X(t),z.disableds=!1,z.disabled2=!1;break;case 2:X(t),z.disableds=!0,z.disabled2=!0}}const ee=()=>{z.inputNumber=z.setForm.name.length},te=e=>{},se=()=>{delete z.setForm.userType,C.value.resetFields(),z.setVisible=!1},ae=e=>{p.success(e.message),z.setVisible=!1,z.setForm.userType=null,z.setForm.allClose=!1,z.setForm.type1=!1,z.setForm.type2=!1,z.setForm.type3=!1,z.setForm.gz=!1,z.setForm.gz2=!1,z.setForm.time1=null,z.setForm.time2=null,z.setForm.time3=null,C.value.resetFields(),re()},ie=()=>{C.value.validate().then((()=>{const e=z.setForm.type1,t=z.setForm.type2,s=z.setForm.type3;if(e&&0===z.setForm.time1.length||t&&0===z.setForm.time2.length||s&&0===z.setForm.time3.length)return void p.warning("请选择时间");const a={};z.id&&0!==z.formStatus&&(a.id=z.id),a.name=z.setForm.name,a.userType=z.setForm.userType.toLocaleString(),a.siteTypeId=z.setForm.siteTypeId.toLocaleString(),a.temporaryClosed=z.setForm.allClose?1:0,a.siteIds=z.setForm.siteIds,a.configList=(()=>{const e=[],t=[z.setForm.type1,z.setForm.type2,z.setForm.type3],s=[{type:1,startTime:z.setForm.time1[0],endTime:z.setForm.time1[1]},{type:2,startTime:z.setForm.time2[0],endTime:z.setForm.time2[1]},{type:3,startTime:z.setForm.time3[0],endTime:z.setForm.time3[1]}];return t.forEach(((t,a)=>{t&&e.push(s[a])})),e})(),0===z.formStatus?o(a).then((e=>{ae(e)})):l(a).then((e=>{ae(e)}))}))},oe=e=>{z.cid=e,z.sitess=x.value.siteTable.map((t=>{if(e.includes(t.id))return{value:t.id,label:t.siteName}})).filter((e=>void 0!==e))},le=(e,t)=>{z.cid.length?(z.setForm.siteIds=z.cid,z.siteOptions=z.sitess,z.chooseSiteVisible=!1):p.warning("请选择场地")},de=e=>{z.chooseSiteVisible=!1},re=()=>{z.spinLoad=!0,d(z.pagination).then((e=>{const{list:t,total:s,pageNo:a,pageSize:i}=e.data;z.yuTable=t,z.pagination={total:s,pageSize:i,pageNo:a},z.spinLoad=!1})).finally((()=>{z.spinLoad=!1}))};return b((()=>{re(),i().then((e=>{z.typeOptions=e.data}))})),(e,i)=>{const o=y("plus-outlined"),l=y("a-button"),d=y("a-input"),r=y("a-form-item"),m=y("a-select"),c=y("a-select-option"),u=y("a-checkbox"),b=y("a-row"),X=y("a-range-picker"),ae=y("a-radio"),me=y("a-form"),ne=y("a-drawer");return F(),f("div",N,[v("div",O,[g(l,{type:"primary",onClick:i[0]||(i[0]=e=>$(0))},{icon:h((()=>[g(o)])),default:h((()=>[T(" 新增预约类型")])),_:1})]),w,g(t,{columns:z.columns,dataSource:z.yuTable,slots:["operation"],rowSelection:!1,totals:z.pagination,spinLoad:z.spinLoad,onOnSelectedRowKeys:Z},{bodyCell:h((({column:e,record:t})=>["siteTypeName"===e.dataIndex?(F(),f("span",D,k(t.siteTypeName?t.siteTypeName:"_"),1)):j("v-if",!0),"operation"===e.dataIndex?(F(),f(_,{key:1},[v("a",{onClick:e=>$(1,t),style:{color:"var(--primary-color)","margin-right":"10px"}},"编辑",8,M),v("a",{onClick:e=>$(2,t),style:{color:"var(--primary-color)","margin-right":"10px"}},"查看",8,U),g(l,{onClick:e=>(e=>{n("提示","确定要删除该类型吗?",Y).then((t=>{t&&a({id:e.id}).then((e=>{p.success(e.message),re()}))}))})(t),type:"text",disabled:!!t.defaults,style:I([t.defaults?"color:#ccc":"color: var(--error-color)",{"margin-right":"10px"}])},{default:h((()=>[T("删除")])),_:2},1032,["onClick","disabled","style"])],64)):j("v-if",!0)])),_:1},8,["columns","dataSource","totals","spinLoad"]),j(" 侧边新增&编辑预约类型弹框 "),g(ne,{onClose:se,width:500,destroyOnClose:"",title:["新增预约类型","编辑预约类型","查看预约类型"][z.formStatus],placement:e.right,maskClosable:!1,visible:z.setVisible,class:"drawer_button"},{footer:h((()=>[v("div",P,[g(l,{style:{"margin-right":"8px"},onClick:se},{default:h((()=>[T("取消")])),_:1}),g(l,{type:"primary",onClick:ie},{default:h((()=>[T("确定")])),_:1})])])),default:h((()=>[g(me,{ref_key:"setRef",ref:C,layout:"vertical",model:z.setForm,rules:z.setRules},{default:h((()=>[g(r,{label:"预约类型:",name:"name"},{default:h((()=>[g(d,{maxlength:z.maxInput,disabled:z.disabled2,onInput:ee,value:z.setForm.name,"onUpdate:value":i[1]||(i[1]=e=>z.setForm.name=e),valueModifiers:{trim:!0},placeholder:"请输入"},null,8,["maxlength","disabled","value"]),v("div",L,k(z.inputNumber)+"/"+k(z.maxInput),1)])),_:1}),g(r,{label:"关联场地类型:",name:"siteTypeId"},{default:h((()=>[g(m,{disabled:z.disabled2,value:z.setForm.siteTypeId,"onUpdate:value":i[2]||(i[2]=e=>z.setForm.siteTypeId=e),mode:"multiple",placeholder:"请选择","max-tag-count":3,options:z.typeOptions,fieldNames:G},{maxTagPlaceholder:h((e=>[v("span",V,"+ "+k(e.length)+" ...",1)])),_:1},8,["disabled","value","options"])])),_:1}),z.setForm.siteTypeId&&z.setForm.siteTypeId.length>0?(F(),S(r,{key:0,label:"关联具体场地:",name:"siteIds"},{default:h((()=>[g(m,{disabled:z.disabled2,value:z.setForm.siteIds,"onUpdate:value":i[3]||(i[3]=e=>z.setForm.siteIds=e),mode:"tags",placeholder:"请选择(多选)","max-tag-count":3,onClick:i[4]||(i[4]=e=>(8===x.value.columns.length&&x.value.columns.pop(),z.changeTypeOptions=z.typeOptions.filter((e=>z.setForm.siteTypeId.some((t=>e.id===t)))),void(z.chooseSiteVisible=!0))),options:z.siteOptions,fieldNames:J,onDeselect:te,open:!1},null,8,["disabled","value","options"])])),_:1})):j("v-if",!0),g(r,{label:"使用人员类型:",name:"userType"},{default:h((()=>[g(m,{disabled:z.disabled2,placeholder:"请选择",mode:"tags",value:z.setForm.userType,"onUpdate:value":i[5]||(i[5]=e=>z.setForm.userType=e),options:z.userOptions,fieldNames:Q},{default:h((()=>[g(c,{value:0},{default:h((()=>[T("学生")])),_:1}),g(c,{value:1},{default:h((()=>[T("教职工")])),_:1})])),_:1},8,["disabled","value","options"])])),_:1}),q,g(r,null,{default:h((()=>[g(b,{style:{margin:"12px 0"}},{default:h((()=>[g(u,{checked:z.setForm.type1,"onUpdate:checked":i[6]||(i[6]=e=>z.setForm.type1=e),disabled:2===z.formStatus||z.disableds},{default:h((()=>[T("工作日")])),_:1},8,["checked","disabled"])])),_:1}),g(b,null,{default:h((()=>[g(X,{disabled:2===z.formStatus||(!z.setForm.type1||z.disableds),style:{width:"452px"},"disabled-date":W,value:z.setForm.time1,"onUpdate:value":i[7]||(i[7]=e=>z.setForm.time1=e),valueFormat:"YYYY-MM-DD",format:"YYYY-MM-DD"},null,8,["disabled","value"])])),_:1})])),_:1}),g(r,null,{default:h((()=>[v("div",E,[v("div",R,[g(u,{checked:z.setForm.type2,"onUpdate:checked":i[8]||(i[8]=e=>z.setForm.type2=e),disabled:2===z.formStatus||z.disableds},{default:h((()=>[T("周末")])),_:1},8,["checked","disabled"])]),v("div",B,[g(ae,{checked:z.setForm.gz,"onUpdate:checked":i[9]||(i[9]=e=>z.setForm.gz=e),onClick:i[10]||(i[10]=e=>{z.setForm.gz?(z.setForm.gz=!1,z.setForm.time2=[]):(z.setForm.gz=!0,z.setForm.time2=z.setForm.time1)}),disabled:2===z.formStatus||z.disableds},{default:h((()=>[T("时间同工作日")])),_:1},8,["checked","disabled"])])]),g(X,{disabled:2===z.formStatus||(z.disableds||!z.setForm.type2),style:{width:"452px"},"disabled-date":W,value:z.setForm.time2,"onUpdate:value":i[11]||(i[11]=e=>z.setForm.time2=e),valueFormat:"YYYY-MM-DD",format:"YYYY-MM-DD"},null,8,["disabled","value"])])),_:1}),g(r,null,{default:h((()=>[v("div",A,[v("div",H,[g(u,{checked:z.setForm.type3,"onUpdate:checked":i[12]||(i[12]=e=>z.setForm.type3=e),disabled:2===z.formStatus||z.disableds},{default:h((()=>[T("节假日")])),_:1},8,["checked","disabled"])]),v("div",K,[g(ae,{checked:z.setForm.gz2,"onUpdate:checked":i[13]||(i[13]=e=>z.setForm.gz2=e),onClick:i[14]||(i[14]=e=>{z.setForm.gz2?(z.setForm.gz2=!1,z.setForm.time3=[]):(z.setForm.gz2=!0,z.setForm.time3=z.setForm.time1)}),disabled:2===z.formStatus||z.disableds},{default:h((()=>[T("时间同工作日")])),_:1},8,["checked","disabled"])])]),g(X,{disabled:2===z.formStatus||(z.disableds||!z.setForm.type3),style:{width:"452px"},"disabled-date":W,value:z.setForm.time3,"onUpdate:value":i[15]||(i[15]=e=>z.setForm.time3=e),valueFormat:"YYYY-MM-DD",format:"YYYY-MM-DD"},null,8,["disabled","value"])])),_:1}),g(r,null,{default:h((()=>[g(ae,{checked:z.setForm.allClose,"onUpdate:checked":i[16]||(i[16]=e=>z.setForm.allClose=e),disabled:2===z.formStatus||z.disabled2,onClick:i[17]||(i[17]=e=>{z.setForm.allClose?(z.setForm.allClose=!1,z.disableds=!1):(z.setForm.type1=!1,z.setForm.type2=!1,z.setForm.type3=!1,z.setForm.allClose=!0,z.disableds=!0)})},{default:h((()=>[T("临时封控关闭")])),_:1},8,["checked","disabled"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","placement","visible"]),j(" 选择具体场地（场地类型多选）"),g(s,{title:"选择场地",ref_key:"statusRef",ref:x,showStatus:!1,types:z.changeTypeOptions,isVisible:z.chooseSiteVisible,onEmitHandleOk:le,onSelectChangeArr:oe,onEmithandleCancel:de,siteTypeId:z.setForm.siteTypeId},null,8,["types","isVisible","siteTypeId"])])}}},[["__scopeId","data-v-e9c73b5c"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/appModel/siteBooking/appointmentType/index.vue"]]);export{G as default};
