import{_ as e,u as a,s as t,H as i,p as l}from"./index.7061e8ea.js";import"./vue.a2f518ee.js";import{_ as d}from"./ScoringCriteriaAdd.86e4b8fd.js";import{C as r}from"./index.2069fba3.js";import{d as o}from"./dayjs.49e29cb2.js";import{a as n}from"./vue-router.907b547c.js";import{m as s}from"./ant-design-vue.db4d48e3.js";import{q as c,r as u,y as p,w as m,b8 as v,o as f,a as g,b as h,c as y,a3 as b,a2 as I,u as x,a7 as _,O as k,F as S,a8 as U,a9 as w,P as j,b5 as C,b4 as N}from"./@vue.919ff404.js";/* empty css                    */import"./secure-ls.8c8acb46.js";import"./@babel.6d5f88cb.js";import"./nprogress.c2257662.js";import"./axios.7aed06b8.js";import"./qs.e55e9b28.js";import"./side-channel.ea627785.js";import"./get-intrinsic.8c87d952.js";import"./has-symbols.caae0f97.js";import"./has-proto.76cff6c7.js";import"./function-bind.cb3858f2.js";import"./has.c1051c46.js";import"./call-bind.208b5ef0.js";import"./object-inspect.e2cfb4a5.js";import"./@ant-design.2e172c39.js";import"./@ctrl.c020ccd3.js";import"./vuex.f308ecec.js";import"./vuex-persistedstate.fa252374.js";import"./vue-grid-layout.a3ef67ec.js";import"./resize-observer-polyfill.f664b406.js";import"./vue-types.022beab3.js";import"./dom-align.0991ecc5.js";import"./lodash-es.36dcd19c.js";import"./async-validator.267d9719.js";import"./scroll-into-view-if-needed.61c672a4.js";import"./compute-scroll-into-view.17358474.js";import"./cropperjs.fe6d04b8.js";const E=e=>(C("data-v-40a76051"),e=e(),N(),e),L={class:"activitypage"},T={class:"activity"},q=E((()=>h("h3",null,"基本活动信息",-1))),M={key:1},R=["src"],z=E((()=>h("span",null,"活动时间: ",-1))),O=E((()=>h("span",{style:{"font-size":"12px",color:"rgba(0, 0, 0, 0.45)"}},"（注意：新建活动的时间不能与已创建活动的时间发生冲突）",-1))),G=E((()=>h("h3",null,"评分规则",-1))),D=E((()=>h("span",null,"评分细则:",-1))),J={class:"ScoringCriteria_title"},A=E((()=>h("span",null,"一级指标",-1))),Y=E((()=>h("div",{class:"ScoringCriteria_title"},[h("span",null,"二级指标")],-1))),B=E((()=>h("span",null,"-",-1))),H=E((()=>h("div",{class:"ScoringCriteria_title"},[h("span",null,"一级指标")],-1))),P=E((()=>h("div",{class:"ScoringCriteria_title"},[h("span",null,"二级指标")],-1))),V=E((()=>h("h3",null,"评比奖项设置",-1))),$={class:"ScoringCriteria_title"},F=E((()=>h("span",null,"奖章名次",-1))),K={class:"ScoringCriteria_title",style:{height:"100%","align-items":"center"}},Q=["src"],W={class:"ScoringCriteria_title"},X=["src"],Z={style:{"padding-left":"2px",flex:"1","white-space":"nowrap","text-overflow":"ellipsis",overflow:"hidden"}},ee=E((()=>h("div",{class:"ScoringCriteria_title"},[h("span",null,"奖章名次")],-1))),ae=["src"],te={key:0,class:"btns"},ie={class:"fn"};var le=e({__name:"activity",setup(e){let C=c({prizeList:[{ranking:1}],ruleList:[{moralEducationGroup:[]}],type:1});const N=u(null),E=u({}),le=n(),de=p((()=>"edit"==le.query.type)),re=e=>e.isBefore(o(E.value.semesterStartDate))||e.isAfter(o(E.value.semesterEndDate)),oe=()=>{window.history.back()},ne=a(),se=[{lable:"0.5分",value:"0.5"},{lable:"1分",value:"1"},{lable:"2分",value:"2"},{lable:"5分",value:"5"}];m((()=>C.time),(()=>{ve(C.time)}));const ce=u([]),ue=u([]),pe=u([]),me=c({}),ve=e=>{C.startTimeLong=o(e[0]).valueOf(),C.endTimeLong=o(e[1]).valueOf()},fe=p((()=>{const e=[];return ne.state.base.commentJsonKeys.INIT_ROLL_LIST.forEach((a=>"classes"!==a.key&&e.push(a.level))),e})),ge=e=>{s.success(e,2,(()=>{window.history.back()}))},he=()=>(N.value.validate().then((e=>{le.query.id?t.post("/cloud/moralEducationActivity/update",C).then((e=>{ge("编辑成功")})):t.post("/cloud/moralEducationActivity",C).then((e=>{ge("操作成功")}))})).catch((e=>{})),!1),ye=()=>{t.get("/cloud/moralEducationConfig/list").then((e=>{e.data.forEach((e=>{me[e.configItem]=e.configVal})),C.ruleList[0].minScoreUnit=me.minScoreUnit})),t.post("/cloud/moralEducationScoreStandard/page").then((e=>{let a=[];e.data.forEach((e=>{let t=JSON.parse(JSON.stringify(e)),i=a.find((a=>a.firstIndicatorId==e.firstIndicatorId));if(i)t.label=t.secondIndicatorName,i.child.push(t);else{let e=JSON.parse(JSON.stringify(t));e.label=t.secondIndicatorName,t.child=[e],t.label=t.firstIndicatorName,a.push(t)}})),pe.value=a,C.ruleList.forEach((async e=>{Ue(e.firstIndicatorId,e),await t.get(`/cloud/moralEducationGroup/queryGroupByIndicator?indicatorId=${e.firstIndicatorId}`).then((a=>{e.moralEducationGroup=a.data})),we(e)}))}))},be=e=>{1==e?C.ruleList.push({minScoreUnit:me.minScoreUnit}):C.prizeList.push({ranking:C.prizeList.length+1})},Ie=(e,a)=>{1==e?C.ruleList.splice(a,1):(C.prizeList.splice(a,1),C.prizeList.forEach(((e,a)=>{e.ranking=a+1})))},xe=u(!1),_e=e=>{let a=e.map((e=>e.name));C.users=a.join(),N.value.clearValidate(["users"]),C.participateList=e.map((e=>({targetId:e.id,targetName:e.name,targetPid:e.pid})))},ke=e=>{const a=new FormData;a.append("file",e.file),i(a).then((e=>{const{data:a}=e;C.promotionalImage=a[0].url,N.value.clearValidate(["promotionalImage"])}))},Se=()=>{xe.value=!0},Ue=(e,a)=>{const t=pe.value.find((a=>a.firstIndicatorId==e));a.dataSource=t.child},we=e=>{const a=e.dataSource.find((a=>a.secondIndicatorId==e.secondIndicatorId));e.standardName=a.standardName,e.standardId=a.standardId,t.get(`/cloud/moralEducationGroup/queryGroupByIndicator?indicatorId=${a.firstIndicatorId}`).then((a=>{e.moralEducationGroup=a.data}))};return setTimeout((()=>(t.get("/cloud/moralEducationActivity/querySchoolSemesterYear").then((e=>{E.value=e.data})),t.get("/cloud/moralEducationConfig/list").then((e=>{e.data.forEach((e=>{me[e.configItem]=e.configVal})),C.ruleList[0].minScoreUnit=me.minScoreUnit})),t.post("/cloud/moralEducationScoreStandard/page").then((e=>{let a=[];e.data.forEach((e=>{let t=JSON.parse(JSON.stringify(e)),i=a.find((a=>a.firstIndicatorId==e.firstIndicatorId));if(i)t.label=t.secondIndicatorName,i.child.push(t);else{let e=JSON.parse(JSON.stringify(t));e.label=t.secondIndicatorName,t.child=[e],t.label=t.firstIndicatorName,a.push(t)}})),pe.value=a,le.query.id&&t.get(`/cloud/moralEducationActivity/detail?id=${le.query.id}`).then((e=>{Object.assign(C,e.data),C.users=C.participateList.map((e=>e.targetName)).join(),C.checkedList=C.participateList.map((e=>({id:e.targetId,name:e.targetName,pid:e.targetPid}))),C.time=[o(C.startTime),o(C.endTime)],C.ruleList.forEach((async e=>{Ue(e.firstIndicatorId,e),await t.get(`/cloud/moralEducationGroup/queryGroupByIndicator?indicatorId=${e.firstIndicatorId}`).then((a=>{e.moralEducationGroup=a.data}))}))}))})),t.post("/cloud/moralEducationHonorTitle/activityHonorTitleList",{activityid:C.activityid}).then((e=>{ue.value=e.data})),void t.post("/cloud/moralEducationMedal/activityMedalList",{activityid:C.activityid}).then((e=>{ce.value=e.data})))),0),(e,a)=>{const t=v("a-form-item"),i=v("a-input"),n=v("a-textarea"),s=v("plus-square-filled"),c=v("a-button"),u=v("a-range-picker"),p=v("a-radio"),m=v("a-radio-group"),le=v("a-select-option"),ne=v("a-select"),ge=v("a-table-column"),je=v("a-input-number"),Ce=v("a-table"),Ne=v("a-cascader"),Ee=v("a-form"),Le=l;return f(),g("div",L,[h("div",T,[y(Ee,{model:x(C),layout:"vertical",ref_key:"formRef",ref:N},{default:b((()=>[q,y(t,{label:"活动宣传图：",name:"promotionalImage",rules:[{required:de.value,message:"请设置活动宣传图"}]},{default:b((()=>[de.value?(f(),I(r,{key:0,value:x(C).promotionalImage,"onUpdate:value":a[0]||(a[0]=e=>x(C).promotionalImage=e),onChange:ke,isNum:5,title:"点击上传图片"},null,8,["value"])):(f(),g("div",M,[h("img",{src:x(C).promotionalImage,style:{width:"102px",height:"102px"}},null,8,R)]))])),_:1},8,["rules"]),y(t,{label:"活动标题：",name:"title",rules:[{required:de.value,message:"请输入活动标题"}]},{default:b((()=>[y(i,{value:x(C).title,"onUpdate:value":a[1]||(a[1]=e=>x(C).title=e),maxlength:20,disabled:!de.value,showCount:!0,placeholder:"请输入"},null,8,["value","disabled"])])),_:1},8,["rules"]),y(t,{label:"活动介绍：",name:"description",rules:[{required:de.value,message:"请输入活动介绍"}]},{default:b((()=>[y(n,{value:x(C).description,"onUpdate:value":a[2]||(a[2]=e=>x(C).description=e),placeholder:"请输入",maxlength:300,disabled:!de.value,showCount:!0,rows:4},null,8,["value","disabled"])])),_:1},8,["rules"]),y(t,{label:"参与对象：",name:"users",rules:[{required:de.value,message:"请选择"}]},{default:b((()=>[y(i,{class:"item-input",readonly:"",value:x(C).users,"onUpdate:value":a[3]||(a[3]=e=>x(C).users=e),placeholder:"请选择班级",disabled:!de.value},{suffix:b((()=>[de.value?(f(),I(s,{key:0,class:"square-filled",onClick:Se})):_("v-if",!0)])),_:1},8,["value","disabled"])])),_:1},8,["rules"]),y(t,{name:"time",rules:[{required:de.value,message:"请选择活动时间"}]},{label:b((()=>[z,O])),default:b((()=>[y(u,{value:x(C).time,"onUpdate:value":a[5]||(a[5]=e=>x(C).time=e),format:"YYYY-MM-DD","show-time":"",disabled:!de.value,"disabled-date":re,onChange:ve},{renderExtraFooter:b((()=>[_(' <a-button\r\n                                type="text"\r\n                                style="color: rgb(0, 183, 129)"\r\n                                @click="selTime(1)"\r\n                                >本学年</a-button\r\n                            > '),y(c,{type:"text",onClick:a[4]||(a[4]=e=>{return a=2,void(C.time=1==a?[o(E.value.yearStartDate),o(E.value.yearEndDate)]:[o(E.value.semesterStartDate),o(E.value.semesterEndDate)]);var a}),style:{color:"rgb(0, 183, 129)"}},{default:b((()=>[k("本学期")])),_:1})])),_:1},8,["value","disabled"])])),_:1},8,["rules"]),y(t,{label:"评分周期：",name:"cycle",rules:[{required:de.value,message:"请选择评分周期"}]},{default:b((()=>[y(m,{value:x(C).cycle,"onUpdate:value":a[6]||(a[6]=e=>x(C).cycle=e),name:"radioGroup",disabled:!de.value},{default:b((()=>[y(p,{value:1},{default:b((()=>[k("按周循环")])),_:1}),y(p,{value:2},{default:b((()=>[k("按月循环")])),_:1})])),_:1},8,["value","disabled"])])),_:1},8,["rules"]),G,y(t,{rules:[{required:de.value}]},{label:b((()=>[D,de.value?(f(),I(c,{key:0,type:"link",target:"_blank",style:{"font-size":"14px",color:"#00b781"},href:"/#/appModel/moralEducationEvaluation/set"},{default:b((()=>[k("设置")])),_:1})):_("v-if",!0),y(c,{type:"link",style:{"font-size":"14px",color:"#00b781","padding-left":"0"},onClick:ye},{default:b((()=>[k("刷新")])),_:1})])),default:b((()=>[de.value?(f(),I(Ce,{key:0,"data-source":x(C).ruleList,bordered:"",pagination:!1},{emptyText:b((()=>[k("请添加评分细则")])),default:b((()=>[y(ge,{key:"age","data-index":"age",width:"200px"},{title:b((()=>[h("div",J,[A,h("img",{onClick:a[7]||(a[7]=e=>be(1)),src:d,class:"ScoringCriteriaAdd"})])])),default:b((({record:e,index:a})=>[y(ne,{ref:"select",value:e.firstIndicatorId,"onUpdate:value":a=>e.firstIndicatorId=a,placeholder:"请选择",onChange:a=>Ue(a,e)},{default:b((()=>[(f(!0),g(S,null,U(x(pe),(e=>(f(),I(le,{value:e.firstIndicatorId,key:e.firstIndicatorId},{default:b((()=>[k(w(e.firstIndicatorName),1)])),_:2},1032,["value"])))),128))])),_:2},1032,["value","onUpdate:value","onChange"])])),_:1}),y(ge,{key:"age","data-index":"age",width:"200px"},{title:b((()=>[Y])),default:b((({record:e,index:a})=>[y(ne,{ref:"select",value:e.secondIndicatorId,"onUpdate:value":a=>e.secondIndicatorId=a,placeholder:"请选择",onChange:a=>we(e)},{default:b((()=>[(f(!0),g(S,null,U(e.dataSource,(e=>(f(),I(le,{value:e.secondIndicatorId,key:e.secondIndicatorId},{default:b((()=>[k(w(e.secondIndicatorName),1)])),_:2},1032,["value"])))),128))])),_:2},1032,["value","onUpdate:value","onChange"])])),_:1}),y(ge,{key:"address",title:"评分范围","data-index":"address",width:"250px"},{default:b((({record:e})=>[h("div",null,[y(je,{value:e.scoreRangeMin,"onUpdate:value":a=>e.scoreRangeMin=a,min:me.defaultScoreRangeMin,placeholder:">="+me.defaultScoreRangeMin,style:{width:"80px"},max:me.defaultScoreRangeMax},null,8,["value","onUpdate:value","min","placeholder","max"]),B,y(je,{value:e.scoreRangeMax,"onUpdate:value":a=>e.scoreRangeMax=a,min:me.defaultScoreRangeMin,placeholder:"<="+me.defaultScoreRangeMax,style:{width:"80px"},max:me.defaultScoreRangeMax},null,8,["value","onUpdate:value","min","placeholder","max"])])])),_:1}),y(ge,{key:"standardName",title:"评分标准",width:"200px","data-index":"standardName"},{default:b((({record:e})=>[k(w(e.standardName),1)])),_:1}),y(ge,{key:"action",title:"项目初始分值",width:"120px"},{default:b((({record:e})=>[y(je,{value:e.initializeScore,"onUpdate:value":a=>e.initializeScore=a,min:1,max:20},null,8,["value","onUpdate:value"])])),_:1}),y(ge,{key:"action",title:"评分组",width:"200px"},{default:b((({record:e})=>[y(ne,{value:e.groupId,"onUpdate:value":a=>e.groupId=a,placeholder:"请选择",options:e.moralEducationGroup,fieldNames:{label:"name",value:"id"}},null,8,["value","onUpdate:value","options"])])),_:1}),y(ge,{key:"action",title:"评分最小单位",width:"130px"},{default:b((({record:e})=>[y(ne,{value:e.minScoreUnit,"onUpdate:value":a=>e.minScoreUnit=a,placeholder:"请选择",options:se},null,8,["value","onUpdate:value"])])),_:1}),y(ge,{key:"honorTitle",title:"操作",align:"center",width:"60px"},{default:b((({record:e,index:a})=>[y(c,{type:"text",danger:"",onClick:e=>Ie(1,a)},{default:b((()=>[k("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data-source"])):(f(),I(Ce,{key:1,"data-source":x(C).ruleList,bordered:"",pagination:!1},{emptyText:b((()=>[k("暂无数据")])),default:b((()=>[y(ge,{key:"age","data-index":"age",width:"200px"},{title:b((()=>[H])),default:b((({record:e,index:a})=>[k(w(e.firstIndicatorName),1)])),_:1}),y(ge,{key:"age","data-index":"age",width:"200px"},{title:b((()=>[P])),default:b((({record:e,index:a})=>[k(w(e.secondIndicatorName),1)])),_:1}),y(ge,{key:"address",title:"评分范围","data-index":"address",width:"100px"},{default:b((({record:e})=>[h("div",null,w(e.scoreRangeMin)+" - "+w(e.scoreRangeMax),1)])),_:1}),y(ge,{key:"standardName",title:"评分标准",width:"200px","data-index":"standardName"},{default:b((({record:e})=>[k(w(e.standardName),1)])),_:1}),y(ge,{key:"action",title:"项目初始分值",width:"120px"},{default:b((({record:e})=>[k(w(e.initializeScore),1)])),_:1}),y(ge,{key:"action",title:"评分组",width:"200px"},{default:b((({record:e})=>[k(w(e.groupName),1)])),_:1}),y(ge,{key:"action",title:"评分最小单位",width:"130px"},{default:b((({record:e})=>[k(w(e.minScoreUnit),1)])),_:1})])),_:1},8,["data-source"]))])),_:1},8,["rules"]),V,y(t,{label:"奖项设置：",rules:[{required:de.value}]},{default:b((()=>[de.value?(f(),I(Ce,{key:0,"data-source":x(C).prizeList,pagination:!1,bordered:""},{emptyText:b((()=>[k("请添加奖项")])),default:b((()=>[y(ge,{key:"ranking","data-index":"ranking"},{title:b((()=>[h("div",$,[F,h("img",{onClick:a[8]||(a[8]=e=>be(2)),src:d,class:"ScoringCriteriaAdd"})])])),_:1}),y(ge,{key:"action",title:"奖章图标"},{default:b((({record:e,index:a})=>[y(Ne,{value:e.medalId,"onUpdate:value":a=>e.medalId=a,options:[],placeholder:"请选择",style:{width:"200px"}},{displayRender:b((()=>[h("div",K,[h("img",{src:e.medalUrl,width:"20",height:"20"},null,8,Q)])])),_:2},1032,["value","onUpdate:value"]),y(ne,{value:e.medalId,"onUpdate:value":a=>e.medalId=a,style:{width:"200px",position:"absolute",opacity:"0",left:"16px","z-index":"999"},options:x(ce),onChange:a=>((e,a)=>{const t=ce.value.find((a=>a.medalId==e));a.medalUrl=t.medalUrl})(a,e),fieldNames:{label:"medalUrl",value:"medalId"}},{option:b((e=>[h("div",W,[h("img",{src:e.medalUrl,width:"20",height:"20"},null,8,X),h("span",Z,w(e.description),1)])])),displayRender:b((({labels:e,selectedOptions:a})=>[k(" 1212 ")])),_:2},1032,["value","onUpdate:value","options","onChange"])])),_:1}),y(ge,{key:"honorTitle",title:"荣誉称号"},{default:b((({record:e})=>[y(ne,{value:e.honorTitleId,"onUpdate:value":a=>e.honorTitleId=a,style:{width:"200px"},placeholder:"请选择",options:x(ue),fieldNames:{label:"honorTitle",value:"honorTitleId"}},null,8,["value","onUpdate:value","options"])])),_:1}),y(ge,{key:"honorTitle",title:"操作",align:"center"},{default:b((({record:e,index:a})=>[y(c,{type:"text",danger:"",onClick:e=>Ie(2,a)},{default:b((()=>[k("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data-source"])):(f(),I(Ce,{key:1,"data-source":x(C).prizeList,pagination:!1,bordered:""},{emptyText:b((()=>[k("暂无数据")])),default:b((()=>[y(ge,{key:"ranking","data-index":"ranking"},{title:b((()=>[ee])),_:1}),y(ge,{key:"action",title:"奖章图标"},{default:b((({record:e,index:a})=>[h("img",{src:e.medalUrl,style:{width:"20px",height:"20px"}},null,8,ae)])),_:1}),y(ge,{key:"honorTitle","data-index":"honorTitle",title:"荣誉称号"})])),_:1},8,["data-source"]))])),_:1},8,["rules"])])),_:1},8,["model"])]),y(Le,{visible:x(xe),"onUpdate:visible":a[9]||(a[9]=e=>j(xe)?xe.value=e:null),multiple:!0,mode:"depa",checked:x(C).checkedList,"onUpdate:checked":a[10]||(a[10]=e=>x(C).checkedList=e),checkParents:!1,tabs:[{tab:"选择班级",key:2,checked:!0,disabled:fe.value}],onHandleOk:_e},null,8,["visible","checked","tabs"]),de.value?(f(),g("div",te,[h("div",ie,[y(c,{type:"primary",onClick:he},{default:b((()=>[k("发布")])),_:1}),y(c,{style:{"margin-left":"10px"},onClick:oe},{default:b((()=>[k("取消")])),_:1})])])):_("v-if",!0)])}}},[["__scopeId","data-v-40a76051"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/appModel/moralEducationEvaluation/classInfo/activity.vue"]]);export{le as default};
