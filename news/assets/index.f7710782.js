import"./vue.a2f518ee.js";import{u as e}from"./vue-router.907b547c.js";import{a as t,m as s,M as a}from"./ant-design-vue.db4d48e3.js";import{_ as i,u as l,p as o}from"./index.7061e8ea.js";import{d}from"./dayjs.49e29cb2.js";import{q as n,u as c,a as r,g as u,b as p,d as b,p as m,c as h}from"./punchTheClock.f98483ac.js";import{y as k,q as v,r as y,w as f,f as g,b8 as j,o as w,a as S,c as x,a3 as _,O as I,a1 as L,u as C,a7 as T,F as D,a8 as q,a2 as N,a9 as O,b as E,H as U,L as M,e as z,a4 as R,aK as Y,a5 as H,b5 as K,b4 as F}from"./@vue.919ff404.js";import{g as P}from"./FilterDropdown.5a779a00.js";import{E as V}from"./@ant-design.2e172c39.js";import"./@babel.6d5f88cb.js";import"./resize-observer-polyfill.f664b406.js";import"./vue-types.022beab3.js";import"./@ctrl.c020ccd3.js";import"./dom-align.0991ecc5.js";import"./lodash-es.36dcd19c.js";import"./async-validator.267d9719.js";import"./scroll-into-view-if-needed.61c672a4.js";import"./compute-scroll-into-view.17358474.js";/* empty css                    */import"./secure-ls.8c8acb46.js";import"./nprogress.c2257662.js";import"./axios.7aed06b8.js";import"./qs.e55e9b28.js";import"./side-channel.ea627785.js";import"./get-intrinsic.8c87d952.js";import"./has-symbols.caae0f97.js";import"./has-proto.76cff6c7.js";import"./function-bind.cb3858f2.js";import"./has.c1051c46.js";import"./call-bind.208b5ef0.js";import"./object-inspect.e2cfb4a5.js";import"./vuex.f308ecec.js";import"./vuex-persistedstate.fa252374.js";import"./vue-grid-layout.a3ef67ec.js";const A={class:"publish-scope"};var $=i({__name:"addTask",emits:["emitTaskList"],setup(e,{expose:a,emit:i}){const p=l(),b=t.useForm,m=k((()=>p.state.base.commentJsonKeys.INIT_SELECT.map((e=>({tab:e.lable,identity:e.identity,key:"teacher"===e.key?1:2,checked:!0}))))),h=v({loadingTask:!1,title:"新建任务",detailsId:"",visible:!1,kemus:[],students:[],selectVisibles:!1,multipleTrue:!0,selectMode:"depa",selectTabs:m,checkedList:[],publishScopeCheckedLists:[],fieldNames:{label:"name",value:"id"},treeData:[],cycle:[{key:"1",value:"周一"},{key:"2",value:"周二"},{key:"3",value:"周三"},{key:"4",value:"周四"},{key:"5",value:"周五"},{key:"6",value:"周六"},{key:"7",value:"周日"}],subjectIdOption:[],rulesData:["subjectIdList","taskName","taskDescription","publishScopeCheckedLists","publishStartEnd","frequency"]}),z=y([]),R=v({subjectDisabled:!1,id:"",publishScopeCheckedLists:[],subjectIdList:[],taskName:"",taskDescription:"",publishScopeObjList:[],publishStartEnd:[],publishStart:[],publishEnd:[],frequency:"single",customerOption:[],requirementList:[]}),Y=e=>{},H=e=>{R.publishStart=[],R.publishEnd=[],e&&e.length&&(R.publishStart=e[0],R.publishEnd=e[1])},K=v({subjectIdList:[{required:!0,message:"请选择选择科目!"}],taskName:[{required:!0,message:"请输入打卡任务!"}],taskDescription:[{required:!0,message:"请输入任务描述!"}],publishScopeCheckedLists:[{required:!0,message:"请选择发布范围!"}],publishStartEnd:[{required:!0,message:"请选择发布时间范围!"}],frequency:[{required:!0,message:"请选择打卡频次!"}],customerOption:[{required:!0,message:"请选择自定义周期!"}]}),{validateInfos:F,resetFields:P,validate:V}=b(R,K),$=e=>{let t="",s="";R.publishScopeCheckedLists=[],R.publishScopeObjList=e.map((e=>(e.ancestors||0===e.ancestors||"dept"===e.objType?(s=e.hasOwnProperty("ancestors")?"0"===e.ancestors?"parent":"children":e.objLevel,t="dept"):(t="class",s=e.rollValue||e.objLevel),R.publishScopeCheckedLists.push(e.id),{objType:t,objLevel:s,id:e.id,name:e.showName||e.name}))),h.checkedList=R.publishScopeObjList},J=()=>{h.visible=!1,P()},B=(e,t)=>{R.publishScopeObjList=t},G=()=>{const e=R.id?c:r;V(h.rulesData).then((()=>{h.loadingTask=!0,e(R).then((e=>{s.success(e.message),i("emitTaskList"),J()})).finally((()=>h.loadingTask=!1))}))},Q=()=>{u(h.detailsId).then((e=>{const{data:t}=e;for(const s in R)R[s]="publishScopeCheckedLists"===s?t.publishScopeObjList.map((e=>e.id)):"publishStartEnd"===s?[t.publishStart,t.publishEnd]:t[s];h.checkedList=t.publishScopeObjList}))},W=e=>e&&e<d().subtract(1,"day");return f((()=>R.frequency),(e=>{h.rulesData=[];for(const t in K)"custom"!==e&&"customerOption"===t||h.rulesData.push(t)})),f((()=>h.visible),(e=>{if(e&&h.detailsId)return h.title="编辑任务",void Q();h.title="新建任务",h.detailsId=""})),a({teachClasses:z,initState:h,taskState:R,getPunchTheClockDetailsInfo:Q}),g((()=>{n().then((e=>{const{data:t}=e;h.subjectIdOption=t}))})),(e,t)=>{const s=j("close-outlined"),a=j("a-select-option"),i=j("a-select"),l=j("a-form-item"),d=j("a-input"),n=j("a-textarea"),c=j("a-range-picker"),r=j("a-radio"),u=j("a-radio-group"),p=j("a-checkbox"),b=j("a-col"),m=j("a-row"),k=j("a-checkbox-group"),v=j("a-form"),y=j("a-button"),f=j("a-drawer"),g=o;return w(),S(D,null,[x(f,{visible:h.visible,"onUpdate:visible":t[8]||(t[8]=e=>h.visible=e),title:h.title,width:"520",zIndex:"1031",keyboard:!1,closable:!1,maskClosable:!1,"footer-style":{textAlign:"center"},onClose:J},{extra:_((()=>[x(s,{onClick:J})])),footer:_((()=>[x(y,{style:{"margin-right":"8px"},onClick:J},{default:_((()=>[I("取消")])),_:1}),x(y,{type:"primary",loading:h.loadingTask,onClick:G},{default:_((()=>[I("发布")])),_:1},8,["loading"])])),default:_((()=>[x(v,{name:"create-work-form",layout:"vertical"},{default:_((()=>[x(l,L({label:"选择科目："},C(F).subjectIdList),{default:_((()=>[x(i,{value:R.subjectIdList,"onUpdate:value":t[0]||(t[0]=e=>R.subjectIdList=e),mode:"multiple",disabled:R.subjectDisabled,maxTagTextLength:3,placeholder:"请选择",onChange:Y},{default:_((()=>[T(' <a-select-option value="-1">不限</a-select-option> '),(w(!0),S(D,null,q(h.subjectIdOption,(e=>(w(),N(a,{key:e.id,value:e.id},{default:_((()=>[I(O(e.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value","disabled"])])),_:1},16),x(l,L({label:"打卡任务："},C(F).taskName),{default:_((()=>[x(d,{value:R.taskName,"onUpdate:value":t[1]||(t[1]=e=>R.taskName=e),"show-count":"",maxlength:20,placeholder:"请输入"},null,8,["value"])])),_:1},16),x(l,L({label:"任务描述："},C(F).taskDescription),{default:_((()=>[x(n,{showCount:"",maxlength:200,value:R.taskDescription,"onUpdate:value":t[2]||(t[2]=e=>R.taskDescription=e),"auto-size":{minRows:3,maxRows:5},placeholder:"请输入"},null,8,["value"])])),_:1},16),x(l,L({label:"发布范围："},C(F).publishScopeCheckedLists,{class:"is-confirmation-item"}),{default:_((()=>[E("div",A,[x(i,{value:R.publishScopeCheckedLists,"onUpdate:value":t[3]||(t[3]=e=>R.publishScopeCheckedLists=e),mode:"multiple",style:{width:"100%"},placeholder:"请选择",fieldNames:h.fieldNames,options:z.value,onChange:B},null,8,["value","fieldNames","options"]),T(' <plus-square-filled\r\n                        class="publish-scope-icon"\r\n                        @click="handerSelect"\r\n                    /> ')])])),_:1},16),x(l,L({class:"form-item-inline",label:"发布时间范围："},C(F).publishStartEnd),{default:_((()=>[h.visible?(w(),N(c,{key:0,style:{width:"100%"},value:R.publishStartEnd,"onUpdate:value":t[4]||(t[4]=e=>R.publishStartEnd=e),"disabled-date":W,separator:"至","value-format":"YYYY-MM-DD",format:"YYYY-MM-DD",onChange:H},null,8,["value"])):T("v-if",!0)])),_:1},16),x(l,L({label:"打卡频次：",class:"work-logo work-logo-cycle cycle-radio"},C(F).frequency),{default:_((()=>[x(u,{value:R.frequency,"onUpdate:value":t[5]||(t[5]=e=>R.frequency=e)},{default:_((()=>[x(r,{value:"single"},{default:_((()=>[I("单次")])),_:1}),x(r,{value:"custom"},{default:_((()=>[I("自定义")])),_:1})])),_:1},8,["value"])])),_:1},16),U(x(l,L({label:"自定义：",class:"work-logo work-logo-cycle cycle-checkbox"},C(F).customerOption),{default:_((()=>[x(k,{class:"checkbox-group-cycle",value:R.customerOption,"onUpdate:value":t[6]||(t[6]=e=>R.customerOption=e),style:{width:"100%"}},{default:_((()=>[x(m,null,{default:_((()=>[(w(!0),S(D,null,q(h.cycle,(e=>(w(),N(b,{span:6,key:e.key},{default:_((()=>[x(p,{value:e.key},{default:_((()=>[I(O(e.value),1)])),_:2},1032,["value"])])),_:2},1024)))),128))])),_:1})])),_:1},8,["value"])])),_:1},16),[[M,"custom"===R.frequency]]),x(l,{label:"打卡要求：",class:"work-logo"},{default:_((()=>[x(k,{value:R.requirementList,"onUpdate:value":t[7]||(t[7]=e=>R.requirementList=e)},{default:_((()=>[x(p,{value:"upload_picture"},{default:_((()=>[I("提交时必须包含图片")])),_:1})])),_:1},8,["value"])])),_:1})])),_:1})])),_:1},8,["visible","title"]),x(g,{visible:h.selectVisibles,"onUpdate:visible":t[9]||(t[9]=e=>h.selectVisibles=e),treeData:h.treeData,multiple:h.multipleTrue,tabs:h.selectTabs,mode:h.selectMode,checked:h.checkedList,"onUpdate:checked":t[10]||(t[10]=e=>h.checkedList=e),onHandleOk:$},null,8,["visible","treeData","multiple","tabs","mode","checked"])],64)}}},[["__scopeId","data-v-1b623781"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/teachManager/page/tePunch/addTask.vue"]]);var J={detailList:[{label:"总人数",value:"peopleCount"},{label:"周期",value:"cycleTotalDay"},{label:"发布时间",value:"publishStart"},{label:"截止时间",value:"publishEnd"},{label:"打卡频次",value:"customerOption"},{label:"发布范围",value:"publishScopeObjList"},{label:"打卡要求",value:"requirementList"}],detailColumnsClass:[{title:"姓名",dataIndex:"name",key:"id",width:80,ellipsis:!0,showSorterTooltip:!0},{title:"打卡日期",dataIndex:"signDate",key:"id",width:100},{title:"打卡时间",dataIndex:"signTime",key:"id",width:80},{title:"班级",dataIndex:"className",key:"className",width:100,ellipsis:!0,showSorterTooltip:!0},{title:"图片",dataIndex:"pictureList",key:"id",width:80}],detailColumnsDept:[{title:"姓名",dataIndex:"name",key:"id",width:80,ellipsis:!0,showSorterTooltip:!0},{title:"打卡日期",dataIndex:"signDate",key:"id",width:100},{title:"打卡时间",dataIndex:"signTime",key:"id",width:80},{title:"部门",dataIndex:"deptName",key:"deptName",width:80,ellipsis:!0,showSorterTooltip:!0},{title:"图片",dataIndex:"pictureList",key:"id",width:80}],detailColor:function(){let e="#";for(let t=0;t<6;t++)e+=(16*Math.random()|0).toString(16);return e},details:[{title:"序号",dataIndex:"seq",key:"seq",width:100},{title:"创建时间",dataIndex:"createTime",key:"createTime",width:180},{title:"打卡任务",dataIndex:"taskName",key:"id",width:180,beyondHiding:!1,ellipsis:!0,showSorterTooltip:!0},{title:"任务描述",dataIndex:"taskDescription",key:"id",width:160,ellipsis:!0,showSorterTooltip:!0},{title:"周期",dataIndex:"cycle",key:"id",width:100,ellipsis:!0,showSorterTooltip:!0},{title:"频次",dataIndex:"frequency",key:"id",width:100,ellipsis:!0,showSorterTooltip:!0},{title:"布置对象",dataIndex:"publishScope",key:"id",width:140,ellipsis:!0,showSorterTooltip:!0},{title:"发布范围",dataIndex:"publishScopeObj",key:"id",width:170,ellipsis:!0,showSorterTooltip:!0},{title:"发布时间",dataIndex:"publishStart",key:"id",width:120,ellipsis:!0,showSorterTooltip:!0},{title:"截止时间",dataIndex:"publishEnd",key:"id",width:120,ellipsis:!0,showSorterTooltip:!0},{title:"今日打卡数（人）",dataIndex:"todaySignCount",key:"id",width:160,ellipsis:!0,showSorterTooltip:!0},{title:"状态",dataIndex:"status",key:"status",width:90,ellipsis:!0,showSorterTooltip:!0,customFilterIcon:"caret-right-outlined",filters:[{text:"全部",value:""},{text:"进行中",value:"in_progress"},{text:"未开始",value:"not_start"},{text:"已结束",value:"end"}],filterDropdown:e=>(e.selectedKeys.length?e.selectedKeys=e.selectedKeys[0]:e.selectedKeys="",P(e))},{title:"操作",dataIndex:"operation",key:"id",fixed:"right",align:"left",width:130}]};const B={class:"clockIntask"},G=(e=>(K("data-v-f3bf8566"),e=e(),F(),e))((()=>E("div",{class:"clockIntask_head"},"打卡任务",-1))),Q={class:"add-task"},W={class:"template_class"},X={class:"template_list"},Z=["onClick"],ee={class:"table_student"},te={key:0,class:"table-create-time"},se={class:"create-time-icon"},ae={key:0},ie={key:1,class:"editable-row-operations"},le={key:0},oe={key:0},de={key:1},ne=z({name:"clockIntask"});var ce=i(Object.assign(ne,{setup(t){const i=e(),l=y(),o=v({selectedRows:[],templateList:[],disableds:!0,spinLoad:!1,clockStatus:{in_progress:"进行中",not_start:"未开始",end:"已结束",color_in_progress:"success",color_not_start:"warning",color_end:"default"},pagination:{pageNo:1,pageSize:10,total:0},status:"",columns:J.details,direction:"desc",dataSource:[]}),d={fixed:!0,onChange:e=>{o.selectedRows=e},getCheckboxProps:e=>({disabled:"in_progress"===e.status||"end"===e.status})},n=()=>{const{status:e,direction:t}=o,s={...o.pagination,status:e,direction:t};p(s).then((e=>{const{list:t,pageNo:s,pageSize:a,total:i}=e.data;o.dataSource=t,o.pagination={pageNo:s,pageSize:a,total:i}}))};function c(){h().then((e=>{l.value.teachClasses=null==e?void 0:e.data.map((e=>({id:e.classesId,name:e.classesName,objType:"class",objLevel:"classes"})))}))}const r=(e,t)=>{c(),e&&(l.value.initState.detailsId=t.id),l.value.initState.visible=!0},u=()=>{a.confirm({title:"删除提示",icon:x(V),content:"你确定要删除选择的任务吗？",okText:"确认",cancelText:"取消",onOk(){b(o.selectedRows).then((()=>{s.success("删除成功！"),n()}))}})},f=(e,t,s,a)=>{var i;const{pageSize:l,current:d}=e;o.pagination.pageNo=d,o.pagination.pageSize=l,(null==(i=t.status)?void 0:i.length)&&(o.status=t.status[0]),n()},L=e=>{o.direction=e,n()},U=k((()=>e=>e.subject.length>3?(e.beyondHiding=!0,`(${e.subject.substring(0,2)}...)`):(e.beyondHiding=!1,`(${e.subject})`)));return g((()=>{m().then((e=>{o.templateList=(null==e?void 0:e.data)||[]})),n()})),(e,t)=>{const s=j("a-divider"),a=j("plus-outlined"),p=j("a-button"),b=j("a-popover"),m=j("caret-up-outlined"),h=j("caret-down-outlined"),k=j("a-badge"),v=j("a-tooltip"),y=j("a-table"),g=j("a-spin");return w(),S("div",B,[G,E("div",Q,[x(b,{placement:"bottom",overlayClassName:"yide_popover"},{content:_((()=>[E("div",W,[E("div",X,[(w(!0),S(D,null,q(o.templateList,((e,t)=>(w(),S("div",{onClick:t=>function(e){c();const{initState:t,taskState:s}=l.value;s.subjectDisabled=!0,s.taskDescription=e.taskDescription,s.taskName=e.taskName,s.subjectIdList=[e.subjectId],t.visible=!0}(e),class:"template_item",key:t},O(e.taskName),9,Z)))),128))]),x(s,{style:{margin:"0px"}}),E("div",{class:"add_new",onClick:t[0]||(t[0]=e=>r(!1))}," 创建新的打卡 ")])])),default:_((()=>[x(p,{type:"primary"},{icon:_((()=>[x(a)])),default:_((()=>[I(" 新增任务 ")])),_:1})])),_:1}),x(p,{style:{"margin-left":"12px"},type:"primary",danger:"",disabled:o.selectedRows&&o.selectedRows<=0,ghost:"",onClick:u},{default:_((()=>[I("删除")])),_:1},8,["disabled"])]),x(g,{spinning:o.spinLoad},{default:_((()=>[E("div",ee,[x(y,{scroll:{x:1200},"row-key":e=>e.id,columns:o.columns,"data-source":o.dataSource,rowSelection:d,onChange:f,pagination:o.pagination},{headerCell:_((({column:e})=>["createTime"===e.key?(w(),S("span",te,[I(O(e.title)+" ",1),E("span",se,[x(m,{class:R({outlinedActive:"asc"===o.direction}),onClick:t[1]||(t[1]=e=>L("asc"))},null,8,["class"]),x(h,{class:R({outlinedActive:"desc"===o.direction}),onClick:t[2]||(t[2]=e=>L("desc"))},null,8,["class"])])])):T("v-if",!0)])),bodyCell:_((({column:e,text:t,index:s,record:a})=>["seq"===e.dataIndex?(w(),S("div",ae,O(s+1),1)):T("v-if",!0),"operation"===e.dataIndex?(w(),S("div",ie,[x(p,{class:"look",type:"link",onClick:e=>{return t=a.id,void i.push({name:"details",query:{signTaskId:t}});var t}},{default:_((()=>[I("查看")])),_:2},1032,["onClick"]),x(p,{class:R(""+("in_progress"===a.status||"end"===a.status?"":"look")),disabled:"in_progress"===a.status||"end"===a.status,type:"link",onClick:e=>r(!0,a)},{default:_((()=>[I("编辑")])),_:2},1032,["class","disabled","onClick"]),T(' <a-button\r\n                                type="link"\r\n                                :disabled="record.status === \'end\'"\r\n                                danger\r\n                                @click="handleClockDelete(record.id)"\r\n                                >删除</a-button\r\n                            > ')])):T("v-if",!0),"status"===e.dataIndex?(w(),N(k,{key:2,status:o.clockStatus["color_"+a.status],text:o.clockStatus[a.status]},null,8,["status","text"])):"createTime"===e.dataIndex?(w(),S(D,{key:3},[],64)):(w(),N(v,{key:4,placement:"topLeft"},Y({default:_((()=>["taskName"===e.dataIndex?(w(),S("span",oe,[I(O(t)+" ",1),a.subject?(w(),S("span",{key:0,class:"beyond-hiding",style:H({position:a.beyondHiding?"absolute":"initial"})},O(U.value(a)),5)):T("v-if",!0)])):(w(),S("span",de,O(t),1))])),_:2},[(null==t?void 0:t.length)>10?{name:"title",fn:_((()=>[I(O(t)+" ",1),"taskName"===e.dataIndex&&a.subject?(w(),S("span",le,"（"+O(a.subject)+"）",1)):T("v-if",!0)])),key:"0"}:void 0]),1024))])),_:1},8,["row-key","columns","data-source","pagination"])])])),_:1},8,["spinning"]),x(C($),{ref_key:"taskRef",ref:l,onEmitTaskList:n},null,512)])}}}),[["__scopeId","data-v-f3bf8566"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/teachManager/page/tePunch/index.vue"]]);export{ce as default};
