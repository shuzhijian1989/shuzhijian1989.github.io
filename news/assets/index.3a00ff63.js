import{u as e,_ as i,aQ as a,H as t,aR as l,aS as s,p as n,aT as d,aU as o,aV as r,aW as m,aX as u,aY as c,aZ as p,a_ as b,a$ as g,ac as f,b0 as h,n as v,b1 as y,b2 as _,X as k,b3 as F}from"./index.7061e8ea.js";import"./vue.a2f518ee.js";import{_ as L}from"./siteImg.e530de90.js";import{u as I,a as x}from"./vue-router.907b547c.js";import{m as N,M as w}from"./ant-design-vue.db4d48e3.js";import"./qrcode.f5521435.js";/* empty css                                                          */import{b as C}from"./trafficRules.626c1e24.js";import{y as M,Q as S,q as T,w as j,b8 as V,o as P,a2 as E,a3 as U,c as D,b as O,O as A,a9 as q,a7 as B,a as z,F as K,a8 as R,f as $,b5 as H,b4 as Q,r as J,I as X,u as W,H as Y,M as Z,n as G}from"./@vue.919ff404.js";import{_ as ee}from"./index.272083a4.js";import{D as ie}from"./index.1cbb3529.js";import{I as ae}from"./index.5bf217c5.js";import{E as te}from"./@ant-design.2e172c39.js";/* empty css                    */import"./secure-ls.8c8acb46.js";import"./@babel.6d5f88cb.js";import"./nprogress.c2257662.js";import"./axios.7aed06b8.js";import"./dayjs.49e29cb2.js";import"./qs.e55e9b28.js";import"./side-channel.ea627785.js";import"./get-intrinsic.8c87d952.js";import"./has-symbols.caae0f97.js";import"./has-proto.76cff6c7.js";import"./function-bind.cb3858f2.js";import"./has.c1051c46.js";import"./call-bind.208b5ef0.js";import"./object-inspect.e2cfb4a5.js";import"./vuex.f308ecec.js";import"./vuex-persistedstate.fa252374.js";import"./vue-grid-layout.a3ef67ec.js";import"./resize-observer-polyfill.f664b406.js";import"./vue-types.022beab3.js";import"./@ctrl.c020ccd3.js";import"./dom-align.0991ecc5.js";import"./lodash-es.36dcd19c.js";import"./async-validator.267d9719.js";import"./scroll-into-view-if-needed.61c672a4.js";import"./compute-scroll-into-view.17358474.js";import"./encode-utf8.c8acd0c0.js";import"./dijkstrajs.9287da7c.js";const le=e(),se=M((()=>{const e=[];return le.state.base.commentJsonKeys.INIT_ROLL_LIST.forEach((i=>"classes"!==i.key&&e.push(i.level))),e})),ne=S(),de=S(),oe=S(),re=S(),me={buildingId:[{required:!0,message:"请先选择建筑"}]},ue={name:[{required:!0,message:"请先输入建筑名称"}],campus:[{required:!0,message:"请先选择校区"}]},ce={key:"id",title:"name",children:"children"},pe=[{title:"楼层",dataIndex:"floorNum",width:160},{title:"每层房间数",dataIndex:"roomNum"}],be=[{title:"楼层",dataIndex:"floor",width:"50px",ellipsis:!0},{title:"房间号",dataIndex:"roomNum",width:"50px",ellipsis:!0},{title:"场地名称",dataIndex:"name",width:100,ellipsis:!0},{title:"容纳人数",dataIndex:"peppleNum",width:"80px",ellipsis:!0},{title:"面积(㎡)",dataIndex:"space",width:"80px",ellipsis:!0},{title:"场地类型",dataIndex:"siteTypeName",width:"80px",ellipsis:!0},{title:"管理员",dataIndex:"listName",width:100,ellipsis:!0},{title:"绑定班级",dataIndex:"classesName",width:100,ellipsis:!0},{title:"操作",dataIndex:"operation",width:120,align:"center"}],ge=T({qrcodeTitle:"",qrcodeUrl:"",modalVisible:!1,visibleProps:!1,sitePlainOptions:["Apple","Pear","Orange"],transitionList:[],rollId:null,disabled:!1,campusList:[],classesNameVisible:!1,managerVisible:!1,classVisible:!1,batchEditDisabled:!0,accept:".doc,.docx,.xlsx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document",selectedKeys:[],removeDisabled:!0,transitionDisabled:!0,leftTableLoging:!1,siteTableLoging:!1,transitionFormLoading:!1,buildFormLoading:!1,siteFormLoading:!1,isSelectSource:1,searchName:"",buildVisible:!1,isAddEdit:!1,isAreaEdit:!1,areaEditId:"",isType:!0,buildTitle:"添加建筑",buildData:[],scenarioTypeData:[],buildForm:{name:"",buildNum:"",campus:"",scenarioType:""},layoutList:[],siteList:[],siteVisible:!1,siteTitle:"添加场地",siteForm:{deviceIds:[],name:"",classesId:"",listName:"",list:[],siteTypeId:null,floor:"",roomNum:"",peppleNum:"",space:"",classesName:""},typeList:[],transitionVisible:!1,transitionTitle:"转场",transitionForm:{buildingId:null,siteIds:[]},arrSite:[],selectSourceParams:{modalVisible:!0,selectSourceObj:{singleChoice:!0,checkPeople:!1,defaultExpand:[],selectedPoolSelectedSet:[],optionalClass:{key:"type",value:se},tabsTexts:[{tab:"绑定班级",key:"student"}],treeData_student:[],treeData_teacher:[]}},managerName:"",addbuildId:"",buildId:"",editSiteList:[],classesArr:[],managerList:[],classesNameList:[],isBuildManage:!1,buildManagerList:[],buildManageVisible:!1,buildManageFormLoading:!1,buildManageForm:{buildManageName:"",buildManageList:[]},pagination:{pageNo:1,pageSize:10,total:0},selectTabs:[{tab:"班级",key:2,checked:!0,disabled:se}]});const fe={class:"upload_wap"},he={class:"upload"},ve={class:"upload_format__hint upload_hint__rule"},ye={class:"upload_item__warp"},_e={class:"upload_item_image__warp"};var ke=i({__name:"introduce",props:{visibleProps:{type:Boolean,default:!0},detailId:{type:String,default:""}},emits:["update:visibleProps","introduceForm"],setup(e,{emit:i}){const l=e,s=T({image1M:!1,imgNumber:6,visible:!0,siteTitle:"场地简介和图片",multiple:!1,progress:0,spinning:!1,siteFormLoading:!1,fileList:[],imgPathsList:[],introduceForm:{imgPaths:"",describe:null}}),n=()=>{i("update:visibleProps",!1)},d=()=>{n(),s.introduceForm.imgPaths="",s.imgPathsList.length&&(s.introduceForm.imgPaths=s.imgPathsList.toString()),i("introduceForm",s.introduceForm)},o=(e,i)=>{if(s.imgPathsList.length+i.length>s.imgNumber)return s.image1M||N.warning(`当前限制选择 ${s.imgNumber} 个文件，本次选择了 ${s.imgPathsList.length} 个文件，共选择了 ${s.imgPathsList.length+i.length} 个文件`),s.image1M=!0,!0;return e.size/1024/1024<10?s.image1M=!1:(s.image1M=!0,N.warning("上传图像须小于1MB！")),!1},r=async e=>{if(s.image1M)return;const i=new FormData;i.append("file",e.file),await t(i).then((e=>{const{data:i}=e,{url:a}=i[0];s.imgPathsList.push(a)})),s.fileList=e.fileList};return j((()=>l.visibleProps),(e=>{e&&(s.introduceForm={imgPaths:"",describe:null},s.imgPathsList=[],s.fileList=[],a({id:l.detailId}).then((({data:e})=>{e.imgPaths&&(s.imgPathsList=e.imgPaths.split(",")),s.introduceForm=e})))})),(e,i)=>{const a=V("plus-outlined"),t=V("a-button"),m=V("a-upload"),u=V("a-image"),c=V("close-circle-filled"),p=V("a-col"),b=V("a-row"),g=V("a-spin"),f=V("a-form-item"),h=V("a-textarea"),v=V("a-form"),y=V("a-modal");return P(),E(y,{maskClosable:!1,destroyOnClose:!0,visible:l.visibleProps,"onUpdate:visible":i[2]||(i[2]=e=>l.visibleProps=e),confirmLoading:s.siteFormLoading,title:s.siteTitle,width:"784px",onOk:d,onCancel:n},{default:U((()=>[D(v,{layout:"vertical",name:"base",ref:"transitionFromRef",model:s.introduceForm},{default:U((()=>[D(f,{label:"场地图片",name:"buildingId"},{default:U((()=>[O("div",fe,[D(g,{tip:`${s.progress}%`,indicator:e.indicator,spinning:s.spinning},{default:U((()=>[O("div",he,[D(m,{multiple:!0,showUploadList:!1,"file-list":s.fileList,name:"file",action:"/","before-upload":o,onChange:r,class:"upload_comp",accept:"image/png,image/jpg,image/jpeg"},{default:U((()=>[D(t,{type:"primary",ghost:"",style:{"margin-top":"75px"},disabled:s.imgPathsList.length>s.imgNumber-1,onClick:i[0]||(i[0]=e=>s.image1M=!1)},{icon:U((()=>[D(a)])),default:U((()=>[A(" 上传图片 ")])),_:1},8,["disabled"])])),_:1},8,["file-list"]),O("p",ve," 最多只能上传"+q(s.imgNumber)+"张图片，大小不超过10M ",1)]),B(" 已上传图片 "),D(b,{gutter:[24,24],class:"upload_list"},{default:U((()=>[(P(!0),z(K,null,R(s.imgPathsList,((e,i)=>(P(),E(p,{span:4,key:i},{default:U((()=>[O("div",ye,[O("div",_e,[D(u,{class:"upload_item_image",preview:!1,width:"86px",height:"86px",src:e},null,8,["src"]),B(" remove "),D(c,{class:"upload_item__remove",title:"删除",onClick:e=>(e=>{s.imgPathsList.splice(e,1),s.fileList.splice(e,1)})(i)},null,8,["onClick"])])])])),_:2},1024)))),128))])),_:1})])),_:1},8,["tip","indicator","spinning"])])])),_:1}),D(f,{label:"场地介绍",name:"buildingId"},{default:U((()=>[D(h,{value:s.introduceForm.describe,"onUpdate:value":i[1]||(i[1]=e=>s.introduceForm.describe=e),placeholder:"请输入",maxlength:300,showCount:"","auto-size":{minRows:2,maxRows:10}},null,8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible","confirmLoading","title"])}}},[["__scopeId","data-v-4807ba4c"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/basicManagement/site/field/introduce.vue"]]);const Fe=e=>(H("data-v-184a3a1d"),e=e(),Q(),e),Le={style:{display:"flex",width:"100%"}},Ie={style:{display:"flex",width:"100%"}},xe={style:{width:"360px"}},Ne=Fe((()=>O("div",{style:{height:"30px"}},"管理员：",-1))),we=Fe((()=>O("div",{style:{"font-size":"14px","font-family":"PingFangSC-Medium, PingFang SC","font-weight":"600",color:"rgba(0, 0, 0, 0.85)","margin-bottom":"16px"}},null,-1))),Ce={style:{display:"flex",width:"100%"}},Me={style:{display:"flex",width:"100%"}},Se=Fe((()=>O("div",{style:{"font-size":"14px","font-family":"PingFangSC-Medium, PingFang SC","font-weight":"600",color:"rgba(0, 0, 0, 0.85)","margin-bottom":"16px"}}," 添加设备 ",-1))),Te={style:{display:"flex",width:"100%"}},je={class:"check-box-group"},Ve={class:"ellipsis"};var Pe=i({__name:"addEidtArea",props:{buildId:{type:String,default:""},siteVisible:{type:Boolean,default:!1},isAreaEdit:{type:Boolean,default:!1},areaEditId:{type:String,default:""}},emits:["update:siteVisible","emitSite"],setup(i,{emit:t}){const r=i,m=e(),u=M((()=>{const e=[];return m.state.base.commentJsonKeys.INIT_ROLL_LIST.forEach((i=>"classes"!==i.key&&e.push(i.level))),e})),c=S(),p=T({sitePlainOptions:[],managerVisible:!1,siteVisible:!1,loading:!1,classesArr:[],managerList:[],managerName:[],typeList:[],siteForm:{deviceIds:[],name:"",listName:"",list:[],siteTypeId:null,floor:"",roomNum:"",peppleNum:"",space:"",classesId:"",classesName:""},selectTabs:[{tab:"班级",key:2,checked:!0,disabled:u}]}),b={name:[{required:!0,message:"请先输入场地名称"}],siteTypeId:[{required:!0,message:"请先输入场地类型"}]},g=async()=>{p.managerVisible=!0,p.isBuildManage=!1},f=e=>{let i="",a="";if(e.length){const{id:t,showName:l}=e[0];i=t,a=l}p.siteForm.classesId=i,p.siteForm.classesName=a},h=e=>{if(!0===p.isBuildManage){const i=e.map((e=>e.id));p.buildManageForm.buildManageList=i;const a=e.map((e=>e.name));p.buildManageForm.buildManageName=a.toString()}else{const i=e.map(((i,a)=>{const t=[];return t.push(Object.assign({},{peopleId:e[a].peopleId?e[a].peopleId:e[a].id,name:e[a].name})),t}));p.siteForm.list=[...new Set([].concat(...i.map((e=>e))))],p.managerName=p.siteForm.list.map((e=>e.name)).toString()}},v=()=>{p.siteForm.deviceIds=[],p.siteForm.classesId="",p.siteForm.classesName="",c.value.resetFields(),t("update:siteVisible",!1)},y=()=>{c.value.validate().then((()=>{let e=d;r.areaEditId&&(e=o),p.loading=!0;const i={...p.siteForm};i.buildingId||(i.buildingId=r.buildId),p.managerName||(i.list=[]),i.classesName||(i.classesId=""),e(i).then((e=>{N.success(e.message),t("emitSite"),v()})).finally((()=>{p.loading=!1}))}))};j((()=>r.siteVisible),(e=>{p.siteVisible=e,p.classesArr=[],p.managerName="",p.managerList=[],p.siteForm.imgPaths="",r.areaEditId&&e&&_()}));const _=()=>{a({id:r.areaEditId}).then((({data:e})=>{const{list:i,classesId:a,classesName:t}=e;if(p.siteForm=e,i.length){const e=[];i.forEach((i=>{e.push(i.name)})),p.managerName=e.toString(),p.managerList=i}a&&(p.classesArr=[{id:a,name:t}],p.siteForm.classesName=t)}))};return $((()=>{l().then((e=>{p.typeList=e.data})).finally((()=>{p.deleteLoging=!1})),s().then((e=>{p.sitePlainOptions=e.data}))})),(e,a)=>{const t=V("a-input"),l=V("a-form-item"),s=V("a-form-item-rest"),d=V("a-select-option"),o=V("a-select"),r=V("a-input-number"),m=V("a-checkbox"),u=V("a-checkbox-group"),_=V("a-form"),k=V("a-modal"),F=n;return P(),z(K,null,[D(k,{maskClosable:!1,destroyOnClose:!0,confirmLoading:p.loading,visible:p.siteVisible,"onUpdate:visible":a[10]||(a[10]=e=>p.siteVisible=e),title:(i.areaEditId?"编辑":"添加")+"场地",width:"784px",onOk:y,onCancel:v},{default:U((()=>[D(_,{layout:"vertical",name:"base",autocomplete:"off",ref_key:"siteFormRefs",ref:c,rules:b,model:p.siteForm},{default:U((()=>[O("div",Le,[D(l,{name:"name",label:"场地名称：",style:{width:"360px"}},{default:U((()=>[D(t,{maxlength:20,style:{width:"100%"},value:p.siteForm.name,"onUpdate:value":a[0]||(a[0]=e=>p.siteForm.name=e),valueModifiers:{trim:!0},placeholder:"请输入"},null,8,["value"])])),_:1}),D(l,{style:{width:"360px","margin-left":"16px"},label:"绑定班级：",name:"classesName"},{default:U((()=>[B(" 选择班级 "),D(t,{value:p.siteForm.classesName,"onUpdate:value":a[1]||(a[1]=e=>p.siteForm.classesName=e),placeholder:"请选择",onClick:a[2]||(a[2]=e=>p.classVisible=!0),onChange:e.deleteClass,"allow-clear":""},null,8,["value","onChange"])])),_:1})]),O("div",Ie,[D(s,null,{default:U((()=>[O("div",xe,[Ne,B(" 管理员选人 "),D(t,{value:p.managerName,"onUpdate:value":a[3]||(a[3]=e=>p.managerName=e),placeholder:"请选择",onClick:g,onChange:e.handerManager,"allow-clear":""},null,8,["value","onChange"])])])),_:1}),D(l,{name:"siteTypeId",style:{width:"360px","margin-left":"16px"},label:"场地类型："},{default:U((()=>[D(o,{value:p.siteForm.siteTypeId,"onUpdate:value":a[4]||(a[4]=e=>p.siteForm.siteTypeId=e),ref:"select",placeholder:"请选择"},{default:U((()=>[(P(!0),z(K,null,R(p.typeList,(e=>(P(),E(d,{key:e.id,value:e.id},{default:U((()=>[A(q(e.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1})]),we,O("div",Ce,[D(l,{label:"楼层：",name:"floor",style:{width:"360px"}},{default:U((()=>[D(r,{max:27,min:-3,id:"inputNumber",style:{width:"100%"},value:p.siteForm.floor,"onUpdate:value":a[5]||(a[5]=e=>p.siteForm.floor=e),placeholder:"请输入"},null,8,["value"])])),_:1}),D(l,{label:"房间号：",name:"roomNum",style:{width:"360px","margin-left":"16px"}},{default:U((()=>[D(t,{maxlength:10,style:{width:"100%"},value:p.siteForm.roomNum,"onUpdate:value":a[6]||(a[6]=e=>p.siteForm.roomNum=e),valueModifiers:{trim:!0},placeholder:"请输入"},null,8,["value"])])),_:1})]),O("div",Me,[D(l,{label:"容纳人数：",name:"peppleNum",style:{width:"360px"}},{default:U((()=>[D(r,{max:999999999,id:"inputNumber",style:{width:"100%"},value:p.siteForm.peppleNum,"onUpdate:value":a[7]||(a[7]=e=>p.siteForm.peppleNum=e),placeholder:"请输入"},null,8,["value"])])),_:1}),D(l,{label:"面积(㎡)：",name:"space",style:{width:"360px","margin-left":"16px"}},{default:U((()=>[D(r,{id:"inputNumber",style:{width:"100%"},value:p.siteForm.space,"onUpdate:value":a[8]||(a[8]=e=>p.siteForm.space=e),placeholder:"请输入",step:1,min:0,max:99999999.99,precision:2},null,8,["value"])])),_:1})]),Se,O("div",Te,[D(u,{value:p.siteForm.deviceIds,"onUpdate:value":a[9]||(a[9]=e=>p.siteForm.deviceIds=e),name:"checkboxgroup"},{default:U((()=>[O("ul",je,[(P(!0),z(K,null,R(p.sitePlainOptions,(e=>(P(),z("li",{key:e.id},[D(m,{value:e.id},{default:U((()=>[O("span",Ve,q(e.name),1)])),_:2},1032,["value"])])))),128))])])),_:1},8,["value"])])])),_:1},8,["model"])])),_:1},8,["confirmLoading","visible","title"]),B(" 选择管理员 "),D(F,{tabs:[{tab:"管理员",key:1,checked:!0}],mode:"personnel",visible:p.managerVisible,"onUpdate:visible":a[11]||(a[11]=e=>p.managerVisible=e),selectedKeys:[],checked:p.managerList,"onUpdate:checked":a[12]||(a[12]=e=>p.managerList=e),checkedKey:"id",onHandleOk:h},null,8,["visible","checked"]),B(" 选择班级 "),D(F,{multiple:!1,mode:"depa",checkedKey:"id",tabs:p.selectTabs,visible:p.classVisible,"onUpdate:visible":a[13]||(a[13]=e=>p.classVisible=e),checked:p.classesArr,"onUpdate:checked":a[14]||(a[14]=e=>p.classesArr=e),onHandleOk:f},null,8,["tabs","visible","checked"])],64)}}},[["__scopeId","data-v-184a3a1d"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/basicManagement/site/field/addEidtArea.vue"]]);const Ee=e=>(H("data-v-16ef7a8d"),e=e(),Q(),e),Ue={class:"site"},De={key:0,class:"left"},Oe=Ee((()=>O("i",{class:"iconfont icon-xingzhuangjiehe12",style:{"margin-right":"5px"}},null,-1))),Ae={key:1,style:{display:"flex","justify-content":"center","align-items":"center","min-height":"800px",width:"276px","border-right":"1px solid #ccc"}},qe=Ee((()=>O("i",{class:"iconfont icon-xingzhuangjiehe12",style:{"margin-right":"5px"}},null,-1))),Be={key:0,class:"right"},ze=Ee((()=>O("div",{class:"siteTitleClass"},"场地列表",-1))),Ke={class:"operationButton"},Re=Ee((()=>O("div",null,null,-1))),$e={class:"buttonBox"},He={key:0},Qe=["onClick"],Je=["onClick"],Xe=["onClick"],We={key:1,class:"right"},Ye=Ee((()=>O("img",{src:L,alt:""},null,-1))),Ze=Ee((()=>O("p",null,"尚未添加任何建筑信息",-1))),Ge={key:1},ei=Ee((()=>O("div",{class:"add_build_class"},null,-1))),ii=Ee((()=>O("div",{class:"add_build_tip_class"}," 可选择填写下方信息快速创建整栋楼的教室布局 ",-1))),ai={style:{width:"360px"}},ti=Ee((()=>O("div",{style:{height:"30px"}},"楼栋管理员：",-1))),li=["src"];var si=i({__name:"index",setup(i){const{setItem:t}=r(),d=I(),L=x(),T=e(),j=M((()=>T.state.user.currentSchool.isShowCampus)),H=S();function Q(e){}function le(e){let i=[];e.forEach((e=>{ge.buildId===e.id&&(i=e.managerList)})),ge.buildManagerList=i}const se=(e,i)=>{const{type:a,children:t,pid:l}=i;ge.pagination.pageNo=1,ge.pagination.pageSize=10,ge.searchName="",ge.buildId=e,ge.rollId=a?2==a?l:e:t[0].id,ge.isType=2!==a,Se(),le([i]),ge.selectedKeys=[e]},fe=e=>{e.forEach((e=>{e.id===ge.buildId&&(e.disabled=!0),e.children&&e.children.length>0&&(e.disabled=!0,fe(e.children))}))},he=async()=>{ge.leftTableLoging=!0,await m().then((e=>{const{data:i}=e;if(ge.buildData=i,!ge.buildId&&!ge.selectedKeys.length&&i.length){const{id:e,children:a}=i[0];ge.buildId=e,ge.selectedKeys=[e],ge.rollId=a[0].id}le(i),Se()})).finally((()=>{ge.leftTableLoging=!1}))};function ve(){ge.buildManageFormLoading=!0;const e={buildingId:ge.buildId,peopleIds:ge.buildManageForm.buildManageList};u(e).then((e=>{N.success(e.message),ge.managerList=[],ge.buildManageVisible=!1,he()})).finally((()=>{ge.buildManageFormLoading=!1}))}const ye=()=>{if(ge.buildForm.buildNum>0){const e=[];for(let i=0;i<ge.buildForm.buildNum;i++)e.push(Object.assign({},{floorNum:i+1}));ge.layoutList=e}else if(ge.buildForm.buildNum<0&&ge.buildForm.buildNum>=-3){const e=Math.abs(ge.buildForm.buildNum),i=[];for(let a=0;a<e;a++)i.push(Object.assign({},{floorNum:"-"+(a+1)}));ge.layoutList=i}else 0!==ge.buildForm.buildNum&&""!==ge.buildForm.buildNum&&null!==ge.buildForm.buildNum||(ge.layoutList=[])};const _e=(e,i)=>{ge.isAddEdit=e,e?(ge.buildVisible=!0,ge.buildTitle="编辑建筑",ge.buildForm=i,ge.buildForm.buildNum="",ge.layoutList=[]):(ge.buildVisible=!0,ge.buildTitle="添加建筑",ge.buildForm={},ge.layoutList=[],void 0!==ne.value&&ne.value.resetFields(),F().then((e=>{ge.campusList=null==e?void 0:e.data,ge.campusList.length&&(ge.buildForm.campus=null==e?void 0:e.data[0].id)})))},Fe=()=>{ne.value.validate().then((()=>{if(ge.isAddEdit)Ie();else{ge.layoutList.filter((e=>!e.roomNum)).length?N.error("请输入每层房间数"):xe()}})).catch((e=>{}))},Le=()=>{ge.buildVisible=!1,he()},Ie=()=>{ge.buildFormLoading=!0,c(ge.buildForm).then((e=>{N.success(e.message),ge.buildVisible=!1,he()})).finally((()=>{ge.buildFormLoading=!1}))},xe=()=>{ge.buildFormLoading=!0;const e={...ge.buildForm,rollId:ge.buildForm.campus};p(e).then((e=>{if(N.success(e.message),ge.buildVisible=!1,ge.layoutList.length>0){const i=ge.layoutList.map(((i,a)=>{const t=[];for(let l=0;l<1*ge.layoutList[a].roomNum;l++)t.push(Object.assign({},{floor:ge.layoutList[a].floorNum,roomNum:l<9?`${ge.layoutList[a].floorNum}0${l+1}`:`${ge.layoutList[a].floorNum}${l+1}`,name:"",peppleNum:"",space:"",list:[],classesName:"",buildingId:e.data}));return t}));ge.arrSite=i,t("batchData",{name:ge.buildForm.name,buildNum:ge.buildForm.buildNum,layoutList:ge.arrSite,typeList:ge.typeList,isEdit:!1}),d.push({name:"siteCreate"})}he()})).finally((()=>{ge.buildFormLoading=!1}))},Ne=e=>{var i,a;ge.siteForm.classesId=null==(i=e[0])?void 0:i.id,ge.siteForm.classesName=null==(a=e[0])?void 0:a.showName},we=e=>{if(!0===ge.isBuildManage){const i=e.map((e=>e.id));ge.buildManageForm.buildManageList=i;const a=e.map((e=>e.name));ge.buildManageForm.buildManageName=a.toString()}else{const i=e.map(((i,a)=>{const t=[];return t.push(Object.assign({},{peopleId:e[a].peopleId?e[a].peopleId:e[a].id,name:e[a].name})),t}));ge.siteForm.list=[...new Set([].concat(...i.map((e=>e))))],ge.managerName=ge.siteForm.list.map((e=>e.name)).toString()}},Ce=()=>{ge.siteForm.list=[],ge.managerName="",ge.buildManageForm.buildManageName="",ge.buildManageForm.buildManageList=[]},Me=e=>{ge.isSearchName=!0,ge.buildId="",ge.searchName=e,ge.pagination.pageNo=1,ge.pagination.pageSize=10,Se()},Se=()=>{ge.siteTableLoging=!0;const e={...ge.pagination,buildingId:ge.buildId,name:ge.searchName};g(e).then((e=>{e.data.list.length>0?ge.batchEditDisabled=!1:ge.batchEditDisabled=!0,ge.siteList=e.data.list,ge.pagination.total=e.data.total,ge.siteList.length&&ge.siteList.forEach((e=>{var i;if(void 0!==e.list){const a=null==(i=e.list)?void 0:i.map((e=>e.name?e.name:[]));e.listName=a.join("、")}}))})).finally((()=>{ge.siteTableLoging=!1}))},Te=()=>{si(),ni(),ge.siteVisible=!0,ge.managerList=[],ge.managerName=[],ge.siteTitle="添加场地",ge.areaEditId="",ge.siteForm.classesName="",ge.siteForm.deviceIds=[],ge.siteForm.list=[],G((()=>{var e;null==(e=de.value)||e.resetFields()}))},je=()=>{f(H.value.qrcodeRef,"场地二维码.png")},Ve=e=>{ge.siteForm={...ge.siteForm,...e},Ee()},Ee=()=>{ge.siteFormLoading=!0;const e={...ge.siteForm};e.buildingId||(e.buildingId=ge.buildId),o(e).then((e=>{N.success(e.message),ge.siteVisible=!1,Se()})).finally((()=>{ge.siteFormLoading=!1}))},si=()=>{l().then((e=>{ge.typeList=e.data})).finally((()=>{ge.deleteLoging=!1}))},ni=()=>{s().then((e=>{ge.sitePlainOptions=e.data})).finally((()=>{ge.leftTableLoging=!1}))},di=()=>{w.confirm({title:"删除提示",icon:D(te),content:"删除后不可恢复，如需继续删除，请点击确定",okType:"danger",okText:"确定",cancelText:"取消",onOk(){const e={ids:ge.transitionForm.siteIds};h(e).then((e=>{N.success(e.message),ge.pagination.pageNo=1,Se()}))}})},oi=()=>{d.push({path:"/basicManagement/site/siteType"})},ri=()=>{d.push({path:"/basicManagement/site/siteEquipment"})},mi=J({errorName:"场地",upload:"",download:"",continueImport:"",importType:0,params:{}}),ui=async()=>{const e="http://192.168.3.158:9528";re.value.modalVisible=!0,mi.value.download=`${e}${v.generalExportUrl}`,mi.value.importType=1,mi.value.params={code:"siteColumn"},mi.value.continueImport=v.importSite,mi.value.upload=`${e}${v.uploadSite}`},ci=()=>{he()},pi=(e,i)=>{ge.editSiteList=i,e.length>0?(ge.removeDisabled=!1,ge.transitionDisabled=!1,ge.transitionForm.siteIds=e):(ge.removeDisabled=!0,ge.transitionDisabled=!0)},bi=()=>{void 0===ge.editSiteList?(t("batchData",{eidtSiteId:ge.buildId,isEdit:!0,islist:!1,typeList:ge.typeList}),d.push({name:"siteCreate"})):(t("batchData",{editSiteList:ge.editSiteList,eidtSiteId:ge.buildId,isEdit:!0,islist:!0,typeList:ge.typeList}),d.push({name:"siteCreate"}))},gi=()=>{ge.transitionForm.buildingId=null,y().then((e=>{ge.transitionVisible=!0,ge.transitionList=e.data,fe(ge.transitionList)}))},fi=()=>{ge.transitionVisible=!1,he()},hi=()=>{ge.transitionFormLoading=!0,oe.value.validate().then((()=>{_(ge.transitionForm).then((e=>{ge.transitionVisible=!1,N.success(e.message),he()})).finally((()=>{ge.transitionFormLoading=!1}))})).catch((e=>{}))};function vi(){ge.buildManageVisible=!0;const e=ge.buildManagerList.map((e=>e.name));ge.buildManageForm.buildManageList=ge.buildManagerList.map((e=>e.peopleId)),ge.managerList=ge.buildManagerList.map((e=>({id:e.peopleId,name:e.name}))),ge.buildManageForm.buildManageName=e.toString()}function yi(){ge.managerVisible=!0,ge.isBuildManage=!0}const _i=e=>{ge.pagination.pageNo=e.current,ge.pagination.pageSize=e.pageSize,Se()};return $((async()=>{const{buildingId:e}=L.query;ge.isType=!0,ge.buildId=e||"",ge.selectedKeys=e?[e]:[],await he(),await si(),C().then((({data:e})=>{ge.scenarioTypeData=e})),T.dispatch("selectSource/setOrganizationTree").then((e=>{ge.selectSourceParams.treeData_teacher=e})),T.dispatch("selectSource/setStudentStatusTree").then((e=>{ge.selectSourceParams.treeData_student=e}))})),(e,i)=>{const t=V("a-input-search"),l=V("more-outlined"),s=V("a-button"),d=V("a-menu-item"),o=V("Authorized"),r=V("a-menu"),m=V("a-dropdown"),u=V("a-spin"),c=V("a-divider"),p=V("plus-outlined"),g=k,f=V("a-select-option"),h=V("a-select"),v=V("a-form-item"),y=V("a-input"),_=V("a-input-number"),F=V("a-table"),L=V("a-form-item-rest"),I=V("a-form"),x=V("a-modal"),C=V("a-tree-select"),M=V("router-view"),S=X("auth");return P(),z("div",Ue,[B(" 侧边 "),D(u,{spinning:W(ge).leftTableLoging},{default:U((()=>[0!==W(ge).buildData.length?(P(),z("div",De,[D(t,{allowClear:"",value:W(ge).searchName,"onUpdate:value":i[0]||(i[0]=e=>W(ge).searchName=e),valueModifiers:{trim:!0},placeholder:"请输入关键字搜索",style:{width:"100%","padding-bottom":"16px"},onSearch:Me},null,8,["value"]),D(ie,{class:"demp-tree",ref:"dempTree",treeData:W(ge).buildData,fieldNames:W(ce),onEmitSelect:se,selectedKeys:W(ge).selectedKeys,treeIcon:"icon-xingzhuangjiehe112"},{handleItem:U((({handleItem:e})=>[D(m,{trigger:["click"]},{overlay:U((()=>[D(r,null,{default:U((()=>[D(o,{auth:"editBuilding"},{default:U((()=>[D(d,{onClick:i=>_e(!0,e)},{default:U((()=>[D(s,{type:"text"},{default:U((()=>[A("编辑")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024),D(o,{auth:"removeBuilding"},{default:U((()=>[D(d,{onClick:i=>{return a=e,void w.confirm({title:"删除建筑",icon:D(te),content:"删除建筑将会删除该建筑中的所有场地信息，确定要删除当前建筑吗？",okType:"danger",okText:"确定",cancelText:"取消",onOk(){const e={ids:[a.id]};b(e).then((e=>{N.success(e.message)})).finally((()=>{he()}))},onCancel(){he()}});var a}},{default:U((()=>[D(s,{type:"link",danger:""},{default:U((()=>[A("删除")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),default:U((()=>[2==e.type?Y((P(),z("a",{key:0,style:{"margin-right":"5px",position:"absolute",right:"0",top:"5px",color:"#3a3a3a",display:"block"},onClick:i[1]||(i[1]=Z((()=>{}),["prevent","stop"]))},[D(l)])),[[S,["editBuilding","removeBuilding"]]]):B("v-if",!0)])),_:2},1024)])),_:1},8,["treeData","fieldNames","selectedKeys"]),Y((P(),E(s,{type:"primary",style:{margin:"16px"},onClick:i[2]||(i[2]=e=>_e(!1,{}))},{icon:U((()=>[Oe])),default:U((()=>[A(" 添加建筑 ")])),_:1})),[[S,"addBuilding"]])])):B("v-if",!0),0==W(ge).buildData.length?(P(),z("div",Ae,[D(s,{type:"primary",style:{"margin-top":"16px"},onClick:i[3]||(i[3]=e=>_e(!1,{}))},{icon:U((()=>[qe])),default:U((()=>[A(" 添加建筑 ")])),_:1})])):B("v-if",!0)])),_:1},8,["spinning"]),B(" 表格 "),0!==W(ge).buildData.length?(P(),z("div",Be,[ze,D(c,{style:{"margin-left":"-16px",width:"103%",height:"2px"}}),O("div",Ke,[Re,O("div",$e,[Y((P(),E(s,{disabled:W(ge).isType,type:"primary",onClick:Te},{icon:U((()=>[D(p)])),default:U((()=>[A(" 添加场地 ")])),_:1},8,["disabled"])),[[S,"addOrigin"]]),Y((P(),E(s,{onClick:ri},{default:U((()=>[A(" 场地设备 ")])),_:1})),[[S,"originType"]]),Y((P(),E(s,{onClick:oi},{default:U((()=>[A(" 场地类型 ")])),_:1})),[[S,"originType"]]),Y((P(),E(s,{onClick:gi,disabled:W(ge).transitionDisabled},{default:U((()=>[A("转 场 ")])),_:1},8,["disabled"])),[[S,"transition"]]),Y((P(),E(s,{onClick:ui},{default:U((()=>[A(" 批量导入 ")])),_:1})),[[S,"batchImport"]]),Y((P(),E(s,{onClick:bi,disabled:W(ge).batchEditDisabled},{default:U((()=>[A("批量修改 ")])),_:1},8,["disabled"])),[[S,"batchEdit"]]),D(s,{onClick:vi},{default:U((()=>[A("批量设置管理员 ")])),_:1}),Y((P(),E(s,{danger:"",class:"rightButton",onClick:di,disabled:W(ge).removeDisabled},{default:U((()=>[A("删除 ")])),_:1},8,["disabled"])),[[S,"removeOrigin"]])])]),D(u,{spinning:W(ge).siteTableLoging},{default:U((()=>[D(ee,{style:{width:"100%"},columns:W(be),dataSource:W(ge).siteList,slots:["operation"],rowSelection:!0,totals:W(ge).pagination,onOnSelectedArry:pi,onOnSelectedRowKeys:_i},{bodyCell:U((({column:e,text:i,record:t})=>["qrCode"===e.dataIndex?(P(),z("span",He,q(t.qrCode||"-"),1)):"operation"===e.dataIndex?(P(),z(K,{key:1},[Y((P(),z("a",{style:{color:"var(--primary-color)"},onClick:e=>(e=>{ge.areaEditId=e.id,ge.siteVisible=!0})(t)},[A(" 编辑 ")],8,Qe)),[[S,"editOrigin"]]),Y((P(),z("a",{style:{color:"var(--primary-color)"},onClick:e=>{return i=t,ge.visibleProps=!0,void(ge.detailId=i.id);var i}},[A(" 场地介绍 ")],8,Je)),[[S,"editOrigin"]]),B(' v-auth="`QRCode`" '),O("a",{style:{color:"var(--primary-color)"},onClick:e=>{return i=t.id,void a({id:i}).then((({data:e})=>{ge.modalVisible=!0;const{qrCode:i,classesName:a,name:t}=e;ge.qrcodeTitle=`${a}   ${t}`,G((()=>{ge.qrcodeUrl=i}))}));var i}}," 查看二维码 ",8,Xe)],64)):(P(),E(g,{key:2,title:i||"-"},null,8,["title"]))])),_:1},8,["columns","dataSource","totals"])])),_:1},8,["spinning"])])):B("v-if",!0),B(" 无数据 "),0==W(ge).buildData.length?(P(),z("div",We,[O("div",{class:"rightNoData"},[Ye,Ze,O("div",{class:"batchImport",onClick:ui},"批量导入")])])):B("v-if",!0),B(" 添加编辑建筑 "),D(x,{maskClosable:!1,destroyOnClose:!0,visible:W(ge).buildVisible,"onUpdate:visible":i[7]||(i[7]=e=>W(ge).buildVisible=e),title:W(ge).buildTitle,onOk:Fe,width:"408px",onCancel:Le,style:{"max-height":"660px"}},{footer:U((()=>[D(s,{key:"back",onClick:Le},{default:U((()=>[A("取消")])),_:1}),D(s,{key:"submit",type:"primary",loading:W(ge).buildFormLoading,onClick:Fe},{default:U((()=>[A("确定")])),_:1},8,["loading"])])),default:U((()=>[D(I,{autocomplete:"off",layout:"vertical",name:"base",ref_key:"buildFormRef",ref:ne,rules:W(ue),model:W(ge).buildForm},{default:U((()=>[!W(ge).isAddEdit&&j.value?(P(),E(v,{key:0,name:"campus",label:"校区："},{default:U((()=>[D(h,{value:W(ge).buildForm.campus,"onUpdate:value":i[4]||(i[4]=e=>W(ge).buildForm.campus=e),ref:"select",placeholder:"请选择校区"},{default:U((()=>[(P(!0),z(K,null,R(W(ge).campusList,(e=>(P(),E(f,{key:e.id,value:e.id},{default:U((()=>[A(q(e.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1})):B("v-if",!0),D(v,{label:"建筑名称：",name:"name"},{default:U((()=>[D(y,{maxlength:20,value:W(ge).buildForm.name,"onUpdate:value":i[5]||(i[5]=e=>W(ge).buildForm.name=e),valueModifiers:{trim:!0},placeholder:"请输入"},null,8,["value"])])),_:1}),W(ge).isAddEdit?B("v-if",!0):(P(),z("div",Ge,[ei,ii,D(v,{label:"楼层数：",name:"buildNum"},{default:U((()=>[D(_,{max:27,min:-3,id:"inputNumber",style:{width:"100%"},value:W(ge).buildForm.buildNum,"onUpdate:value":i[6]||(i[6]=e=>W(ge).buildForm.buildNum=e),placeholder:"请输入",onPressEnter:ye,onChange:ye,precision:0},null,8,["value"])])),_:1}),W(ge).layoutList.length>0?(P(),E(L,{key:0},{default:U((()=>[D(F,{sticky:"","data-source":W(ge).layoutList,pagination:!1,columns:W(pe),scroll:{y:150},size:"small"},{bodyCell:U((({column:e,record:i})=>["roomNum"===e.dataIndex?(P(),E(_,{key:0,max:30,min:1,id:"inputNumber",style:{width:"170px"},value:i.roomNum,"onUpdate:value":e=>i.roomNum=e,placeholder:"请输入"},null,8,["value","onUpdate:value"])):B("v-if",!0)])),_:1},8,["data-source","columns"])])),_:1})):B("v-if",!0),B(' <a-form-item name="scenarioType" label="场景类型：">\r\n                        <a-select\r\n                            v-model:value="state.buildForm.scenarioType"\r\n                            ref="select"\r\n                            placeholder="请选择校区"\r\n                        >\r\n                            <a-select-option\r\n                                v-for="item in state.scenarioTypeData"\r\n                                :key="item.id"\r\n                                :value="item.id"\r\n                                >{{ item.name }}</a-select-option\r\n                            >\r\n                        </a-select>\r\n                        <div class="create_scenario">\r\n                            没有您想要的场景类型，试试\r\n                            <a-button class="button-link" type="link" >\r\n                                新建场景类型\r\n                            </a-button>\r\n                            呢\r\n                        </div>\r\n                    </a-form-item> ')]))])),_:1},8,["rules","model"])])),_:1},8,["visible","title"]),B(" 添加编辑场地 "),D(Pe,{siteVisible:W(ge).siteVisible,"onUpdate:siteVisible":i[8]||(i[8]=e=>W(ge).siteVisible=e),buildId:W(ge).buildId,areaEditId:W(ge).areaEditId,onEmitSite:i[9]||(i[9]=e=>Se())},null,8,["siteVisible","buildId","areaEditId"]),B(" 场地转场 "),D(x,{maskClosable:!1,visible:W(ge).transitionVisible,"onUpdate:visible":i[11]||(i[11]=e=>W(ge).transitionVisible=e),title:W(ge).transitionTitle,onOk:hi,onCancel:fi,width:"408px"},{footer:U((()=>[D(s,{key:"back",onClick:fi},{default:U((()=>[A("取消")])),_:1}),D(s,{key:"submit",type:"primary",loading:W(ge).transitionFormLoading,onClick:hi},{default:U((()=>[A("确定 ")])),_:1},8,["loading"])])),default:U((()=>[D(I,{layout:"vertical",name:"base",ref_key:"transitionFromRef",ref:oe,rules:W(me),model:W(ge).transitionForm},{default:U((()=>[D(v,{label:"转场至：",name:"buildingId"},{default:U((()=>[D(C,{value:W(ge).transitionForm.buildingId,"onUpdate:value":i[10]||(i[10]=e=>W(ge).transitionForm.buildingId=e),"show-search":"",placeholder:"请选择","allow-clear":"","tree-default-expand-all":"","tree-data":W(ge).transitionList,"field-names":{children:"children",label:"name",key:"id",value:"id"},disabled:W(ge).disabled,onSelect:Q,showSearch:!1},null,8,["value","tree-data","disabled"])])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["visible","title"]),B(" 楼栋设置管理员 "),D(x,{maskClosable:!1,visible:W(ge).buildManageVisible,"onUpdate:visible":i[14]||(i[14]=e=>W(ge).buildManageVisible=e),title:"楼栋管理员",onOk:ve,width:"408px"},{footer:U((()=>[D(s,{key:"back",onClick:i[12]||(i[12]=e=>W(ge).buildManageVisible=!1)},{default:U((()=>[A("取消")])),_:1}),D(s,{key:"submit",type:"primary",loading:W(ge).buildManageFormLoading,onClick:ve},{default:U((()=>[A("确定 ")])),_:1},8,["loading"])])),default:U((()=>[D(I,{layout:"vertical",name:"base",ref_key:"transitionFromRef",ref:oe,model:W(ge).buildManageForm},{default:U((()=>[D(L,null,{default:U((()=>[O("div",ai,[ti,B(" 管理员选人 "),D(y,{value:W(ge).buildManageForm.buildManageName,"onUpdate:value":i[13]||(i[13]=e=>W(ge).buildManageForm.buildManageName=e),placeholder:"请选择",onClick:yi,onChange:Ce,"allow-clear":""},null,8,["value"])])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible"]),B(" 导入导出 "),D(ae,{ref_key:"importExportRef",ref:re,onEmitCallback:ci,action:mi.value,accept:W(ge).accept},null,8,["action","accept"]),B(" 选择班级 "),D(W(n),{multiple:!1,mode:"depa",tabs:W(ge).selectTabs,visible:W(ge).classVisible,"onUpdate:visible":i[15]||(i[15]=e=>W(ge).classVisible=e),checked:W(ge).classesArr,"onUpdate:checked":i[16]||(i[16]=e=>W(ge).classesArr=e),onHandleOk:Ne},null,8,["tabs","visible","checked"]),B(" 选择管理员 "),D(W(n),{tabs:[{tab:"管理员",key:1,checked:!0}],mode:"personnel",visible:W(ge).managerVisible,"onUpdate:visible":i[17]||(i[17]=e=>W(ge).managerVisible=e),selectedKeys:[],checked:W(ge).managerList,"onUpdate:checked":i[18]||(i[18]=e=>W(ge).managerList=e),checkedKey:"id",onHandleOk:we},null,8,["visible","checked"]),D(M),D(ke,{visibleProps:W(ge).visibleProps,"onUpdate:visibleProps":i[19]||(i[19]=e=>W(ge).visibleProps=e),detailId:W(ge).detailId,onIntroduceForm:Ve},null,8,["visibleProps","detailId"]),B(" 二维码 弹框 "),D(x,{visible:W(ge).modalVisible,"onUpdate:visible":i[20]||(i[20]=e=>W(ge).modalVisible=e),title:W(ge).qrcodeTitle,width:408,class:"invite_member",bodyStyle:{textAlign:"center",display:"flex",alignItems:"center"},onCancel:i[21]||(i[21]=e=>W(ge).modalVisible=!1)},{footer:U((()=>[D(s,{class:"button-link",type:"link",onClick:je},{default:U((()=>[A(" 下载二维码 ")])),_:1})])),default:U((()=>[O("img",{class:"code_img",src:W(ge).qrcodeUrl,alt:""},null,8,li)])),_:1},8,["visible","title"])])}}},[["__scopeId","data-v-16ef7a8d"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/basicManagement/site/field/index.vue"]]);export{si as default};
