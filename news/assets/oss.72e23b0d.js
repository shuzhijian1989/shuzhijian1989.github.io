import{O as e}from"./ali-oss.e15d125a.js";import{S as s}from"./index.7061e8ea.js";import"./ydutils.99497787.js";const t=(t,o={},c)=>new Promise((async(n,l)=>{const{code:i,data:d}=await s();if(0!==i)return void l({code:-1,msg:"获取凭证失败，无法上传",url:null});const{accessKeyId:u,accessKeySecret:m,bucket:p,region:h,stsToken:f}=d,g=new e({region:h,accessKeyId:u,accessKeySecret:m,stsToken:f,bucket:p,secure:!0}),y=a(t.name||t.file.name),w=r(20)+y,S=await g.multipartUpload((o.catalogue||"helpvideo")+`/${w}`,t.raw||t.file||t,{progress(e,s){c&&c(Math.round(100*e),s)},meta:{year:2055,people:"test"}});if(200===S.res.status){n({code:0,msg:"上传成功",url:(S.res.requestUrls[0]&&S.res.requestUrls[0].split("?"))[0].replace("https://cloud-yide.oss-cn-shenzhen.aliyuncs.com","https://alicdn.1d1j.cn")})}else l({code:-1,msg:"上传到0SS失败",url:null})})),r=e=>{e=e||32;const s="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",t=s.length;let r="";for(let a=0;a<e;a++)r+=s.charAt(Math.floor(Math.random()*t));return r},a=e=>{const s=e.lastIndexOf(".");let t="";return-1!==s&&(t=e.substring(s)),t};export{t as g};
