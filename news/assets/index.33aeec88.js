import"./vue.a2f518ee.js";import{a as e}from"./index.323b38c6.js";import{M as a,m as s}from"./ant-design-vue.db4d48e3.js";import{C as i,a as t,u as o,d as n,c as r,s as c,p as d}from"./creadForm.61811a7e.js";import{r as l}from"./trafficRules.626c1e24.js";import{s as m}from"./synchronFace.8dba19bd.js";import{_ as p}from"./index.272083a4.js";import{_ as u}from"./index.7061e8ea.js";import{r as f,q as b,f as v,b8 as y,I as h,o as g,a as j,b as w,c as k,H as S,a2 as _,a3 as x,O as C,a7 as F,u as L,a9 as T,h as I,b5 as M,b4 as V}from"./@vue.919ff404.js";import{E as D}from"./@ant-design.2e172c39.js";import"./@babel.6d5f88cb.js";import"./FilterDropdown.5a779a00.js";import"./resize-observer-polyfill.f664b406.js";import"./vue-types.022beab3.js";import"./@ctrl.c020ccd3.js";import"./dom-align.0991ecc5.js";import"./lodash-es.36dcd19c.js";import"./dayjs.49e29cb2.js";import"./async-validator.267d9719.js";import"./scroll-into-view-if-needed.61c672a4.js";import"./compute-scroll-into-view.17358474.js";import"./qs.e55e9b28.js";import"./side-channel.ea627785.js";import"./get-intrinsic.8c87d952.js";import"./has-symbols.caae0f97.js";import"./has-proto.76cff6c7.js";import"./function-bind.cb3858f2.js";import"./has.c1051c46.js";import"./call-bind.208b5ef0.js";import"./object-inspect.e2cfb4a5.js";/* empty css                    */import"./secure-ls.8c8acb46.js";import"./vue-router.907b547c.js";import"./nprogress.c2257662.js";import"./axios.7aed06b8.js";import"./vuex.f308ecec.js";import"./vuex-persistedstate.fa252374.js";import"./vue-grid-layout.a3ef67ec.js";const E=e=>(M("data-v-0b4ddaa3"),e=e(),V(),e),A={class:"attendance_machine"},P={class:"operation_box"},z={class:"head_title"},N=E((()=>w("p",null,"考勤机列表",-1))),O={key:1},q={key:2,style:{display:"flex"}},R={key:1},U={key:2},K=E((()=>w("span",null,"该设备还未激活",-1))),H=E((()=>w("i",{class:"iconfont icon-outlinebeifen iconClass"},null,-1))),B=E((()=>w("span",{class:"tips"},"验证密码用于操作人脸机设置的验证，请记住你的密码",-1)));var G=u({__name:"index",setup(u){const M=f(),V=b({tableSpinning:!1,formVisible:!1,isEdit:!1,deviceType:3,pagination:{total:0,pageNo:1,pageSize:10},fieldList:[],echoMachineData:{},machineId:"",submitLoading:!1,no:"",passwordvisible:!1,passwordForm:{newPassword:""},passwordId:"",machineStatus:""}),E=e=>{V.no=e,V.pagination.pageNo=1,V.pagination.pageSize=10,se()},G=e=>{const a={id:e.id};t(a).then((e=>{se(),s.success(e.message)}))},J=()=>{M.value.validateFields().then((()=>{const e={id:V.passwordId,password:V.passwordForm.newPassword};l(e).then((e=>{s.success(e.message),V.passwordvisible=!1,se()}))}))},Q=(e,a)=>{switch(V.isEdit=e,e){case!1:V.echoMachineData={},V.formVisible=!0;break;case!0:V.formVisible=!0,Z(a)}},W=e=>{V.submitLoading=e,V.formVisible=e},X=e=>{V.isEdit?Y(e):$(e)},Y=e=>{const a={...e,id:V.machineId,deviceType:V.deviceType};o(a).then((e=>{s.success(e.message),se(),V.formVisible=!1}))},Z=e=>{V.machineId=e.id,n({id:e.id}).then((e=>{const{data:a}=e;V.echoMachineData=a}))},$=e=>{V.submitLoading=!0;const a={...e,deviceType:V.deviceType};r(a).then((e=>{s.success(e.message),V.formVisible=!1,V.submitLoading=!1,se()})).finally((()=>{V.submitLoading=!1}))},ee=e=>{e.forEach((e=>{e.children&&(e.disabled=!0,ee(e.children))}))},ae=e=>{const{current:a,pageSize:s,machineStatus:i}=e;V.machineStatus=i?i[0]:"",V.pagination.pageNo=a,V.pagination.pageSize=s,se()},se=()=>{V.tableSpinning=!0;const e={...V.pagination,no:V.no,machineStatus:V.machineStatus,deviceType:V.deviceType};d(e).then((e=>{const{data:a}=e;V.pagination.total=a.total,V.dataSource=a.list})).finally((()=>{V.tableSpinning=!1}))};return v((()=>{se(),c().then((e=>{const{data:a}=e;V.fieldList=a,ee(a)}))})),(t,o)=>{const n=y("a-input-search"),r=y("plus-outlined"),c=y("a-button"),d=y("a-badge"),l=y("a-tooltip"),u=y("a-spin"),f=y("a-input"),b=y("a-form-item"),v=y("a-form"),Y=y("a-modal"),Z=h("auth");return g(),j("div",A,[w("div",P,[w("div",z,[N,k(n,{placeholder:"请输入设备序列号/考勤机名称",onSearch:E,allowClear:!0})]),S((g(),_(c,{type:"primary",onClick:o[0]||(o[0]=e=>Q(!1))},{icon:x((()=>[k(r)])),default:x((()=>[C(" 新增考勤机 ")])),_:1})),[[Z,"addAttendance","managementAttendance"]])]),F(" 表格 "),k(u,{spinning:V.tableSpinning},{default:x((()=>[k(p,{columns:L(e),dataSource:V.dataSource,rowKey:"id",style:{flex:"1"},rowSelection:!1,isScroll:!0,totals:V.pagination,onOnSelectedRowKeys:ae},{bodyCell:x((({column:e,record:i})=>["machineStatus"===e.key?(g(),_(d,{key:0,status:["default","success"][i.machineStatus]||"",text:["离线","在线"][i.machineStatus]||"-"},null,8,["status","text"])):F("v-if",!0),"no"===e.dataIndex?(g(),j("span",O,T((null==i?void 0:i.no)||"-"),1)):F("v-if",!0),"operation"===e.key?(g(),j("div",q,[1==i.machineStatus?(g(),_(c,{key:0,type:"link",onClick:e=>{return a=i.siteId,void m({deviceNo:a}).then((e=>{s.success(e.message)}));var a},style:{color:"var(--primary-color)"}},{default:x((()=>[C("一键同步")])),_:2},1032,["onClick"])):F("v-if",!0),S((g(),_(c,{type:"link",onClick:e=>Q(!0,i),style:{color:"var(--primary-color)"}},{default:x((()=>[C("编辑")])),_:2},1032,["onClick"])),[[Z,"editAttendance","managementAttendance"]]),i.machineStatus?(g(),j("div",R,[S((g(),_(c,{style:{color:"var(--primary-color)"},type:"link",onClick:e=>{return a=i,V.passwordForm.newPassword="",V.passwordvisible=!0,void(V.passwordId=a.id);var a}},{default:x((()=>[C("重置验证密码")])),_:2},1032,["onClick"])),[[Z,"resetPassword","managementAttendance"]])])):(g(),j("div",U,[k(c,{style:{color:"#999999"},type:"link"},{default:x((()=>[C(" 重置验证密码 "),k(l,{placement:"top"},{title:x((()=>[K])),default:x((()=>[H])),_:1})])),_:1})])),S((g(),_(c,{type:"link",style:{color:"red"},onClick:e=>{return t=i,void a.confirm({title:"删除提示",icon:k(D),content:I("div",{},[I("p","删除所选设备后，下列设置将同步清除或失效，并且不可恢复，确定删除吗？"),I("br"),I("p","1.该设备上所有绑定的通行规则和人脸信息 "),I("p","2.该设备回到初始化状态")]),okText:"确认",cancelText:"取消",onCancel(){s.info("已取消！")},onOk(){G(t)}});var t}},{default:x((()=>[C("删除")])),_:2},1032,["onClick"])),[[Z,"deleteAttendance","managementAttendance"]])])):F("v-if",!0)])),_:1},8,["columns","dataSource","totals"])])),_:1},8,["spinning"]),F(" 重置密码弹框 "),k(Y,{visible:V.passwordvisible,"onUpdate:visible":o[2]||(o[2]=e=>V.passwordvisible=e),title:"重置密码",onOk:J,maskClosable:!1},{default:x((()=>[k(v,{model:V.passwordForm,name:"passwordForm",layout:"vertical",ref_key:"passwordRef",ref:M},{default:x((()=>[k(b,{label:"请输入新的验证密码",name:"newPassword",rules:[{required:!0,message:"请输入新的验证密码"}]},{default:x((()=>[k(f,{value:V.passwordForm.newPassword,"onUpdate:value":o[1]||(o[1]=e=>V.passwordForm.newPassword=e),maxlength:4},null,8,["value"]),k(L(D)),B])),_:1})])),_:1},8,["model"])])),_:1},8,["visible"]),F(" 新增/编辑 "),k(i,{formVisible:V.formVisible,isEdit:V.isEdit,isType:V.deviceType,fieldList:V.fieldList,echoMachineData:V.echoMachineData,submitLoading:V.submitLoading,onFormCancel:W,onFormSubmit:X},null,8,["formVisible","isEdit","isType","fieldList","echoMachineData","submitLoading"])])}}},[["__scopeId","data-v-0b4ddaa3"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/basicManagement/deviceManagement/attendanceMachine/index.vue"]]);export{G as default};
