import"./vue.a2f518ee.js";import{b as e}from"./index.323b38c6.js";import{M as a,m as i}from"./ant-design-vue.db4d48e3.js";import{C as s,p as t,s as o,c as n,d as r,u as c,a as l}from"./creadForm.61811a7e.js";import{r as d}from"./trafficRules.626c1e24.js";import{r as m,h as p}from"./synchronFace.8dba19bd.js";import{_ as u}from"./index.272083a4.js";import{_ as f}from"./index.7061e8ea.js";import{q as b,t as v,r as h,f as y,b8 as g,I as j,o as k,a as w,a7 as S,c as x,a3 as _,u as C,b as D,H as I,a2 as L,O as T,a9 as F,P as V,h as M,b5 as O,b4 as E}from"./@vue.919ff404.js";import{E as P}from"./@ant-design.2e172c39.js";import"./@babel.6d5f88cb.js";import"./FilterDropdown.5a779a00.js";import"./resize-observer-polyfill.f664b406.js";import"./vue-types.022beab3.js";import"./@ctrl.c020ccd3.js";import"./dom-align.0991ecc5.js";import"./lodash-es.36dcd19c.js";import"./dayjs.49e29cb2.js";import"./async-validator.267d9719.js";import"./scroll-into-view-if-needed.61c672a4.js";import"./compute-scroll-into-view.17358474.js";import"./qs.e55e9b28.js";import"./side-channel.ea627785.js";import"./get-intrinsic.8c87d952.js";import"./has-symbols.caae0f97.js";import"./has-proto.76cff6c7.js";import"./function-bind.cb3858f2.js";import"./has.c1051c46.js";import"./call-bind.208b5ef0.js";import"./object-inspect.e2cfb4a5.js";/* empty css                    */import"./secure-ls.8c8acb46.js";import"./vue-router.907b547c.js";import"./nprogress.c2257662.js";import"./axios.7aed06b8.js";import"./vuex.f308ecec.js";import"./vuex-persistedstate.fa252374.js";import"./vue-grid-layout.a3ef67ec.js";const N=e=>(O("data-v-aa6c996e"),e=e(),E(),e),z={class:"faceMachineDiv"},B=N((()=>D("p",{class:"text"},"自助借还书机列表",-1))),R={class:"searchHead"},U={key:0,style:{display:"flex","align-items":"center"}},q=N((()=>D("span",null,"该设备还未激活",-1))),H={key:1},A={key:2},K=N((()=>D("div",{style:{display:"none"}},null,-1))),G={key:0},J=N((()=>D("span",{class:"tips"},"验证密码用于操作借还书机设置的验证，请记住你的密码",-1)));var Q=f({__name:"index",setup(f){const O=b({deviceType:6,detailsVisible:!1,formVisible:!1,isEdit:!1,fieldList:[],echoMachineData:{},machineId:"",title:"",disabled:!1,passwordvisible:!1,passwordForm:{newPassword:""},machineStatus:"",no:"",pagination:{total:0,pageNo:1,pageSize:10},dataSource:[],ruleDetailsSource:[],spinning:!1,submitLoading:!1,passwordId:""}),{passwordvisible:E,passwordForm:N,dataSource:Q,ruleDetailsSource:W,spinning:X,detailsVisible:Y}=v(O),Z=[{title:"方向",dataIndex:"inOut",key:"id"},{title:"规则",dataIndex:"ruleName",key:"ruleName"}],$=e=>{e.forEach((e=>{e.children&&(e.disabled=!0,$(e.children))}))},ee=e=>{const{current:a,pageSize:i,machineStatus:s}=e;O.machineStatus=s?s[0]:"",O.pagination.pageNo=a,O.pagination.pageSize=i,ce()},ae=e=>{O.no=e,O.pagination.pageNo=1,O.pagination.pageSize=10,ce()},ie=h(),se=()=>{ie.value.validateFields().then((()=>{ue()}))},te=()=>{ie.value.resetFields()},oe=(e,a)=>{switch(O.isEdit=e,e){case!1:O.echoMachineData={},O.formVisible=!0;break;case!0:O.formVisible=!0,de(a)}},ne=e=>{O.submitLoading=e,O.formVisible=e},re=e=>{O.isEdit?me(e):le(e)};const ce=()=>{const e={...O.pagination,no:O.no,machineStatus:O.machineStatus,deviceType:O.deviceType};t(e).then((e=>{const{data:a}=e;O.pagination.total=a.total,O.dataSource=a.list}))},le=e=>{O.submitLoading=!0;const a={...e,deviceType:O.deviceType};n(a).then((e=>{i.success(e.message),O.formVisible=!1,O.submitLoading=!1,ce()})).finally((()=>{O.submitLoading=!1}))},de=e=>{O.machineId=e.id,r({id:e.id}).then((e=>{const{data:a}=e;O.echoMachineData=a}))},me=e=>{const a={...e,id:O.machineId,deviceType:O.deviceType};c(a).then((e=>{i.success(e.message),ce(),O.formVisible=!1}))},pe=e=>{const a={id:e.id};l(a).then((e=>{ce(),i.success(e.message)}))},ue=()=>{const e={id:O.passwordId,password:O.passwordForm.newPassword};d(e).then((e=>{i.success(e.message),O.passwordvisible=!1}))};return y((()=>{ce(),o().then((e=>{const{data:a}=e;O.fieldList=a,$(a)}))})),(t,o)=>{const n=g("a-input-search"),r=g("plus-outlined"),c=g("a-button"),l=g("exclamation-circle-outlined"),d=g("a-tooltip"),f=g("a-badge"),b=g("a-spin"),v=g("a-modal"),h=g("a-input"),y=g("a-form-item"),$=g("a-form"),ce=j("auth");return k(),w("div",z,[S(" 人自助借还书机列表页面 "),x(b,{spinning:C(X)},{default:_((()=>[x(u,{class:"worker-table",columns:C(e),dataSource:C(Q),rowSelection:!1,isScroll:!0,totals:O.pagination,onOnSelectedRowKeys:ee},{handleItem:_((()=>[B,D("div",R,[x(n,{placeholder:"请输入借还书机序列号/借还书机名称",style:{width:"336px"},allowClear:"",onSearch:ae}),S(" TODO:权限设置 "),I((k(),L(c,{type:"primary",onClick:o[0]||(o[0]=e=>oe(!1))},{icon:_((()=>[x(r)])),default:_((()=>[T(" 添加借还书机 ")])),_:1})),[[ce,"add"]])])])),bodyCell:_((({column:e,record:s})=>["operation"===e.dataIndex?(k(),w("div",U,[S(' <a-button\r\n                                type="link"\r\n                                style="margin-left: 0"\r\n                                v-if="record.machineStatus == 1"\r\n                                @click="oneClickSync(record.no)"\r\n                                >一键同步</a-button\r\n                            > '),1==s.machineStatus?(k(),L(c,{key:0,type:"link",style:{"margin-left":"0"},onClick:e=>{return a=s.no,void p({deviceNo:a}).then((e=>{i.success(e.message)}));var a}},{default:_((()=>[T("重启")])),_:2},1032,["onClick"])):S("v-if",!0),1==s.machineStatus?(k(),L(c,{key:1,type:"link",style:{"margin-left":"0"},onClick:e=>{return a=s.no,void m({deviceNo:a}).then((e=>{i.success(e.message)}));var a}},{default:_((()=>[T("更新")])),_:2},1032,["onClick"])):S("v-if",!0),I((k(),L(c,{type:"link",onClick:e=>oe(!0,s),style:{"margin-left":"0"}},{default:_((()=>[T("编辑 ")])),_:2},1032,["onClick"])),[[ce,"edit"]]),S(' <a-button\r\n                                type="link"\r\n                                @click="resetPassword(record)"\r\n                                :disabled="record.isBinding == \'1\'"\r\n                                :style="\r\n                                    record.isBinding == 2\r\n                                        ? \'color:  var(--primary-color)\'\r\n                                        : record.isBinding == 1\r\n                                        ? \'color: #cccccc\'\r\n                                        : \'\'\r\n                                "\r\n                                v-auth="`resetPassword`"\r\n                                >重置验证密码</a-button\r\n                            > '),"1"==s.isBinding?(k(),L(d,{key:2,placement:"top"},{title:_((()=>[q])),default:_((()=>[x(l,{style:{color:"#efa216f2"}})])),_:1})):S("v-if",!0),I((k(),L(c,{type:"link",onClick:e=>{return t=s,void a.confirm({title:"删除提示",icon:x(P),content:M("div",{},[M("p","删除所选设备后，下列设置将同步清除或失效，并且不可恢复，确定删除吗？"),M("br"),M("p","1.该设备上所有绑定的通行规则和借还书机信息 "),M("p","2.该设备回到初始化状态")]),okText:"确认",cancelText:"取消",onCancel(){i.info("已取消！")},onOk(){pe(t)}});var t},style:{color:"red"}},{default:_((()=>[T("删除")])),_:2},1032,["onClick"])),[[ce,"remove"]])])):S("v-if",!0),"machineStatus"===e.dataIndex?(k(),w("div",H,[x(f,{status:["default","success"][s.machineStatus]||"",text:["离线","在线"][s.machineStatus]||"-"},null,8,["status","text"])])):S("v-if",!0),"machineDirection"===e.dataIndex?(k(),w("div",A,F(["-","出","入"][s.machineDirection]),1)):S("v-if",!0)])),_:1},8,["columns","dataSource","totals"])])),_:1},8,["spinning"]),S(" 查看页弹框 "),x(v,{visible:C(Y),"onUpdate:visible":o[1]||(o[1]=e=>V(Y)?Y.value=e:null),title:"查看规则",maskClosable:!1},{footer:_((()=>[K])),default:_((()=>[x(u,{class:"worker-table",columns:Z,dataSource:C(W),rowSelection:!1},{bodyCell:_((({column:e,record:a})=>["inOut"===e.dataIndex?(k(),w("div",G,F(1==a.inOut?"出":2==a.inOut?"入":""),1)):S("v-if",!0)])),_:1},8,["dataSource"])])),_:1},8,["visible"]),S(" 重置密码弹框 "),x(v,{visible:C(E),"onUpdate:visible":o[3]||(o[3]=e=>V(E)?E.value=e:null),title:"重置密码",onOk:se,onCancel:te,maskClosable:!1},{default:_((()=>[x($,{model:C(N),name:"passwordForm",layout:"vertical",ref_key:"passwordRef",ref:ie},{default:_((()=>[x(y,{label:"请输入新的验证密码",name:"newPassword",rules:[{required:!0,message:"请输入新的验证密码"}]},{default:_((()=>[x(h,{value:C(N).newPassword,"onUpdate:value":o[2]||(o[2]=e=>C(N).newPassword=e),maxlength:"4"},null,8,["value"]),x(C(P)),J])),_:1})])),_:1},8,["model"])])),_:1},8,["visible"]),S(" 新增/编辑 "),x(s,{formVisible:O.formVisible,isEdit:O.isEdit,isType:O.deviceType,fieldList:O.fieldList,echoMachineData:O.echoMachineData,submitLoading:O.submitLoading,onFormCancel:ne,onFormSubmit:re},null,8,["formVisible","isEdit","isType","fieldList","echoMachineData","submitLoading"])])}}},[["__scopeId","data-v-aa6c996e"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/basicManagement/deviceManagement/borrowAndReturnBooks/index.vue"]]);export{Q as default};
