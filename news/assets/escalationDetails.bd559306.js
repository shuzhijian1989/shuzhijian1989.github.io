import"./vue.a2f518ee.js";import{_ as a}from"./index.272083a4.js";import{d as e}from"./dayjs.49e29cb2.js";import{u as t,a as i}from"./vue-router.907b547c.js";import{u as s,_ as l}from"./index.7061e8ea.js";import{e as n,y as o,b8 as c,o as r,a as d,F as p,O as u,a9 as m,c as y,a3 as f,a2 as g,r as b,q as S,f as j,b as v,a7 as k,H as x,u as T,L as E,b5 as h,b4 as _}from"./@vue.919ff404.js";import{m as C}from"./ant-design-vue.db4d48e3.js";import{g as D,q as w,a as I,b as q,c as z,d as N,e as L}from"./questionnaire.6c946fd1.js";import"./@babel.6d5f88cb.js";/* empty css                    */import"./secure-ls.8c8acb46.js";import"./nprogress.c2257662.js";import"./axios.7aed06b8.js";import"./qs.e55e9b28.js";import"./side-channel.ea627785.js";import"./get-intrinsic.8c87d952.js";import"./has-symbols.caae0f97.js";import"./has-proto.76cff6c7.js";import"./function-bind.cb3858f2.js";import"./has.c1051c46.js";import"./call-bind.208b5ef0.js";import"./object-inspect.e2cfb4a5.js";import"./@ant-design.2e172c39.js";import"./@ctrl.c020ccd3.js";import"./vuex.f308ecec.js";import"./vuex-persistedstate.fa252374.js";import"./vue-grid-layout.a3ef67ec.js";import"./resize-observer-polyfill.f664b406.js";import"./vue-types.022beab3.js";import"./dom-align.0991ecc5.js";import"./lodash-es.36dcd19c.js";import"./async-validator.267d9719.js";import"./scroll-into-view-if-needed.61c672a4.js";import"./compute-scroll-into-view.17358474.js";var O=l(n({__name:"allTemplate",props:{text:{type:String,default:""},column:{type:Object,default:()=>({dataIndex:""})},record:{type:Object,default:()=>({status:""})},reportEndTime:{type:String,default:""},reportStartTime:{type:String,default:""}},emits:["emitEscalation"],setup(a,{emit:l}){const n=a,b=s(),S=t(),j=i(),v=o((()=>{const a=e(e().format("YYYY-MM-DD")).unix();return e(n.reportStartTime).unix()>a||a<e(n.reportEndTime).add(1,"day").unix()})),k=o((()=>(b.state.selectSource.dictionary.report_type||[]).map((a=>({label:a.label,value:a.value}))))),x=(a,e,t)=>{const{type:i}=a;switch(i){case 0:S.push({name:"escalationForm",query:{status:e,disable:t}});break;case 1:S.push({query:{...j.query,disable:t}}),l("emitEscalation",{name:"facultyEscalationColumns",status:e,disable:t});break;case 2:S.push({query:{...j.query,disable:t}}),l("emitEscalation",{name:"parentEscalationColumns",status:e,disable:t})}};return(e,t)=>{const i=c("a-badge"),s=c("a-button");return r(),d("div",null,["type"===a.column.dataIndex?(r(),d(p,{key:0},[u(m(k.value[a.record.type].label),1)],64)):"condition"===a.column.dataIndex?(r(),d(p,{key:1},[y(i,{status:a.record.condition?"success":"default"},null,8,["status"]),u(" "+m(a.record.condition?"已上报":"未上报"),1)],64)):"operation"===a.column.dataIndex?(r(),d(p,{key:2},[a.record.condition?(r(),d(p,{key:0},[y(s,{type:v.value?"link":"text",disabled:!v.value,onClick:t[0]||(t[0]=e=>x(a.record,!a.record.type||null))},{default:f((()=>[u(" 重新上报")])),_:1},8,["type","disabled"]),y(s,{type:"link",onClick:t[1]||(t[1]=e=>x(a.record,!0,1))},{default:f((()=>[u("查看详情")])),_:1})],64)):(r(),g(s,{key:1,type:v.value?"link":"text",disabled:!v.value,onClick:t[2]||(t[2]=e=>x(a.record))},{default:f((()=>[u(" 上报 ")])),_:1},8,["type","disabled"]))],64)):(r(),d(p,{key:3},[u(m(a.text),1)],64))])}}}),[["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/appModel/views/questionnaire/allTemplate.vue"]]);const $=[{title:"上报类型",dataIndex:"type",key:"id"},{title:"信息完整率",dataIndex:"percentage",key:"percentage"},{title:"上报情况",dataIndex:"condition",key:"condition"},{title:"操作",dataIndex:"operation",key:"id",width:180}];var M=Object.freeze(Object.defineProperty({__proto__:null,allEscalationColumns:$,facultyEscalationColumns:[{title:"教师姓名",dataIndex:"employeeName",key:"id"},{title:"手机号码",dataIndex:"phone",key:"id"},{title:"出生日期",dataIndex:"birthday",key:"id"},{title:"年级",dataIndex:"rollName",key:"id"},{title:"身份",dataIndex:"identity",key:"id",width:100}],parentEscalationColumns:[{title:"幼儿姓名",dataIndex:"studentName",key:"id"},{title:"年级",dataIndex:"rollName",key:"id"},{title:"班级",dataIndex:"classesName",key:"id"},{title:"主监护人电话",dataIndex:"elternPhone",key:"id"},{title:"监护人与学生的关系",dataIndex:"relationship",key:"id",width:180}]},Symbol.toStringTag,{value:"Module"}));const P=(a=>(h("data-v-11884c9a"),a=a(),_(),a))((()=>v("i",{class:"iconfont icon-xingzhuangjiehe19"},null,-1))),Y={key:0};var A=l(n({__name:"escalationDetails",setup(e){const l=s(),n=i(),p=t(),h=b(0),_=S({spinning:!1,exportLoading:!1,escalationLoading:!1,escalationTitle:"返回",escalationDetailsStatus:!1,columnsState:"allEscalationColumns",escalationType:"",spinLoad:!1,columns:$||[],escalationAll:[],pagination:{pageNo:1,pageSize:10,total:0},escalationDetails:{flag:!1,reportStartTime:"",reportEndTime:"",elternStartTime:"",elternEndTime:"",employeeStartTime:"",employeeEndTime:"",list:[]}}),A=a=>{const{name:e,status:t,disable:i}=a;switch(_.escalationDetailsStatus=t,h.value=i||n.query.disable,_.columnsState=e,_.columns=M[e],e){case"facultyEscalationColumns":H(t),_.escalationTitle="教职工信息上报";break;case"parentEscalationColumns":K(t),_.escalationTitle="家长信息上报";break;default:U()}},F=a=>{const{current:e,pageSize:t,total:i}=a;_.pagination.pageNo=e,_.pagination.pageSize=t,_.pagination.total=i;const s={name:_.columnsState,status:_.escalationDetailsStatus};A(s)},U=()=>new Promise((async(a,e)=>{_.spinning=!0;const{data:t}=await D().finally((()=>{_.spinning=!1})),{list:i,reportStartTime:s,reportEndTime:l}=t;_.escalationDetails.reportStartTime=s,_.escalationDetails.reportEndTime=l,_.escalationDetails={..._.escalationDetails,...t},_.escalationAll=i,_.escalationType=`数据采集时间：${s} 至 ${l}`,_.pagination={pageNo:1,pageSize:10,total:0},_.spinning=!1,a(t)})).finally((()=>{_.spinning=!1})),H=a=>{_.spinning=!0;const e=a?q:z;_.escalationType="教师信息上报需提供：教师姓名/手机号码/出生日期/年级/身份；若上述字段缺失，可导出数据在【教职工管理】中进行对比并完善基本信息。",e(_.pagination).then((a=>{const{list:e,pageNo:t,pageSize:i,total:s}=a.data;_.pagination={pageNo:t,pageSize:i,total:s},_.escalationDetails.list=e})).finally((()=>{_.spinning=!1}))},K=a=>{_.spinning=!0;const e=a?N:L;_.escalationType="家长信息上报需提供：班级 / 幼儿姓名 / 监护人电话 / 监护人与学生的关系；若上述字段缺失，可导出数据在【学籍管理】中进行对比并完善基本信息。",e(_.pagination).then((a=>{const{list:e,pageNo:t,pageSize:i,total:s}=a.data;_.pagination={pageNo:t,pageSize:i,total:s},_.escalationDetails.list=e.map((a=>(a.hasOwnProperty("relationship")&&(a.relationship=J.value[a.relationship-1].label),a)))})).finally((()=>{_.spinning=!1}))},R=()=>{const a="facultyEscalationColumns"===_.columnsState?1:2;_.escalationLoading=!0,w(a).then((a=>{C.success(a.message),G()})).finally((()=>{_.escalationLoading=!1}))},B=()=>{let a=1,e="教职工信息不全人员";"parentEscalationColumns"===_.columnsState&&(a=2,e="家长信息不全人员"),I(a,null,e)},G=async()=>{_.escalationTitle="返回",await U(),"allEscalationColumns"===_.columnsState&&p.back(-1),_.columns=$,_.columnsState="allEscalationColumns"},J=o((()=>(l.state.selectSource.dictionary.relations||[]).map((a=>({label:a.label,value:a.value})))));return j((()=>{U()})),(e,t)=>{const i=c("a-layout-header"),s=c("check-circle-filled"),l=c("a-alert"),n=c("a-button"),o=c("a-layout-content"),p=c("a-layout-footer"),b=c("a-spin"),S=c("a-layout");return r(),g(S,{class:"yd-layout"},{default:f((()=>[y(b,{spinning:_.spinning},{default:f((()=>[y(i,{class:"yd-layout-header"},{default:f((()=>[v("span",{onClick:G},[k(' <arrow-left-outlined class="left-outlined" /> '),P,u(m(_.escalationTitle),1)])])),_:1}),_.escalationDetails.flag&&"allEscalationColumns"===_.columnsState?(r(),g(i,{key:0,class:"escalation-details-info"},{default:f((()=>[y(l,{banner:"",message:`信息已成功上报：${_.escalationDetails.elternStartTime} 至 ${_.escalationDetails.elternEndTime} 家长作答问卷时间，${_.escalationDetails.employeeStartTime} 至 ${_.escalationDetails.employeeEndTime} 园长和老师作答问卷时间`,type:"info"},{icon:f((()=>[y(s)])),_:1},8,["message"])])),_:1})):k("v-if",!0),y(o,{class:"yd-layout-content yd-layout-content-pdbtm"},{default:f((()=>[_.escalationType?(r(),g(l,{key:0,class:"escalation-warning",message:_.escalationType,type:"warning","show-icon":""},null,8,["message"])):k("v-if",!0),h.value||"allEscalationColumns"===_.columnsState?k("v-if",!0):(r(),g(n,{key:1,style:{"margin-bottom":"16px",float:"right","z-index":"1"},loading:_.exportLoading,onClick:B},{default:f((()=>[u("导出信息不全人员 ")])),_:1},8,["loading"])),y(a,{rowSelection:!1,columns:_.columns,dataSource:_.escalationDetails.list||[],totals:_.pagination,spinLoad:_.spinLoad,onOnSelectedRowKeys:F},{bodyCell:f((({column:a,text:e,record:t})=>[k(" 已上报 、 未上报 start"),x(y(T(O),{column:a,text:e+"",record:t,reportStartTime:_.escalationDetails.reportStartTime,reportEndTime:_.escalationDetails.reportEndTime,onEmitEscalation:A},null,8,["column","text","record","reportStartTime","reportEndTime"]),[[E,"allEscalationColumns"==_.columnsState]]),k(" 已上报 、 未上报 end"),"allEscalationColumns"!==_.columnsState?(r(),d("span",Y,m(e||"--"),1)):k("v-if",!0)])),_:1},8,["columns","dataSource","totals","spinLoad"])])),_:1}),h.value||"allEscalationColumns"===_.columnsState?k("v-if",!0):(r(),g(p,{key:1,class:"yd-layout-footer"},{default:f((()=>[y(n,{loading:_.escalationLoading,type:"primary",onClick:R},{default:f((()=>[u("上报 ")])),_:1},8,["loading"])])),_:1}))])),_:1},8,["spinning"])])),_:1})}}}),[["__scopeId","data-v-11884c9a"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/appModel/views/questionnaire/escalationDetails.vue"]]);export{A as default};
