import{_ as e}from"./index.272083a4.js";import"./vue.a2f518ee.js";import{m as t,a,M as i}from"./ant-design-vue.db4d48e3.js";import{c as s,g as l,a as o,u as n,b as d,d as r,e as c,p as u,f as p,h as m,q as g,i as y,r as v,w as b,j as f}from"./model.465db796.js";import{d as k}from"./dayjs.49e29cb2.js";import{_ as h,u as L,p as I}from"./index.7061e8ea.js";import{Y as _}from"./table.81b98c8b.js";import{g as C}from"./oss.72e23b0d.js";import{y as x,Q as w,q as j,w as S,b8 as U,o as R,a as E,c as O,a3 as T,O as N,b as V,u as G,a2 as M,F as D,a8 as Y,a9 as z,a7 as B,f as F,M as P,a1 as q,a5 as A,aw as K,n as $,R as H,b5 as J,b4 as W,e as Q}from"./@vue.919ff404.js";import{T as X}from"./index.112873ae.js";import{f as Z}from"./@ant-design.2e172c39.js";import"./@babel.6d5f88cb.js";import"./resize-observer-polyfill.f664b406.js";import"./vue-types.022beab3.js";import"./@ctrl.c020ccd3.js";import"./dom-align.0991ecc5.js";import"./lodash-es.36dcd19c.js";import"./async-validator.267d9719.js";import"./scroll-into-view-if-needed.61c672a4.js";import"./compute-scroll-into-view.17358474.js";import"./FilterDropdown.5a779a00.js";/* empty css                    */import"./secure-ls.8c8acb46.js";import"./vue-router.907b547c.js";import"./nprogress.c2257662.js";import"./axios.7aed06b8.js";import"./qs.e55e9b28.js";import"./side-channel.ea627785.js";import"./get-intrinsic.8c87d952.js";import"./has-symbols.caae0f97.js";import"./has-proto.76cff6c7.js";import"./function-bind.cb3858f2.js";import"./has.c1051c46.js";import"./call-bind.208b5ef0.js";import"./object-inspect.e2cfb4a5.js";import"./vuex.f308ecec.js";import"./vuex-persistedstate.fa252374.js";import"./vue-grid-layout.a3ef67ec.js";import"./ali-oss.e15d125a.js";import"./ydutils.99497787.js";import"./ydutils.a58fbaf1.js";const ee={class:"evaluation-group"},te={style:{position:"absolute",right:"10px",top:"4px"}};var ae=h({__name:"addEvaluationGroupDrawer",props:{isVisible:{type:Boolean,default:!1}},emits:["update:isVisible","emitRatingGroup"],setup(e,{emit:a}){const i=e,l=L(),o=x((()=>{const e=[];return l.state.base.commentJsonKeys.INIT_ROLL_LIST.forEach((t=>"classes"!==t.key&&e.push(t.level))),e})),n=w(!1),d=w(),r=w("新增评比组"),c=j({evaluationLoging:!1,checkedPeopleList:[],peopleVisible:!1,scoringYselectTabs:[{tab:"教职工",key:1,checked:!0},{tab:"学生组",key:2,checked:!0,disabled:o}],evaluationForm:{name:"",persons:"",personList:[]}}),u=j({name:[{required:!0,message:"请输入"}],persons:[{required:!0,message:"请选择"}]});function p(e){const t=[];c.evaluationForm.personList=e.map((e=>(t.push(e.name),{identity:e.identity||1===e._source?1:0,personId:e.id||1===e._source?e.id:e.userId,personName:e.name}))),t.length&&(c.evaluationForm.persons=t.toString(" 、 "),d.value.validateFields("persons")),c.checkedPeopleList=e}function m(){d.value.resetFields(),a("update:isVisible",!1)}function g(){d.value.validate().then((()=>{c.evaluationLoging=!0,s(c.evaluationForm).then((e=>{t.success(e.message),a("emitRatingGroup"),m()})).finally((()=>{c.evaluationLoging=!1}))}))}return S((()=>i.isVisible),(e=>{n.value=e})),(e,t)=>{const a=U("a-input"),i=U("a-form-item"),s=U("plus-outlined"),l=U("a-button"),o=U("a-form"),y=U("a-drawer");return R(),E("div",ee,[O(y,{visible:n.value,"onUpdate:visible":t[4]||(t[4]=e=>n.value=e),maskClosable:!1,title:r.value,width:"520",closable:!1,"footer-style":{textAlign:"center"},onClose:m},{footer:T((()=>[O(l,{style:{"margin-right":"8px"},onClick:m},{default:T((()=>[N(" 取消 ")])),_:1}),O(l,{type:"primary",onClick:g,loading:c.evaluationLoging},{default:T((()=>[N("确认")])),_:1},8,["loading"])])),default:T((()=>[O(o,{layout:"vertical",ref_key:"evaluationRef",ref:d,model:c.evaluationForm,rules:u},{default:T((()=>[O(i,{label:"评比组名称：",name:"name"},{default:T((()=>[O(a,{placeholder:"请输入",value:c.evaluationForm.name,"onUpdate:value":t[0]||(t[0]=e=>c.evaluationForm.name=e)},null,8,["value"])])),_:1}),O(i,{label:"评比组人员：",name:"persons",class:"selectInputClass"},{default:T((()=>[O(a,{placeholder:"请选择",readonly:"",value:c.evaluationForm.persons,"onUpdate:value":t[1]||(t[1]=e=>c.evaluationForm.persons=e)},null,8,["value"]),V("div",te,[O(G(I),{mode:"personnel",tabs:c.scoringYselectTabs,visible:c.peopleVisible,"onUpdate:visible":t[2]||(t[2]=e=>c.peopleVisible=e),checked:c.checkedPeopleList,"onUpdate:checked":t[3]||(t[3]=e=>c.checkedPeopleList=e),onHandleOk:p},{default:T((()=>[O(l,{disabled:c.isLook,type:"primary",class:"btn",size:"small"},{icon:T((()=>[O(s)])),_:1},8,["disabled"])])),_:1},8,["tabs","visible","checked"])])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["visible","title"])])}}},[["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/appModel/studentEvaluation/activity/addEvaluationGroupDrawer.vue"]]);const ie={key:0};var se=h({__name:"selectRatingGroupModal",props:{selectRatingVisible:{type:Boolean,default:!1},ratingGroupEcho:{type:String,default:""},ratingGroupList:{type:Array,default:()=>[]}},emits:["ratingGroupObj","update:isVisible"],setup(e,{emit:t}){const a=e,i=w(!1),s=w("");function l(){t("update:selectRatingVisible",!1)}function o(){t("ratingGroupObj",s.value),l()}return S((()=>a.selectRatingVisible),(e=>{i.value=e,a.ratingGroupEcho&&(s.value=a.ratingGroupEcho)})),(t,a)=>{const n=U("a-radio"),d=U("a-radio-group"),r=U("a-empty"),c=U("a-modal");return R(),M(c,{destroyOnClose:"",visible:i.value,"onUpdate:visible":a[1]||(a[1]=e=>i.value=e),maskClosable:!1,title:"选择评比组",onOk:o,onCancel:l,class:"select-rating-group"},{default:T((()=>[O(d,{class:"rating-radio-group",value:s.value,"onUpdate:value":a[0]||(a[0]=e=>s.value=e)},{default:T((()=>[(R(!0),E(D,null,Y(e.ratingGroupList,(e=>(R(),M(n,{key:e.id,value:e.id,style:{display:"flex",flex:"1","min-height":"84px",padding:"10px","align-items":"center","margin-bottom":"10px",background:"#f6f6f6","border-radius":"4px 4px 0px 0px"}},{default:T((()=>[V("h1",null,z(e.name),1),V("div",null,[(R(!0),E(D,null,Y(e.personList,((t,a)=>(R(),E("span",{key:t.personIdentity},[N(z(t.personName)+" ",1),a!==e.personList.length-1?(R(),E("i",ie," ")):B("v-if",!0)])))),128))])])),_:2},1032,["value"])))),128))])),_:1},8,["value"]),e.ratingGroupList.length?B("v-if",!0):(R(),M(r,{key:0,image:"image/empty.png","image-style":{width:"100%",height:"180px"}}))])),_:1},8,["visible"])}}},[["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/appModel/studentEvaluation/activity/selectRatingGroupModal.vue"]]);const le=[{title:"评分项目",width:"50%",key:"projectName",dataIndex:"projectName"},{title:"评分范围",key:"ruleDescription",dataIndex:"ruleDescription",width:"50%"},{title:"操作",width:80,align:"center",key:"operation"}],oe=[{title:"奖章图标",width:264,key:"medalUrl",dataIndex:"medalUrl"},{title:"荣誉称号",dataIndex:"honorTitle",key:"honorTitle"},{title:"操作",width:"80px",key:"operation",align:"center"}],ne=[{key:0,value:"每日1评"},{key:1,value:"1周1评"},{key:2,value:"1月1评"},{key:3,value:"1学期1评"},{key:4,value:"自定义评比时段"}],de=[{key:0,value:"班主任评分",tips:"（适用于班级内学生的评比打分，由班主任单独给班级内每个学生直接进行评分）"},{key:1,value:"学生互评",tips:"（适用于班级内学生的评比打分，由班级内的学生互相评分，最终取平均分）"},{key:2,value:"评比组",tips:"（适用于班级之间的评比打分，自定义选择教职工/学生作为打分员）"}],re=[{title:"评比组名称",width:264,key:"groupName",dataIndex:"groupName"},{title:"评比组人员",dataIndex:"personList",key:"personList"}],ce=[{title:"评分时间",key:"scoringTime",dataIndex:"scoringTime"},{title:"评分人",dataIndex:"scoringPerson",key:"scoringPerson"},{title:"分值",key:"score",dataIndex:"score",align:"center"}];const ue=e=>(J("data-v-420c79f8"),e=e(),W(),e),pe={class:"create_warp"},me={class:"header"},ge=ue((()=>V("i",{class:"iconfont icon-xingzhuangjiehe19"},null,-1))),ye={class:"body center"},ve=ue((()=>V("h1",{class:"form-title"},"基本活动信息",-1))),be={key:1},fe=ue((()=>V("div",{class:"ant-upload-text"},"点击上传图片",-1))),ke=ue((()=>V("h1",{class:"form-title"},"评比规则",-1))),he={style:{"max-height":"500px","overflow-y":"scroll"}},Le=ue((()=>V("span",{style:{padding:"0 20px"}},"-",-1))),Ie=ue((()=>V("span",{style:{"padding-left":"8px"}},"添 加 ",-1))),_e={style:{position:"absolute",right:"0",top:"10px"}},Ce={class:"tips"},xe=ue((()=>V("span",{class:"tips"},"（评分最高者得）",-1))),we=ue((()=>V("span",{class:"tips"}," （评分由高到低依次多个荣誉称号） ",-1))),je=["src"],Se=ue((()=>V("span",{style:{"padding-left":"8px"}},"添加奖项 ",-1))),Ue={key:0,class:"footer"},Re={class:"center"},Ee={style:{"padding-bottom":"24px"}},Oe=ue((()=>V("span",null,"评分类目：",-1))),Te={style:{cursor:"pointer",width:"300px","white-space":"nowrap","text-overflow":"ellipsis",overflow:"hidden","word-break":"break-all"}};var Ne=h({__name:"createOrEdit",props:{isEdit:{type:Number,default:0},id:[String,Number],activityItem:{type:Object,default:()=>({id:""})}},emits:["submit"],setup(e,{emit:i}){const s=e,u=L(),p=w(),m=w([]),g=a.useForm,y=e=>{const t=k().subtract(1,"day").format("YYYY-MM-DD HH:mm:ss");return e&&e<k(t).endOf("day")},v=(e,t)=>{const a=[];for(let i=e;i<t;i++)a.push(i);return a},b=e=>{const t=k().date();let a=k().hour();const i=k().minute();let s=null,l=null;if(s=()=>v(-1,a).splice(1,20),l=()=>v(-2,i).splice(1,i),e){k(e).date()>t?(a=k().hour(),s="",l=""):k(e).hour()>a?(a=k().hour(),l=""):l=()=>v(-2,i).splice(1,i)}return{disabledHours:s,disabledMinutes:l}},f=x((()=>{const e=[];return u.state.base.commentJsonKeys.INIT_ROLL_LIST.forEach((t=>"classes"!==t.key&&e.push(t.level))),e})),h=j({ratingGroupList:[],selectRatingGroupList:[],isVisible:!1,selectRatingVisible:!1,ratingGroupEcho:"",scoringCycles:ne,scoringMethods:de,yselectTabs:[{tab:"请选择班级",key:2,checked:!0,disabled:f}],ruleObj:{projectName:"",minScore:"",maxScore:""}}),J=j({headerTitle:["","新增","编辑","查看"],visible:!1,drawerVisible:!1,checkedList:[],groupIds:[],groupListOptions:[],uploadLoading:!1,ruleVisible:!1,selectedRowKeys:[],selectedRows:[],medalAllList:[],medalAllObj:{},submitBtnLoading:!1,loading:!1,personList:[],isLook:!1,modalCategoryId:"",oldRuleList:[]}),W=j({cycle:0,promotionalImage:"",groupId:"",time:[],status:0,startTimeLong:"",endTimeLong:"",title:"",description:"",ruleList:[],classList:[],scoringMethod:0,scoringPrize:0,groupObj:{},medalList:[{honorTitle:"",medalUrl:null}],publishSetting:0,publishTimeLong:""});function Q(e){var t,a,i,s;const l=e.target.value;W.medalList=l?[{honorTitle:(null==(t=W.medalList[0])?void 0:t.honorTitle)||"",medalUrl:(null==(a=W.medalList[0])?void 0:a.medalUrl)||null}]:[{honorTitle:(null==(i=W.medalList[0])?void 0:i.honorTitle)||"",medalUrl:(null==(s=W.medalList[0])?void 0:s.medalUrl)||null}]}function X(e,t){J.selectedRowKeys=e,J.selectedRows=function(e){const t={};return e.reduce(((e,a)=>(!t[a.ruleId]&&(t[a.ruleId]=e.push(a)),e)),[])}(J.oldRuleList.concat(t))}const Z=j({promotionalImage:[{required:!0,message:"请上传图片"}],title:[{required:!0,message:"请填写活动标题"}],scoringCycle:[{required:!0,message:"请选择评分周期"}],description:[{required:!0,message:"请填写活动介绍"}],ruleList:[{required:!0,message:"请设置评分规则",validator:(e,t)=>{let a="";for(let i=0;i<t.length;i++){const e=t[i];if(""===e.projectName.replace(/(^\s*)|(\s*$)/g,"")){a="请设置评分项目";break}if(""===e.maxScore||""===e.minScore){a="请设置评分范围";break}}return a?Promise.reject(a):Promise.resolve()}}],classList:[{required:!0,message:"请选择参与对象"}],medalList:[{required:!0,validator:(e,t)=>{let a="";for(let i=0;i<t.length;i++){const e=t[i];if(""===e.honorTitle.replace(/(^\s*)|(\s*$)/g,"")){a="请设置评比奖项";break}if(""===e.url){a="请设置评比奖项";break}}return a?Promise.reject(a):Promise.resolve()}}],scoringMethod:[{required:!0,message:"请选择"}]});let ee=null;const{resetFields:te,validate:ie,validateInfos:ce}=g(W,Z,{onValidate:(...e)=>{}});function ue(){const e=JSON.parse(JSON.stringify(h.ruleObj));W.ruleList=[e]}function Ne(){const e=JSON.parse(JSON.stringify(h.ruleObj));W.ruleList=[...W.ruleList,e]}function Ve(){}function Ge(){if(!(J.selectedRows.length<=100))return t.error("评分规则设置不可超过100条"),!1;J.ruleVisible=!1,W.ruleList=[...J.selectedRows],J.selectedRows=[],J.selectedRowKeys=[]}async function Me(e){const a=e.size/1024/1024<5;return"image/png,image/jpg,image/jpeg".includes(e.type)?a?(ee=e,function(e,t){const a=new FileReader;a.addEventListener("load",(()=>t(a.result))),a.readAsDataURL(e)}(e,(e=>{W.promotionalImage=e})),!1):(t.error("图片大小不超过5M"),!1):(t.error("格式不正确，暂支持image/png,image/jpg,image/jpeg"),!1)}function De(e){J.checkedList=J.groupListOptions.filter((t=>e.includes(t.id))),W.classList=J.checkedList.map((e=>({classId:e.id||e.classId,gradeId:e.pid||e.gradeId})))}function Ye(e){J.groupListOptions=[...e],J.groupIds=e.map((e=>e.id)),W.classList=e.map((e=>({classId:e.id||e.classId,gradeId:e.pid||e.gradeId}))),J.checkedList=[...e]}function ze(){W.medalList.length<=5?W.medalList.push({medalUrl:null,honorTitle:""}):t.warning("最多可添加6项")}function Be(){2===W.scoringMethod&&(J.personList=[],Ke())}function Fe(){ie().then((async()=>{var e,a,l;J.submitBtnLoading=!0;const o=H(W),[r,c]=o.time;o.startTimeLong=null==(e=k(r))?void 0:e.valueOf(),o.endTimeLong=null==(a=k(c))?void 0:a.valueOf(),o.publishTimeLong=null==(l=k(o.publishTimeLong))?void 0:l.valueOf();try{if(ee){const{url:e}=await C(ee,{catalogue:"studentAssessmentActivity"});o.promotionalImage=e}2===s.isEdit?n({...o,personList:J.personList,id:s.id}).then((e=>{t.success(e.message),i("submit")})).finally((()=>{J.submitBtnLoading=!1})):1===s.isEdit&&d({...o,personList:J.personList}).then((e=>{t.success(e.message),i("submit")})).finally((()=>{J.submitBtnLoading=!1}))}catch(u){W.url="",t.error("上传图片出错了"),J.submitBtnLoading=!1}})).catch((e=>{})).finally((()=>{J.submitBtnLoading=!1}))}function Pe(e){return r({...e,pageSize:999,categoryId:J.modalCategoryId})}function qe(e){Pe.update()}function Ae(e){W.groupId=e,h.ratingGroupList.forEach((t=>{t.id===e&&(t.groupName=t.name,h.selectRatingGroupList=[t])}))}function Ke(){c({pageNo:1,pageSize:10}).then((({data:e})=>{h.ratingGroupList=e.list}))}S((()=>W.cycle),(e=>{4===e?(!W.time.length&&(W.time=[]),Z.time=[{required:!0,message:"请选择时间"}]):delete Z.time})),S((()=>W.publishSetting),(e=>{e?Z.publishTimeLong=[{required:!0,message:"请选择发布日期"}]:(delete Z.publishTimeLong,W.publishTimeLong="")}));const $e=()=>{J.medalAllList.forEach((e=>{e.checked=!1,W.medalList.forEach((t=>{`${e.medalUrl}?medalId=${e.medalId}`===t.medalUrl&&(e.checked=!0)}))}))};return F((()=>{l({activityId:s.id}).then((e=>{var t;const a=[];null==(t=e.data)||t.forEach((e=>{a.push(e),J.medalAllObj[e.medalId]=JSON.parse(JSON.stringify(e))})),J.medalAllList=a})),2!==s.isEdit&&3!==s.isEdit||(3===s.isEdit&&(J.isLook=!0),J.loading=!0,o(s.id).then((e=>{var t;const{data:a}=e;for(const i in W)"classList"===i?(J.checkedList=[],J.groupListOptions=[],a[i].forEach((e=>{J.checkedList.push({id:e.classId,name:e.className,classId:e.classId,gradeId:e.gradeId,showName:e.className||e.gradeName}),J.groupListOptions.push({id:e.classId||e.gradeId,showName:e.className||e.gradeName}),J.groupIds=[...J.groupIds,e.classId]})),W[i]=a[i]):"time"===i?$((()=>{W[i]=[k(a.startTimeLong).format("YYYY-MM-DD")||"",k(a.endTimeLong).format("YYYY-MM-DD")||""]})):"publishTimeLong"===i?W[i]=k(a[i]).format("YYYY-MM-DD HH:mm:ss"):"medalList"===i?(W[i]=[],$((()=>{const e=[];W[i]=a[i].map((t=>(e.push(t.medalId),{medalUrl:t.medalUrl+"?medalId="+t.medalId,medalId:t.medalId,honorTitle:t.honorTitle,ranking:t.ranking}))),e.length&&J.medalAllList.forEach((t=>{e.includes(t.medalId)&&(t.checked=!0)}))}))):W[i]=a[i];(null==(t=a.groupObj)?void 0:t.groupId)&&(h.ratingGroupEcho=a.groupObj.groupId,W.groupId=a.groupObj.groupId,$((()=>{h.selectRatingGroupList=[a.groupObj]})))})).finally((()=>{J.loading=!1})),Ke())})),(t,a)=>{const i=U("a-button"),s=U("a-image"),l=U("loading-outlined"),o=U("plus-outlined"),n=U("a-upload"),d=U("a-form-item"),r=U("a-input"),c=U("a-textarea"),u=U("a-input-number"),g=U("a-input-group"),v=U("a-table"),f=U("a-radio"),k=U("a-radio-group"),L=U("a-range-picker"),C=U("a-select"),x=U("a-select-option"),w=U("a-date-picker"),j=U("a-form"),S=U("a-spin"),F=U("a-tooltip"),$=U("a-modal");return R(),E("div",pe,[V("div",me,[O(i,{type:"text",class:"tabs_back",onClick:a[0]||(a[0]=P((e=>t.$emit("back")),["stop"]))},{default:T((()=>[ge])),_:1}),V("span",null,z(J.headerTitle[e.isEdit])+"评比活动",1)]),V("div",ye,[O(S,{spinning:J.loading,tip:"正在获取活动详情..."},{default:T((()=>[O(j,{layout:"vertical",ref_key:"createWarpRef",ref:p},{default:T((()=>[ve,O(d,q({label:"活动宣传图："},G(ce).promotionalImage),{default:T((()=>[O(n,{name:"avatar","list-type":"picture-card",class:"uploader","show-upload-list":!1,action:"/","before-upload":Me,accept:"image/png,image/jpg,image/jpeg",disabled:J.isLook},{default:T((()=>[W.promotionalImage?(R(),M(s,{width:"100%",height:"100%",preview:!1,key:W.promotionalImage,src:W.promotionalImage,class:"animate__animated animate__headShake"},null,8,["src"])):(R(),E("div",be,[J.uploadLoading?(R(),M(l,{key:0})):(R(),M(o,{key:1})),fe]))])),_:1},8,["disabled"])])),_:1},16),O(d,q({label:"活动标题："},G(ce).title),{default:T((()=>[O(r,{disabled:J.isLook,"show-count":"",placeholder:"请输入",maxlength:20,value:W.title,"onUpdate:value":a[1]||(a[1]=e=>W.title=e)},null,8,["disabled","value"])])),_:1},16),O(d,q({label:"活动介绍："},G(ce).description),{default:T((()=>[O(c,{disabled:J.isLook,value:W.description,"onUpdate:value":a[2]||(a[2]=e=>W.description=e),"show-count":"",rows:4,maxlength:300,placeholder:"请输入"},null,8,["disabled","value"])])),_:1},16),ke,O(d,q(G(ce).ruleList,{class:W.ruleList.length||1!=e.isEdit?"":"controlItem"}),{label:T((()=>[N(" 评分项目： "),!J.isLook&&W.ruleList.length<=99?(R(),M(i,{key:0,type:"text",class:"edit_rule",onClick:ue},{default:T((()=>[N(" 设置 ")])),_:1})):B("v-if",!0)])),default:T((()=>[V("div",he,[O(v,{pagination:!1,columns:G(le),bordered:"",size:"small",rowKey:"ruleId","data-source":W.ruleList,style:A({margin:W.ruleList.length?0:"16px 0",marginBottom:"10px"})},{bodyCell:T((({column:e,record:t,index:a})=>["projectName"===e.key?(R(),M(r,{key:0,class:"set-warp-hide",value:t.projectName,"onUpdate:value":e=>t.projectName=e,placeholder:"请输入","show-count":"",maxlength:100,disabled:J.isLook},null,8,["value","onUpdate:value","disabled"])):B("v-if",!0),"ruleDescription"===e.key?(R(),M(g,{key:1,style:{display:"flex"}},{default:T((()=>[O(u,{value:t.minScore,"onUpdate:value":e=>t.minScore=e,placeholder:"请选择",step:.5,disabled:J.isLook,max:t.maxScore?t.maxScore-.5:"",min:-100},null,8,["value","onUpdate:value","disabled","max"]),Le,O(u,{value:t.maxScore,"onUpdate:value":e=>t.maxScore=e,placeholder:"请选择",step:.5,disabled:J.isLook,min:t.minScore,max:100},null,8,["value","onUpdate:value","disabled","min"])])),_:2},1024)):B("v-if",!0),"operation"===e.key?(R(),M(i,{key:2,disabled:J.isLook,type:"link",danger:"",class:"btn btn_danger",onClick:e=>function(e){W.ruleList.splice(e,1)}(a)},{default:T((()=>[N("删除")])),_:2},1032,["disabled","onClick"])):B("v-if",!0)])),_:1},8,["columns","data-source","style"]),J.isLook?B("v-if",!0):(R(),M(i,{key:0,class:"addBtn",type:"primary",ghost:"",onClick:Ne},{icon:T((()=>[O(o)])),default:T((()=>[Ie])),_:1}))])])),_:1},16,["class"]),O(d,q({label:"评分周期：",class:"form-item-flex"},G(ce).scoringCycle),{default:T((()=>[O(k,{value:W.cycle,"onUpdate:value":a[3]||(a[3]=e=>W.cycle=e),name:"scoringCycle",disabled:J.isLook||2==W.status},{default:T((()=>[(R(!0),E(D,null,Y(h.scoringCycles,(e=>(R(),M(f,{key:e.key,value:e.key},{default:T((()=>[N(z(e.value),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value","disabled"]),4===W.cycle?(R(),M(d,K(q({key:0},G(ce).time)),{default:T((()=>[O(L,{disabled:J.isLook||2==W.status,value:W.time,"onUpdate:value":a[4]||(a[4]=e=>W.time=e),"disabled-date":y,valueFormat:"YYYY-MM-DD"},null,8,["disabled","value"])])),_:1},16)):B("v-if",!0)])),_:1},16),O(d,q({label:"参与对象："},G(ce).classList),{default:T((()=>[O(C,{class:"selectInputClass",disabled:J.isLook,value:J.groupIds,"onUpdate:value":a[5]||(a[5]=e=>J.groupIds=e),placeholder:"请选择班级",options:J.groupListOptions,mode:"multiple",open:!1,"field-names":{label:"showName",value:"id"},onChange:De},null,8,["disabled","value","options"]),V("div",_e,[O(G(I),{mode:"depa",tabs:h.yselectTabs,visible:J.visible,"onUpdate:visible":a[6]||(a[6]=e=>J.visible=e),checked:J.checkedList,"onUpdate:checked":a[7]||(a[7]=e=>J.checkedList=e),onHandleOk:Ye},{default:T((()=>[O(i,{disabled:J.isLook,type:"primary",size:"small",class:"yselect-tabs-btn"},{icon:T((()=>[O(o)])),_:1},8,["disabled"])])),_:1},8,["tabs","visible","checked"])])])),_:1},16),O(d,q({label:"评分方式："},G(ce).scoringMethod),{default:T((()=>[O(k,{disabled:J.isLook,value:W.scoringMethod,"onUpdate:value":a[10]||(a[10]=e=>W.scoringMethod=e),onChange:Be,class:"scoring-radio-group"},{default:T((()=>[(R(!0),E(D,null,Y(h.scoringMethods,(e=>(R(),M(f,{value:e.key,key:e.key},{default:T((()=>[N(z(e.value)+" ",1),V("span",Ce,z(e.tips),1)])),_:2},1032,["value"])))),128)),2===W.scoringMethod?(R(),E(D,{key:0},[J.isLook?B("v-if",!0):(R(),M(i,{key:0,type:"link",onClick:a[8]||(a[8]=P((e=>h.selectRatingVisible=!0),["stop"])),style:A({color:J.isLook?"":"#00b781"})},{default:T((()=>[N(" 选择评比组 ")])),_:1},8,["style"])),J.isLook?B("v-if",!0):(R(),M(i,{key:1,type:J.isLook?"text":"link",style:A({color:J.isLook?"":"#00b781"}),onClick:a[9]||(a[9]=P((e=>h.isVisible=!0),["stop"]))},{default:T((()=>[N(" 新增评比组 ")])),_:1},8,["type","style"])),h.selectRatingGroupList.length?(R(),M(v,{key:2,columns:G(re),bordered:"",size:"small",pagination:!1,style:A({color:J.isLook&&"#999"}),"data-source":h.selectRatingGroupList},{bodyCell:T((({column:e,record:t})=>["personList"===e.key?(R(!0),E(D,{key:0},Y(t.personList,((e,t)=>(R(),E("span",{key:t},z(e.personName||e.name)+"   ",1)))),128)):B("v-if",!0)])),_:1},8,["columns","style","data-source"])):B("v-if",!0)],64)):B("v-if",!0)])),_:1},8,["disabled","value"])])),_:1},16),O(d,q({label:"评比奖项设置："},G(ce).medalList),{default:T((()=>[V("div",null,[O(k,{disabled:J.isLook,value:W.scoringPrize,"onUpdate:value":a[11]||(a[11]=e=>W.scoringPrize=e),onChange:Q,style:{"margin-bottom":"16px"}},{default:T((()=>[O(f,{value:0},{default:T((()=>[N("仅1项 "),xe])),_:1}),O(f,{value:1},{default:T((()=>[N(" 多项 "),we])),_:1})])),_:1},8,["disabled","value"]),O(v,{columns:G(oe),bordered:"",size:"small",pagination:!1,"data-source":W.medalList},{bodyCell:T((({column:e,record:t,index:a})=>["medalUrl"===e.key?(R(),M(C,{key:0,value:t.medalUrl,"onUpdate:value":e=>t.medalUrl=e,disabled:J.isLook,style:{width:"100%"},placeholder:"请选择",onChange:$e,"option-label-prop":"children"},{default:T((()=>[(R(!0),E(D,null,Y(J.medalAllList,((e,t)=>(R(),M(x,{class:"table-select-option",key:`${a}_${t}`,disabled:e.checked,value:`${e.medalUrl}?medalId=${e.medalId}`},{default:T((()=>[e.medalUrl?(R(),E("img",{key:0,src:e.medalUrl,alt:"",style:{width:"24px",height:"24px","vertical-align":"middle"}},null,8,je)):B("v-if",!0)])),_:2},1032,["disabled","value"])))),128))])),_:2},1032,["value","onUpdate:value","disabled"])):B("v-if",!0),"honorTitle"===e.key?(R(),M(r,{key:1,disabled:J.isLook||!t.medalUrl,style:{width:"378px"},"show-count":"",placeholder:"请输入",maxlength:20,value:t.honorTitle,"onUpdate:value":e=>t.honorTitle=e},null,8,["disabled","value","onUpdate:value"])):B("v-if",!0),"operation"===e.key?(R(),M(i,{key:2,disabled:J.isLook||W.medalList.length<2,type:"link",danger:"",class:"btn btn_danger",onClick:e=>function(e){J.medalAllList.forEach(((t,a)=>{`${t.medalUrl}?medalId=${t.medalId}`===W.medalList[e].medalUrl&&(t.checked=!1,J.medalAllObj[t.medalId].checked&&J.medalAllList.splice(a,1))})),1!==W.medalList.length&&W.medalList.splice(e,1)}(a)},{default:T((()=>[N("删除")])),_:2},1032,["disabled","onClick"])):B("v-if",!0)])),_:1},8,["columns","data-source"])])])),_:1},16),B("   "),1!==W.scoringPrize||J.isLook?B("v-if",!0):(R(),M(i,{key:0,type:"primary",class:"addBtn",ghost:"",onClick:ze,disabled:J.isLook},{icon:T((()=>[O(o)])),default:T((()=>[Se])),_:1},8,["disabled"])),O(d,q({label:"发布时间：",required:!W.publishSetting},G(ce).publishTimeLong),{default:T((()=>[O(k,{value:W.publishSetting,"onUpdate:value":a[12]||(a[12]=e=>W.publishSetting=e),disabled:J.isLook},{default:T((()=>[O(f,{value:0},{default:T((()=>[N("立即发布")])),_:1}),O(f,{value:1},{default:T((()=>[N("定时发布")])),_:1})])),_:1},8,["value","disabled"]),1==W.publishSetting?(R(),M(w,{key:0,disabled:J.isLook,"show-time":"",value:W.publishTimeLong,"onUpdate:value":a[13]||(a[13]=e=>W.publishTimeLong=e),"disabled-date":y,"disabled-time":b,valueFormat:"YYYY-MM-DD HH:mm:ss"},null,8,["disabled","value"])):B("v-if",!0),B(' :disabledSeconds="disabledRangeTime" ')])),_:1},16,["required"])])),_:1},512)])),_:1},8,["spinning"])]),J.isLook?B("v-if",!0):(R(),E("div",Ue,[V("div",Re,[O(i,{disabled:J.isLook,type:"primary",loading:J.submitBtnLoading,onClick:Fe},{default:T((()=>[N("保 存 ")])),_:1},8,["disabled","loading"])])])),O($,{visible:J.ruleVisible,"onUpdate:visible":a[15]||(a[15]=e=>J.ruleVisible=e),title:"设置评分规则",onOk:Ge,class:"ruleClass",width:"656px",onCancel:Ve},{default:T((()=>[V("div",Ee,[Oe,O(C,{value:J.modalCategoryId,"onUpdate:value":a[14]||(a[14]=e=>J.modalCategoryId=e),style:{width:"148px"},onChange:qe},{default:T((()=>[(R(!0),E(D,null,Y(m.value,((e,t)=>(R(),M(x,{value:e.id,key:t},{default:T((()=>[N(z(e.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])]),O(G(_),{columns:G(le),loadData:Pe,pagination:!1,"row-selection":{selectedRowKeys:J.selectedRowKeys,onChange:X},rowKey:"ruleId"},{bodyCell:T((({column:e,record:t})=>["ruleDescription"===e.key?(R(),M(F,{key:0,placement:"topLeft"},{title:T((()=>[V("span",null,z(t.ruleDescription),1)])),default:T((()=>[V("div",Te,z(t.ruleDescription),1)])),_:2},1024)):B("v-if",!0)])),_:1},8,["columns","row-selection"])])),_:1},8,["visible"]),O(G(ae),{isVisible:h.isVisible,"onUpdate:isVisible":a[16]||(a[16]=e=>h.isVisible=e),onEmitRatingGroup:Ke},null,8,["isVisible"]),O(G(se),{selectRatingVisible:h.selectRatingVisible,"onUpdate:selectRatingVisible":a[17]||(a[17]=e=>h.selectRatingVisible=e),ratingGroupList:h.ratingGroupList,ratingGroupEcho:h.ratingGroupEcho,onRatingGroupObj:Ae},null,8,["selectRatingVisible","ratingGroupList","ratingGroupEcho"])])}}},[["__scopeId","data-v-420c79f8"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/appModel/studentEvaluation/activity/createOrEdit.vue"]]);const Ve={key:0,class:"write_score_theme"},Ge={key:0,class:"write_score_red"},Me={key:1,class:"write_score_theme"};var De=h({__name:"scoringResultsDrawer",props:{isVisible:{type:Boolean,default:!1},activityCycleList:{type:Array,default:()=>[]},identityId:{type:String,default:""},activityId:{type:String,default:""},cycleId:{type:String,default:""}},emits:["update:isVisible","emitRatingGroup"],setup(t,{emit:a}){const i=t,s=j({columns:ce,dataSource:[],optionsWooks:[],wook:"",scoringResultsTitle:"评价结果",visible:!1,scoringResultsLoging:!1,paginations:{pageNo:1,pageSize:10,total:0}}),l=()=>{a("update:isVisible",!1)},o=()=>{const{activityId:e,identityId:t}=i,a={...s.paginations,activityId:e,identityId:t,cycleId:s.wook};u(a).then((({data:e})=>{s.dataSource=e.list}))};return S((()=>i.isVisible),(e=>{s.visible=e,e&&(s.optionsWooks=i.activityCycleList,s.wook=i.cycleId,o())})),(t,a)=>{const i=U("a-select"),n=U("a-drawer");return R(),M(n,{class:"drawer-flex",visible:s.visible,"onUpdate:visible":a[1]||(a[1]=e=>s.visible=e),maskClosable:!1,destroyOnClose:!0,title:s.scoringResultsTitle,width:"520",closable:!0,"footer-style":{textAlign:"center"},onClose:l},{default:T((()=>[O(i,{style:{width:"100%","margin-bottom":"20px"},value:s.wook,"onUpdate:value":a[0]||(a[0]=e=>s.wook=e),options:s.optionsWooks,onChange:o,placeholder:"请选择",fieldNames:{label:"seq",value:"id"}},null,8,["value","options"]),O(G(e),{columns:s.columns,"data-source":s.dataSource,rowSelection:!1,isExpandedRow:!0,rowKeyId:"score"},{bodyCell:T((({column:e,text:t})=>["score"===e.key?(R(),E("span",Ve,z(t),1)):B("v-if",!0)])),expandedRowRender:T((({record:e})=>[V("ul",null,[(R(!0),E(D,null,Y(e.detailList,((e,t)=>(R(),E("li",{class:"detail_item",key:t},[V("span",null,z(t+1)+". "+z(e.projectName),1),e.writeScore<0?(R(),E("span",Ge,z(e.writeScore)+" 分 ",1)):(R(),E("span",Me,z(e.writeScore)+" 分 ",1))])))),128))])])),_:1},8,["columns","data-source"]),B(' <template #footer>\r\n            <a-button style="margin-right: 8px" @click="onClose">\r\n                取消\r\n            </a-button>\r\n        </template> ')])),_:1},8,["visible","title"])}}},[["__scopeId","data-v-752f985a"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/appModel/studentEvaluation/activity/scoringResultsDrawer.vue"]]);const Ye={class:"info_warp"},ze={class:"header"},Be=(e=>(J("data-v-47711fd6"),e=e(),W(),e))((()=>V("i",{class:"iconfont icon-xingzhuangjiehe19"},null,-1))),Fe={style:{margin:"29px 16px"}},Pe=["onClick"];var qe=h(Q({__name:"progressInfo",props:{title:{type:String,default:""},isClass:{type:Boolean,default:!1},activityItem:{type:Object,default:()=>{}}},setup(e){const t=e,{classInfoColumns:a,studentInfoColumns:i}=p(),s=w(),l=j({spinning:!1,title:t.title,scoringId:"",activityId:"",isVisible:!1,gradeId:null,cycleId:null,activityCycle:[],val:1,gradeClassoptions:[],gradeClassList:[],paginations:{pageNo:1,pageSize:10,total:0},dataSource:[]}),o=()=>{const{paginations:e,gradeClassList:a,cycleId:i}=l,s={...e,id:t.activityItem.id,cycleId:i,gradeClassBindList:a};l.spinning=!0,m(s).then((({data:e})=>{const{resultList:{pageNo:t,pageSize:a,total:i,list:s},gradeList:o}=e;l.paginations={pageNo:t,pageSize:a,total:i},l.gradeClassoptions=o,l.dataSource=s})).finally((()=>{l.spinning=!1}))},n=e=>{l.paginations=e,o()},d=()=>{o()},r=()=>{s.value.resetFields(),o()};return F((()=>{o(),(()=>{const e={id:t.activityItem.id};g(e).then((({data:e})=>{l.activityCycle=e}))})()})),(o,c)=>{const u=U("a-button"),p=U("a-cascader"),m=U("a-form-item"),g=U("a-select"),y=U("SearchOutlined"),v=U("a-form");return R(),E("div",Ye,[V("div",ze,[O(u,{type:"text",class:"tabs_back_info",onClick:c[0]||(c[0]=P((e=>o.$emit("back")),["stop"]))},{default:T((()=>[Be])),_:1}),V("span",null,'"'+z(l.title)+'"评比活动详情',1)]),V("div",Fe,[O(v,{class:"warp-form",model:l,layout:"inline",ref_key:"infoRef",ref:s},{default:T((()=>[O(m,{label:"年级班级：",name:"gradeClassList"},{default:T((()=>[O(p,{style:{width:"240px"},allowClear:"",value:l.gradeClassList,"onUpdate:value":c[1]||(c[1]=e=>l.gradeClassList=e),options:l.gradeClassoptions,placeholder:"请选择","change-on-select":e.isClass,fieldNames:{label:"showName",value:"id"}},null,8,["value","options","change-on-select"])])),_:1}),O(m,{label:"活动周期：",name:"cycleId"},{default:T((()=>[O(g,{value:l.cycleId,"onUpdate:value":c[2]||(c[2]=e=>l.cycleId=e),size:"middle",placeholder:"请选择",style:{width:"240px"},options:l.activityCycle,fieldNames:{label:"seq",value:"id"}},null,8,["value","options"])])),_:1}),O(m,null,{default:T((()=>[O(u,{type:"primary",style:{"margin-right":"10px"},onClick:d},{icon:T((()=>[O(y)])),default:T((()=>[N("   查询 ")])),_:1}),O(u,{onClick:r},{default:T((()=>[N(" 重置 ")])),_:1})])),_:1})])),_:1},8,["model"]),O(G(X),{columns:e.isClass?G(a):G(i),paginations:l.paginations,dataSource:l.dataSource,rowKey:"id",spinning:l.spinning,onChange:n},{bodyCell:T((({column:e,record:a})=>["score"===e.key?(R(),E("span",{key:0,onClick:e=>{return i=a,l.scoringId=i.studentId||i.classId,l.activityId=t.activityItem.id,void(l.isVisible=!0);var i},style:{color:"var(--primary-color)",cursor:"pointer"}},z(a.score),9,Pe)):B("v-if",!0)])),_:1},8,["columns","paginations","dataSource","spinning"])]),O(G(De),{isVisible:l.isVisible,"onUpdate:isVisible":c[3]||(c[3]=e=>l.isVisible=e),activityCycleList:l.activityCycle,cycleId:l.cycleId,identityId:l.scoringId,activityId:l.activityId},null,8,["isVisible","activityCycleList","cycleId","identityId","activityId"])])}}}),[["__scopeId","data-v-47711fd6"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/appModel/studentEvaluation/activity/progressInfo.vue"]]);const Ae={key:0,class:"assessment_activity"},Ke={style:{display:"flex","justify-content":"end","margin-bottom":"10px"}},$e={key:1,style:{display:"flex"}},He={class:"btnBox"},Je={key:1,class:"noChange"},We={key:0,class:"btnBox"},Qe={key:1,class:"noChange"},Xe={key:1,class:"btnBox"},Ze={key:1,class:"noChange"},et={class:"btnBox"},tt=["onClick"],at={key:1,class:"noChange"};var it=h({__name:"index",setup(a){const{activityColumns:s}=p(),l=j({status:null,paginations:{pageNo:1,pageSize:10,total:0},dataSource:[],isRenderCreateEdit:!1,isEdit:0,id:"",isProgressInfo:!1,classOrstudent:!1,activityInfoItem:{}});function o(){const{paginations:e,status:t}=l,a={...e,status:t};y(a).then((({data:e})=>{const{list:t,pageNo:a,pageSize:i,total:s}=e;l.paginations={pageNo:a,pageSize:i,total:s},l.dataSource=t}))}function n(){l.isProgressInfo=!1,l.isRenderCreateEdit=!1}function d(){o(),n()}const r=x((()=>{const e=[{text:"待发布",color:"#FDB500"},{text:"已发布",color:"#00C088"},{text:"已撤回",color:"#BFBFBF"},{text:"已结束",color:"#595959"}];return t=>e[t]}));function c(e,t){l.isRenderCreateEdit=!0,l.isEdit=e,l.id=t}const u=e=>{const{total:t,pageSize:a,current:i,status:s}=e;l.paginations={total:t,pageSize:a,pageNo:i},s&&(l.status=s[0]),o()};return F((()=>{o()})),(a,p)=>{const m=U("plus-outlined"),g=U("a-button"),y=U("a-badge"),k=e;return R(),E("div",null,[l.isRenderCreateEdit||l.isProgressInfo?B("v-if",!0):(R(),E("div",Ae,[O(k,{columns:G(s),totals:l.paginations,dataSource:l.dataSource,rowKey:"id",rowSelection:!1,onOnSelectedRowKeys:u},{handleItem:T((()=>[V("div",Ke,[O(g,{type:"primary",style:{"margin-left":"12px"},onClick:p[0]||(p[0]=e=>c(1))},{icon:T((()=>[O(m)])),default:T((()=>[N(" 新增评比活动 ")])),_:1})])])),bodyCell:T((({column:e,record:a})=>["status"===e.key?(R(),M(y,{key:0,color:r.value(a.status).color,status:"success",text:r.value(a.status).text},null,8,["color","text"])):B("v-if",!0),"operation"===e.key?(R(),E("div",$e,[O(g,{type:"link",class:"btn",onClick:e=>c(3,a.id)},{default:T((()=>[N("查看")])),_:2},1032,["onClick"]),V("div",He,[0!=a.status?(R(),M(g,{key:0,type:"link",class:"btn",onClick:e=>{return t=a,l.activityInfoItem=t,l.classOrstudent=2===t.type,void(l.isProgressInfo=!0);var t}},{default:T((()=>[N("活动详情")])),_:2},1032,["onClick"])):(R(),E("span",Je,"活动详情"))]),0==a.status||2==a.status?(R(),E("div",We,[0==a.status?(R(),M(g,{key:0,type:"link",class:"btn",onClick:e=>{return i=a.id,void f({id:i}).then((e=>{t.success(e.message),o()}));var i}},{default:T((()=>[N("发布")])),_:2},1032,["onClick"])):(R(),E("span",Qe,"发布"))])):(R(),E("div",Xe,[1==a.status?(R(),M(g,{key:0,type:"link",class:"btn",onClick:e=>{return i=a.id,void b({id:i}).then((e=>{t.success(e.message),o()}));var i}},{default:T((()=>[N("撤回")])),_:2},1032,["onClick"])):(R(),E("span",Ze,"撤回 "))])),V("div",et,[0==a.status||2==a.status?(R(),E("a",{key:0,type:"link",onClick:e=>c(2,a.id),class:"btn"},"编辑 ",8,tt)):(R(),E("span",at,"编辑 "))]),O(g,{style:{"margin-left":"8px"},type:"link",danger:"",onClick:e=>{return s=a.id,void i.confirm({title:"确定删除吗",icon:O(Z),okText:"确定",okType:"danger",cancelText:"取消",onOk(){v([s]).then((e=>{t.success(e.message),o()}))},onCancel(){}});var s},class:"btn btn_danger"},{default:T((()=>[N("删除")])),_:2},1032,["onClick"])])):B("v-if",!0)])),_:1},8,["columns","totals","dataSource"])])),l.isRenderCreateEdit&&!l.isProgressInfo?(R(),M(G(Ne),{key:1,isEdit:l.isEdit,id:l.id,onBack:n,onSubmit:d},null,8,["isEdit","id"])):B("v-if",!0),!l.isRenderCreateEdit&&l.isProgressInfo?(R(),M(G(qe),{key:2,onBack:n,isClass:l.classOrstudent,activityItem:l.activityInfoItem,title:l.activityInfoItem.title},null,8,["isClass","activityItem","title"])):B("v-if",!0)])}}},[["__scopeId","data-v-47f41cf2"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/views/appModel/studentEvaluation/activity/index.vue"]]);export{it as default};
