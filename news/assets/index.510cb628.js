import{u as e,_ as l,n as t}from"./index.7061e8ea.js";import"./vue.a2f518ee.js";import{e as s,r as c,q as a,y as o,t as d,m as r,b8 as n,o as i,a2 as u,a3 as h,a7 as S,c as m,a4 as P,a as p,F as k,a8 as y,b as v,O as g,a9 as f}from"./@vue.919ff404.js";const b=s({name:"SelectSource",props:{modalConfirmLoading:{type:Boolean,default:!1},isJob:{type:Boolean,default:!1}},emits:["callbackParameter"],components:{},setup(l,{emit:s}){const{proxy:n}=r(),i=e(),u=c(["1458257624041546325"]),h=c([]),S=c([]),m=c({}),P=c("teacher"),p=c({children:"children",title:"name",key:"id"}),k=a({sourceSearch:"",tableDataSource:[],selectedRowKeys:[],tableColumns:[{title:"姓名",dataIndex:"name"},{title:"teacher"===P.value?"部门":"班级",dataIndex:"showName"}],selectedPool:{selectedPoolSelectedSet:[]},isSourceSearch:!0,selectCheckAll:!1,selectIndeterminate:!1,selectedDataSet:[]}),y=e=>{const{emp_status_yes_id:s}=i.state.selectSource.dictionary,c={pageNo:1,pageSize:100,[""!==k.sourceSearch?"name":"deptId"]:e};return l.isJob&&(c.statusList=s),new Promise(((e,l)=>{n.$defHttp.post(t.facultyList,c).then((l=>{const{data:t}=l;e(t.list)})).catch((e=>{}))}))},v=(e,l)=>{const s={[k.sourceSearch?"name":"classesId"]:e};return new Promise(((e,c)=>{n.$defHttp.post(t.studentlistSearch,s).then((t=>{const{data:s}=t;e(s),l&&s.forEach((e=>{e.children=e.elterns,l.push(e)}))})).catch((e=>{}))}))},g=()=>{f(),k.sourceSearch="",k.isSourceSearch=!0;i.commit("selectSource/GET_USER_INFOS",{modalVisible:!1})},f=()=>{if(!n.isSourceSearch)return n.selectedPool.selectedPoolSelectedSet=[],void(k.selectedRowKeys=[]);n.selectSourceParams.tabsTexts.forEach((e=>{n.selectedPool[`selestChecked${e.key}`]=[]})),n.selectedPool.selectedPoolSelectedSet=[],n.selectedPool[`selestIndeterminate${P.value}`]=!1,n.selectedPool[`selestcheckAll${P.value}`]=!1},b=(e,l)=>{const t={},s=[];return e.forEach((e=>{t[e[l]]||(t[e[l]]=e,s.push(e))})),s},C=(e,l,t)=>{e.forEach((e=>{if(e.name.includes(l)){const l=JSON.parse(JSON.stringify(e));delete l.children,t.push(l)}e.children.length&&C(e.children,l,t)}))},$=(e,l)=>{const t=[];e&&e.length&&l.length&&e.forEach((e=>{l.some((l=>{if(l.id==e.id)return l=e,e}))&&t.push(e)})),t.length?(n.selectedPool[`selestIndeterminate${P.value}`]=t.length!==e.length,n.selectedPool[`selestcheckAll${P.value}`]=t.length==e.length):(n.selectedPool[`selestcheckAll${P.value}`]=!1,n.selectedPool[`selestIndeterminate${P.value}`]=!1),k.isSourceSearch?n.selectedPool[`selestChecked${P.value}`]=t:k.selectedRowKeys=t},K=o((()=>(k.selectedPool.selectedPoolSelectedSet=i.state.selectSource.selectSourceObj.selectedPoolSelectedSet,i.state.selectSource.modalVisible))),x=o((()=>{const{tabsTexts:e}=i.state.selectSource.selectSourceObj;return e&&e.length&&(P.value=e[0].key,e.map((e=>{n.selectedPool[`selestList${e.key}`]=[],n.selectedPool[`selestChecked${e.key}`]=[],n.selectedPool[`selestcheckAll${e.key}`]=!1,n.selectedPool[`selestIndeterminate${e.key}`]=!1}))),i.state.selectSource.selectSourceObj}));return{activeKey:P,fieldNames:p,modalVisible:K,handerCancel:g,selectedItmes:m,selectedKeys:h,handerTabClick:e=>{k.sourceSearch="",k.tableDataSource=[],k.selectedRowKeys=[],P.value=e.key,p.value.title="student"===e.key?"showName":"name",k.tableColumns[1].title="student"===e.key?"班级":"部门",e.states?n.selectSourceParams.checkPeople=!1:n.selectSourceParams.checkPeople=!0},expandedKeys:u,clickSelect:async(e,l)=>{h.value=[l.node.id],m.value=l.node;let t=l.node.children;if(n.selectSourceParams.checkPeople||t.length){if(n.selectSourceParams.checkPeople)if("teacher"===P.value)t=await y(e[0]);else if(n.selectSourceParams.isParent)t=[],4!=l.node.type||l.node.children.length||await v(e[0],l.node.children),!l.node.type&&(t=l.node.children);else{if(t=[],4!=l.node.type)return;t=await v(e[0])}n.selectedPool[`selestList${P.value}`]=t,$(t,n.selectedPool.selectedPoolSelectedSet)}},onSourceSearch:async e=>{const l=n.selectSourceParams[`treeData_${P.value}`],t=[];if(k.tableDataSource=[],n.selectSourceParams.checkPeople){if(k.isSourceSearch=!e,!m.value.id){const e=n.selectSourceParams[`treeData_${P.value}`][0];m.value=e}"teacher"===P.value?k.tableDataSource=await y(k.sourceSearch):k.tableDataSource=await v(k.sourceSearch)}else C(l,e,t),n.selectedPool[`selestList${P.value}`]=t;$(k.tableDataSource,n.selectedPool.selectedPoolSelectedSet)},onCheckAllChange:e=>{const l=n.selectedPool[`selestcheckAll${P.value}`]?n.selectedPool[`selestList${P.value}`]:[];n.selectedPool[`selestChecked${P.value}`]=l,n.selectedPool.selectedPoolSelectedSet=l,n.selectedPool[`selestIndeterminate${P.value}`]=!1},handerClearSearch:()=>{k.sourceSearch="",k.isSourceSearch=!0,n.selectSourceParams.checkPeople?k.tableDataSource=[]:n.selectedPool[`selestList${P.value}`]=[]},handerChangeItem:(e,l)=>{n.selectSourceParams.singleChoice?(e=e.length?[e[e.length-1]]:e,n.selectedPool.selectedPoolSelectedSet=[],n.selectedPool[`selestChecked${P.value}`]=e):(n.selectedPool[`selestIndeterminate${P.value}`]=!!e.length&&e.length<n.selectedPool[`selestList${P.value}`].length,n.selectedPool[`selestcheckAll${P.value}`]=e.length===n.selectedPool[`selestList${P.value}`].length);const t=[];n.selectSourceParams.tabsTexts.forEach((e=>{t.push(...k.selectedPool.selectedPoolSelectedSet,...k.selectedPool[`selestChecked${e.key}`])}));const s=b(t,"id");if(n.selectSourceParams.checkPeople&&n.selectSourceParams.isNum&&s.length>n.selectSourceParams.isNum){const e=[];return s.forEach(((l,t)=>{t<n.selectSourceParams.isNum&&e.push(l)})),k.selectedPool.selectedPoolSelectedSet=e,k.selectedPool[`selestChecked${P.value}`]=e,void n.$message.warning(`最多只能选${n.selectSourceParams.isNum}个`)}k.selectedPool.selectedPoolSelectedSet=s},selectSourceParams:x,handerSourceSubmit:()=>{n.selectedPool.selectedPoolSelectedSet.length&&(s("callbackParameter",k.selectedPool.selectedPoolSelectedSet),g())},handerSelectedDel:e=>{const l=[];if(!n.isSourceSearch)return n.selectedPool.selectedPoolSelectedSet.forEach((t=>{t.id!==e&&l.push(t)})),k.selectedRowKeys=l,void(n.selectedPool.selectedPoolSelectedSet=l);n.selectedPool[`selestChecked${P.value}`].forEach((t=>{t.id!==e&&l.push(t)})),n.selectedPool[`selestIndeterminate${P.value}`]=!0,n.selectedPool[`selestcheckAll${P.value}`]=!1,n.selectedPool[`selestChecked${P.value}`]=l,n.selectedPool.selectedPoolSelectedSet=[...l],k.selectedPool[`selestIndeterminate${P.value}`]=k.selectedPool.selectedPoolSelectedSet.length>0},onSelectChange:e=>{k.selectedRowKeys=e,k.selectedPool[`selestChecked${P.value}`]=e;const l=[];n.selectSourceParams.tabsTexts.forEach((e=>{l.push(...k.selectedPool[`selestChecked${e.key}`])})),n.selectedPool.selectedPoolSelectedSet=b(l,"id")},...d(k),onCheckSelectAllChange:f,olSelectedPoolSelectedSet:S,clickCheckWarp:({id:e})=>{const l=[];k.selectedPool.selectedPoolSelectedSet.forEach((t=>{t.id!==e&&l.push(t)})),k.selectedPool.selectedPoolSelectedSet=l}}}}),C={class:"source-modal-search"},$={key:0,class:"check-all",style:{padding:"6px 15px"}},K={class:"check-all-num"},x={class:"check-all-num"},w=["onClick"],_={class:"check-all-num"};var I=l(b,[["render",function(e,l,t,s,c,a){const o=n("a-tab-pane"),d=n("a-tabs"),r=n("a-input-search"),b=n("a-button"),I=n("a-table"),N=n("team-outlined"),D=n("a-tree"),A=n("a-empty"),L=n("a-col"),T=n("a-checkbox"),E=n("a-checkbox-group"),O=n("a-row"),R=n("close-outlined"),U=n("a-modal");return i(),u(U,{class:"source-modal",width:"1000px",visible:e.modalVisible,"onUpdate:visible":l[7]||(l[7]=l=>e.modalVisible=l),maskClosable:!1,"confirm-loading":e.modalConfirmLoading,onCancel:e.handerCancel,onOk:e.handerSourceSubmit},{default:h((()=>[S(' v-model:activeKey="activeKey" '),m(d,{class:P(["source-modal-top",{"source-modal-tops":e.selectSourceParams.tabsTexts.length>1,"source-modal-reset":e.selectSourceParams.tabsTexts.length<2}]),size:"large",type:e.selectSourceParams.tabsTexts.length>1?"card":"line",onTabClick:e.handerTabClick},{default:h((()=>[(i(!0),p(k,null,y(e.selectSourceParams.tabsTexts,(e=>(i(),u(o,{key:e,tab:e.tab},null,8,["tab"])))),128))])),_:1},8,["class","type","onTabClick"]),m(O,{class:"source-modal-content"},{default:h((()=>[m(L,{class:"source-modal-col",span:16},{default:h((()=>[S(" 搜索框 "),v("div",C,[m(r,{value:e.sourceSearch,"onUpdate:value":l[0]||(l[0]=l=>e.sourceSearch=l),placeholder:"请输入关键字","enter-button":"",onSearch:e.onSourceSearch},null,8,["value","onSearch"]),e.sourceSearch?(i(),u(b,{key:0,class:"clear-search",type:"link",onClick:e.handerClearSearch},{default:h((()=>[g("取消 ")])),_:1},8,["onClick"])):S("v-if",!0)]),S(" 搜索后的table表格 "),e.isSourceSearch?(i(),u(O,{key:1,class:"source-modal-col-row"},{default:h((()=>[m(L,{class:"source-modal-col-row-col",style:{padding:"0"},span:12},{default:h((()=>[S(" 左侧的tree树 "),m(D,{expandedKeys:e.selectSourceParams.defaultExpand,"onUpdate:expandedKeys":l[1]||(l[1]=l=>e.selectSourceParams.defaultExpand=l),selectedKeys:e.selectedKeys,"onUpdate:selectedKeys":l[2]||(l[2]=l=>e.selectedKeys=l),"tree-data":e.selectSourceParams[`treeData_${e.activeKey}`],blockNode:"",fieldNames:e.fieldNames,selectable:!0,onSelect:e.clickSelect},{title:h((({dataRef:l})=>[m(N,{class:"icon-yellow"}),g(" "+f("student"==e.activeKey?l.name||l.showName:l.name),1)])),_:1},8,["expandedKeys","selectedKeys","tree-data","fieldNames","onSelect"]),e.selectSourceParams[`treeData_${e.activeKey}`].length?S("v-if",!0):(i(),u(A,{key:0,image:"/image/empty.png","image-style":{marginTop:"114px",height:"120px"}}))])),_:1}),S(" 中间的被选池 "),m(L,{span:12,class:"source-modal-col-row-col",style:{padding:"0",border:"none"}},{default:h((()=>[e.selectSourceParams.singleChoice?(i(),p("p",$,[g(" 全选 "),v("span",K," 共"+f(e.selectedPool[`selestList${e.activeKey}`].length)+" "+f(e.selectSourceParams.checkPeople?"人":"组"),1)])):(i(),u(T,{key:1,class:"check-all",checked:e.selectedPool[`selestcheckAll${e.activeKey}`],"onUpdate:checked":l[3]||(l[3]=l=>e.selectedPool[`selestcheckAll${e.activeKey}`]=l),disabled:e.selectSourceParams.isNum||!e.selectedPool[`selestList${e.activeKey}`].length,indeterminate:e.selectedPool[`selestIndeterminate${e.activeKey}`],onChange:e.onCheckAllChange},{default:h((()=>[g(" 全选 "),v("span",x," 共"+f(e.selectedPool[`selestList${e.activeKey}`].length)+f(e.selectSourceParams.checkPeople?"人":"组"),1)])),_:1},8,["checked","disabled","indeterminate","onChange"])),m(E,{value:e.selectedPool[`selestChecked${e.activeKey}`],"onUpdate:value":l[4]||(l[4]=l=>e.selectedPool[`selestChecked${e.activeKey}`]=l),onChange:e.handerChangeItem},{default:h((()=>[(i(!0),p(k,null,y(e.selectedPool[`selestList${e.activeKey}`],(l=>(i(),p("div",{class:"customize-checkbox-group",key:l.id,onClick:t=>e.clickCheckWarp(l)},[m(N,{class:"icon-yellow"}),m(T,{value:l,disabled:!(!e.selectSourceParams.optionalClass||"{}"===JSON.stringify(e.selectSourceParams.optionalClass))&&e.selectSourceParams.optionalClass.value.includes(l[e.selectSourceParams.optionalClass.key])},{default:h((()=>[g(f("student"==e.activeKey&&l.showName||l.name),1)])),_:2},1032,["value","disabled"])],8,w)))),128))])),_:1},8,["value","onChange"]),e.selectedPool[`selestList${e.activeKey}`].length?S("v-if",!0):(i(),u(A,{key:2,image:"/image//empty.png","image-style":{marginTop:"86px",height:"120px"}}))])),_:1})])),_:1})):(i(),u(I,{key:0,rowKey:e=>e,columns:e.tableColumns,dataSource:e.tableDataSource,"row-selection":{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange,type:1==e.selectSourceParams.isNum?"radio":"checkbox "}},null,8,["rowKey","columns","dataSource","row-selection"]))])),_:1}),S(" 右侧的已选池 "),m(L,{span:8,class:"source-modal-ovh"},{default:h((()=>[m(T,{class:"check-all select-check-all",checked:e.selectCheckAll,"onUpdate:checked":l[5]||(l[5]=l=>e.selectCheckAll=l),disabled:!e.selectedPool.selectedPoolSelectedSet.length,indeterminate:e.selectIndeterminate,onChange:e.onCheckSelectAllChange},{default:h((()=>[g(" 已选 "),v("span",_," 共"+f(e.selectedPool.selectedPoolSelectedSet.length)+f(e.selectSourceParams.checkPeople?"人":"组"),1),m(b,{class:"clear-all",type:"link"},{default:h((()=>[g("清空")])),_:1})])),_:1},8,["checked","disabled","indeterminate","onChange"]),m(E,{value:e.selectedDataSet,"onUpdate:value":l[6]||(l[6]=l=>e.selectedDataSet=l)},{default:h((()=>[(i(!0),p(k,null,y(e.selectedPool.selectedPoolSelectedSet,(l=>(i(),p("div",{class:"customize-checkbox-group customize-checkbox-select-group",key:e.selectSourceParams.isParent?l.studentId:l.id},[m(N,{class:"icon-yellow"}),m(T,{value:l},{default:h((()=>[g(f("student"==e.activeKey&&l.showName||l.name),1)])),_:2},1032,["value"]),m(R,{class:"close-outlined",onClick:t=>e.handerSelectedDel(e.selectSourceParams.isParent?l.studentId:l.id)},null,8,["onClick"])])))),128))])),_:1},8,["value"]),e.selectedPool.selectedPoolSelectedSet.length?S("v-if",!0):(i(),u(A,{key:0,image:"/image/empty.png","image-style":{marginTop:"152px",height:"120px"}}))])),_:1})])),_:1})])),_:1},8,["visible","confirm-loading","onCancel","onOk"])}],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/components/SelectSource/index.vue"]]);export{I as S};
