import"./vue.a2f518ee.js";import{_ as a,az as e,n as l,ay as t,aA as n,aB as i,aC as s}from"./index.7061e8ea.js";import"./ant-design-vue.db4d48e3.js";import{e as o,Q as r,q as d,y as c,f as p,b8 as u,o as m,a2 as v,a3 as _,a7 as f,c as g,O as b,H as y,L as h,b as k,A as C,a as x,F as L,a9 as w,a8 as D,b5 as I,b4 as S}from"./@vue.919ff404.js";const T=a=>(I("data-v-2327072c"),a=a(),S(),a),j={class:"data-import_body"},O={class:"data-import_base__info"},$=T((()=>k("h5",{class:"dibi_title"},"填写导入数据信息",-1))),E=T((()=>k("p",{class:"dibi_hint"}," 请按照数据模板的格式准备导入数据，模板中的表头名称不可更改，表头行不能删除 ",-1))),z={class:"data-export_base__info"},A=T((()=>k("h5",{class:"dibi_title"},"填写导入数据信息",-1))),B=T((()=>k("p",{class:"dibi_hint"}," 请按照数据模板的格式准备导入数据，模板中的表头名称不可更改，表头行不能删除 ",-1))),F={key:0,class:"tip"},M=T((()=>k("p",{class:"help"}," 导入过程中如发现相同数据，则新数据将覆盖掉现有数据 ",-1))),U={class:"data-import_abnormal"},q={key:0,class:"error-download"},H={class:"abnormal_data__num"},N={class:"abnormal_data__numtext"},P={class:"abnormal_data__successnum"},Q={key:0,class:"abnormal_data__numtext"},V={class:"abnormal_data__errornum"},G={key:1,class:"abnormal_data__list"},J=T((()=>k("div",{class:"dia-adl_title"},"异常提示：",-1))),K={class:"dia-adl_list"},R={class:"data-import_loading"},W=T((()=>k("p",{class:"dil_hint"},"正在导入数据",-1))),X={class:"data-import_success"},Y=T((()=>k("h3",{class:"dis_title",style:{margin:"0"}},"数据导入失败",-1))),Z={class:"dis_hint__danger"},aa={class:"abnormal_data__list",style:{"text-align":"left","margin-top":"10px"}},ea=T((()=>k("div",{class:"dia-adl_title"},"异常提示：",-1))),la={class:"dia-adl_list"},ta=T((()=>k("h3",{class:"dis_title"},"数据导入完成",-1))),na={class:"dis_hint"},ia={class:"dis_hint__success"},sa={class:"dis_hint__danger"};var oa=a(o({__name:"index",props:{action:{type:Object,default:()=>{}},accept:{type:String,default:null},semesterId:{type:String,default:()=>{}},helpText:{type:Boolean,default:!0}},emits:["emitCallback"],setup(a,{expose:o,emit:I}){const S=a,T=r(!1),oa=r(!1),ra=r(!1),da=r(0),ca=r(0),pa=r([]),ua=r([]),ma=r({successCount:0,errorCount:0,errorMsg:[],id:""}),va=d({btnLoading:!1,importID:"",tip:"数据导入中...",spinning:!1,uploadSpinning:!1,time:null,percentLen:0,modalConfirmLoading:!1,modalTitle:"数据导入"}),_a=c((()=>S.accept)),fa=()=>{const{download:a,importType:l,params:t={}}=S.action;va.btnLoading=!0,l?e(a,t,"场地导入模版",S.action.importType).then((()=>{va.btnLoading=!1})):(window.location.href=`${a}?t=${Date.now()}`,va.btnLoading=!1)},ga=(a,e)=>{va.spinning=!a.schedule,100!==a.schedule?(va.percentLen=a.schedule,va.time=setTimeout((()=>{ba(e)}),1e3)):(va.percentLen=a.schedule,ma.value=a,clearInterval(va.time))},ba=a=>{da.value=1,S.action.progress?i(S.action.progress,{importId:a}).then((e=>{const{data:l}=e;ga(l,a)})).catch((()=>{})):s(`${l.uploadProgress}/${a}`).then((e=>{const{data:l}=e;ga(l,a)})).catch((()=>{}))},ya=()=>{pa.value=[],ua.value=[],da.value=0,va.uploadSpinning=!1,clearInterval(va.time)},ha=a=>(pa.value=[...pa.value,a],!1),ka=()=>{if(S.action.importErrorLog){const a={importId:va.importID,importType:1};e(S.action.importErrorLog,a,"学籍异常数据")}else{const a=`${l.exportErrorData}/${va.importID}`;t(a,{},`${S.action.errorName}异常数据`)}},Ca=({file:a,fileList:e})=>{const l=e.slice(-1);ua.value=l,xa()},xa=async()=>{const a=new FormData;ua.value.forEach((e=>{a.append("file",e.originFileObj)})),oa.value=!0,va.uploadSpinning=!0,S.action.importType&&a.append("importType",S.action.importType),n(S.action.upload,a).then((a=>{const{data:e}=a;ra.value=!1,ma.value=e,da.value=1,ba(e),va.importID=e})).catch((()=>{pa.value=[],ua.value=[]})).finally((()=>{va.uploadSpinning=!1,oa.value=!1}))},La=()=>{clearInterval(va.time),da.value=0,1===da.value&&I("emitCallback"),ya(),ua.value=[],pa.value=[],T.value=!1,I("emitCallback")};o({modalVisible:T});const wa=c((()=>(va.uploadSpinning=!1,a=>da.value===a)));return p((()=>{da.value=0})),(e,l)=>{const t=u("DownloadOutlined"),n=u("a-button"),i=u("UploadOutlined"),s=u("a-upload"),o=u("a-spin"),r=u("exclamation-circle-filled"),d=u("a-progress"),c=u("close-circle-outlined"),p=u("check-circle-filled"),I=u("a-modal");return m(),v(I,{width:800,visible:T.value,"onUpdate:visible":l[0]||(l[0]=a=>T.value=a),maskClosable:!1,title:va.modalTitle,"confirm-loading":va.modalConfirmLoading,onOk:La,onCancel:La},{footer:_((()=>[f(" <a-button key=\"back\" :type=\"bodyStatus !== 3 ? '' : 'primary'\" @click=\"handleOk\">{{ bodyStatus !== 3 ? '关闭'\r\n                : '确定' }}</a-button> "),g(n,{key:"back",type:3!==da.value?"":"primary",onClick:La},{default:_((()=>[b("关闭")])),_:1},8,["type"]),y(g(n,{onClick:ya},{default:_((()=>[b("重新上传")])),_:1},512),[[h,wa.value(1)]]),f(' <a-button\r\n                type="primary"\r\n                :disabled="!importData.successCount"\r\n                @click="handleImportData"\r\n                :loading="loading"\r\n                v-show="showCurrentDom(1)"\r\n                >继续导入</a-button\r\n            > '),f(' <a-button key="submit" type="primary" :loading="loading" @click="handleAmportExport"\r\n                v-show="showCurrentDom(0)">下一步</a-button> ')])),default:_((()=>[y(k("div",j,[g(C,{name:"fade-in-linear"},{default:_((()=>[k("div",O,[$,E,k("a",{href:"javascript:0;",download:"",onClick:fa},[g(n,{loading:va.btnLoading},{icon:_((()=>[g(t,{class:"icon-color"})])),default:_((()=>[b(" 下载文件 ")])),_:1},8,["loading"])])])])),_:1}),g(C,{name:"fade-in-linear"},{default:_((()=>[k("div",z,[A,B,g(o,{spinning:va.uploadSpinning},{default:_((()=>[g(s,{accept:_a.value,ref:"uploads",multiple:!1,"before-upload":ha,"auto-upload":!1,"file-list":pa.value,limit:1,onChange:Ca},{default:_((()=>[g(n,null,{icon:_((()=>[g(i,{class:"icon-color"})])),default:_((()=>[b(" 上传文件 ")])),_:1})])),_:1},8,["accept","file-list"])])),_:1},8,["spinning"])])])),_:1}),!0===a.helpText?(m(),x("div",F,[k("p",null,[g(r,{style:{"margin-right":"10px",color:"#faad14"}}),b("特别提示 ")]),M])):f("v-if",!0)],512),[[h,wa.value(0)]]),g(C,{name:"el-fade-in-linear",persisted:""},{default:_((()=>[y(k("div",U,[g(o,{class:"mg20",tip:va.tip,spinning:va.spinning},{default:_((()=>[va.percentLen&&va.percentLen<100?(m(),v(d,{key:0,class:"mg20",percent:va.percentLen,status:"active"},null,8,["percent"])):f("v-if",!0),100==va.percentLen?(m(),x(L,{key:1},[f(' <div class="abnor/mal_hint" v-if="importData.errorCount">\r\n                            <exclamation-circle-filled\r\n                                style="margin-right: 10px; color: #faad14"\r\n                            />\r\n                            <span>继续导入将忽略异常数据</span>\r\n                        </div> '),ma.value.errorCount?(m(),x("div",q,[g(n,{type:"link",onClick:ka},{default:_((()=>[b("下载异常数据")])),_:1})])):f("v-if",!0),k("div",H,[k("div",N,[b(" 正常数据条数: "),k("span",P,w(ma.value.successCount),1),b("条 ")]),ma.value.errorCount?(m(),x("div",Q,[b(" 异常数据条数: "),k("span",V,w(ma.value.errorCount),1),b("条 ")])):f("v-if",!0)]),ma.value.errorCount?(m(),x("div",G,[J,k("ul",K,[(m(!0),x(L,null,D(ma.value.errorMsg,((a,e)=>(m(),x("li",{key:e},w(a),1)))),128))])])):f("v-if",!0)],64)):f("v-if",!0)])),_:1},8,["tip","spinning"])],512),[[h,wa.value(1)]])])),_:1}),g(C,{name:"el-fade-in-linear",persisted:""},{default:_((()=>[y(k("div",R,[k("div",null,[k("span",null,w(ca.value)+"%",1),g(d,{class:"dil_progress",percentage:ca.value,color:"#00B781","show-text":!1,"stroke-width":10},null,8,["percentage"]),W])],512),[[h,wa.value(2)]])])),_:1}),g(C,{name:"el-fade-in-linear",persisted:""},{default:_((()=>[y(k("div",X,[ma.value.errorCount?(m(),x(L,{key:0},[g(c,{style:{color:"red","font-size":"40px"}}),Y,k("p",null,[b(" 未导入 "),k("span",Z,w(ma.value.errorCount),1),b("条数据 ")]),k("div",aa,[ea,k("ul",la,[(m(!0),x(L,null,D(ma.value.errorMsg,((a,e)=>(m(),x("li",{key:e},w(a),1)))),128))])])],64)):(m(),x(L,{key:1},[g(p,{style:{"margin-right":"10px",color:"var(--primary-color)","font-size":"40px"}}),ta,k("p",na,[b(" 您已成功导入 "),k("span",ia,w(ma.value.successCount),1),b("条数据，未导入 "),k("span",sa,w(ma.value.errorCount),1),b("条数据 ")])],64))],512),[[h,wa.value(3)]])])),_:1})])),_:1},8,["visible","title","confirm-loading"])}}}),[["__scopeId","data-v-2327072c"],["__file","C:/Users/66406/Desktop/ydproject/cloudSystem3.0/cloud-system-2.0/src/components/ImportExport/index.vue"]]);export{oa as I};
