"use strict";var h=Object.defineProperty;var p=(o,e,i)=>e in o?h(o,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[e]=i;var a=(o,e,i)=>(p(o,typeof e!="symbol"?e+"":e,i),i);var n=require("electron"),u=require("path");const w={id:null,title:"",width:null,height:null,minWidth:null,minHeight:null,route:"",resizable:!0,maximize:!1,backgroundColor:"#eee",data:null,isMultiWindow:!1,isMainWin:!1,parentId:null,modal:!1};class m{constructor(){a(this,"main");a(this,"group");a(this,"tray");this.main=null,this.group={},this.tray=null}winOpts(e=[]){return{width:e[0],height:e[1],backgroundColor:"#f7f8fc",autoHideMenuBar:!0,resizable:!0,minimizable:!0,maximizable:!0,frame:!0,show:!1,minWidth:0,minHeight:0,modal:!0,webPreferences:{contextIsolation:!1,nodeIntegration:!0,webSecurity:!1,preload:u.resolve(__dirname,"../electron-preload/index.ts")}}}getWindow(e){return n.BrowserWindow.fromId(e)}createWindows(e){let i=Object.assign({},w,e);for(let s in this.group)if(this.getWindow(Number(s))&&this.group[s].route===i.route&&!this.group[s].isMultiWindow){this.getWindow(Number(s)).focus();return}let t=this.winOpts([i.width||1e3,i.height||900]);i.parentId?t.parent=this.getWindow(i.parentId):this.main&&window.console.log(666),t.modal=i.modal,t.resizable=i.resizable,i.backgroundColor&&(t.backgroundColor=i.backgroundColor),i.minWidth&&(t.minWidth=i.minWidth),i.minHeight&&(t.minHeight=i.minHeight);let r=new n.BrowserWindow(t);r.webContents.openDevTools(),this.group[r.id]={route:i.route,isMultiWindow:i.isMultiWindow},i.maximize&&i.resizable&&r.maximize(),i.isMainWin&&(this.main&&(delete this.group[this.main.id],this.main.close()),this.main=r),i.id=r.id,r.on("close",()=>r.setOpacity(0));let l;n.app.isPackaged?l=i.route?`app://./index.html${i.route}`:"app://./index.html":l=i.route?`http://${process.env.VITE_DEV_SERVER_HOST}:${process.env.VITE_DEV_SERVER_PORT}${i.route}?winId=${i.id}`:`http://${process.env.VITE_DEV_SERVER_HOST}:${process.env.VITE_DEV_SERVER_PORT}?winId=${i.id}`,r.loadURL(l),r.once("ready-to-show",()=>{r.show()})}createTray(){const e=n.Menu.buildFromTemplate([{label:"\u6CE8\u9500",click:()=>{}},{type:"separator"},{label:"\u9000\u51FA",role:"quit"}]);this.tray=new n.Tray(u.resolve(__dirname,"favicon.ico")),this.tray.on("click",()=>{for(let i in this.group)this.group[i]&&this.getWindow(Number(i)).show()}),this.tray.on("right-click",()=>{var i;(i=this.tray)==null||i.popUpContextMenu(e)}),this.tray.setToolTip("\u5C0F\u732A\u8BFE\u5802")}listen(){n.ipcMain.on("pinUp",(e,i)=>{if(e.preventDefault(),i&&this.main.id==i){let t=this.getWindow(Number(this.main.id));t.isAlwaysOnTop()?t.setAlwaysOnTop(!1):t.setAlwaysOnTop(!0)}}),n.ipcMain.on("window-hide",(e,i)=>{if(i)this.getWindow(Number(i)).hide();else for(let t in this.group)this.group[t]&&this.getWindow(Number(t)).hide()}),n.ipcMain.on("window-show",(e,i)=>{if(i)this.getWindow(Number(i)).show();else for(let t in this.group)this.group[t]&&this.getWindow(Number(t)).show()}),n.ipcMain.on("mini",(e,i)=>{if(i)this.getWindow(Number(i)).minimize();else for(let t in this.group)this.group[t]&&this.getWindow(Number(t)).minimize()}),n.ipcMain.on("window-max",(e,i)=>{if(i)this.getWindow(Number(i)).maximize();else for(let t in this.group)this.group[t]&&this.getWindow(Number(t)).maximize()}),n.ipcMain.on("window-new",(e,i)=>this.createWindows(i))}}const c={}.ENV!=="production";async function d(){let o=new m;o.listen(),o.createWindows({isMainWin:!0}),o.createTray()}n.app.on("window-all-closed",()=>{process.platform!=="darwin"&&n.app.quit()});n.app.on("activate",()=>{n.BrowserWindow.getAllWindows().length===0&&d()});n.app.on("ready",async()=>{d()});c&&(process.platform==="win32"?process.on("message",o=>{o==="graceful-exit"&&n.app.quit()}):process.on("SIGTERM",()=>{n.app.quit()}));
